---
description: çµæ´»ã€ç»„ä»¶åŒ–ã€é«˜æ•ˆçš„UIåº“ã€‚
---

# React

## åŸºç¡€è¯­æ³•

### æŠ€æœ¯ç‰¹ç‚¹

**éæŠ€æœ¯æ–¹é¢**

- ç”±**facebook**æ¥ç»´æŠ¤å’Œæ›´æ–°ï¼Œå®ƒæ˜¯å¤§é‡ä¼˜ç§€ç¨‹åºå‘˜çš„**æ€æƒ³ç»“æ™¶**ï¼›
- **react hooks**æ˜¯**å¼€åˆ›æ€§**çš„æ–°åŠŸèƒ½ï¼›
- **vue composition api**å­¦ä¹ **react hooks**çš„æ€æƒ³ï¼›

**æŠ€æœ¯æ–¹é¢**

- **å£°æ˜å¼**---å®ƒå…è®¸åªéœ€è¦ç»´æŠ¤**è‡ªå·±çš„çŠ¶æ€**ï¼Œå½“çŠ¶æ€æ”¹å˜æ—¶ï¼ŒReact å¯ä»¥æ ¹æ®**æœ€æ–°çš„çŠ¶æ€**å»æ¸²æŸ“ UI ç•Œé¢
- **ç»„ä»¶åŒ–å¼€å‘**---å¤æ‚é¡µé¢æ‹†åˆ†æˆä¸€ä¸ªä¸ª**å°ç»„ä»¶**
- **è·¨å¹³å°**---Webã€ReactNativeï¼ˆæˆ– Flutterï¼‰ã€ReactVR

### ä¸‰ä¸ªå¼€å‘ä¾èµ–

react å¼€å‘å¿…é¡»éœ€è¦**3 ä¸ªåº“**ï¼š

- **react**---åŒ…å« react æ‰€å¿…é¡»çš„**æ ¸å¿ƒä»£ç **
- **react-dom**---react æ¸²æŸ“åœ¨**ä¸åŒå¹³å°**æ‰€éœ€è¦çš„æ ¸å¿ƒä»£ç 
- **babel**---å°†**jsx**è½¬æ¢æˆæµè§ˆå™¨è¯†åˆ«çš„ä»£ç çš„å·¥å…·

**ä¸ºä»€ä¹ˆéœ€è¦ react-dom è¿™ä¸ªåº“å‘¢ï¼Ÿ**

- web ç«¯ï¼šreact-dom ä¼šå°†**jsx**æœ€ç»ˆæ¸²æŸ“æˆ**çœŸå® DOM**ï¼Œæ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­
- native ç«¯ï¼šreact-dom ä¼šå°†**jsx**æœ€ç»ˆæ¸²æŸ“æˆ**åŸç”Ÿçš„æ§ä»¶**ï¼Œæ¯”å¦‚ android å’Œ ios çš„æŒ‰é’®

**babel å’Œ react çš„å…³ç³»**

- å¯ä»¥ä½¿ç”¨**React.createElement**æ¥ç¼–å†™ js ä»£ç ï¼Œä½†æ˜¯éå¸¸**ç¹ç**ï¼Œä¸”**å¯è¯»æ€§å·®**ï¼›
- è€Œ**jsx**ï¼ˆJavaScript XMLï¼‰çš„è¯­æ³•å¯ä»¥å…‹æœä»¥ä¸Šç¼ºç‚¹ï¼›
- ä½†æµè§ˆå™¨ä¸èƒ½è¯†åˆ«**jsx**è¿™ç§é«˜çº§è¯­æ³•ï¼Œéœ€è¦**babel**è¿›è¡Œè½¬æ¢æˆ**æ™®é€š js**ï¼›

### **hello æ¡ˆä¾‹**

```html
<div id="root"></div>
<script
  crossorigin
  src="https://unpkg.com/react@18/umd/react.development.js"
></script>
<script
  crossorigin
  src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
></script>
<!-- babel -->
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
```

```jsx
// scriptè¦å†™ä¸Štypeå±æ€§ï¼Œéœ€è¦è½¬åŒ–ä»£ç 
// React18ä»¥å‰
// ReactDOM.render(<h2>Hello World</h2>, document.querySelector('#root'))
// 18ä¹‹å
const root = ReactDOM.createRoot(document.querySelector('#root'))
// 1.æ–‡æœ¬å®šä¹‰æˆå˜é‡
let msg = 'Hello World'

// 2.ç›‘å¬æŒ‰é’®çš„ç‚¹å‡»
function btnClick() {
  // 2.1ä¿®æ”¹æ•°æ®
  msg = 'React'

  // 2.2é‡æ–°æ¸²æŸ“ç•Œé¢
  rootRender()
))
}
rootRender()
// 3.å°è£…ä¸€ä¸ªæ¸²æŸ“å‡½æ•°
function rootRender() {
  root.render((
    <div>
      <h2>{msg}</h2>
      <button onClick={btnClick}>ä¿®æ”¹æ–‡æœ¬</button>
    </div>
  ))
}
```

### jsx

jsx æ˜¯ä¸€ç§ JavaScript çš„**è¯­æ³•æ‹“å±•**ï¼ˆeXtensionï¼‰ï¼Œå¾ˆå¤šåœ°æ–¹ç§°ä¹‹ä¸º JavaScript XMLï¼Œå› ä¸ºçœ‹èµ·æ¥å°±æ˜¯ä¸€æ®µ XML è¯­æ³•ï¼›

å®ƒç”¨äº**æè¿° UI ç•Œé¢**ï¼Œå¹¶ä¸”å…¶å¯ä»¥å®Œæˆ**å’Œ JavaScript èåˆ**åœ¨ä¸€èµ·ä½¿ç”¨ï¼›

å®ƒ**ä¸åŒäº Vue ä¸­çš„æ¨¡æ¿è¯­æ³•**ï¼Œä¸éœ€è¦å­¦ä¹ æ¨¡æ¿è¯­æ³•ä¸­çš„ä¸€äº›æŒ‡ä»¤ï¼ˆæ¯”å¦‚ v-forã€v-ifã€v-elseã€v-bindï¼‰ï¼›

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      counter: 0,
    };
  }
  // æ–¹æ³•

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    const { counter } = this.state;
    const msg = <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>;
    return msg;
  }
}
// åˆ›å»ºrootå¹¶æ¸²æŸ“Appç»„ä»¶
const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

**ä¸ºä»€ä¹ˆ React é€‰æ‹© JSX è€Œä¸æ˜¯åƒ vue ä¸€æ ·æä¸€ä¸ªæ¨¡æ¿è¯­æ³•ï¼Ÿ**

react è®¤ä¸º**æ¸²æŸ“é€»è¾‘**æœ¬è´¨ä¸Šä¸**å…¶å®ƒ UI é€»è¾‘**å­˜åœ¨å†…åœ¨è€¦åˆï¼›

- æ¯”å¦‚**UI éœ€è¦ç»‘å®šäº‹ä»¶**ï¼›
- æ¯”å¦‚**UI ä¸­éœ€è¦å±•ç¤ºçŠ¶æ€**ï¼›
- æ¯”å¦‚åœ¨**æŸäº›çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œåˆéœ€è¦æ”¹å˜ UI**ï¼›

#### ä¹¦å†™è§„èŒƒ

- é¡¶å±‚åªèƒ½æœ‰**ä¸€ä¸ªæ ¹å…ƒç´ **ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™å¤–å±‚åŒ…è£¹ä¸€ä¸ª divï¼ˆæˆ–**Fragment**ï¼‰ï¼›
- ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œé€šå¸¸åœ¨æœ€å¤–å±‚åŒ…ä¸€ä¸ª**å°æ‹¬å·**ï¼›
- å•æ ‡ç­¾å¿…é¡»ä»¥/>ç»“å°¾ï¼›
- **æ³¨é‡Š**å†™æ³• `{ /* æ³¨é‡Š */ }`

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      counter: 0,
    };
  }
  // æ–¹æ³•

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    {
      /* æ³¨é‡Š */
    }
    const { counter } = this.state;
    const msg = <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>;
    return msg;
  }
}
// åˆ›å»ºrootå¹¶æ¸²æŸ“Appç»„ä»¶
const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

#### åµŒå…¥å†…å®¹

æ’å…¥**å˜é‡ä¸ºå­å…ƒç´ **æ—¶

- è‹¥æ˜¯**Numberã€Stringã€Array**ç±»å‹æ—¶ï¼Œå¯ä»¥ç›´æ¥æ˜¾ç¤ºï¼›
- è‹¥æ˜¯**nullã€undefinedã€Boolean**ç±»å‹æ—¶ï¼Œå†…å®¹ä¸ºç©ºï¼Œè¦æƒ³æ˜¾ç¤º**éœ€è¦è½¬æ¢**ä¸ºå­—ç¬¦ä¸²ï¼›
- **object å¯¹è±¡ç±»å‹**ä¸èƒ½ä½œä¸ºå­å…ƒç´ ï¼ˆnot valid as a react childï¼‰

æ’å…¥**è¡¨è¾¾å¼**æ—¶

ç±»ä¼¼æ’å€¼è¡¨è¾¾å¼

- è¿ç®—è¡¨è¾¾å¼
- ä¸‰å…ƒè¿ç®—ç¬¦
- æ‰§è¡Œä¸€ä¸ªå‡½æ•°

#### ç»‘å®šå±æ€§

- **class ç»‘å®š**å°½é‡ä½¿ç”¨**className**ï¼Œå› ä¸ºåœ¨ jsx ä¸­ class æ˜¯å…³é”®å­—ï¼ˆæœ‰è­¦å‘Šï¼‰ï¼›
- æœ‰**åŠ¨æ€ç±»**å¯ä»¥ä½¿ç”¨**å­—ç¬¦ä¸²æ‹¼æ¥**ã€**æ•°ç»„åŠ¨æ€æ·»åŠ **ã€ç¬¬ä¸‰æ–¹åº“**classnames**ç­‰ç­‰ï¼›
- ç»‘å®š style å±æ€§ï¼šç»‘å®š**å¯¹è±¡ç±»å‹**ï¼›

```jsx
constructor() {
  super()
  this.state = {
    title: 'hhh',
    isActive: true
  }
}
// æ–¹æ³•

// æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
render() {
  const { title, isActive } = this.state
  // 1.classç»‘å®šå†™æ³•ä¸€ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
  const className = `abc cba ${isActive ? 'active' : ''}`
  // 2.classç»‘å®šå†™æ³•äºŒï¼šå°†æ‰€æœ‰çš„classæ”¾æ•°ç»„ä¸­
  const classList = ['abc', 'cba']
  if(isActive) classList.push('active')

  return (
    <div>
      <h2 title={title} className={className}>123</h2>
      <h2 className={classList.join(' ')}>123</h2>
      <h2 style={{color: "red", fontSize: "30px"}}>ggg</h2>
    </div>
  )
}
```

#### äº‹ä»¶ç»‘å®š

**åŸç”Ÿ DOM æœ‰ä¸ªç›‘å¬äº‹ä»¶ï¼Œå¯ä»¥å¦‚ä½•æ“ä½œï¼Ÿ**

- è·å–èŠ‚ç‚¹ï¼Œæ·»åŠ ç›‘å¬äº‹ä»¶
- èŠ‚ç‚¹ä¸Šç»‘å®š onxxx

**åœ¨ React ä¸­æ˜¯å¦‚ä½•æ“ä½œçš„å‘¢ï¼Ÿ**

- äº‹ä»¶å‘½åé‡‡ç”¨**å°é©¼å³°**ï¼ˆcamelCaseï¼‰ï¼›
- é€šè¿‡**{}**ä¼ å…¥äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™å‡½æ•°ä¼šåœ¨äº‹ä»¶å‘ç”Ÿæ—¶è¢«æ‰§è¡Œï¼›

##### **this çš„ç»‘å®šé—®é¢˜**

- ä¸»åŠ¨ä¿®æ”¹ this æŒ‡å‘ï¼Œ**æ˜¾å¼ç»‘å®š**
- **es6 class yields**
- ç›´æ¥ä¼ å…¥**ç®­å¤´å‡½æ•°**

**æ–¹æ³•åœ¨å“ªé‡Œå®šä¹‰?**

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      msg: "hello",
    };
  }
  // ç»„ä»¶æ–¹æ³•
  btnClick() {
    console.log(this); // undefined
  }

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    return (
      <div>
        <h2>{this.state.msg}</h2>
        <button onClick={this.btnClick}>ä¿®æ”¹æ–‡æœ¬</button>
      </div>
    );
  }
}

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

`onClick={this.btnClick}`

ç­‰æ•ˆäº

```js
const click = this.btnClick;
click();
```

ç”±äº**ç±»**ä¸­ä»£ç ä¼šä½¿ç”¨**ä¸¥æ ¼æ¨¡å¼**ï¼Œ**ç‹¬ç«‹è°ƒç”¨**çš„å‡½æ•°ä¸­**this æŒ‡å‘ undefined**

**å¦‚ä½•å°† this æŒ‡å‘å½“å‰å¯¹è±¡å®ä¾‹ï¼Ÿ**æ˜¾å¼ç»‘å®š

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      msg: "hello",
    };
  }
  // ç»„ä»¶æ–¹æ³•
  btnClick() {
    console.log(this); // undefined
  }

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    return (
      <div>
        <h2>{this.state.msg}</h2>
        <button onClick={this.btnClick.bind(this)}>ä¿®æ”¹æ–‡æœ¬</button>
      </div>
    );
  }
}

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

render å‡½æ•°ä¸­çš„ this æŒ‡å‘çš„ä¾¿æ˜¯**å½“å‰å¯¹è±¡çš„å®ä¾‹**

`onClick={this.btnClick.bind(this)}`

ç­‰æ•ˆäº

```js
const click = this.btnClick.bind(this);
click();
```

ç»¼ä¸Šï¼Œ

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      msg: "hello",
    };
  }
  // ç»„ä»¶æ–¹æ³•
  btnClick() {
    this.setState({
      msg: "React",
    });
  }

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    return (
      <div>
        <h2>{this.state.msg}</h2>
        <button onClick={this.btnClick.bind(this)}>ä¿®æ”¹æ–‡æœ¬</button>
      </div>
    );
  }
}

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

è¿˜å¯ä»¥è¿™æ ·ä¿®æ”¹ thisï¼Œæå‰åœ¨**constructor**é‡Œä¿®æ”¹ this æŒ‡å‘ï¼Œè¿™æ ·ä½¿ç”¨æ—¶ä¼šæ–¹ä¾¿ä¸€ç‚¹ï¼Œä¸ç”¨æ¯æ¬¡éƒ½è¦å†™ bind

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      msg: "hello",
    };
    this.btnClick = this.btnClick.bind(this);
  }
  // ç»„ä»¶æ–¹æ³•
  btnClick() {
    this.setState({
      msg: "React",
    });
  }

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    return (
      <div>
        <h2>{this.state.msg}</h2>
        <button onClick={this.btnClick}>ä¿®æ”¹æ–‡æœ¬</button>
      </div>
    );
  }
}

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

**setState()æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿ**

ç»§æ‰¿è‡ª**React.Component**ï¼Œå…¶å†…éƒ¨å®Œæˆäº†ä¸¤ä»¶äº‹ï¼š

- å°†**state**ä¸­æŒ‡å®šçš„å€¼ä¿®æ”¹æ‰ï¼ˆè¿™é‡Œæ˜¯ msgï¼‰ï¼›
- è‡ªåŠ¨**é‡æ–°æ‰§è¡Œ render**å‡½æ•°ï¼›

**es6 class yields æ–¹å¼**

```jsx
// åˆ©ç”¨es6çš„class yieldsè¯­æ³•ï¼Œç±»ä¸­ä¹Ÿå¯ä»¥ç»™æˆå‘˜èµ‹å€¼
btnClick = () => {
  console.log(this) // å½“å‰å¯¹è±¡å®ä¾‹
}

// æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
render() {
  const { btnClick } = this
  return (
    <div>
      <button onClick={btnClick}></button>
    </div>
  )
}
```

**ç›´æ¥ä¼ å…¥ç®­å¤´å‡½æ•°**

- å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œä¼šè°ƒç”¨è¯¥ç®­å¤´å‡½æ•°ï¼›

- è€Œè¯¥ç®­å¤´å‡½æ•°é‡Œé¢åˆå¯ä»¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼›

```jsx
btnClick = () => {
  console.log(this) // å½“å‰å¯¹è±¡å®ä¾‹
}

// æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
render() {
  const { btnClick } = this
  return (
    <div>
      <button onClick={() => btnClick()}></button>
    </div>
  )
}
```

##### å‚æ•°ä¼ é€’é—®é¢˜

è™½ç„¶**bind**é‚£ç§æ–¹å¼ä¹Ÿå¯ä»¥ä¼ é€’å‚æ•°ï¼Œä½†æ˜¯ä¼šæœ‰**å‚æ•°é¡ºåº**çš„é—®é¢˜ï¼›

æ‰€ä»¥ä½¿ç”¨**ç®­å¤´å‡½æ•°**å¥½ä¸€ç‚¹ï¼›

```jsx
// åˆ©ç”¨es6çš„class yieldsè¯­æ³•ï¼Œç±»ä¸­ä¹Ÿå¯ä»¥ç»™æˆå‘˜èµ‹å€¼
btnClick = (event, name, age) => {
  console.log(event) // å½“å‰å¯¹è±¡å®ä¾‹
  console.log(name)
  console.log(age)
}

// æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
render() {
  const { btnClick } = this
  return (
    <div>
      <button onClick={(e) => btnClick(e, 'zsf', 18)}></button>
    </div>
  )
}
```

#### æ¡ä»¶æ¸²æŸ“

- æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆé€»è¾‘è¾ƒå¤šçš„æƒ…å†µï¼‰
- ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆç®€å•é€»è¾‘ï¼‰
- ä¸è¿ç®—ç¬¦&&ï¼ˆæ¡ä»¶æˆç«‹æ¸²æŸ“æŸä¸ªç»„ä»¶ï¼Œä¸æˆç«‹ä»€ä¹ˆä¹Ÿä¸æ¸²æŸ“ï¼‰

#### jsx è½¬åŒ– js æœ¬è´¨

æ¯é‡åˆ°ä¸€ä¸ªæ ‡ç­¾ï¼Œå°±ä¼šè°ƒç”¨**React.createElement(type, config, ...children)**

å‚æ•°**type**ï¼š

- è‹¥æ˜¯æ ‡ç­¾å…ƒç´ ï¼Œä½¿ç”¨**å­—ç¬¦ä¸²**ï¼Œå¦‚ **â€™divâ€˜**ï¼›
- è‹¥æ˜¯ç»„ä»¶å…ƒç´ ï¼Œä½¿ç”¨**ç»„ä»¶å**ï¼Œå¦‚ **login**ï¼›

å‚æ•°**config**ï¼š

- æ‰€æœ‰ jsx ä¸­çš„**å±æ€§**éƒ½åœ¨ config ä¸­ä»¥**é”®å€¼å¯¹**çš„å½¢å¼å­˜åœ¨ï¼Œæ¯”å¦‚**className å±æ€§**ï¼›

å‚æ•°**children**ï¼š

- å­˜æ”¾åœ¨å…ƒç´ ä¸­çš„å†…å®¹ï¼Œä»¥**children æ•°ç»„**çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼›

å¤åˆ¶ä¸€æ®µ jsx ä»£ç å» babel å®˜ç½‘è½¬åŒ–

jsx

```jsx
<div>
  <h2>{this.state.msg}</h2>
  <button onClick={this.btnClick}>ä¿®æ”¹æ–‡æœ¬</button>
</div>
```

js

```js
"use strict";

/*#__pure__*/ React.createElement(
  "div",
  null,
  /*#__pure__*/ React.createElement("h2", null, (void 0).state.msg),
  /*#__pure__*/ React.createElement(
    "button",
    { onClick: (void 0).btnClick },
    "\u4FEE\u6539\u6587\u672C"
  )
);
```

å…¶ä¸­

```
/*#__pure__*/
```

pure æ˜¯**â€œçº¯â€**çš„æ„æ€ï¼Œè¡¨ç¤ºåé¢çš„å‡½æ•°æ˜¯**çº¯å‡½æ•°**ï¼›

ç”±äºçº¯å‡½æ•°**æ²¡æœ‰å‰¯ä½œç”¨**ï¼ˆä¸ä¼šå½±å“å…¶å®ƒä½œç”¨åŸŸçš„å†…å®¹ï¼‰ï¼Œåœ¨ç”¨ä¸ä¸Šçš„æ—¶å€™ï¼Œ**tree shaking**æ—¶å¯ä»¥æ”¾å¿ƒæ‘‡æ‰ï¼›

#### è™šæ‹Ÿ DOM

é€šè¿‡ React.createElement æœ€ç»ˆåˆ›å»ºå‡ºæ¥ä¸€ä¸ª**ReactElement**å¯¹è±¡ï¼›

ä¸€ä¸ªä¸ª ReactElement å¯¹è±¡ç»„æˆ**JavaScript å¯¹è±¡æ ‘**ï¼›

è¿™ä¸ªå¯¹è±¡æ ‘å°±æ˜¯**è™šæ‹Ÿ DOM**ï¼›

**è™šæ‹Ÿ DOM æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ**

- å¯ä»¥å¿«é€Ÿè¿›è¡Œ**diff**ç®—æ³•ï¼Œæ›´æ–°èŠ‚ç‚¹ï¼›
- å®ƒåªæ˜¯ js å¯¹è±¡ï¼Œæ¸²æŸ“æˆä»€ä¹ˆçœŸå®èŠ‚ç‚¹ç”±**å¹³å°**å†³å®šï¼Œ**è·¨å¹³å°**ï¼›
- **å£°æ˜å¼**ç¼–ç¨‹ï¼Œä½ åªéœ€è¦å‘Šè¯‰ React å¸Œæœ› UI æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œä¸éœ€è¦ç›´æ¥è¿›è¡Œ DOM æ“ä½œï¼Œä»æ‰‹åŠ¨ä¿®æ”¹ DOMã€å±æ€§æ“ä½œã€äº‹ä»¶å¤„ç†ä¸­è§£æ”¾å‡ºæ¥

#### åè°ƒ

å¯ä»¥é€šè¿‡**ReactDOM.render**è®©è™šæ‹Ÿ DOM å’ŒçœŸå® DOM çš„åŒæ­¥èµ·æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å«**åè°ƒ**ï¼›

### åˆ—è¡¨æ¡ˆä¾‹

```jsx
// ç»„ä»¶æ•°æ®
constructor() {
  super()
  this.state = {
    list: [1, 2, 3, 4],
    currentIndex: 0
  }
}
//
btnClick = (index) => {
  this.setState({
    currentIndex: index
  })
}

// æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
render() {
  const { list, currentIndex } = this.state
  const { btnClick } = this

  return (
    <div>
      <ul>
        {
          list.map((item, index) => {
            return (
             <li
               className={currentIndex === index ? 'active' : ''}
               key={item}
               onClick={() => btnClick(index)}
             >
             {item}
             </li>
            )
          })
        }
      </ul>
    </div>
  )
}
```

### è®¡æ•°å™¨æ¡ˆä¾‹

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      counter: 0,
    };

    this.increment = this.increment.bind(this);
    this.decrement = this.decrement.bind(this);
  }
  // æ–¹æ³•
  increment() {
    this.setState({
      counter: this.state.counter + 1,
    });
  }
  decrement() {
    this.setState({
      counter: this.state.counter - 1,
    });
  }

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    const { counter } = this.state;
    const { increment, decrement } = this;
    return (
      <div>
        <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
        <button onClick={increment}>+</button>
        <button onClick={decrement}>-</button>
      </div>
    );
  }
}

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

### è´­ç‰©è½¦æ¡ˆä¾‹

**æ•°æ®æº**

```js
const books = [
  {
    id: 1,
    name: "ã€Šç®—æ³•å¯¼è®ºã€‹",
    date: "2006-9",
    price: 85.0,
    count: 1,
  },
  {
    id: 2,
    name: "ã€ŠUNIXç¼–ç¨‹è‰ºæœ¯ã€‹",
    date: "2006-2",
    price: 59.0,
    count: 1,
  },
  {
    id: 3,
    name: "ã€Šç¼–ç¨‹ç ç‘ã€‹",
    date: "2008-10",
    price: 39.0,
    count: 1,
  },
  {
    id: 4,
    name: "ã€Šä»£ç å¤§å…¨ã€‹",
    date: "2006-3",
    price: 128.0,
    count: 1,
  },
];
```

**ç»„ä»¶æ•°æ®**

```jsx
// ç»„ä»¶æ•°æ®
constructor() {
  super()
  this.state = {
    books: books
  }
}
```

**ç»„ä»¶æ–¹æ³•**

```jsx
// æ€»ä»·
getTotalPrice() {
  return this.state.books.reduce((preValue, item) => preValue + item.count * item.price, 0)
}
// å¢åŠ /å‡å°‘
changeCount(index, count) {
  // reactä¸æ¨èç›´æ¥ä¿®æ”¹stateä¸­çš„æ•°æ®ï¼Œæ¨èåšæ³•æ˜¯æµ…æ‹·è´
  const newBooks = [...this.state.books]
  newBooks[index].count += count
  // ä¿®æ”¹stateï¼Œé‡æ–°æ‰§è¡Œrenderå‡½æ•°
  this.setState({ books: newBooks })
}
// åˆ é™¤ä¸€æ¡æ•°æ®
removeItem(index) {
  const newBooks = [...this.state.books]
  newBooks.splice(index, 1)
  // ä¿®æ”¹stateï¼Œé‡æ–°æ‰§è¡Œrenderå‡½æ•°
  this.setState({ books: newBooks })
}
```

**æ¸²æŸ“å‡½æ•°**

```jsx
// æœ‰ä¹¦æ—¶çš„æ¸²æŸ“å†…å®¹
renderBookList() {
  const { books } = this.state
  return (
    <div>
      <table>
        <thead>
          <tr>
            <th>åºå·</th>
            <th>ä¹¦ç±åç§°</th>
            <th>å‡ºç‰ˆæ—¥æœŸ</th>
            <th>ä»·æ ¼</th>
            <th>è´­ä¹°æ•°é‡</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {
            books.map((item, index) => {
              return (
                <tr key={index}>
                  <td>{index + 1}</td>
                  <td>{item.name}</td>
                  <td>{item.date}</td>
                  <td>{'ï¿¥' + item.price.toFixed(2)}</td>
                  <td>
                    <button
                      disabled={item.count <= 1}
                      onClick={() => this.changeCount(index, -1)}
                    >
                    -
                    </button>
                    {item.count}
                    <button onClick={() => this.changeCount(index, 1)}>+</button>
                  </td>
                  <td>
                    <button onClick={() => this.removeItem(index)}>åˆ é™¤</button>
                  </td>
                </tr>
              )
            })
          }
        </tbody>
      </table>
      <h2>æ€»ä»·æ ¼ï¼š{'ï¿¥' + this.getTotalPrice().toFixed(2)}</h2>
    </div>
  )
}
// æ— ä¹¦æ—¶çš„æ¸²æŸ“å†…å®¹
renderBookEmpty() {
  return <div><h2>è´­ç‰©è½¦ä¸ºç©ºï¼Œè¯·æ·»åŠ ä¹¦ç±</h2></div>
}
// æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
render() {
  const { books } = this.state
  return books.length ? this.renderBookList() : this.renderBookEmpty()
}
```

## ç»„ä»¶åŒ–å¼€å‘

æ ¹æ®**å®šä¹‰æ–¹å¼**ï¼Œå¯åˆ†ä¸º

- å‡½æ•°ç»„ä»¶
- ç±»ç»„ä»¶

æ ¹æ®å†…éƒ¨**æ˜¯å¦æœ‰çŠ¶æ€éœ€è¦ç»´æŠ¤**ï¼Œå¯åˆ†ä¸º

- æ— çŠ¶æ€ç»„ä»¶
- æœ‰çŠ¶æ€ç»„ä»¶

æ ¹æ®**èŒè´£**ï¼Œå¯åˆ†ä¸º

- å±•ç¤ºå‹ç»„ä»¶
- å®¹å™¨å‹ç»„ä»¶

### ç±»ç»„ä»¶

1. å®šä¹‰ä¸€ä¸ª**ç±»**ï¼ˆç±»å**å¤§å†™**ï¼Œç»„ä»¶åç§°å¿…é¡»æ˜¯å¤§å†™ï¼Œå°å†™ä¼šè¢«è®¤ä¸ºæ˜¯ html å…ƒç´ ï¼‰ï¼Œ**ç»§æ‰¿è‡ª React.Component**;
2. **constructor**å¯é€‰ï¼Œé€šå¸¸åˆå§‹åŒ–ä¸€äº›æ•°æ®ï¼›
3. **this.state**ä¸­ç»´æŠ¤ç»„ä»¶å†…éƒ¨æ•°æ®ï¼›
4. class ä¸­å¿…é¡»å®ç°**render æ–¹æ³•**ï¼ˆrender å½“ä¸­è¿”å›çš„**jsx å†…å®¹**ï¼Œå°±æ˜¯ä¹‹å React ä¼šå¸®åŠ©æˆ‘ä»¬æ¸²æŸ“çš„å†…å®¹ï¼‰ï¼›

#### render å‡½æ•°çš„è¿”å›å€¼

- **react**å…ƒç´ ï¼ˆé€šè¿‡ jsx å†™çš„ä»£ç ï¼Œç»„ä»¶ä¹Ÿç®— react å…ƒç´ ï¼‰
- **æ•°ç»„ **ï¼ˆä¼šéå†æ•°ç»„å…ƒç´ å¹¶æ˜¾ç¤ºï¼‰æˆ– **fragments**
- **portals**ï¼šå¯ä»¥æ¸²æŸ“å­èŠ‚ç‚¹åˆ°ä¸åŒçš„ DOM å­æ ‘ä¸­
- **å­—ç¬¦ä¸²**æˆ–**æ•°å€¼ç±»å‹**ï¼Œåœ¨ DOM ä¸­ä¼šè¢«æ¸²æŸ“ä¸ºæ–‡æœ¬èŠ‚ç‚¹
- **å¸ƒå°”ç±»å‹**æˆ–**null**ï¼šä»€ä¹ˆéƒ½ä¸æ¸²æŸ“

#### æ•°æ®

ç»„ä»¶ä¸­çš„æ•°æ®ï¼Œå¯ä»¥åˆ†æˆ 2 ç±»ï¼š

- **å‚ä¸**ç•Œé¢æ›´æ–°çš„æ•°æ®ï¼šå½“**æ•°æ®å˜åŒ–**æ—¶ï¼Œéœ€è¦**æ›´æ–°**ç»„ä»¶æ¸²æŸ“çš„å†…å®¹
- **ä¸å‚ä¸**ç•Œé¢æ›´æ–°çš„æ•°æ®ï¼šåä¹‹

å‚ä¸ç•Œé¢æ›´æ–°çš„æ•°æ®ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º**å‚ä¸æ•°æ®æµ**ï¼Œè¿™äº›æ•°æ®å®šä¹‰åœ¨**å½“å‰å¯¹è±¡çš„ state**ä¸­ï¼›

å¯ä»¥é€šè¿‡åœ¨**æ„é€ å‡½æ•°**ä¸­**this.state** = `{æ•°æ®}`ï¼›

å½“**æ•°æ®å‘ç”Ÿå˜åŒ–**æ—¶ï¼Œå¯ä»¥è°ƒç”¨**this.setState**æ¥æ›´æ–°æ•°æ®ï¼Œå¹¶ä¸”é€šçŸ¥ React è¿›è¡Œ update æ“ä½œï¼›

update æ“ä½œæ—¶ï¼Œå°±ä¼š**é‡æ–°è°ƒç”¨ render å‡½æ•°**ï¼Œå¹¶ä½¿ç”¨**æœ€æ–°çš„æ•°æ®**ï¼Œæ¥æ¸²æŸ“ç•Œé¢ï¼›

```jsx
class App extends React.Component {
  // ç»„ä»¶æ•°æ®
  constructor() {
    super();
    this.state = {
      msg: "hello",
    };
  }
  // ç»„ä»¶æ–¹æ³•

  // æ¸²æŸ“å†…å®¹ renderæ–¹æ³•
  render() {
    return (
      <div>
        <h2>{this.state.msg}</h2>
        <button>ä¿®æ”¹æ–‡æœ¬</button>
      </div>
    );
  }
}

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(<App />);
```

### å‡½æ•°å¼ç»„ä»¶

è¿”å›å€¼å’Œ**ç±»ç»„ä»¶ render å‡½æ•°**è¿”å›å€¼ä¸€æ ·

#### ç‰¹ç‚¹ï¼ˆhooks å‡ºç°ä¹‹å‰ï¼‰

- æ— ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿ**ä¼šè¢«æ›´æ–°å¹¶æŒ‚è½½**ï¼Œä½†æ˜¯**æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°**ï¼›
- this**ä¸èƒ½æŒ‡å‘ç»„ä»¶å®ä¾‹**ï¼Œå› ä¸ºæ²¡æœ‰ç»„ä»¶å®ä¾‹ï¼›
- **æ²¡æœ‰å†…éƒ¨çŠ¶æ€**ï¼›

```jsx
function App() {
  return <h2>123</h2>;
}
```

#### æ³¨æ„

> ä¸è¦åœ¨å‡½æ•°ç»„ä»¶å†…å®šä¹‰å­ç»„ä»¶ï¼

```jsx
export default function Gallery() {
  // ğŸ”´ Never define a component inside another component!
  function Profile() {
    // ...
  }
  // ...
}
```

ç±»ä¼¼è¿™æ ·ï¼Œ**ä¼šéå¸¸æ…¢å’Œå¯¼è‡´ bugï¼**

å¯ä»¥å°†å­ç»„ä»¶åœ¨æ–‡ä»¶é¡¶å±‚å®šä¹‰ï¼š

```jsx
export default function Gallery() {
  // ...
}

// âœ… Declare components at the top level
function Profile() {
  // ...
}
```

### ç”Ÿå‘½å‘¨æœŸ

ä»**åˆ›å»ºåˆ°é”€æ¯**çš„è¿‡ç¨‹ï¼Œå«ç”Ÿå‘½å‘¨æœŸï¼›

- è£…è½½é˜¶æ®µï¼ˆMountï¼‰ï¼Œç»„ä»¶**ç¬¬ä¸€æ¬¡åœ¨ DOM æ ‘è¢«æ¸²æŸ“**çš„è¿‡ç¨‹ï¼›
- æ›´æ–°è¿‡ç¨‹ï¼ˆUpdateï¼‰ï¼Œ**ç»„ä»¶çŠ¶æ€**æˆ–**props**å‘ç”Ÿæ”¹å˜ï¼Œé‡æ–°æ›´æ–°æ¸²æŸ“çš„è¿‡ç¨‹ï¼›
- å¸è½½é˜¶æ®µï¼ˆUnmountï¼‰ï¼Œç»„ä»¶**ä» DOM æ ‘ä¸­è¢«ç§»é™¤**çš„è¿‡ç¨‹ï¼›

**ç”Ÿå‘½å‘¨æœŸå‡½æ•°**

React å†…éƒ¨ä¸ºäº†å‘Šè¯‰æˆ‘ä»¬**å½“å‰å¤„äºå“ªäº›é˜¶æ®µ**ï¼Œä¼šå¯¹ç»„ä»¶å†…éƒ¨å®ç°**æŸäº›å‡½æ•°è¿›è¡Œå›è°ƒ**ï¼Œè¿™äº›å‡½æ•°ä¾¿æ˜¯ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š

- æ¯”å¦‚å®ç°**componentDidMount**å‡½æ•°ï¼Œç»„ä»¶å·²ç»**æŒ‚è½½åˆ° DOM ä¸Š**æ—¶ï¼Œå°±ä¼šå›è°ƒï¼›
- æ¯”å¦‚å®ç°**componentDidUpdate**å‡½æ•°ï¼Œç»„ä»¶å·²ç»**å‘ç”Ÿäº†æ›´æ–°**æ—¶ï¼Œå°±ä¼šå›è°ƒï¼›
- æ¯”å¦‚å®ç°**componentWillUnmount**å‡½æ•°ï¼Œç»„ä»¶**å³å°†è¢«ç§»é™¤**æ—¶ï¼Œå°±ä¼šå›è°ƒï¼›

è°ˆåŠ React çš„ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œä¸»è¦æ˜¯**ç±»çš„ç”Ÿå‘½å‘¨æœŸ**ï¼ˆ**å‡½æ•°å¼ç»„ä»¶**æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œä¸è¿‡å¯ä»¥é€šè¿‡**hooks**æ¥æ¨¡æ‹Ÿä¸€äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„å›è°ƒï¼‰

#### æ‰§è¡Œé¡ºåº

**mount**é˜¶æ®µï¼š

- æ‰§è¡Œç±»çš„**constructor**æ–¹æ³•ï¼›
- æ‰§è¡Œ**render**æ–¹æ³•ï¼›
- React æ›´æ–°**DOM**å’Œ**Refs**ï¼›
- æ‰§è¡Œ**componentDidMount**æ–¹æ³•

**update**é˜¶æ®µï¼š

- æ‰§è¡Œ**setState**æ–¹æ³•ï¼›
- æ‰§è¡Œ**render**æ–¹æ³•ï¼›
- React æ›´æ–°**DOM**å’Œ**Refs**ï¼›
- æ‰§è¡Œ**componentDidUpdate**æ–¹æ³•ï¼›

**unMount**é˜¶æ®µï¼š

- å½“ç»„ä»¶è¢«å¸è½½ï¼Œä¼šæ‰§è¡Œ**componentWillUnmount**æ–¹æ³•

#### æ“ä½œå»ºè®®

##### **constructor**

è‹¥**ä¸åˆå§‹åŒ– state**æˆ–**ä¸è¿›è¡Œæ–¹æ³•ç»‘å®š**ï¼Œåˆ™ä¸éœ€è¦ React ç»„ä»¶å®ç°æ„é€ å‡½æ•°ï¼›

é€šå¸¸åªåšä¸¤ä»¶äº‹ï¼š

- åˆå§‹åŒ– stateï¼›
- ä¸ºäº‹ä»¶ç»‘å®š thisï¼›

##### componentDidMount

- ä¾èµ–äº DOM çš„æ“ä½œ
- å‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå®˜æ–¹å»ºè®®ï¼‰
- æ·»åŠ ä¸€äº›è®¢é˜…ï¼ˆä¼šåœ¨ componentWillUnmount å–æ¶ˆè®¢é˜…ï¼‰

##### componentDidUpdate

- è‹¥å¯¹æ›´æ–°å‰åçš„**props**è¿›è¡Œäº†æ¯”è¾ƒï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤å¤„è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼ˆä¾‹å¦‚å½“ props æœªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸å‘é€ç½‘ç»œè¯·æ±‚ï¼‰

##### componentWillUnmount

- æ¸…é™¤ã€å–æ¶ˆæ“ä½œ

#### ä¸å¸¸ç”¨ç”Ÿå‘½å‘¨æœŸ

**shouldComponentUpdate**

å½“è¯¥å‡½æ•°è¿”å›**false**æ—¶ï¼Œåˆ™**ä¸ä¼šé‡æ–°æ‰§è¡Œ render**å‡½æ•°ï¼Œåä¹‹åˆ™ä¼šï¼›

**getSnapshotBeforeUpdate**

åœ¨ React æ›´æ–° DOM ä¹‹å‰å›è°ƒçš„ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥è·å–**DOM æ›´æ–°å‰**çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æ»šåŠ¨ä½ç½®ï¼›

### ç»„ä»¶é€šä¿¡

#### çˆ¶ä¼ å­

- çˆ¶ç»„ä»¶é€šè¿‡**å±æ€§=å€¼**çš„å½¢å¼æ¥ä¼ é€’ç»™å­ç»„ä»¶ï¼›
- å­ç»„ä»¶é€šè¿‡**props å‚æ•°**è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼›

**çˆ¶ç»„ä»¶**

```jsx
import React, { Component } from "react";
import Header from "./Header";

class Main extends Component {
  constructor() {
    super();
    this.state = {
      list: [1, 2, 3],
    };
  }
  render() {
    const { list } = this.state;
    return <Header list={list} />;
  }
}
```

**å­ç»„ä»¶**

```jsx
import React, { Component } from "react";

class Header extends Component {
  constructor(props) {
    super(props);
    this.state = {};
  }

  render() {
    const { list } = this.props;
    return (
      <ul>
        {list.map((item) => {
          return <li key={item}>{item}</li>;
        })}
      </ul>
    );
  }
}
```

å½“ constructor æ¥æ”¶çš„å‚æ•° props ä¼ é€’ç»™ super æ—¶ï¼Œå†…éƒ¨**å°† props ä¿å­˜åœ¨å½“å‰å®ä¾‹**ä¸­ï¼Œç±»ä¼¼è¿›è¡Œäº† `this.props = props`

constructor**ä¹Ÿå¯ä»¥çœç•¥**ï¼Œå†…éƒ¨é»˜è®¤è¿›è¡Œä¿å­˜ props æ“ä½œï¼›

#### props ç±»å‹é™åˆ¶

å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œä¼ é€’çš„æ•°æ®åº”è¯¥è¿›è¡Œ**ç±»å‹æ£€æŸ¥**ï¼ˆé˜²æ­¢â€å­—ç¬¦ä¸²è°ƒç”¨ mapâ€œè¿™ç§é”™è¯¯ï¼‰

- Flow
- TypeScript
- prop-types åº“

ä» React15.5 å¼€å§‹ï¼ŒReact.PropTypes å·²ç§»å…¥å¦ä¸€ä¸ªåŒ…ä¸­ï¼šprop-types åº“

```jsx
import React, { Component } from "react";
import PropsTypes from "prop-types";

class Header extends Component {
  constructor(props) {
    super(props);
    this.state = {};
  }

  render() {
    const { list } = this.props;
    return (
      <ul>
        {list.map((item) => {
          return <li key={item}>{item}</li>;
        })}
      </ul>
    );
  }
}

Header.propsTypes = {
  list: PropsTypes.array.isRequired,
};
```

é€šè¿‡ç»„ä»¶å®ä¾‹çš„**propsTypes å±æ€§**ï¼Œè®¾ç½®äº† list æ˜¯**æ•°ç»„ç±»å‹**ä¸”æ˜¯**å¿…ä¼ **çš„ props

è‹¥éå¿…ä¼ ï¼Œå¯ä»¥æ˜¯è®¾ç½®**é»˜è®¤å€¼**ï¼ˆå¯ä»¥é¿å… undefined é—®é¢˜ï¼‰

```js
Header.propsTypes = {
  list: PropsTypes.array.isRequired,
};
Header.defaultProps = {
  list: [],
};
```

å¯ä»¥é™åˆ¶çš„ç±»å‹æœ‰

- array
- bool
- func
- number
- object
- string
- symbol
- node
- **element**

#### å­ä¼ çˆ¶

**å­ç»„ä»¶å¦‚ä½•å‘çˆ¶ç»„ä»¶ä¼ é€’æ¶ˆæ¯ï¼Ÿ**

- åœ¨ vue ä¸­æ˜¯é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶æ¥å®Œæˆï¼›
- åœ¨ react ä¸­åŒæ ·é€šè¿‡**props**ä¼ é€’æ¶ˆæ¯ï¼Œåªæ˜¯è®©çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’ä¸€ä¸ª**å›è°ƒå‡½æ•°**ï¼Œåœ¨å­ç»„ä»¶ä¸­**è°ƒç”¨**è¿™å›è°ƒå‡½æ•°ï¼›

**çˆ¶ç»„ä»¶ main.jsx**

```jsx
import React, { Component } from "react";
import Header from "./Header";

class Main extends Component {
  constructor() {
    super();
    this.state = {
      counter: 100,
    };
  }

  changeCount(count) {
    this.setState({
      counter: this.state.counter + count,
    });
  }

  render() {
    const { counter } = this.state;
    return (
      <div>
        <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
        <Header addClick={(count) => this.changeCount(count)} />
      </div>
    );
  }
}
```

**å­ç»„ä»¶ header.jsx**

```jsx
import React, { Component } from "react";

class Header extends Component {
  add(count) {
    this.props.addClick(count);
  }
  render() {
    const { add } = this;
    return (
      <div>
        <button onClick={(e) => add(1)}>+1</button>
      </div>
    );
  }
}
```

å½“å­ç»„ä»¶çš„æŒ‰é’®ç‚¹å‡»ä¹‹åï¼Œä¼šè°ƒç”¨**çˆ¶ç»„ä»¶**ä¼ è¿‡æ¥çš„**props ä¸­çš„ addClick()**;

ä»è€Œé€šçŸ¥çˆ¶ç»„ä»¶å»è°ƒç”¨**changeCount()**,å»ä¿®æ”¹**çˆ¶ç»„ä»¶çš„æ•°æ®**ï¼›

#### æ¡ˆä¾‹

**çˆ¶ç»„ä»¶ App.jsx**

```jsx
import React from "react";
import TabControl from "./TabControl";
class App extends React.Component {
  constructor() {
    super();
    this.state = {
      titles: ["æµè¡Œ", "æ–°å“", "ç²¾é€‰"],
      tabIndex: 0,
    };
  }
  changeTab(index) {
    this.setState({
      tabIndex: index,
    });
  }

  render() {
    const { titles, tabIndex } = this.state;
    return (
      <div>
        <TabControl
          titles={titles}
          tabClick={(index) => this.changeTab(index)}
        />
        <h1>{titles[tabIndex]}</h1>
      </div>
    );
  }
}
```

**å­ç»„ä»¶ TabControl.jsx**

```jsx
import React, { Component } from "react";
import "./style.css";

class TabControl extends Component {
  constructor(props) {
    super(props);

    this.state = {
      currentIndex: 0,
    };
  }
  itemClick(index) {
    this.setState({
      currentIndex: index,
    });
    this.props.tabClick(index);
  }

  render() {
    const { titles } = this.props;
    const { currentIndex } = this.state;

    return (
      <div className="tab-control">
        {titles.map((item, index) => {
          return (
            <div
              className={`item ${index === currentIndex ? "active" : ""}`}
              key={item}
              onClick={() => this.itemClick(index)}
            >
              <span className="text">{item}</span>
            </div>
          );
        })}
      </div>
    );
  }
}
```

**style.css**

```css
.tab-control {
  display: flex;
  height: 40px;
  text-align: center;
}

.tab-control .item {
  flex: 1;
}

.tab-control .item.active {
  color: red;
}

.tab-control .item.active .text {
  padding: 3px;
  border-bottom: 3px solid red;
}
```

#### éçˆ¶å­

å¦‚æœä¸¤ç»„ä»¶ä¼ é€’æ•°æ®è·¨å±‚çº§æ¯”è¾ƒå¤šï¼Œä¸€å±‚å±‚ä¼ é€’éå¸¸éº»çƒ¦ï¼›

react æä¾›äº†ä¸€ä¸ª APIï¼š**Context**ï¼›

Context æä¾›äº†ä¸€ç§**ç»„ä»¶é—´å…±äº«æŸäº›æ•°æ®**çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚å½“å‰è®¤è¯å¾—ç”¨æˆ·ã€ä¸»é¢˜æˆ–é¦–é€‰è¯­è¨€ï¼›

##### context çš„åŸºæœ¬ä½¿ç”¨

React.createContext å‚æ•°æœ‰ä¸ª**defaultValue**ï¼Œå¦‚æœ**ä¸æ˜¯åä»£ç»„ä»¶**å…³ç³»ï¼ˆå…„å¼Ÿç»„ä»¶ï¼‰ï¼Œå¯ä»¥ä» defaultValue å–åˆ°å…±äº«çš„æ•°æ®

1. ä½¿ç”¨**React.createContext**åˆ›å»ºå‡º contextï¼ˆæ¯ä¸ª context å¯¹è±¡éƒ½ä¼šè¿”å›ä¸€ä¸ª Provider ç»„ä»¶ï¼Œå®ƒå…è®¸**æ¶ˆè´¹ç»„ä»¶è®¢é˜…**context çš„å˜åŒ–ï¼‰ï¼›
2. é€šè¿‡**context çš„ Provider ä¸­çš„ value**å±æ€§ä¸º**åä»£**æä¾›å¸Œæœ›å…±äº«çš„æ•°æ®ï¼›
3. åä»£è®¾ç½®**contextType**ä¸ºæŒ‡å®š contextï¼ˆå¯ä»¥å¤šä¸ª contextï¼‰ï¼›
4. ç„¶åå¯ä»¥è·å–åˆ°é‚£äº›æ•°æ®äº†ï¼›

**context.js**

```js
import React from "react";
const ThemeContext = React.createContext();
export default ThemeContext;
```

**App.jsx**

```jsx
import React from "react";
import Home from "./Home";
import ThemeContext from "./context";

class App extends React.Component {
  render() {
    return (
      <div>
        <h2>App</h2>
        <ThemeContext.Provider value={{ color: "red", size: "30" }}>
          <Home></Home>
        </ThemeContext.Provider>
      </div>
    );
  }
}
```

**Home.jsx**

```jsx
import React, { Component } from "react";
import HomeInfo from "./HomeInfo";

class Home extends Component {
  render() {
    return (
      <div>
        <h2>Home</h2>
        <HomeInfo></HomeInfo>
      </div>
    );
  }
}
```

**HomeInfo.jsx**

```jsx
import React, { Component } from "react";
import ThemeContext from "./context";

class HomeInfo extends Component {
  render() {
    const { color } = this.context;
    return (
      <div>
        <h2>HomeInfo:{color}</h2>
      </div>
    );
  }
}
HomeInfo.contextType = ThemeContext;
```

##### å‡½æ•°å¼ç»„ä»¶å…±äº« context

åœ¨ç±»ç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨**this**æ‹¿åˆ° contextï¼›

**è€Œå‡½æ•°å¼ç»„ä»¶ä¸­ this æ‹¿ä¸åˆ°ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ**

**context.Consumer**ä¹Ÿå¯ä»¥è®¢é˜…åˆ° context çš„å˜æ›´ï¼ˆå½“ç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨**å¤šä¸ª context**ä¹Ÿå¯ä»¥ä½¿ç”¨ Consumerï¼‰ï¼›

éœ€è¦ä¸€ä¸ª**å‡½æ•°**ä½œä¸º**å­å…ƒç´ **ï¼Œé€šè¿‡è¯¥å‡½æ•°çš„**å‚æ•° value**ä¼ é€’å½“å‰çš„ contextï¼›

```jsx
import ThemeContext from "./context";
function HomeBannar() {
  return (
    <div>
      <h2>HomeBannar</h2>
      <ThemeContext.Consumer>
        {(value) => {
          return <h2>{value.color}</h2>;
        }}
      </ThemeContext.Consumer>
    </div>
  );
}
```

##### äº‹ä»¶æ€»çº¿ EventBus

context å®ç°è·¨ç»„ä»¶ä¼ é€’æ•°æ®åªèƒ½ä»æ ¹å¼€å§‹ï¼Œè¦æ˜¯éœ€è¦**å…„å¼Ÿç»„ä»¶ä¹‹é—´ä¼ é€’å‘¢**ï¼Ÿäº‹ä»¶æ€»çº¿

å…ˆå®‰è£…ç›¸å…³çš„åº“ï¼Œæ¯”å¦‚ event-bus

**event-bus.js**

```js
import { HYEventBus } from "hy-event-store";

const eventBus = new HYEventBus();

export default eventBus;
```

ç„¶åå‘å°„äº‹ä»¶

```jsx
import eventBus from './event-bus'

...
preClick() {
  eventBus.emit('bannerPrev', 10)
}

render() {
  return (
    <div>
      <h2>HomeBanner</h2>
      <button onClick={e => this.preClick()}>ä¸Šä¸€ä¸ª</button>

    </div>
  )
}
```

åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåï¼Œå¯ä»¥ç›‘å¬äº‹ä»¶

```jsx
import eventBus from './event-bus'

...
componentDidMount() {
  eventBus.on('bannerPrev', (val) => {
    console.log(val)
  })
}
```

åœ¨ç»„ä»¶é”€æ¯åï¼Œè¦ç§»é™¤äº‹ä»¶ç›‘å¬ï¼›

æ–¹ä¾¿åœ¨**eventBus.off()**ä¼ é€’å‡½æ•°ï¼Œåœ¨**eventBus.on()**ä¼ é€’çš„å‡½æ•°åº”è¯¥æŠ½ç¦»æˆ**å•ç‹¬çš„å‡½æ•°**ï¼›

```jsx
import eventBus from "./event-bus"

...
componentDidMount() {
  eventBus.on('bannerPrev', this.bannerPrevClick)
}

bannerPrevClick(val) {
  console.log(val)
}

componentWillUnmount() {
  eventBus.off('bannerPrev', this.bannerPrevClick)
}
```

ç„¶è€Œè¿˜æœ‰ä¸ªé—®é¢˜ï¼š**bannerPrevClick**åœ¨è¿è¡Œæ—¶æ‰¾ä¸åˆ° thisï¼ˆå½“å‰ç»„ä»¶å®ä¾‹ï¼‰ï¼Œè¿™æ ·å°±æ— æ³•è°ƒç”¨ setState()

å¯ä»¥å°†**bannerPrevClick**å®šä¹‰æˆç®­å¤´å‡½æ•°ï¼Œæˆ–è€…æ˜¾ç¤ºç»‘å®š

```jsx
import eventBus from "./event-bus"

...
componentDidMount() {
  eventBus.on('bannerPrev', this.bannerPrevClick)
}

bannerPrevClick = (val) => {
  console.log(val)
}

componentWillUnmount() {
  eventBus.off('bannerPrev', this.bannerPrevClick)
}
```

æˆ–

```jsx
import eventBus from "./event-bus"

...
componentDidMount() {
  eventBus.on('bannerPrev', this.bannerPrevClick)
}

bannerPrevClick(val) {
  console.log(val)
}

componentWillUnmount () {
  eventBus.off('bannerPrev', this.bannerPrevClick)
}
```

### å®ç°æ’æ§½æ–¹æ¡ˆ

react ä¸­æœ‰ä¸¤ç§å®ç°æ’æ§½çš„æ–¹å¼ï¼š

- ç»„ä»¶çš„**children**å­å…ƒç´ ï¼›
- props å±æ€§ä¼ é€’**React**å…ƒç´ ï¼›

#### props çš„**children å±æ€§**

- props ä¸­æœ‰ä¸€ä¸ª**children**å±æ€§ï¼Œæ˜¯ä¸ª**æ•°ç»„**ï¼Œå­˜æ”¾ç€å¤šä¸ªå­å…ƒç´ ï¼›
- è‹¥åªæœ‰ä¸€ä¸ªå­å…ƒç´ ï¼Œåˆ™ children ä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯è¯¥å­å…ƒç´ æœ¬èº«ï¼ˆç¼ºç‚¹ï¼‰ï¼›

**çˆ¶å…ƒç´ **

```jsx
class App extends Component {
  render() {
    return (
      <div>
        <NavBar>
          <button>æŒ‰é’®</button>
          <h2>æ ‡é¢˜</h2>
          <i>æ–œä½“æ–‡å­—</i>
        </NavBar>
      </div>
    );
  }
}
```

**å­å…ƒç´ **

```jsx
class NavBar extends Component {
  render() {
    const { children } = this.props;
    return (
      <div className="nav-bar">
        <div className="left">{children[0]}</div>
        <div className="center">{children[1]}</div>
        <div className="right">{children[2]}</div>
      </div>
    );
  }
}
```

é€šè¿‡ children å­å…ƒç´ å®ç°æ’æ§½æ•ˆæœï¼Œè¿˜æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯éœ€è¦**ç´¢å¼•**ç²¾å‡†åŒ¹é…ï¼›

#### props ä¼ é€’ React å­å…ƒç´ 

**çˆ¶å…ƒç´ **

```jsx
render () {
    return (
      <div>
        <NavBar
          leftSlot={<button>æŒ‰é’®</button>}
          centerSlot={<h2>æ ‡é¢˜</h2>}
          rightSlot={<i>æ–œä½“æ–‡å­—</i>}
        />
      </div>
    )
  }
```

**å­å…ƒç´ **

```jsx
render () {
    const { leftSlot, centerSlot, rightSlot } = this.props
    return (
      <div className='nav-bar'>
        <div className="left">{leftSlot}</div>
        <div className="center">{centerSlot}</div>
        <div className="right">{rightSlot}</div>
      </div>
    )
  }
```

#### ä½œç”¨åŸŸæ’æ§½

å¸Œæœ›**å¤ç”¨**æŸä¸ªç»„ä»¶ï¼›

ä½†æ˜¯è¯¥ç»„ä»¶å±•ç¤º**æ•°æ®çš„æ–¹å¼**å¯èƒ½**ä¸ç¬¦åˆé¢„æœŸ**ï¼›

è€Œ**çˆ¶ç»„ä»¶**å¸Œæœ›èƒ½å†³å®š**æ•°æ®çš„æ¯ä¸€é¡¹**è¯¥ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼å±•ç¤ºï¼›

è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½å•¦

**å¦‚ä½•å–åˆ°è¿™æ¯ä¸€é¡¹å‘¢ï¼Ÿ**é€šè¿‡å‡½æ•°

**çˆ¶ç»„ä»¶**

```jsx
constructor() {
  super()
  this.state = {
    titles: ['æµè¡Œ', 'æ–°å“', 'ç²¾é€‰'],
    tabIndex: 0
  }
}
changeTab (index) {
  this.setState({
    tabIndex: index
  })
}

render () {
  const { titles, tabIndex } = this.state
  return (
    <div>
      <TabControl
        titles={titles}
        tabClick={(index) => this.changeTab(index)}
        itemType={(item) => <button>{item}</button>}
      />
      <h1>{titles[tabIndex]}</h1>
    </div>
  )
}
```

**å­ç»„ä»¶**

```jsx
constructor(props) {
super(props)

this.state = {
  currentIndex: 0
}

emClick (index) {
this.setState({
  currentIndex: index
})
this.props.tabClick(index)


nder () {
const { titles, itemType } = this.props
const { currentIndex } = this.state

return (
  <div className='tab-control'>
    {
      titles.map((item, index) => {
        return (
          <div
            className={`item ${index === currentIndex ? 'active' : ''}`}
            key={item}
            onClick={() => this.itemClick(index)}
          >
            {itemType(item)}
          </div>
        )
      })
    }
  </div>
)
```

åœ¨**çˆ¶ç»„ä»¶ä¸­**ï¼Œä½¿ç”¨**TabControl ç»„ä»¶**æ—¶å¢åŠ ä¸€ä¸ª propsï¼ˆ**itemType**ï¼‰ï¼›

itemType çš„å€¼æ˜¯ä¸€ä¸ª**å‡½æ•°**ï¼Œè¿™ä¸ªå‡½æ•°å†³å®š**æ¯ä¸€é¡¹æ•°æ®**åœ¨**å­ç»„ä»¶ä¸­**çš„å±•ç¤ºæ–¹å¼ï¼›

è€Œå­ç»„ä»¶é€šè¿‡**props**ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”é€šè¿‡**å‚æ•°**ï¼Œå¯ä»¥ä¼ é€’**æ¯ä¸€é¡¹æ•°æ®**äº¤ç»™**çˆ¶ç»„ä»¶**ï¼›

### setState

#### ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒ

ä¿®æ”¹äº† state ä¹‹åï¼Œå¸Œæœ› React æ ¹æ®**æœ€æ–°çš„ state**æ¥é‡æ–°æ¸²æŸ“ç•Œé¢ï¼Œä½†æ˜¯ React ä¸çŸ¥é“æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼›

React å¹¶**æ²¡æœ‰æ•°æ®åŠ«æŒ**ï¼Œè€Œ Vue2 ä½¿ç”¨**Object.defineProperty**æˆ–è€… Vue3 ä½¿ç”¨**Proxy**æ¥ç›‘å¬æ•°æ®çš„å˜åŒ–ï¼›

éœ€è¦é€šè¿‡ setState æ¥å‘ŠçŸ¥ Reactï¼Œæ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼›

#### ç”¨æ³•

##### **ç”¨æ³• 1ï¼šä¼ å…¥ä¸€ä¸ªå¯¹è±¡**

```js
setState({
  msg: 1,
});
```

å†…éƒ¨è°ƒç”¨**Object.assign(this.state, newState)**ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šå’Œ state**åˆå¹¶**ï¼Œå°†æŒ‡å®šå±æ€§çš„å€¼è¦†ç›–

##### **ç”¨æ³• 2ï¼šä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°**

è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡

```js
setState(() => {
  return {
    msg: 1,
  };
});
```

è¿™ç§æ–¹å¼å’Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡ç±»ä¼¼ï¼Œ**é‚£è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ**

1ï¼‰å¯ä»¥ç¼–å†™å¯¹æ–° state çš„**å¤„ç†é€»è¾‘**ï¼Œå†…èšæ€§æ›´å¼º

2ï¼‰å½“å‰å›è°ƒå‡½æ•°å¯ä»¥ä¼ é€’**ä¹‹å‰çš„ state å’Œ props**

##### ç”¨æ³• 3ï¼šä¼ å…¥ç¬¬äºŒå‚æ•°ï¼ˆcallbackï¼‰

setState åœ¨ React çš„äº‹ä»¶å¤„ç†ä¸­æ˜¯ä¸€ä¸ª**å¼‚æ­¥è°ƒç”¨**ï¼Œä¸ä¼šç«‹å³å®Œæˆï¼Œä¹Ÿä¸ä¼šé˜»å¡å…¶å®ƒä»£ç ï¼›

å¦‚æœå¸Œæœ›æ•°æ®åˆå¹¶ä¹‹åè¿›è¡Œä¸€äº›é€»è¾‘å¤„ç†ï¼Œå°±å¯ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼›

```js
this.state = {
    msg: 0,
    name: 'hhh'
}

...
setState({ msg: 1 }, () => {
	console.log(this.state.msg)// 1
})
console.log(this.state.msg)// 0
```

#### ä¸ºä»€ä¹ˆè®¾è®¡æˆå¼‚æ­¥

1ï¼‰å¯ä»¥æ˜¾è‘—**æå‡æ€§èƒ½**

- è‹¥æ¯æ¬¡è°ƒç”¨ setState éƒ½è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œæ„å‘³ç€ render å‡½æ•°ä¼šè¢«**é¢‘ç¹è°ƒç”¨**ï¼Œç•Œé¢é‡æ–°æ¸²æŸ“ï¼Œè¿™æ ·æ•ˆç‡æ˜¯å¾ˆä½çš„ï¼›
- æœ€å¥½çš„åŠæ³•åº”è¯¥æ˜¯è·å–åˆ°å¤šä¸ªæ›´æ–°ï¼Œä¹‹åè¿›è¡Œ**æ‰¹é‡æ›´æ–°**ï¼Œåªæ‰§è¡Œä¸€æ¬¡ render å‡½æ•°ï¼›

2ï¼‰è‹¥åŒæ­¥æ›´æ–°äº† stateï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œ render å‡½æ•°ï¼Œé‚£ state å’Œ props ä¸èƒ½ä¿æŒåŒæ­¥

**è€Œ React18 ä¹‹å‰ï¼Œæœ‰äº›æƒ…å†µ setState æ˜¯åŒæ­¥çš„**

- setTimeout
- åŸç”Ÿ dom äº‹ä»¶

å¦‚æœæƒ³æŠŠ setState å˜æˆåŒæ­¥ï¼Œç«‹å³æ‹¿åˆ°æœ€æ–° stateï¼Œå¯ä»¥ä½¿ç”¨**flushSync()**ï¼Œè¿™ä¸ªå‡½æ•°åœ¨**react-dom**ä¸­ï¼›

```jsx
flushSync(() => {
  this.setState({
    msg: "123",
  });
});
console.log(this.state.msg);
```

### React æ€§èƒ½ä¼˜åŒ–

React åœ¨**state**æˆ–**props**å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè°ƒç”¨ React çš„ render æ–¹æ³•ï¼Œåˆ›å»ºå‡ºä¸€æ£µæ–°çš„æ ‘ï¼›

å¦‚æœä¸€æ£µæ ‘å‚è€ƒå¦å¤–ä¸€æ£µæ ‘è¿›è¡Œå®Œå…¨æ¯”è¾ƒæ›´æ–°ï¼Œé‚£æ—¶é—´å¤æ‚åº¦å°†æ˜¯**O(nÂ²)**ï¼›

è¿™å¼€é”€ä¼šæœ‰ç‚¹å¤§ï¼Œäºæ˜¯ React è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°†å…¶ä¼˜åŒ–æˆäº†**O(n)**:

- åªä¼š**åŒå±‚èŠ‚ç‚¹**æ¯”è¾ƒï¼Œä¸ä¼šè·¨èŠ‚ç‚¹æ¯”è¾ƒï¼›
- **ä¸åŒç±»å‹**çš„èŠ‚ç‚¹ï¼Œäº§ç”Ÿä¸åŒçš„æ ‘ç»“æ„ï¼›
- å¼€å‘ä¸­ï¼Œå¯ä»¥é€šè¿‡**key**æ¥æŒ‡å®šå“ªäº›èŠ‚ç‚¹åœ¨ä¸åŒçš„æ¸²æŸ“ä¸‹ä¿æŒç¨³å®šï¼›

#### shouldComponentUpdate

å½“ä¸€ä¸ªç»„ä»¶çš„ render å‡½æ•°è¢«æ‰§è¡Œï¼Œé‚£è¿™ä¸ªç»„ä»¶çš„é‚£äº›**å­ç»„ä»¶çš„ render å‡½æ•°**ä¹Ÿä¼šè¢«æ‰§è¡Œï¼›

å¦‚æœé‚£äº›å­ç»„ä»¶çš„ state æˆ–è€… props å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œé‚£é‡æ–°æ‰§è¡Œ render å‡½æ•°æ˜¯**å¤šä½™çš„ã€æµªè´¹æ€§èƒ½**çš„ï¼›

å®ƒä»¬è°ƒç”¨ render å‡½æ•°åº”è¯¥æœ‰ä¸ªå‰æï¼š**ä¾èµ–çš„æ•°æ®ï¼ˆstateã€propsï¼‰å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå†è°ƒç”¨è‡ªå·±çš„ render å‡½æ•°**ï¼›

å¦‚ä½•æ§åˆ¶ render å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨ï¼šé€šè¿‡ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ**shouldComponentUpdate**æ–¹æ³•ï¼Œå¾ˆå¤šæ—¶å€™ç®€ç§°**SCU**ï¼›

è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼š

- 1ï¼‰nextPropsï¼Œä¿®æ”¹ä¹‹åçš„ props
- 2ï¼‰nextStateï¼Œä¿®æ”¹ä¹‹åçš„ state

ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç»„ä»¶ä¸­

```jsx
shouldComponentUpdate(nextProps, nextState) {
    if (this.state.msg !== nextState.msg) return true
    return false
}
```

åªæœ‰ msg å‘ç”Ÿæ”¹å˜æ‰ä¼šé‡æ–°æ‰§è¡Œå®ƒçš„ render å‡½æ•°

å¯æ˜¯ï¼Œå¦‚æœæ¯ä¸ªç»„ä»¶éƒ½è¦è¿™æ ·åˆ¤æ–­ï¼Œé‚£æœªå…ä¹Ÿå¤ªéº»çƒ¦äº†

è¿™æ—¶å€™ React ç»™æˆ‘æˆ‘ä»¬æä¾›äº†**PureComponent**

#### PureComponent

è‹¥å½“å‰ç»„ä»¶æ˜¯**ç±»ç»„ä»¶**ï¼Œå¯ä»¥**ç»§æ‰¿ PureComponent**ï¼›

å¯¹äº props å’Œ state çš„åˆ¤æ–­ï¼Œå†…éƒ¨å·²ç»å¸®æˆ‘åšäº†ï¼Œæ‰€ä»¥ render å‡½æ•°å°±ä¼šæ ¹æ®éœ€è¦æ¥é‡æ–°æ‰§è¡Œäº†ï¼›

ä¸è¿‡ï¼Œ**å†…éƒ¨çš„æ¯”è¾ƒæ˜¯æµ…å±‚çš„**ï¼Œä½¿ç”¨**shallowEqual()**ï¼›

**åç»­å¼€å‘ç±»ç»„ä»¶åŸºæœ¬éƒ½æ˜¯ç»§æ‰¿ PureComponent**

```jsx
import { PureComponent } from 'react'

class App extends PureComponent {
  ...
  render () {
    return (
      <div>
        <h2>App</h2>
      </div>
    )
  }
}
```

#### memo

ç±»ç»„ä»¶æ‰æœ‰ç”Ÿå‘½å‘¨æœŸ**shouldComponentUpdate**ï¼Œé‚£**å‡½æ•°å¼ç»„ä»¶**å¦‚ä½•åˆ¤æ–­ props æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ

ä½¿ç”¨ react ä¸­çš„**memo**

```jsx
import { memo } from "react";

const Home = memo(function (props) {
  return <h2>home: {props.msg}</h2>;
});

export default Home;
```

#### æ•°æ®ä¸å¯å˜çš„åŠ›é‡

çœ‹ä¸ªä¾‹å­

```jsx
import React from "react";

class App extends React.Component {
  constructor() {
    super();

    this.state = {
      books: [
        { name: "ä½ ä¸çŸ¥é“çš„js", price: 99, count: 1 },
        { name: "jsé«˜çº§ç¨‹åºè®¾è®¡", price: 88, count: 1 },
        { name: "Reacté«˜çº§ç¨‹åºè®¾è®¡", price: 78, count: 2 },
      ],
    };
  }

  addBooks() {
    const newBooks = { name: "Vueé«˜çº§ç¨‹åºè®¾è®¡", price: 66, count: 2 };
    this.state.books.push(newBooks);
    this.setState({ books: this.state.books });
  }

  render() {
    const { books } = this.state;
    return (
      <div>
        <h2>æ•°æ®åˆ—è¡¨</h2>
        <ul>
          {books.map((item, index) => {
            return (
              <li key={index}>
                <span>
                  name:{item.name}-price:{item.price}-counter:{item.count}
                </span>
                <button>+1</button>
              </li>
            );
          })}
        </ul>
        <button onClick={(e) => this.addBooks()}>æ·»åŠ ä¹¦ç±</button>
      </div>
    );
  }
}
```

å•ç‹¬çœ‹ addBooks

```js
addBooks() {
  const newBooks = { name: 'Vueé«˜çº§ç¨‹åºè®¾è®¡', price: 66, count: 2 }
  this.state.books.push(newBooks)
  this.setState({ books: this.state.books })
}
```

è¿™é‡Œä¿®æ”¹ state ä¸­çš„ books æ–¹æ³•æ˜¯**ç›´æ¥ä¿®æ”¹**ï¼Œè™½ç„¶ä¹Ÿèƒ½æˆåŠŸï¼Œä½†æ˜¯ React ä¸æ¨èï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å¦‚æœå°†è¿™ç±»ç»„ä»¶**ç»§æ‰¿ PureComponent**è€Œä¸æ˜¯ Componentï¼Œé‚£è¿™ç§æ–¹æ³•ä¿®æ”¹ä¸æˆåŠŸï¼›

è€Œç»§æ‰¿ PureComponent çš„ç±»ç»„ä»¶å†…éƒ¨ä¼šåˆ¤æ–­ä¿®æ”¹å‰åçš„ state æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸”æ˜¯**æµ…å±‚çš„æ¯”è¾ƒ**ï¼Œä»è€Œå†³å®šæ˜¯å¦é‡æ–°æ‰§è¡Œ render å‡½æ•°ï¼›

è€Œè¿™æµ…å±‚çš„æ¯”è¾ƒåªæ˜¯æ¯”è¾ƒåˆ° books è¿™ä¸€å±‚ï¼ˆå†…å­˜åœ°å€ï¼‰æ˜¯å¦å˜åŒ–ï¼Œå¹¶**æ²¡æœ‰æ¯”è¾ƒ books é‡Œé¢çš„å†…å®¹**ï¼›

è¿™ç§æµ…å±‚æ¯”è¾ƒï¼Œå¯¼è‡´**å†…éƒ¨åˆ¤æ–­ state æ²¡æœ‰å‘ç”Ÿå˜åŒ–**ï¼ˆå®é™… books å†…å®¹å·²ç»å˜äº†ï¼‰ï¼Œè€Œ**ä¸ä¼šé‡æ–°æ‰§è¡Œ render**å‡½æ•°ï¼›

åº”è¯¥å†™æˆè¿™æ ·ï¼ˆç»„ä»¶å…ˆæ”¹æˆç»§æ‰¿ PureComponentï¼‰

```jsx
addBooks () {
  const newBooks = { name: 'Vueé«˜çº§ç¨‹åºè®¾è®¡', price: 66, count: 2 }
  const books = [...this.state.books]
  books.push(newBooks)
  this.setState({ books: books })
}
```

é‡æ–°åˆ›å»ºçš„**books å’Œ state ä¸­ books çš„å†…å­˜åœ°å€ä¸ä¸€æ ·**ï¼Œå†…éƒ¨åˆ¤æ–­ state å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥ä¼šé‡æ–°æ‰§è¡Œ render å‡½æ•°ï¼›

### ref

#### è·å–åŸç”Ÿ dom

- åœ¨ React å…ƒç´ ä¸Šç»‘å®šä¸€ä¸ª ref å­—ç¬¦ä¸²
- æå‰åˆ›å»º ref å¯¹è±¡(é€šè¿‡ current å–åˆ°)ï¼ŒcreateRef()ï¼Œå°†åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ç»‘å®šåˆ° React å…ƒç´ ï¼ˆ**æ¨è**ï¼‰
- ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨å¯¹åº”çš„å…ƒç´ è¢«æ¸²æŸ“ä¹‹åï¼Œå›è°ƒå‡½æ•°è¢«æ‰§è¡Œï¼Œå¹¶å°†è¯¥å…ƒç´ ä¼ å…¥è¯¥å›è°ƒå‡½æ•°

```jsx
import React, { createRef, PureComponent } from "react";

export class App extends PureComponent {
  constructor() {
    super();
    this.titleRef = createRef();
    this.titleEl = null;
  }
  getDOM() {
    // 1.åœ¨Reactå…ƒç´ ä¸Šç»‘å®šä¸€ä¸ªrefå­—ç¬¦ä¸²
    console.log(this.refs.zsf); // å·²åºŸå¼ƒ
    // 2.æå‰åˆ›å»ºrefå¯¹è±¡(é€šè¿‡currentå–åˆ°)ï¼ŒcreateRef()ï¼Œå°†åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ç»‘å®šåˆ°Reactå…ƒç´ 
    console.log(this.titleRef.current);
    // 3.ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨å¯¹åº”çš„å…ƒç´ è¢«æ¸²æŸ“ä¹‹åï¼Œå›è°ƒå‡½æ•°è¢«æ‰§è¡Œï¼Œå¹¶å°†è¯¥å…ƒç´ ä¼ å…¥è¯¥å›è°ƒå‡½æ•°
    console.log(this.titleEl);
  }
  render() {
    return (
      <div>
        <h2 ref="zsf">App1</h2>
        <h2 ref={this.titleRef}>App2</h2>
        <h2 ref={(el) => (this.titleEl = el)}>App2</h2>
        <button onClick={(e) => this.getDOM()}>è·å–DOM</button>
      </div>
    );
  }
}
```

#### è·å–ç»„ä»¶å®ä¾‹

å¯¹äºç±»ç»„ä»¶ï¼Œå’Œè·å–åŸç”Ÿ dom ç±»ä¼¼

```jsx
constructor() {
  super()
  this.hRef = createRef()
}
getDOM () {
  console.log(this.hRef.current)
}
render () {
  return (
    <div>
      <Hello ref={this.hRef} />
      <button onClick={e => this.getDOM()}>è·å–DOM</button>
    </div>
  )
}
```

è€Œ**å‡½æ•°å¼ç»„ä»¶æ²¡æœ‰å®ä¾‹**ï¼Œä½†æ˜¯åœ¨å¼€å‘ä¸­å¯èƒ½æƒ³è¦è·å–**å‡½æ•°å¼ç»„ä»¶ä¸­æŸä¸ªå…ƒç´ çš„ DOM**ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ

ç›´æ¥æ‹¿ä¸åˆ°ï¼Œä½†å¯ä»¥é€šè¿‡ react æä¾›çš„ä¸€ä¸ªé«˜é˜¶å‡½æ•°**forwordRef**ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ä¼ å…¥å‡½æ•°å¼ç»„ä»¶ï¼‰ï¼›

å‡½æ•°å¼ç»„ä»¶ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¥æ”¶ä¸€ä¸ª**ref**ï¼›

åœ¨ App ä¸­åˆ›å»ºçš„**ref**ä¼ ç»™å‡½æ•°å¼ç»„ä»¶**Hello**ï¼Œè€Œç»è¿‡**forwordRef**çš„**è½¬å‘**ï¼Œå¯ä»¥å°†å…¶ç»‘å®šå‡½æ•°å¼ç»„ä»¶æŸä¸ªå…ƒç´ çš„ DOMï¼›

```jsx
const Hello = forwardRef(function (props, ref) {
  return (
    <div>
      <h1 ref={ref}>hello</h1>
      <p>hhh</p>
    </div>
  );
});

class App extends PureComponent {
  constructor() {
    super();
    this.hRef = createRef();
  }
  getDOM() {
    console.log(this.titleRef.current);
  }
  render() {
    return (
      <div>
        <Hello ref={this.hRef} />
        <button onClick={(e) => this.getDOM()}>è·å–DOM</button>
      </div>
    );
  }
}
```

### å—æ§å’Œéå—æ§ç»„ä»¶

#### å—æ§ç»„ä»¶

åœ¨ HTML ä¸­ï¼Œè¡¨å•å…ƒç´ é€šå¸¸ä¼šè‡ªå·±ç»´æŠ¤ stateï¼Œå¹¶æ ¹æ®**ç”¨æˆ·è¾“å…¥**è¿›è¡Œæ›´æ–°ï¼›

è¡¨å•å…ƒç´ ä¸€æ—¦**ç»‘å®š value å€¼æ¥è‡ª state ä¸­çš„å±æ€§**ï¼Œé‚£ä¹ˆå®ƒå°±å˜æˆäº†**å—æ§ç»„ä»¶**ï¼›

è€Œ React ä¸­æ²¡æœ‰åŒå‘ç»‘å®šï¼Œæ˜¯é€šè¿‡å—æ§ç»„ä»¶æ¥æ§åˆ¶ inputã€textarea ç­‰è¡¨å•å…ƒç´ ï¼›

æƒ³ä¿®æ”¹ value éœ€è¦ç›‘å¬è¡¨å•å…ƒç´ çš„**onChange**äº‹ä»¶ï¼Œé€šè¿‡**event.target.value**è·å–æœ€æ–°çš„ value å€¼ï¼›

```jsx
constructor() {
  super()
  this.state = {
    username: ''
  }
}

inputChange (event) {
  this.setState({ username: event.target.value })
}
render () {
  const { username } = this.state
  return (
    <div>
      <h2>App</h2>
      <h2>username:{username}</h2>
      {/* å—æ§ç»„ä»¶ */}
      <input type="text" value={username} onChange={e => this.inputChange(e)} />
      {/* éå—æ§ç»„ä»¶ */}
      <input type="text" />
    </div>
  )
}
```

##### form è¡¨å•

å¯¹äºä¼ ç»Ÿçš„ form è¡¨å•ï¼Œé»˜è®¤æ˜¯æ˜¯ä¼šå‘æœåŠ¡å™¨**å‘èµ·ç½‘ç»œè¯·æ±‚**å¹¶**åˆ·æ–°é¡µé¢**ï¼›

åœ¨ React ä¸­éœ€è¦ç›‘å¬**onSubmit äº‹ä»¶**ï¼Œä½¿ç”¨ event å¯¹è±¡çš„**preventDefault()**é˜»æ­¢è¿™ä¸€é»˜è®¤è¡Œä¸ºï¼›

```jsx
constructor() {
  super()
  this.state = {
    username: ''
  }
}
handleSubmit (event) {
  event.preventDefault()
  console.log(this.state.username)
}
inputChange (event) {
  this.setState({ username: event.target.value })
}
render () {
  const { username } = this.state
  return (
    <div>
      <form onSubmit={e => this.handleSubmit(e)}>
        <label htmlFor="username">
          ç”¨æˆ·ï¼š<input id='username' type="text" value={username} onChange={e => this.inputChange(e)} />
        </label>
        <button type='submit'>æäº¤</button>
      </form>
    </div>
  )
}
```

##### å¤šä¸ªå—æ§ç»„ä»¶åŒä¸ªå‡½æ•°å¤„ç†

```jsx
constructor() {
  super()
  this.state = {
    username: '',
    password: ''
  }
}
handleSubmit (event) {
  event.preventDefault()
  console.log(this.state)
}
inputChange (event) {
  this.setState({ [event.target.name]: event.target.value })
}
render () {
  const { username, password } = this.state
  return (
    <div>
      <form onSubmit={e => this.handleSubmit(e)}>
        <label htmlFor="username">
          ç”¨æˆ·ï¼š<input id='username' name='username' type="text" value={username} onChange={e => this.inputChange(e)} />
        </label>

        <label htmlFor="username">
          å¯†ç ï¼š<input id='password' name='password' type="password" value={password} onChange={e => this.inputChange(e)} />
        </label>

        <button type='submit'>æäº¤</button>
      </form>
    </div>
  )
}
```

##### å¤„ç†å¤šé€‰è¡¨å•

**checkbox**å’Œ**radio**è¿™ä¸¤ç§è¡¨å•ç”¨çš„æ˜¯**checked**æ¥ä¿å­˜çŠ¶æ€ï¼Œä¸æ˜¯ valueï¼›

```jsx
constructor() {
  super()
  this.state = {
    hobbies: [
      { value: 'sing', text: 'å”±', isChecked: false },
      { value: 'dance', text: 'è·³', isChecked: false },
      { value: 'rap', text: 'rap', isChecked: false },
    ]
  }
}
handleSubmit (event) {
  event.preventDefault()

  console.log(this.state.hobbies)
}
inputChange (event, index) {
  const hobbies = [...this.state.hobbies]
  hobbies[index].isChecked = event.target.checked
  this.setState({ hobbies: hobbies })
}

render () {
  const { hobbies } = this.state
  return (
    <div>
      <form onSubmit={e => this.handleSubmit(e)}>
        çˆ±å¥½
        {
          hobbies.map((item, index) => {
            return (
              <label htmlFor={item.value} key={item.value}>
                <input id={item.value} type="checkbox" checked={item.isChecked} onChange={e => this.inputChange(e, index)} />
                <span>{item.text}</span>
              </label>

            )
          })
        }

        <button type='submit'>æäº¤</button>
      </form>
    </div>
  )
}
```

##### select å¤šé€‰

select**å•é€‰**å’Œæ™®é€šè¡¨å•å†™æ³•ç±»ä¼¼ï¼Œè¦æ˜¯å¤šé€‰å‘¢ï¼Ÿ

å¤šé€‰æ—¶ï¼Œselect å…ƒç´ çš„ value å¾—æ˜¯**æ•°ç»„**

select å¦‚ä½•è·å–ç”¨æˆ·é€‰ä¸­çš„å¤šä¸ªçŠ¶æ€å‘¢ï¼Ÿ**event.target.selectedOptions**

ä¸è¿‡**event.target.selectedOptions**æ˜¯ç±»æ•°ç»„ï¼Œä¸èƒ½ä½¿ç”¨ä¸€äº›æ•°ç»„çš„é«˜é˜¶å‡½æ•°ï¼›

å¯ä»¥ä½¿ç”¨**Array.from()**,å°†å®ƒè½¬åŒ–æˆæ•°ç»„ï¼›

```jsx
constructor() {
  super()
  this.state = {
    fruit: ['orange']
  }
}
handleSubmit (event) {
  event.preventDefault()

  console.log(this.state.fruit)
}
inputChange (event) {
  const options = Array.from(event.target.selectedOptions)
  const values = options.map(item => item.value)
  this.setState({ fruit: values })
}

render () {
  const { fruit } = this.state
  return (
    <div>
      <form onSubmit={e => this.handleSubmit(e)}>
        æ°´æœ
        <select value={fruit} onChange={e => this.inputChange(e)} multiple>
          <option value="apple">è‹¹æœ</option>
          <option value="orange">æ©˜å­</option>
          <option value="banana">é¦™è•‰</option>
        </select>
        <button type='submit'>æäº¤</button>
      </form>
    </div>
  )
}
```

#### éå—æ§ç»„ä»¶

è€Œè¡¨å•å…ƒç´ çš„ value å€¼äº¤ç»™**æµè§ˆå™¨**ç»´æŠ¤ï¼Œå€ŸåŠ©**ref**æ¥è·å–

### é«˜é˜¶ç»„ä»¶

Higher-Order Componentsï¼Œç®€ç§°**HOC**ï¼›

é«˜é˜¶ç»„ä»¶æ˜¯**å‚æ•°**ä¸ºç»„ä»¶ï¼Œ**è¿”å›å€¼**ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°ï¼›

å¯ä»¥å¯¹ä¼ å…¥çš„ç»„ä»¶**æ‹¦æˆª**ï¼Œç„¶åå¯ä»¥è¿›è¡Œ**props å¢å¼ºã€ç™»é™†é‰´æƒ**ç­‰ç­‰æ“ä½œ

åº”ç”¨åœºæ™¯ï¼š

- props å¢å¼º
- ç™»é™†é‰´æƒ
- åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚è®¡ç®—æ¸²æŸ“èŠ±è´¹æ—¶é—´ï¼‰

æ¯”å¦‚**memo()**ã€**forwardRef()**éƒ½æ˜¯é«˜é˜¶ç»„ä»¶

#### **åº”ç”¨**

##### props å¢å¼º

ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ æ–°çš„ propsï¼›

**Home**

```jsx
const Home = enhancedUserInfo(function (props) {
  return (
    <h1>
      Home: {props.name}- {props.level}
    </h1>
  );
});
```

**enhancedUserInfo**

```jsx
function enhancedUserInfo(Cpn) {
  class NewComponent extends PureComponent {
    constructor() {
      super();

      this.state = {
        userInfo: {
          name: "zsf",
          level: 99,
        },
      };
    }
    render() {
      return <Cpn {...this.state.userInfo} />;
    }
  }
  return NewComponent;
}
```

**App**

```jsx
export class App extends PureComponent {
  render() {
    return (
      <div>
        <Home />
      </div>
    );
  }
}
```

**å®é™…åº”ç”¨åœºæ™¯---context**

**App**

```jsx
<div>
  <ThemeContext.Provider value={{ color: "red", size: 30 }}>
    <Home />
  </ThemeContext.Provider>
</div>
```

**ThemeContext**

```js
import { createContext } from "react";
const ThemeContext = createContext();
export default ThemeContext;
```

**Home**

```jsx
class Home extends PureComponent {
  render() {
    const { color, size } = this.props;
    return (
      <div>
        Home:{color} - {size}
      </div>
    );
  }
}

export default withTheme(Home);
```

**withTheme**

```jsx
function withTheme(Cpn) {
  return (props) => {
    return (
      <ThemeContext.Consumer>
        {(value) => {
          return <Cpn {...value} {...props} />;
        }}
      </ThemeContext.Consumer>
    );
  };
}
```

##### ç™»é™†é‰´æƒ

å¼€å‘ä¸­ï¼Œè‹¥éœ€è¦**åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†**æ‰èƒ½æ˜¾ç¤ºæŸä¸ªç»„ä»¶ï¼›

å¦‚æœæ¯ä¸ªç»„ä»¶éƒ½éœ€è¦è‡ªå·±åˆ¤æ–­ï¼Œé‚£å¤ªç¹çäº†ï¼›

å¯ä»¥ç¼–å†™ä¸ªé«˜é˜¶ç»„ä»¶ï¼šå¯¹æ¯ä¸ªç»„ä»¶è¿›è¡Œé‰´æƒåˆ¤æ–­ï¼Œç„¶åå†å†³å®šæ˜¯å¦æ˜¾ç¤ºï¼›

**App**

```jsx
render () {
  return (
    <div>
      <Home />
    </div >
  )
}
```

**Home**

```jsx
export class Home extends PureComponent {
  render() {
    return <div>home</div>;
  }
}

export default loginAuth(Home);
```

**loginAuth**

```js
function loginAuth(Cpn) {
  return (props) => {
    const token = localStorage.getItem("token");

    if (token) {
      return <Cpn {...props} />;
    } else {
      return <h2>è¯·å…ˆç™»é™†</h2>;
    }
  };
}
```

##### ç”Ÿå‘½å‘¨æœŸçš„åŠ«æŒ

åº”ç”¨ç±»ä¼¼ã€‚ã€‚ã€‚

#### æ„ä¹‰

æ—©æœŸ React æä¾›ç»„ä»¶ä¹‹é—´å¤ç”¨ä»£ç çš„æ–¹å¼æ˜¯**mixin**ï¼Œç›®å‰å·²ç»ä¸åœ¨å»ºè®®ä½¿ç”¨ï¼›

mixin å¯èƒ½ä¼š**ç›¸äº’ä¾èµ–**ï¼Œ**ç›¸äº’è€¦åˆ**ï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤ï¼›

è€Œ**HOC**ä¹Ÿæ˜¯ä¸€ç§ç»„ä»¶é—´å¤ç”¨ä»£ç çš„æ–¹å¼ï¼›

#### ç¼ºç‚¹

- HOC éœ€è¦åœ¨åŸç»„ä»¶ä¸Šè¿›è¡ŒåŒ…è£¹æˆ–åµŒå¥—ï¼Œè‹¥å¤§é‡ä½¿ç”¨ HOCï¼Œå°†ä¼šäº§ç”Ÿéå¸¸å¤šçš„**åµŒå¥—**ï¼Œè¿™è®©è°ƒè¯•å˜å¾—å›°éš¾ï¼›
- HOC å¯ä»¥**åŠ«æŒ props**ï¼Œåœ¨ä¸éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½é€ æˆå†²çªï¼›

è€Œ**hooks**çš„å‡ºç°ï¼Œæ˜¯å¼€åˆ›æ€§çš„ï¼Œå®ƒè§£å†³äº†å¾ˆå¤š React ä¹‹å‰å­˜åœ¨çš„é—®é¢˜ï¼Œæ¯”å¦‚**this æŒ‡å‘**ã€**hoc çš„åµŒå¥—å¤æ‚**ç­‰ç­‰

### portals

æŸäº›æƒ…å†µä¸‹ï¼Œå¸Œæœ›æ¸²æŸ“çš„å†…å®¹**ç‹¬ç«‹äºçˆ¶ç»„ä»¶**ï¼Œç”šè‡³æ˜¯ç‹¬ç«‹äºå½“å‰æŒ‚è½½åˆ°çš„ DOM å…ƒç´ ä¸­ï¼ˆé»˜è®¤éƒ½æ˜¯æŒ‚è½½åˆ° id ä¸º root çš„ DOM çš„ï¼‰ï¼›

ä½¿ç”¨æ¥è‡ª react-dom ä¸­çš„**createPortal(å†…å®¹ï¼ŒDOM å…ƒç´ )**

### fragment

å¦‚æœä¸å¸Œæœ›å¤šæ¸²æŸ“å‡ºä¸€ä¸ªæ ¹å…ƒç´ ï¼ˆç»å¸¸ä½¿ç”¨ divï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ fragmentï¼›

ç±»ä¼¼ vue ä¸­çš„**template**

```jsx
render () {
  return (
    <Fragment>
      <h1>1</h1>
      <span>2</span>
    </Fragment >
  )
}
```

#### fragment è¯­æ³•ç³–

```jsx
render () {
  return (
    <>
      <h1>1</h1>
      <span>2</span>
    </>
  )
}
```

**å¦‚æœæœ‰ key å±æ€§è¿™ä¸èƒ½çœç•¥ fragment**

### StrictMode

**StrictMode**æ˜¯ä¸€ä¸ªç”¨æ¥**çªå‡ºæ˜¾ç¤º**åº”ç”¨ç¨‹åºä¸­**æ½œåœ¨é—®é¢˜**çš„å·¥å…·ï¼š

- ä¸ fragment ä¸€æ ·ï¼ŒStrictMode ä¸ä¼šæ¸²æŸ“ä»»ä½•å¯è§çš„ UIï¼›
- å®ƒä¸ºå…¶åä»£å…ƒç´ è§¦å‘é¢å¤–çš„æ£€æŸ¥å’Œè­¦å‘Šï¼›
- ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œï¼Œä¸å½±å“ç”Ÿäº§æ„å»ºï¼›
- å¯ä»¥ä¸ºåº”ç”¨ç¨‹åº**ä»»ä½•éƒ¨åˆ†**å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼›

#### æ£€æµ‹å†…å®¹

- ä¸å®‰å…¨çš„**ç”Ÿå‘½å‘¨æœŸ**
- è¿‡æ—¶çš„ ref API
- è¿‡æ—¶çš„ context API
- æ„å¤–çš„å‰¯ä½œç”¨ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæ‰§è¡Œ 2 æ¬¡ç”Ÿå‘½å‘¨æœŸï¼Œçœ‹çœ‹æ˜¯å¦æœ‰å‰¯ä½œç”¨ï¼‰

## react ä¸­çš„æ ·å¼

css çš„è®¾è®¡å¹¶ä¸æ˜¯ä¸ºç»„ä»¶åŒ–è€Œç”Ÿçš„ï¼Œç›®å‰**ç»„ä»¶åŒ–æ¡†æ¶**ä¸­éƒ½éœ€è¦ä¸€ç§åˆé€‚çš„**css è§£å†³æ–¹æ¡ˆ**ï¼›

åœ¨ç»„ä»¶åŒ–ä¸­é€‰æ‹©åˆé€‚çš„ css è§£å†³æ–¹æ¡ˆåº”è¯¥ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š

- å±€éƒ¨ cssï¼šå…·å¤‡**ç‹¬ç«‹ä½œç”¨åŸŸ**ï¼Œä¸ä¼šæ±¡æŸ“å…¶å®ƒç»„ä»¶æ ·å¼ï¼›
- **åŠ¨æ€ css**ï¼šå¯ä»¥è·å–å½“å‰ç»„ä»¶çš„ä¸€äº›çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€çš„å˜åŒ–ç”Ÿæˆä¸åŒçš„ css æ ·å¼ï¼ˆæŸäº›å€¼æ˜¯æ¥è‡ª**js çš„å˜é‡**ï¼‰ï¼›
- æ”¯æŒæ‰€æœ‰çš„**css ç‰¹æ€§**ï¼šä¼ªç±»ã€åŠ¨ç”»ã€åª’ä½“æŸ¥è¯¢ç­‰ï¼›
- ç¼–å†™èµ·æ¥ç¬¦åˆ**css é£æ ¼**ç‰¹ç‚¹

### css è§£å†³æ–¹æ¡ˆ

#### å†…è”æ ·å¼

- style æ¥æ”¶**å°é©¼å³°**å‘½åçš„**js å¯¹è±¡**ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼›
- ä¹Ÿå¯ä»¥å¼•ç”¨**state**ä¸­çš„çŠ¶æ€æ¥è®¾ç½®ç›¸å…³æ ·å¼ï¼›

##### ä¼˜ç‚¹

- æ ·å¼ä¹‹é—´ä¸ä¼šå†²çªï¼›
- å¯ä»¥åŠ¨æ€è·å–å½“å‰ state ä¸­çš„çŠ¶æ€ï¼›

##### ç¼ºç‚¹

- å†™æ³•ä¸Šéœ€è¦é©¼å³°æ ‡è¯†ï¼›
- æŸäº›æ ·å¼æ— æç¤ºï¼›
- å¤§é‡çš„æ ·å¼ä¼šä½¿ä»£ç æ··ä¹±ï¼›
- æŸäº›æ ·å¼æ— æ³•ç¼–å†™ï¼ˆä¼ªç±»ã€ä¼ªå…ƒç´ ï¼‰ï¼›

```jsx
constructor() {
  super()
  this.state = {
    titleSize: 30
  }
}
addSize () {
  this.setState({ titleSize: this.state.titleSize + 2 })
}
render () {
  const { titleSize } = this.state
  return (
    <Fragment>
      <h2 style={{ color: 'red', fontSize: `${titleSize}px` }}>æˆ‘æ˜¯æ ‡é¢˜</h2>
      <button onClick={e => this.addSize()}>å¢åŠ </button>
    </Fragment >
  )
}
```

**å®˜æ–¹æ¨èå†…è”æ ·å¼å’Œæ™®é€š css ç»“åˆèµ·æ¥å†™**

#### æ™®é€šçš„ css

- é€šå¸¸ä¼šç¼–å†™åˆ°ä¸€ä¸ª**å•ç‹¬çš„æ–‡ä»¶**ï¼Œä¹‹åå†è¿›è¡Œå¼•å…¥ï¼›
- ä½†æ˜¯è¿™æ ·çš„ css å±äº**å…¨å±€ cssï¼Œ**æ ·å¼ä¹‹é—´ä¼šç›¸äº’å½±å“ï¼›
- è¿™ç§ç¼–å†™æ–¹å¼æœ€å¤§çš„é—®é¢˜æ˜¯æ ·å¼ä¹‹é—´ä¼š**ç›¸äº’å±‚å **ï¼›

#### css modules

css modules å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½¿ç”¨äº†ç±»ä¼¼**webpack é…ç½®ç¯å¢ƒ**ä¸‹éƒ½å¯ä»¥ä½¿ç”¨çš„ï¼›

è‹¥æƒ³åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œéœ€è¦é…ç½®**webpack.config.js**ä¸­çš„**modules å±æ€§ä¸º true**ï¼›

React è„šæ‰‹æ¶å·²ç»**å†…ç½®**äº† css modules çš„é…ç½®ï¼›

**.css/.less/.scss**ç­‰æ ·å¼æ–‡ä»¶éƒ½éœ€è¦ä¿®æ”¹æˆ**.modules.css/.modules.less/.modules.scss**ç­‰ï¼›

ä¹‹åä»¥**å¯¹è±¡çš„å½¢å¼**ä½¿ç”¨ï¼›

ä¸ºäº†ä¿æŒç±»åçš„**å”¯ä¸€æ€§**ï¼Œç±»åå°¾éƒ¨ä¼šæ‹¼æ¥ä¸Š**åŠ¨æ€çš„å“ˆå¸Œå€¼**ï¼›

**App**

```jsx
import appStyle from './App.module.css'

...
render () {
  return (
    <Fragment>
      <h2 className={appStyle.title}>æˆ‘æ˜¯æ ‡é¢˜</h2>
    </Fragment >
  )
}
```

**App.module.css**

```css
.title {
  font-size: 32px;
  color: green;
}
```

##### ç¼ºç‚¹

- ç±»å**ä¸èƒ½ä½¿ç”¨è¿æ¥ç¬¦**ï¼ˆæ¯”å¦‚.home-titleï¼‰,è¿™åœ¨ js ä¸­æ˜¯ä¸è¯†åˆ«çš„ï¼›
- æ‰€æœ‰çš„ className éƒ½å¿…é¡»ä½¿ç”¨ï¼ˆ**style.className**ï¼‰çš„å½¢å¼æ¥ç¼–å†™ï¼›
- **ä¸æ–¹ä¾¿åŠ¨æ€ä¿®æ”¹æ ·å¼**ï¼Œä¾ç„¶**éœ€è¦ä½¿ç”¨å†…è”æ ·å¼**çš„æ–¹å¼ï¼›

##### React é¡¹ç›®ä¸­ä½¿ç”¨ less

æƒ³åœ¨ React é¡¹ç›®ä¸­ä½¿ç”¨ lessï¼Œå¾—å®‰è£… less-loader å¹¶è¿›è¡Œç›¸å…³çš„é…ç½®ï¼›

###### å®‰è£…

è€Œ webpack é…ç½®åœ¨ React é¡¹ç›®ä¸­æ˜¯éšè—çš„ï¼Œå¦‚æœæƒ³æ”¹å¯ä»¥å®‰è£…ä¸€ä¸ªå·¥å…·**craco**ï¼ˆå°† webpack æºç æš´éœ²å‡ºæ¥ä¿®æ”¹ä¸æ¨èï¼‰ï¼›

```
npm install @craco/craco@alpha
```

å¦‚æœå®‰è£…å‡ºç°è„šæ‰‹æ¶ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œå¯ä»¥å» github ä¸Šçš„ issue éƒ¨åˆ†ï¼ŒæŸ¥çœ‹äººå®¶æ€ä¹ˆè§£å†³çš„ï¼›

æŸ¥åˆ°çš„èµ„æ–™æ˜¯å®‰è£… alpha çš„ç‰ˆæœ¬

```
npm install @craco/craco
```

###### ä¿®æ”¹å‘½ä»¤

åœ¨**package.json**é‡Œçš„ scripts ä¿®æ”¹è¿è¡Œé¡¹ç›®çš„å‘½ä»¤ï¼Œå°†**react-scripts éƒ½æ›¿æ¢æˆ craco**ï¼Œä¸å†æ˜¯ react-scripts å¸®æˆ‘å—å¯åŠ¨é¡¹ç›®äº†ï¼Œäº¤ç»™ carcoï¼›

###### å®‰è£… craco-less

ä½¿ç”¨ craco-less ä»£æ›¿ less-loader

```
npm install craco-less
```

###### æ–°å»ºæ–‡ä»¶

æ–°å»ºä¸€ä¸ªå«**craco.config.js**çš„æ–‡ä»¶ï¼Œé‡Œé¢çš„é…ç½®ä¼šåˆå¹¶åˆ° webpack é…ç½®ä¸­ï¼›

#### CSS in JS

css in js æ¨¡å¼æ˜¯ä¸€ç§å°†**æ ·å¼ä¹Ÿå†™å…¥ JavaScript ä¸­**çš„æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿ä½¿ç”¨ JavaScript çš„**çŠ¶æ€**ï¼›

css in js é€šè¿‡ JavaScript æ¥ä¸º css èµ‹äºˆä¸€äº›èƒ½åŠ›ï¼ŒåŒ…æ‹¬**ç±»ä¼¼ css é¢„å¤„ç†å™¨**ä¸€æ ·çš„**æ ·å¼åµŒå¥—**ã€**å‡½æ•°å®šä¹‰**ã€**é€»è¾‘å¤ç”¨**ã€**åŠ¨æ€ä¿®æ”¹çŠ¶æ€**ç­‰ç­‰ï¼›

è™½ç„¶ css é¢„å¤„ç†å™¨ä¹Ÿå…·å¤‡æŸäº›èƒ½åŠ›ï¼Œä½†**è·å–åŠ¨æ€çŠ¶æ€**ä¾ç„¶æ˜¯ä¸å¥½å¤„ç†çš„ç‚¹ï¼›

æ‰€ä»¥ï¼Œç›®å‰å¯ä»¥è¯´ css-in-js æ˜¯ React ç¼–å†™ css**æœ€ä¸ºå—æ¬¢è¿**çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼›

ç›®å‰æ¯”è¾ƒæµè¡Œçš„ css-in-js çš„åº“æœ‰å“ªäº›ï¼Ÿ

- style-components
- emotion
- glamorous

##### styled-components

å®‰è£…

```
npm install styled-components
```

###### åŸºæœ¬ä½¿ç”¨

ä½¿ç”¨è¯¥åº“ä¸­çš„**sytled.div**æ–¹æ³•ï¼Œæ¸²æŸ“å‡ºä¸€ä¸ª div ç»„ä»¶ï¼›

```js
import styled from "styled-components";

export const AppWrapper = styled.div``; // æ ‡ç­¾æ¨¡æ¿å­—ç¬¦ä¸²å†™æ³•ï¼Œä¹Ÿç®—å‡½æ•°è°ƒç”¨
```

**è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ**

è¿™æ ·å°±å¯ä»¥é’ˆå¯¹ AppWrapper åŒ…è£¹çš„**æ‰€æœ‰å­å…ƒç´ **ï¼Œç¼–å†™æ ·å¼äº†ï¼›

```js
import styled from "styled-components";

export const AppWrapper = styled.div`
  .section {
    border: 1px solid red;
    .title {
      font-size: 30px;
      color: blue;
    }
    .content {
      font-size: 20px;
      color: green;
    }
  }
`;
```

åŒæ—¶å®‰è£…ä¸€ä¸ª vscode æ’ä»¶ï¼ˆvscode-styled-componentsï¼‰ï¼Œå¯ä»¥**é«˜äº®**å’Œ**æç¤º**

###### å¼•ç”¨ js çŠ¶æ€

ä¸»è¦æœ‰ä¸‰ç§

- æ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„ propsï¼ˆæ¨èï¼‰
- attrs ä¸­è®¾ç½®
- æ¥æ”¶å¤–éƒ¨çš„å˜é‡ï¼ˆæ¨èï¼‰

AppWrapper ç»„ä»¶é€šè¿‡**props**æ‹¿åˆ° js çš„çŠ¶æ€ï¼›

ç„¶ååœ¨**æ¨¡æ¿å­—ç¬¦ä¸²**ä¸­å¯ä»¥é€šè¿‡ä¸€ä¸ª**å‡½æ•°**ï¼Œå»æ‹¿åˆ° props ä¸­çš„ js çš„çŠ¶æ€ï¼›

å¦‚æœç›´æ¥é€šè¿‡ props å»å–æ˜¯å–ä¸åˆ°çš„ï¼ˆç›´æ¥å–ä¼šå»å½“å‰ä½œç”¨åŸŸæ‰¾ propsï¼‰ï¼›

```jsx
constructor() {
  super()

  this.state = {
    size: 30,
    color: 'yellow'
  }
}
render () {
  const { size, color } = this.state
  return (
    <AppWrapper size={size} color={color}>
      <div className='section'>
        <h2 className='title'>æˆ‘æ˜¯æ ‡é¢˜</h2>
        <p className='content'>æˆ‘æ˜¯å†…å®¹</p>
      </div>
    </AppWrapper>
  )
}
```

æ ·å¼

```js
import styled from "styled-components";

export const AppWrapper = styled.div`
  .section {
    border: 1px solid red;
    .title {
      font-size: ${(props) => props.size}px;
      color: ${(props) => props.color};
    }
    .content {
      font-size: 20px;
      color: green;
    }
  }
`;
```

###### å…±äº«çŠ¶æ€

æ¯”å¦‚ä¸€äº›**ä¸»é¢˜æ ·å¼**å°±éœ€è¦å…¨å±€å…±äº«ï¼›

æ‰¾åˆ°**æ ¹å…ƒç´ **ï¼Œä½¿ç”¨ styled-components ä¸­çš„**ThemeProvider**åŒ…è£¹æ ¹å…ƒç´ ï¼Œé€šè¿‡**theme å±æ€§**ä¼ é€’å…±äº«çš„å†…å®¹ï¼Œç±»ä¼¼äº context ä¸­å…±äº«çŠ¶æ€ï¼›

è¿™æ ·ï¼Œæ¯ä¸ª**æ ·å¼ç»„ä»¶**ï¼ˆä¸Šè¿° AppWrapper å°±æ˜¯ä¸€ä¸ªæ ·å¼ç»„ä»¶ï¼‰éƒ½å¯ä»¥é€šè¿‡**props**è·å–åˆ°å…±äº«çš„å†…å®¹ï¼Œè·å–æ–¹å¼ä¸ä¸Šè¿°è¿‡ç¨‹ç±»ä¼¼ï¼ˆé€šè¿‡å‡½æ•°ï¼‰ï¼›

æ ¹å…ƒç´ 

```jsx
import ReactDOM from "react-dom/client";
import App from "./App";
import { ThemeProvider } from "styled-components";

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(
  <ThemeProvider theme={{ color: "red" }}>
    <App />
  </ThemeProvider>
);
```

###### æ ·å¼ç»§æ‰¿

å½“éœ€è¦ç»§æ‰¿æŸäº›æ ·å¼æ—¶

```js
const SFButton = styled.button`
  border: 1px solid red;
  border-radius: 5px;
`;

export const SYButtonWrapper = styled(SFButton)`
  background-color: #fff;
`;
```

è¿™æ ·ï¼ŒSYButtonWrapper ç»„ä»¶å°±**ç»§æ‰¿**äº† SFButton ä¸­çš„ border å’Œ borde-radius ç›¸å…³çš„æ ·å¼ï¼Œå°±ä¸ç”¨å†å†™ä¸€éäº†ï¼›

### åŠ¨æ€æ·»åŠ  class

åœ¨ Vue ä¸­æ·»åŠ  class å¾ˆç®€å•ï¼Œä½ å¯ä»¥

- ä¼ å…¥ä¸€ä¸ªå¯¹è±¡
- ä¼ å…¥ä¸€ä¸ªæ•°ç»„
- ç”šè‡³æ˜¯å¯¹è±¡æ•°ç»„æ··åˆä½¿ç”¨

è€Œåœ¨ React ä¸­æ·»åŠ  classï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸‹**é€»è¾‘åˆ¤æ–­**æ¥æ·»åŠ æŸäº› classï¼ˆé€‚åˆæ·»åŠ ç®€å•çš„ classï¼‰ï¼›

ä½†è¦æ˜¯ class å¤æ‚èµ·æ¥ï¼Œè¿™æ·»åŠ èµ·æ¥å˜å¾—å¤æ‚ï¼›

è¿™æ˜¯å°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«**classnames**çš„åº“äº†ï¼›

#### classnames

å®‰è£…

```
npm install classnames
```

```jsx
constructor() {
  super()

  this.state = {
    isbbb: true
  }
}
render () {
  const { isbbb } = this.state
  return (
    <div>
      App
      <h2 className={classNames('aaa', { bbb: isbbb })}>hhh</h2>
    </div>
  )
}
```

å½“ isbbb ä¸º true æ—¶å°±åŠ ä¸Š bbb è¿™ä¸ªç±»å•¦ï¼›

## hooks

**ä¸ºä»€ä¹ˆéœ€è¦ hooksï¼Ÿ**

- React16.8 æ–°å¢ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨**state**ä»¥åŠå…¶å®ƒçš„**React ç‰¹æ€§**ï¼ˆæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸï¼‰
- å‡½æ•°å¼ç»„ä»¶æœ‰ä¸¤ä¸ªç¼ºé™·ï¼š

  - 1ï¼‰ä¸èƒ½ä¿å­˜çŠ¶æ€ï¼›
  - 2ï¼‰ä¿®æ”¹çŠ¶æ€ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œå°±ç®—èƒ½é‡æ–°æ‰§è¡Œï¼ŒçŠ¶æ€ä¹Ÿä¼šè¢«åˆå§‹åŒ–ï¼›

- ç±»ç»„ä»¶éšç€ä¸šåŠ¡çš„å¢å¤šï¼Œæ¯”å¦‚ componentDidMount å¯èƒ½åŒ…å«å¤§é‡çš„é€»è¾‘ä»£ç ï¼ŒåŒ…æ‹¬ç½‘ç»œè¯·æ±‚ã€ä¸€äº›äº‹ä»¶çš„ç›‘å¬ï¼ˆè¿˜éœ€è¦åœ¨ componentWillUNmount ä¸­ç§»é™¤ï¼‰ï¼Œå¯¼è‡´é€»è¾‘éš¾ä»¥æ‹†åˆ†ï¼›

### ä½¿ç”¨åœºæ™¯

- hook åŸºæœ¬å¯ä»¥ä»£æ›¿æ‰€æœ‰ä½¿ç”¨**class ç»„ä»¶**çš„åœ°æ–¹ï¼›
- è‹¥æ˜¯ä¸€ä¸ªæ—§çš„é¡¹ç›®ï¼Œå¹¶ä¸éœ€è¦ç›´æ¥å°†æ‰€æœ‰çš„ä»£ç é‡æ„ä¸º hooksï¼Œå› ä¸ºå®ƒå®Œå…¨**å‘ä¸‹å…¼å®¹**ï¼Œå¯ä»¥**æ¸è¿›å¼**çš„æ¥ä½¿ç”¨å®ƒï¼›
- hook åªèƒ½åœ¨**å‡½æ•°ç»„ä»¶**ä¸­ä½¿ç”¨ï¼›

åªèƒ½åœ¨**å‡½æ•°å¼ç»„ä»¶**ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”ç½®äº**é¡¶å±‚**ï¼ˆæœ€å¤–å±‚ï¼‰

ä½†æ˜¯ä¹Ÿå¯ä»¥åœ¨**è‡ªå®šä¹‰çš„ hook å‡½æ•°**ï¼ˆå‘½åä»¥ use å¼€å¤´ï¼‰ä¸­ä½¿ç”¨

### useState

#### å‚æ•°

åˆå§‹åŒ–å€¼ï¼Œä¸è®¾ç½®ä¸º undefinedï¼Œåªä¼šé¦–æ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨

#### è¿”å›å€¼

**æ•°ç»„**ï¼ŒåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼š

- å…ƒç´ ä¸€ï¼šå½“å‰çŠ¶æ€å€¼ï¼›
- å…ƒç´ äºŒï¼šè®¾ç½®çŠ¶æ€å€¼çš„å‡½æ•°ï¼›

è°ƒç”¨å…ƒç´ äºŒåï¼Œä¼šæ ¹æ®æ–°çš„çŠ¶æ€**é‡æ–°æ¸²æŸ“**å½“å‰ç»„ä»¶

ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œä¹‹åå†…å­˜å°±ä¼šè¢«å›æ”¶ï¼Œè€Œ state ä¸­çš„å˜é‡ä¼šè¢« react æ‰€ä¿ç•™

#### è®¡æ•°å™¨æ¡ˆä¾‹

çœ‹çœ‹ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶å’Œç±»ç»„ä»¶ç¼–å†™æœ‰ä»€ä¹ˆåŒºåˆ«

**ç±»ç»„ä»¶**

```jsx
import React, { PureComponent } from "react";

export class CounterClass extends PureComponent {
  constructor(props) {
    super(props);

    this.state = {
      count: 0,
    };
  }
  changeCount(num) {
    this.setState({ count: this.state.count + num });
  }
  render() {
    const { count } = this.state;
    return (
      <div>
        <h2>å½“å‰è®¡æ•°ï¼š{count}</h2>
        <button onClick={(e) => this.changeCount(1)}>+1</button>
        <button onClick={(e) => this.changeCount(-1)}>-1</button>
      </div>
    );
  }
}

export default CounterClass;
```

**å‡½æ•°å¼ç»„ä»¶ç»“åˆ hook**

**useState**çš„ä½œç”¨æ˜¯ç»™å‡½æ•°å¼ç»„ä»¶**å®šä¹‰çŠ¶æ€**çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çŠ¶æ€çš„**åˆå§‹åŒ–å€¼**ï¼Œåªæœ‰åœ¨**é¦–æ¬¡æ¸²æŸ“**æ—¶æ‰æœ‰æ•ˆï¼›

è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯è¯¥**çŠ¶æ€**ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸ª**å‡½æ•°**ï¼Œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ï¼Œå‚æ•°æ˜¯è¦**ä¿®æ”¹åçš„å€¼**ï¼›

```jsx
import { memo, useState } from "react";

function CounterHook(props) {
  const [counter, setCounter] = useState(0);
  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={(e) => setCounter(counter + 1)}>+1</button>
      <button onClick={(e) => setCounter(counter - 1)}>-1</button>
    </div>
  );
}

export default memo(CounterHook);
```

å¯¹æ¯”ä½ ä¼šå‘ç°ï¼š**å®šä¹‰çŠ¶æ€ä¸€è¡Œä»£ç ï¼Œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ä¹Ÿä¸ç”¨è‡ªå·±å®šä¹‰**

è¿™æ ·ä»£ç æ˜¯ä¸æ˜¯å˜å¾—ç®€æ´å¾ˆå¤šï¼Ÿ

### useEffect

useState å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®šä¹‰çŠ¶æ€ä»¥åŠä¿®æ”¹çŠ¶æ€ï¼Œ**é‚£ç”Ÿå‘½å‘¨æœŸå‘¢ï¼Ÿ**

**Effect Hook**å¯ä»¥å®Œæˆä¸€äº›ç±»ä¼¼**ç±»ç»„ä»¶ä¸­ç”Ÿå‘½å‘¨æœŸ**çš„åŠŸèƒ½ï¼›

äº‹å®ä¸Šï¼Œç±»ä¼¼äº**ç½‘ç»œè¯·æ±‚**ã€**æ‰‹åŠ¨æ›´æ–° DOM**ã€ä¸€äº›**äº‹ä»¶çš„ç›‘å¬**ï¼Œéƒ½æ˜¯ React æ›´æ–° DOM çš„ä¸€äº›å‰¯ä½œç”¨ï¼ˆside Effectsï¼‰

å¯¹äºå®Œæˆè¿™äº›åŠŸèƒ½çš„ hook è¢«ç§°ä¹‹ä¸º**Effect Hook**

#### å‚æ•°

##### å‚æ•°ä¸€

ä¼ å…¥ä¸€ä¸ª**å›è°ƒå‡½æ•°**ï¼Œå½“ç»„ä»¶æ¸²æŸ“å®Œæˆä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå¯ä»¥å°†ç»„ä»¶çš„ä¸€äº›**å‰¯ä½œç”¨**æ”¾åˆ°è¯¥å‡½æ•°å†…ï¼›

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯é¦–æ¬¡æ¸²æŸ“è¿˜æ˜¯ç»„ä»¶é‡æ–°æ¸²æŸ“å®Œæˆï¼Œéƒ½ä¼šæ‰§è¡Œè¯¥å›è°ƒå‡½æ•°

è¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼šåœ¨ç»„ä»¶**é‡æ–°æ¸²æŸ“æˆ–ç»„ä»¶å¸è½½**çš„æ—¶å€™æ‰§è¡Œ

##### å‚æ•°äºŒ

è¯¥ useEffect åœ¨å“ªäº›**state**å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰é‡æ–°æ‰§è¡Œï¼ˆå—è°å½±å“ï¼‰ï¼›

å¦‚æœä¼ å…¥ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œè¡¨ç¤ºä¸å—è°çš„å½±å“ï¼Œç¬¬ä¸€ä¸ªå‚æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼›

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å†³å®šå“ªäº›å‰¯ä½œç”¨é‡æ–°æ‰§è¡Œï¼›

è¿™ä¸ªå‚æ•°ä½¿å¾— useEffect æ¯”ç”Ÿå‘½å‘¨æœŸå¥½ç”¨å¾ˆå¤šï¼›

#### ä¿®æ”¹æ ‡é¢˜æ¡ˆä¾‹

```jsx
import { memo, useEffect, useState } from "react";

function CounterHook(props) {
  const [counter, setCounter] = useState(0);
  useEffect(() => {
    document.title = counter;
  });
  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={(e) => setCounter(counter + 1)}>+1</button>
    </div>
  );
}

export default memo(CounterHook);
```

#### æ¸…é™¤å‰¯ä½œç”¨

ç¼–å†™ class ç»„ä»¶æ—¶ï¼ŒæŸäº›å‰¯ä½œç”¨çš„ä»£ç ï¼Œéœ€è¦åœ¨**componentWillUNmount**ä¸­æ¸…é™¤ï¼Œæ¯”å¦‚ï¼š

- äº‹ä»¶æ€»çº¿æˆ– redux æ‰‹åŠ¨è°ƒç”¨ subscribe ä¹‹åï¼Œéœ€è¦**å–æ¶ˆè®¢é˜…**ï¼›

é‚£ useEffect æ˜¯æ€ä¹ˆå®ç°ç±»ä¼¼**componentWillUNmount**ä¸­çš„æ¸…é™¤æ“ä½œå‘¢ï¼Ÿ

```jsx
useEffect(() => {
  console.log("ç›‘å¬reduxä¸­çŠ¶æ€å˜åŒ–");
  return () => {
    console.log("å–æ¶ˆç›‘å¬reduxä¸­çŠ¶æ€å˜åŒ–");
  };
});
```

å¦‚æœ**ç›‘å¬-å–æ¶ˆç›‘å¬**æ”¾åœ¨ class ç»„ä»¶ä¸­ï¼Œå°±ä¼šå°†**ç›‘å¬**æ“ä½œæ”¾**componentDidMount**ä¸­ï¼Œè€Œ**å–æ¶ˆç›‘å¬**æ“ä½œæ”¾**componentWillUNmount**ä¸­ï¼Œç›¸å…³é€»è¾‘åˆ†æ•£äº†

è€Œä½¿ç”¨**useEffect**åï¼Œå¯ä»¥å¢åŠ ä»£ç çš„**å†…èšæ€§**

è¿™æ˜¯ effect çš„**æ¸…é™¤æœºåˆ¶**

#### å¤šä¸ª useEffect

åœ¨ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ä¸­å¯ä»¥æœ‰**å¤šä¸ª useEffect**ï¼Œé˜²æ­¢ä¸€ä¸ª useEffect å¤„ç†å¤šä¸ªå‰¯ä½œç”¨ï¼Œä¸åŒå‰¯ä½œç”¨åº”è¯¥åˆ†å¼€ï¼Œé€»è¾‘åˆ†ç¦»ï¼Œæ–¹ä¾¿åç»­æŠ½ç¦»æˆè‡ªå®šä¹‰ hookï¼Œå°±å¯ä»¥å¤ç”¨å•¦ï¼›

#### æ€§èƒ½ä¼˜åŒ–

å‰é¢è¯´åˆ°ï¼ŒuseEffect çš„å‚æ•°æ˜¯ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæˆåæ‰§è¡Œï¼Œå¦‚æœè¯¥ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¯¥å‡½æ•°ä¼š**é‡æ–°æ‰§è¡Œ**

è€ŒæŸäº›å‰¯ä½œç”¨åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼ˆç»„ä»¶é¦–æ¬¡æ¸²æŸ“åï¼‰ï¼Œæ¯”å¦‚**ç½‘ç»œè¯·æ±‚**ã€**è®¢é˜…å’Œå–æ¶ˆè®¢é˜…**

å¤šæ¬¡æ‰§è¡Œä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½çš„é—®é¢˜

```jsx
import { memo, useEffect, useState } from "react";

function CounterHook(props) {
  const [counter, setCounter] = useState(0);
  useEffect(() => {
    console.log("counterä¿®æ”¹, éœ€è¦é‡æ–°æ‰§è¡Œ");
  }, [counter]);
  useEffect(() => {
    console.log("è¯¥å‰¯ä½œç”¨åªéœ€è¦é‡æ–°æ‰§è¡Œä¸€æ¬¡");
  }, []);
  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={(e) => setCounter(counter + 1)}>+1</button>
    </div>
  );
}

export default memo(CounterHook);
```

### ç‰¹æ®Šåœºæ™¯çš„ hook

#### useContext

**ç»“åˆ context æ¥ä½¿ç”¨**

ä¹‹å‰åœ¨ç»„ä»¶ä¸­å…±äº« context çš„æ–¹å¼ï¼š

- ç±»ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡**ç±»å.contextType = MyContext** çš„æ–¹å¼è·å– contextï¼›
- å¤šä¸ª Context åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­é€šè¿‡**MyContext.Consumer** å…±äº« contextï¼›

ä½†æ˜¯è¦ç”¨åˆ°å¤šä¸ª contextï¼Œä»£ç å°±ä¼šå­˜åœ¨å¤§é‡çš„åµŒå¥—å…³ç³»ï¼Œå¯è¯»æ€§ä¸å¥½

è€Œ**useContext**å…è®¸æˆ‘ä»¬ç›´æ¥è·å–**æŸä¸ª context**çš„å€¼

å½“**å…±äº«çš„æ•°æ®å‘ç”Ÿå˜åŒ–**ï¼Œé‚£å…±äº«è¿‡è¿™äº›æ•°æ®çš„**ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“**ï¼Œè·å–æœ€æ–°çš„å…±äº«æ•°æ®ï¼›

**æ ¹ç»„ä»¶**

```jsx
import ReactDOM from "react-dom/client";
import App from "./App";
import { ThemeContext, UserContext } from "./context";

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(
  <UserContext.Provider value={{ name: "zsf" }}>
    <ThemeContext.Provider value={{ color: "red" }}>
      <App />
    </ThemeContext.Provider>
  </UserContext.Provider>
);
```

**context**

```js
import { createContext } from "react";

const UserContext = createContext();
const ThemeContext = createContext();

export { UserContext, ThemeContext };
```

**ä»¥å‰ä½¿ç”¨ context**

```jsx
import React, { memo } from "react";
import { ThemeContext, UserContext } from "./context";

const App = memo(() => {
  return (
    <div>
      <h2>App</h2>
      <UserContext.Consumer>
        {(value) => {
          return (
            <h2>
              {value.name}
              <ThemeContext.Consumer>
                {(value) => {
                  return <h2>{value.color}</h2>;
                }}
              </ThemeContext.Consumer>
            </h2>
          );
        }}
      </UserContext.Consumer>
    </div>
  );
});

export default App;
```

**ç»“åˆ useContext ä½¿ç”¨ context**

```
import React, { memo, useContext } from 'react'
import { ThemeContext, UserContext } from './context'

const App = memo(() => {
  const user = useContext(UserContext)
  const theme = useContext(ThemeContext)
  return (
    <div>
      <h2>App</h2>
      {user.name} - {theme.color}
    </div>
  )
})

export default App
```

#### useReducer

useReducer ä»…ä»…æ˜¯ useState çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆï¼›

æŸäº›åœºæ™¯ä¸‹ï¼Œè‹¥**state çš„å¤„ç†é€»è¾‘**æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ useReducer æ¥å¯¹å…¶è¿›è¡Œ**æ‹†åˆ†**ï¼›

æˆ–è¿™æ¬¡ä¿®æ”¹çš„ state éœ€è¦**ä¾èµ–ä¹‹å‰çš„ state**æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼›

##### å‚æ•°

- 1ï¼‰reducer å‡½æ•°
- 2ï¼‰state åˆå§‹åŒ–å€¼

##### è¿”å›å€¼

**æ•°ç»„**

- ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ stateï¼›
- ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ dispatchï¼›

#### useImperativeHandle

ä¹‹å‰æ˜¯æ€ä¹ˆè·å–å­ç»„ä»¶çš„ DOM çš„å‘¢ï¼Ÿ

```jsx
import React, { forwardRef, memo, useRef } from "react";

const Hello = memo(
  forwardRef((props, ref) => {
    return <input type="text" ref={ref} />;
  })
);

const App = memo(() => {
  const titleRef = useRef();

  function showDom() {
    console.log(titleRef.current);
  }

  return (
    <div>
      <Hello ref={titleRef} />
      <button onClick={(e) => showDom()}>+1</button>
    </div>
  );
});

export default App;
```

å¦‚æœæ‹…å¿ƒçˆ¶ç»„ä»¶é™¤äº†**è·å–å­ç»„ä»¶ DOM**ä¹‹å¤–è¿˜è¿›è¡Œå¦å¤–çš„æ“ä½œï¼Œå¯ä»¥ç»™çˆ¶ç»„ä»¶å¯¹å­ç»„ä»¶çš„æ“ä½œ**è®¾ç½®æƒé™**

ä¹Ÿå°±æ˜¯å­ç»„ä»¶æš´éœ²ç»™çˆ¶ç»„ä»¶ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨**useImperativeHandle**

##### å‚æ•°

1ï¼‰ref

2ï¼‰å‡½æ•°ï¼Œè¿”å› ref.current å¯¹è±¡ï¼Œç›¸å½“äº**é‡ç½®**åŸæ¥çš„ ref.current å¯¹è±¡

```jsx
import React, { forwardRef, memo, useImperativeHandle, useRef } from "react";

const Hello = memo(
  forwardRef((props, ref) => {
    // å­ç»„ä»¶å¯¹çˆ¶ç»„ä»¶ä¼ å…¥çš„refè¿›è¡Œå¤„ç†
    useImperativeHandle(ref, () => {
      return {
        focus() {
          // æƒ³DOMæ“ä½œå¯ä»¥åœ¨å­ç»„ä»¶å†…è¿›è¡Œ
          console.log("å­ç»„ä»¶åªæä¾›è¿™ä¸ªæ–¹æ³•");
        },
      };
    });
    return <input type="text" />;
  })
);

const App = memo(() => {
  const titleRef = useRef();

  function showDom() {
    titleRef.current.focus();
  }

  return (
    <div>
      <Hello ref={titleRef} />
      <button onClick={(e) => showDom()}>+1</button>
    </div>
  );
});

export default App;
```

å¦‚æ­¤ä¸€æ¥ï¼Œå­ç»„ä»¶**Hello**åªå‘çˆ¶ç»„ä»¶æä¾›**focus**æ–¹æ³•ï¼Œé€šè¿‡ titleRef.curent è·å–çš„æ–¹æ³•åªæœ‰ focusï¼›

#### useLayoutEffect

å®ƒä¸ useEffect çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼ï¼Œåªæœ‰ä¸€ç‚¹åŒºåˆ«ï¼š

- useEffect ä¼šåœ¨**æ¸²æŸ“çš„å†…å®¹**æ›´æ–°åˆ° DOM ä¸Šåæ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ DOM çš„æ›´æ–°ï¼›
- useLayoutEffect ä¼šåœ¨**æ¸²æŸ“çš„å†…å®¹æ›´æ–°åˆ° DOM ä¹‹å‰**æ‰§è¡Œï¼Œä¼šé˜»å¡ DOM çš„æ›´æ–°ï¼›

```jsx
import React, { memo, useEffect, useLayoutEffect, useState } from "react";

const App = memo(() => {
  const [count, setCount] = useState(0);
  useEffect(() => {
    console.log("useEffect");
  });

  useLayoutEffect(() => {
    console.log("useLayoutEffect");
  });

  console.log("App render");
  return (
    <div>
      <h2>{count}</h2>
      <button onClick={(e) => setCount()}>+1</button>
    </div>
  );
});

export default App;
```

ä½ ä¼šçœ‹åˆ°æ‰“å°é¡ºåºæ˜¯ï¼šApp renderã€useLayoutEffectã€useEffect

ä½†æ˜¯å®˜æ–¹ä¸å¤ªæ¨èä½¿ç”¨

#### useSelector

åœ¨ä¹‹å‰çš„ redux å¼€å‘ä¸­ï¼Œä¸ºäº†è®©ç»„ä»¶å’Œ redux ç»“åˆèµ·æ¥ï¼Œä½¿ç”¨äº†**connect**è¿”å›çš„**é«˜é˜¶å‡½æ•°**ï¼›

è¿˜éœ€è¦ç¼–å†™**mapStateToProps**å’Œ**mapDispatchToProps**æ˜ å°„çš„å‡½æ•°ï¼›

redux7.1 å¼€å§‹ï¼Œæä¾›äº†**Hook**çš„æ–¹å¼ï¼›

å®ƒçš„ä½œç”¨æ˜¯å°† state æ˜ å°„åˆ°ç»„ä»¶ä¸­ï¼š

- å‚æ•° 1ï¼šå°† state æ˜ å°„åˆ°éœ€è¦çš„æ•°æ®ä¸­ï¼›
- å‚æ•° 2ï¼šå¯ä»¥è¿›è¡Œæ¯”è¾ƒæ¥å†³å®šæ˜¯å¦é‡æ–°æ¸²æŸ“ï¼›

```jsx
import React, { memo, useEffect } from 'react'
import { useSelector } from 'react-redux'

const App = memo(() => {
  const { count } = useSelector((state) => ({
      count: state.counter.count
  })
  return (
    <div>
      <h2>App:{count}</h2>
    </div>
  )
})

export default App
```

##### æ€§èƒ½ä¼˜åŒ–

ç»„ä»¶ä½¿ç”¨**useSelector**æ—¶ï¼Œç›‘å¬çš„æ˜¯æ•´ä¸ª**state**ï¼›

åªè¦ state å‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶å°±ä¼š**é‡æ–°æ¸²æŸ“**ï¼›

è¿™æ˜¾ç„¶æ˜¯ä¸åº”è¯¥çš„ï¼šæ¯”å¦‚ï¼Œstate ä¸­çš„ count æ”¹å˜ï¼ŒæŸä¸ª**å­ç»„ä»¶**çš„ props å¹¶æœªå‘ç”Ÿæ”¹å˜ï¼Œè€Œåªæ˜¯ä½¿ç”¨**useSelector**æ˜ å°„ state ä¸­ numï¼Œä½†ç”±äº state å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼›

æ‰€ä»¥å¯¹ state çš„ç›‘å¬ï¼Œåº”è¯¥æ›´ç²¾å‡†äº›ï¼ŒuseSelector æä¾›äº†ç¬¬äºŒä¸ªå‚æ•°ï¼›

```jsx
import React, { memo, useEffect } from 'react'
import { useSelector, shallowEqual } from 'react-redux'

const App = memo(() => {
  const { count } = useSelector((state) => ({
      count: state.counter.count
  }, shallowEqual)
  return (
    <div>
      <h2>App:{count}</h2>
    </div>
  )
})

export default App
```

#### useDispatch

ç›´æ¥è·å– dispatch

```js
const dispatch = useDispatch();
```

#### useId

##### SPA çš„ç¼ºé™·

- é¦–å±æ¸²æŸ“é€Ÿåº¦
- ä¸åˆ©äº SEO ä¼˜åŒ–

##### æœåŠ¡å™¨ç«¯æ¸²æŸ“

**SSR**ï¼ˆServer Side Renderingï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰ï¼ŒæŒ‡çš„æ˜¯é¡µé¢åœ¨**æœåŠ¡å™¨ç«¯**å·²ç»æ¸²æŸ“å¥½äº†ï¼›

CSRï¼ˆClient Side Renderingï¼Œå®¢æˆ·ç«¯æ¸²æŸ“ï¼‰ï¼Œæ¯”å¦‚ SPA é¡µé¢ï¼Œéœ€è¦æµè§ˆå™¨æ‰§è¡Œ jsï¼Œåˆ›å»ºå®Œæ•´çš„é¡µé¢ç»“æ„ï¼›

##### SSR åŒæ„åº”ç”¨

ä¸€å¥—ä»£ç æ—¢å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œï¼Œåˆå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿è¡Œï¼Œå°±å«åŒæ„åº”ç”¨

å‰ç«¯ä»£ç ä»£ç åœ¨**æœåŠ¡å™¨ç«¯**è¿è¡Œåªæ˜¯ htmlï¼Œä¸å…·å¤‡äº¤äº’æ€§ï¼›è¿˜éœ€åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰åŠ è½½é¡µé¢ï¼Œè¿™ä¸ªè¿‡ç¨‹å«**hydration**ï¼›

**è€Œ useId çš„ä½œç”¨æ˜¯ï¼šç”Ÿæˆæ¨ªè·¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„å”¯ä¸€ç¨³å®šçš„ idï¼ŒåŒæ—¶é¿å… hydration ä¸åŒ¹é…**

#### useTransition

å‘Šè¯‰ react å¯¹äºéƒ¨åˆ†ä»»åŠ¡çš„æ›´æ–°ä¼˜å…ˆçº§è¾ƒä½ï¼Œå¯ä»¥ç¨åè¿›è¡Œæ›´æ–°

æ¨èä¸€ä¸ªç”Ÿæˆè™šæ‹Ÿæ•°æ®çš„åº“ **@faker-js/faker**

çœ‹è¿™ä¹ˆä¸€ä¸ªæ¡ˆä¾‹ï¼Œ**æ ¹æ®è¾“å…¥æ¡†è¿‡æ»¤æ˜¾ç¤ºåˆ—è¡¨**

å½“æ•°æ®é‡è¿‡å¤§ï¼Œè¾“å…¥æ¡†çš„é‡æ–°æ¸²æŸ“ä¼šç­‰å¾…**åˆ—è¡¨çš„æ›´æ–°**åæ‰è¿›è¡Œçš„ï¼Œå¯¼è‡´è¾“å…¥æ¡†åˆ·æ–°**å¡é¡¿**ï¼›

æ‰€ä»¥å¯ä»¥ä½¿ç”¨**useTransition**å‘ŠçŸ¥ react åˆ—è¡¨çš„æ›´æ–°ä¼˜å…ˆçº§è¾ƒä½ï¼Œç­‰è¾“å…¥æ¡†é‡æ–°æ¸²æŸ“å†æ›´æ–°åˆ—è¡¨ï¼›

```js
import { faker } from "@faker-js/faker";

const namesArray = [];
for (let i = 0; i < 1000; i++) {
  namesArray.push(faker.name.fullName());
}

export default namesArray;
```

```jsx
import React, { memo, useState, useTransition } from "react";
import namesArray from "./namesArray";

const App = memo(() => {
  const [showNames, setShowNames] = useState(namesArray);
  const [pending, startTransition] = useTransition();

  function valueChangeHandle(event) {
    startTransition(() => {
      const keyword = event.target.value;
      const filterShowNames = namesArray.filter((item) =>
        item.includes(keyword)
      );
      setShowNames(filterShowNames);
    });
  }
  return (
    <div>
      <input type="text" onInput={valueChangeHandle} />
      <h2>ç”¨æˆ·ååˆ—è¡¨ï¼š{pending && <span>loading...</span>}</h2>
      <ul>
        {showNames.map((item, index) => {
          return <li key={index}>{item}</li>;
        })}
      </ul>
    </div>
  );
});

export default App;
```

#### useDeferredValue

ä¸ useTransition ç±»ä¼¼ï¼Œå¯ä»¥æ›´æ–°å»¶è¿Ÿ

```js
import { faker } from "@faker-js/faker";

const namesArray = [];
for (let i = 0; i < 1000; i++) {
  namesArray.push(faker.name.fullName());
}

export default namesArray;
```

```jsx
import React, { memo, useDeferredValue, useState } from "react";
import namesArray from "./namesArray";

const App = memo(() => {
  const [showNames, setShowNames] = useState(namesArray);
  const deferredShowNames = useDeferredValue(showNames);

  function valueChangeHandle(event) {
    const keyword = event.target.value;
    const filterShowNames = namesArray.filter((item) => item.includes(keyword));
    setShowNames(filterShowNames);
  }
  return (
    <div>
      <input type="text" onInput={valueChangeHandle} />
      <h2>ç”¨æˆ·ååˆ—è¡¨ï¼š</h2>
      <ul>
        {deferredShowNames.map((item, index) => {
          return <li key={index}>{item}</li>;
        })}
      </ul>
    </div>
  );
});

export default App;
```

### æ€§èƒ½ä¼˜åŒ–çš„ hook

#### useCallback

åœ¨**å‡½æ•°å¼ç»„ä»¶**ä¸­ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¿®æ”¹çŠ¶æ€çš„**æ–¹æ³•**ï¼›

å½“çŠ¶æ€æ”¹å˜ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ä¹Ÿä¼š**é‡æ–°å®šä¹‰**ï¼›

è¿™æ ·ä½¿å¾—ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ—¶å€™ï¼Œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•è¢«**åå¤å›æ”¶å’Œå®šä¹‰**ï¼Œè¿™æ ·å­˜åœ¨ä¸€å®šçš„æ€§èƒ½é—®é¢˜ï¼›

è€Œ**useCallback**å®é™…çš„ç›®çš„æ˜¯ä¸ºäº†è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼›

**å®ƒæ˜¯å¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–çš„å‘¢ï¼Ÿ**

1. useCallback ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°çš„**è®°å¿†å€¼**ï¼ˆç”¨çš„æ˜¯**é—­åŒ…é™·é˜±**ï¼‰ï¼›
2. åœ¨ä¾èµ–ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¤šæ¬¡å®šä¹‰æ—¶ï¼Œ**è¿”å›çš„å€¼æ˜¯ç›¸åŒçš„**ï¼›

ä½ å¯èƒ½ä¼šè¿™æ ·ç”¨

```jsx
import React, { memo, useCallback, useState } from "react";

const App = memo(() => {
  const [counter, setCounter] = useState(0);
  const increment = useCallback(function () {
    setCounter(counter + 1);
  });

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={increment}>+1</button>
    </div>
  );
});

export default App;
```

è¿™æ ·çš„è¯ï¼Œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ä¾ç„¶å¤šæ¬¡å®šä¹‰ï¼Œä¸è¿‡æ˜¯ä»¥å‚æ•°çš„å½¢å¼ï¼Œå¹¶æ²¡æœ‰è§£å†³é—®é¢˜

##### å‚æ•°

- 1ï¼‰å›è°ƒå‡½æ•°
- 2ï¼‰æ•°ç»„ï¼ˆç±»ä¼¼ useEffectï¼Œåªå…³æ³¨æŸäº›çŠ¶æ€ï¼Œå½“è¿™äº›çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šè¿”å›æ–°çš„**è®°å¿†å€¼**ï¼‰

ç»™ä¸ªæ¡ˆä¾‹è¯´æ˜ä¸€ä¸‹ useCallback çš„å¥½å¤„

```jsx
import React, { memo, useCallback, useState } from 'react'

// å½“propsä¸­çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»„ä»¶æœ¬èº«ä¼šè¢«é‡æ–°æ¸²æŸ“
const SFIncrement = memo(function (props) {
  const { increment } = props
  console.log('SFIncrementè¢«æ¸²æŸ“')
  return (
    <div>
      <button onClick={e => increment()}>ç‚¹å‡»</button>
    </div>
  )
})

const App = memo(() => {
  const [counter, setCounter] = useState(0)
  const [message, setMessage] = useState('hello')

  const increment = () => {
    setCounter(counter + 1)
  }

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={increment}>+1</button>
      <SFIncrement increment={increment} />
      <h3>{message}</h3>
      <button onClick={e => setMessage('ä½ å¥½')}>
  )
export default App
```

å½“çŠ¶æ€**message**å‘ç”Ÿæ”¹å˜ï¼Œç»„ä»¶**App**é‡æ–°æ¸²æŸ“ï¼Œ**inrement**é‡æ–°å®šä¹‰ï¼Œå€¼å‘ç”Ÿå˜åŒ–ï¼Œå­ç»„ä»¶**SFIncrement**å¯¹ increment æœ‰ä¾èµ–ï¼Œä¹Ÿå¾—é‡æ–°æ¸²æŸ“ï¼›

è¿™æ˜¯ä¸åº”è¯¥çš„ã€‚

ä½†å¦‚æœä½¿ç”¨äº† useCallback

```jsx
import React, { memo, useCallback, useState } from "react";

// å½“propsä¸­çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»„ä»¶æœ¬èº«ä¼šè¢«é‡æ–°æ¸²æŸ“
const SFIncrement = memo(function (props) {
  const { increment } = props;
  console.log("SFIncrementè¢«æ¸²æŸ“");
  return (
    <div>
      <button onClick={(e) => increment()}>ç‚¹å‡»</button>
    </div>
  );
});

const App = memo(() => {
  const [counter, setCounter] = useState(0);
  const [message, setMessage] = useState("hello");
  const increment = useCallback(
    function () {
      setCounter(counter + 1);
    },
    [counter]
  );

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={increment}>+1</button>
      <SFIncrement increment={increment} />
      <h3>{message}</h3>
      <button onClick={(e) => setMessage("ä½ å¥½")}></button>
    </div>
  );
});

export default App;
```

å½“çŠ¶æ€**message**å‘ç”Ÿæ”¹å˜ï¼Œç»„ä»¶**App**é‡æ–°æ¸²æŸ“ï¼›

ç”±äº**useCallback**ç¬¬äºŒå‚æ•°å‘ŠçŸ¥å®ƒåªå…³æ³¨çŠ¶æ€**counter**ï¼Œå½“ counter å‘ç”Ÿå˜åŒ–æ‰ä¼šè¿”å›æ–°çš„**è®°å¿†å€¼**ï¼›

å°½ç®¡ä½ ä¿®æ”¹çŠ¶æ€**message**ï¼Œä½†**inrement**ä¾ç„¶ç”¨ä¸Šä¸€æ¬¡çš„è®°å¿†å€¼ï¼ˆé—­åŒ…é™·é˜±ï¼‰ï¼Œå€¼å¹¶**æœªå‘ç”Ÿå˜åŒ–**ï¼Œå­ç»„ä»¶**SFIncrement**ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼›

**è¿™ä¸å°±ä½“ç°å‡º useCallback çš„å¯¹æ€§èƒ½çš„ä¼˜åŒ–äº†å—ï¼Ÿ**

##### åº”ç”¨åœºæ™¯

- å½“**å­ç»„ä»¶**éœ€è¦ä¼ å…¥ä¸€ä¸ª**å‡½æ•°**å½“ props æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ useCallback è¿›è¡Œä¼˜åŒ–

é€šå¸¸ä½¿ç”¨ useCallback çš„ç›®çš„æ˜¯**ä¸å¸Œæœ›å­ç»„ä»¶è¿›è¡Œå¤šæ¬¡æ¸²æŸ“**ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†å‡½æ•°è¿›è¡Œç¼“å­˜ï¼›

#### useRef

ä¸Šè¿°ä»£ç è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š**å½“ counter æ”¹å˜ï¼Œä¹Ÿä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°**

æ–¹å¼ä¸€ï¼Œ**è§£é™¤å¯¹ counter çš„ä¾èµ–**ï¼Œç¼ºé™·ï¼šé—­åŒ…é™·é˜±ï¼ŒçŠ¶æ€ counter æ¯æ¬¡éƒ½æ˜¯ç”¨çš„**åˆå§‹åŒ–çš„å€¼**ï¼Œå¯¼è‡´ä¿®æ”¹éƒ½æ˜¯åœ¨åˆè¯†å€¼çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼ˆ0 + 1ï¼‰ï¼Œä¹Ÿå°±æ— æ³•ä¿®æ”¹çŠ¶æ€

```jsx
import React, { memo, useCallback, useState } from "react";

// å½“propsä¸­çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»„ä»¶æœ¬èº«ä¼šè¢«é‡æ–°æ¸²æŸ“
const SFIncrement = memo(function (props) {
  const { increment } = props;
  console.log("SFIncrementè¢«æ¸²æŸ“");
  return (
    <div>
      <button onClick={(e) => increment()}>ç‚¹å‡»</button>
    </div>
  );
});

const App = memo(() => {
  const [counter, setCounter] = useState(0);
  const [message, setMessage] = useState("hello");
  const increment = useCallback(function () {
    setCounter(counter + 1);
  }, []);

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={increment}>+1</button>
      <SFIncrement increment={increment} />
      <h3>{message}</h3>
      <button onClick={(e) => setMessage("ä½ å¥½")}></button>
    </div>
  );
});

export default App;
```

##### è¿”å›åŒä¸€ä¸ªå¯¹è±¡

åˆ©ç”¨ useRef è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥è§£å†³ä¸Šè¿°çš„**é—­åŒ…é™·é˜±**é—®é¢˜

```jsx
import React, { memo, useCallback, useState, useRef } from "react";

// å½“propsä¸­çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»„ä»¶æœ¬èº«ä¼šè¢«é‡æ–°æ¸²æŸ“
const SFIncrement = memo(function (props) {
  const { increment } = props;
  console.log("SFIncrementè¢«æ¸²æŸ“");
  return (
    <div>
      <button onClick={(e) => increment()}>ç‚¹å‡»</button>
    </div>
  );
});

const App = memo(() => {
  const [counter, setCounter] = useState(0);
  const [message, setMessage] = useState("hello");

  const countRef = useRef();
  countRef.current = counter;
  const increment = useCallback(function () {
    setCounter(countRef.current + 1);
  }, []);

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={increment}>+1</button>
      <SFIncrement increment={increment} />
      <h3>{message}</h3>
      <button onClick={(e) => setMessage("ä½ å¥½")}></button>
    </div>
  );
});

export default App;
```

è™½ç„¶ç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼Œä½†**countRef æ˜¯åŒä¸€ä¸ªå¯¹è±¡**ï¼Œä½†å®ƒçš„**current å±æ€§**æ¯æ¬¡æ¸²æŸ“éƒ½è¢«èµ‹äºˆçŠ¶æ€**counter**æœ€æ–°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ counter è¢«ä¿å­˜åˆ° current äº†ï¼Œcounter å°±å¯ä»¥æ­£ç¡®è¢«ä¿®æ”¹äº†ï¼Œå¹¶ä¸”ä¸ä¼šæ¸²æŸ“å­ç»„ä»¶**SFIncrement**

##### è·å– DOM

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ createRef è·å– DOMï¼Œ**useRef**å¯ä»¥åœ¨**å‡½æ•°å¼ç»„ä»¶**ä¸­è·å– DOMï¼›

```jsx
import React, { memo, useRef } from "react";

const App = memo(() => {
  const titleRef = useRef();

  function showDom() {
    console.log(titleRef.current);
  }

  return (
    <div>
      <h2 ref={titleRef}>hello</h2>
      <button onClick={(e) => showDom()}>+1</button>
    </div>
  );
});

export default App;
```

#### useMemo

##### å‚æ•°

æ¥æ”¶å‚æ•°ç±»ä¼¼ useCallbackï¼Œä½†æ˜¯**useCallback**çš„è¿”å›å€¼æ˜¯**å‚æ•° 1 çš„æœ¬èº«**ï¼Œè€Œ**useMemo**çš„è¿”å›å€¼çš„**å‚æ•° 1 çš„è¿”å›å€¼**ï¼›

**useCallback(fn, [])**ç›¸å½“äº**useMemo(() => fn, [])**

- 1ï¼‰å‡½æ•°
- 2ï¼‰æ•°ç»„

```jsx
import React, { memo, useState } from "react";

function calcNum(num) {
  console.log("è®¡ç®—è¿‡ç¨‹è¢«è°ƒç”¨");
  let total = 0;
  for (let i = 0; i < num; i++) {
    total += 1;
  }
  return total;
}
const App = memo(() => {
  const [counter, setCounter] = useState(0);
  const result = calcNum(50);
  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={(e) => setCounter(counter + 1)}></button>
      <div>ç»“æœ:{result}</div>
    </div>
  );
});

export default App;
```

å½“çŠ¶æ€**counter**å‘ç”Ÿæ”¹å˜ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè€Œ**result è®¡ç®—è¿‡ç¨‹**ä¹Ÿä¼šè¢«é‡æ–°æ‰§è¡Œï¼Œè¿™æ˜¯ä¸åº”è¯¥çš„ï¼›

**ä½¿ç”¨ useMemo ä¹‹å**

```jsx
import React, { memo, useMemo, useState } from "react";

function calcNum(num) {
  console.log("è®¡ç®—è¿‡ç¨‹è¢«è°ƒç”¨");
  let total = 0;
  for (let i = 0; i < num; i++) {
    total += 1;
  }
  return total;
}
const App = memo(() => {
  const [counter, setCounter] = useState(0);

  const result = useMemo(() => {
    return calcNum(50);
  }, []);

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={(e) => setCounter(counter + 1)}>+1</button>
      <div>ç»“æœ:{result}</div>
    </div>
  );
});

export default App;
```

å°½ç®¡ç»„ä»¶è¢«ç¨‹é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿåªä¼šæ‰§è¡Œ**calcNum**ä¸€æ¬¡ï¼›

å¦‚æœ**calcNum**å¯¹å…¶å®ƒçŠ¶æ€æœ‰ä¾èµ–ï¼Œå¯ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¼ ï¼›

åŒç†ï¼Œå¦‚æœ**å¯¹å­ç»„ä»¶ä¼ å…¥ç›¸åŒå†…å®¹çš„å¯¹è±¡**ï¼Œå¯ä»¥ä½¿ç”¨ useMemo è¿›è¡Œä¼˜åŒ–ï¼›

```jsx
import React, { memo, useMemo, useState } from "react";

const App = memo(() => {
  const [counter, setCounter] = useState(0);

  const info = useMemo(() => ({ name: "zsf", age: 18 }), []);

  return (
    <div>
      <h2>å½“å‰è®¡æ•°ï¼š{counter}</h2>
      <button onClick={(e) => setCounter(counter + 1)}>+1</button>
      <å­ç»„ä»¶ info={info} />
    </div>
  );
});

export default App;
```

### è‡ªå®šä¹‰ hook

hook çš„æ€æƒ³å°±æ˜¯æŠ½å–é‡å¤çš„é€»è¾‘ï¼Œå¼€å‘ä¸­é‡åˆ°é‡å¤ä½¿ç”¨çš„é€»è¾‘ï¼Œæ˜¯å¯ä»¥æŠ½å–å‡ºæ¥ï¼Œè‡ªå®šä¹‰æˆ hook çš„ï¼›

**è¿™ä¸å°±ä¹‹å‰çš„é«˜é˜¶ç»„ä»¶ï¼ˆé’ˆå¯¹ç±»ç»„ä»¶ï¼‰çš„ä½œç”¨å—ï¼Ÿ**

è€Œ hook å¤ç”¨é€»è¾‘æ˜¯é’ˆå¯¹å‡½æ•°å¼ç»„ä»¶

#### æ‰“å°ç”Ÿå‘½å‘¨æœŸ

ç°åœ¨æœ‰ä¸ªéœ€æ±‚ï¼Œæ‰€æœ‰ç»„ä»¶åˆ›å»ºå’Œé”€æ¯éƒ½è¿›è¡Œæ‰“å°

```jsx
import React, { memo, useEffect } from "react";

function usePrintLife() {
  useEffect(() => {
    console.log("ç»„ä»¶è¢«åˆ›å»º");
    return () => {
      console.log("ç»„ä»¶è¢«é”€æ¯");
    };
  }, []);
}

const App = memo(() => {
  usePrintLife();
  return (
    <div>
      <h2>App</h2>
    </div>
  );
});

export default App;
```

#### localStorage ä¸ useState ç»“åˆ

å½“å¾ˆå¤šç»„ä»¶éƒ½éœ€è¦è·å– localStorage ä¸­çš„å†…å®¹ä½œä¸ºçŠ¶æ€æ—¶ï¼Œå°±å¯ä»¥å°†è¿™éƒ¨åˆ†ä»£ç æŠ½å–æˆ hook

```js
import { useEffect, useState } from "react";

function useLocalStorage(key) {
  const [data, setData] = useState(JSON.parse(localStorage.getItem(key)) || "");

  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(data));
  }, [data]);

  return [data, setData];
}

export default useLocalStorage;
```

å…¶å®ƒç»„ä»¶åªè¦ä½¿ç”¨**useLocalStorage**è¿™ä¸ª hook å³å¯

#### å…ƒç´ å¯æ‹–åŠ¨

```js
import { useRef, useState, useEffect, useCallback } from 'react';

/**
 * useDraggable Hook
 * @param {Object} options - Hook çš„é€‰é¡¹
 * @param {Function} options.onDragStart - æ‹–åŠ¨å¼€å§‹æ—¶çš„å›è°ƒå‡½æ•°
 * @param {Function} options.onDrag - æ‹–åŠ¨è¿›è¡Œæ—¶çš„å›è°ƒå‡½æ•°
 * @param {Function} options.onDragEnd - æ‹–åŠ¨ç»“æŸæ—¶çš„å›è°ƒå‡½æ•°
 * @param {boolean} options.supportTouch - æ˜¯å¦æ”¯æŒè§¦æ‘¸äº‹ä»¶ï¼Œé»˜è®¤ä¸æ”¯æŒ
 * @returns {Object} - è¿”å›ä¸€ä¸ª ref ç”¨äºç»‘å®šåˆ°å¯æ‹–åŠ¨å…ƒç´ å’Œå½“å‰çš„ä½ç½®
 */
const useDraggable = ({ onDragStart, onDrag, onDragEnd, supportTouch = false } = {}) => {
  const draggableRef = useRef(null);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [isDragging, setIsDragging] = useState(false);

  // å¤„ç†é¼ æ ‡æˆ–è§¦æ‘¸ç§»åŠ¨äº‹ä»¶: è®¡ç®—æ–°ä½ç½®å¹¶æ›´æ–°å…ƒç´ ä½ç½®
  const handleMove = useCallback(
    (startX, startY) => (moveEvent) => {
      moveEvent.preventDefault();
      const clientX = moveEvent.touches ? moveEvent.touches[0].clientX : moveEvent.clientX;
      const clientY = moveEvent.touches ? moveEvent.touches[0].clientY : moveEvent.clientY;

      // æ–°ä½ç½® = é¼ æ ‡/è§¦æ‘¸ä½ç½® - åˆå§‹ä½ç½®
      const newX = clientX - startX;
      const newY = clientY - startY;

      setPosition({ x: newX, y: newY });
      onDrag && onDrag({ x: newX, y: newY });

      if (draggableRef.current) {
        draggableRef.current.style.transform = `translate(${newX}px, ${newY}px)`;
      }
    },
    [onDrag],
  );

  // å¤„ç†é¼ æ ‡æˆ–è§¦æ‘¸æ¾å¼€äº‹ä»¶: è§£ç»‘ç§»åŠ¨å’Œæ¾å¼€äº‹ä»¶
  const handleEnd = useCallback(
    (handleMove) => (endEvent) => {
      setIsDragging(false);
      onDragEnd && onDragEnd(endEvent);

      document.removeEventListener('mousemove', handleMove);
      document.removeEventListener('mouseup', handleEnd);
      if (supportTouch) {
        document.removeEventListener('touchmove', handleMove);
        document.removeEventListener('touchend', handleEnd);
      }
    },
    [onDragEnd, supportTouch],
  );

  // å¤„ç†é¼ æ ‡æˆ–è§¦æ‘¸æŒ‰ä¸‹äº‹ä»¶: è®¡ç®—åˆå§‹ä½ç½®å¹¶ç»‘å®šç§»åŠ¨å’Œæ¾å¼€äº‹ä»¶
  const handleStart = useCallback(
    (event) => {
      if (event.button !== undefined && event.button !== 0) return; // åªå…è®¸å·¦é”®æ‹–åŠ¨

      setIsDragging(true);
      onDragStart && onDragStart(event);

      const clientX = event.touches ? event.touches[0].clientX : event.clientX;
      const clientY = event.touches ? event.touches[0].clientY : event.clientY;

      // åˆå§‹ä½ç½® = é¼ æ ‡/è§¦æ‘¸ä½ç½® - å…ƒç´ å½“å‰ä½ç½®
      const startX = clientX - position.x;
      const startY = clientY - position.y;

      const moveHandler = handleMove(startX, startY);
      const endHandler = handleEnd(moveHandler);

      document.addEventListener('mousemove', moveHandler);
      document.addEventListener('mouseup', endHandler);
      if (supportTouch) {
        document.addEventListener('touchmove', moveHandler, { passive: false });
        document.addEventListener('touchend', endHandler, { passive: false });
      }
    },
    [position, onDragStart, handleMove, handleEnd, supportTouch],
  );

  // ç»‘å®šå’Œè§£ç»‘äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶è®¾ç½® cursor æ ·å¼
  useEffect(() => {
    const element = draggableRef.current;
    if (!element) return;

    element.addEventListener('mousedown', handleStart);
    if (supportTouch) {
      element.addEventListener('touchstart', handleStart, { passive: false });
    }

    // è®¾ç½® cursor æ ·å¼
    element.style.cursor = isDragging ? 'grabbing' : 'grab';

    return () => {
      element.removeEventListener('mousedown', handleStart);
      if (supportTouch) {
        element.removeEventListener('touchstart', handleStart);
      }
      element.style.cursor = ''; // æ¸…é™¤ cursor æ ·å¼
    };
  }, [handleStart, isDragging, supportTouch]);

  return { draggableRef };
};

export default useDraggable;
```

### å…ƒç´ æ‹–åŠ¨çš„å®Œæ•´æµç¨‹

1. **ç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡å·¦é”®ï¼ˆå¼€å§‹è§¦æ‘¸ï¼‰**ï¼š
   - è§¦å‘ **handleMouseDown** äº‹ä»¶ã€‚
   - è®¡ç®—åˆå§‹ä½ç½® startX å’Œ startYã€‚
   - æ·»åŠ  `mousemove` å’Œ `mouseup` äº‹ä»¶ç›‘å¬å™¨ã€‚
2. **ç”¨æˆ·ç§»åŠ¨é¼ æ ‡ï¼ˆæ»‘åŠ¨ï¼‰**ï¼š
   - è§¦å‘ **handleMouseMove**äº‹ä»¶ã€‚
   - è®¡ç®—æ–°çš„ä½ç½® newX å’Œ newYã€‚
   - æ›´æ–° `position` çŠ¶æ€ï¼Œå¹¶ç§»åŠ¨å…ƒç´ åˆ°æ–°çš„ä½ç½®ã€‚
3. **ç”¨æˆ·æ¾å¼€é¼ æ ‡ï¼ˆæ¾å¼€ï¼‰**ï¼š
   - è§¦å‘ **handleMouseUp** äº‹ä»¶ã€‚
   - è®¾ç½® **isDragging** çŠ¶æ€ä¸º `false`ã€‚
   - ç§»é™¤ `mousemove` å’Œ `mouseup` äº‹ä»¶ç›‘å¬å™¨ã€‚

## è·¯ç”±

React Router6.x å‘ç”Ÿäº†è¾ƒå¤§çš„å˜åŒ–ï¼Œç›®å‰å®ƒå·²ç»éå¸¸ç¨³å®šï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼›

### åŸºæœ¬ä½¿ç”¨

#### å®‰è£…

- å®‰è£…æ—¶ï¼Œé€‰æ‹©**react-router-dom**ï¼›
- **react-router**ä¼šåŒ…å«ä¸€äº›**react-native**çš„å†…å®¹ï¼Œweb å¼€å‘ä¸éœ€è¦ï¼›

```
npm install react-router-dom;
```

react-router æœ€ä¸»è¦çš„**API**æ˜¯ç»™æˆ‘ä»¬æä¾›ä¸€äº›ç»„ä»¶ï¼š

**BrowserRouter æˆ– HashRouter**

- Router ä¸­åŒ…å«äº†å¯¹è·¯å¾„æ”¹å˜çš„ç›‘å¬ï¼Œå¹¶ä¸”ä¼šå°†ç›¸åº”çš„è·¯å¾„ä¼ é€’ç»™å­ç»„ä»¶ï¼›
- BrowserRouter ä½¿ç”¨ history æ¨¡å¼ï¼›
- HashRouter ä½¿ç”¨ Hash æ¨¡å¼ï¼›

#### åŒ…è£¹ç»„ä»¶

```jsx
import ReactDOM from "react-dom/client";
import App from "./App";
import { HashRouter } from "react-router-dom";

const root = ReactDOM.createRoot(document.querySelector("#root"));
root.render(
  <HashRouter>
    <App />
  </HashRouter>
);
```

#### è·¯ç”±æ˜ å°„é…ç½®

**Route**sï¼šåŒ…è£¹æ‰€æœ‰çš„ Routeï¼Œåœ¨å…¶ä¸­åŒ¹é…ä¸€ä¸ªè·¯ç”±

**Router5.x**ä½¿ç”¨çš„æ˜¯**Switch ç»„ä»¶**

Route ç»„ä»¶ç”¨äºè·¯å¾„åŒ¹é…ï¼Œæœ‰ä¸‰ä¸ªå±æ€§ï¼š

- **pathï¼šè·¯å¾„**
- **elementï¼šç»„ä»¶ï¼ˆRouter5.x æ˜¯ componentï¼‰**
- exactï¼šç²¾å‡†åŒ¹é…ï¼Œåªæœ‰è·¯å¾„å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¸²æŸ“ï¼ˆRouter6.x ä¸ä»”æ”¯æŒï¼‰

```jsx
return (
  <div>
    <h2>App</h2>
    {/* æ˜ å°„å…³ç³» */}
    <Routes>
      <Route path="/about" element={<About />}></Route>
    </Routes>
  </div>
);
```

#### åˆ‡æ¢è·¯ç”±

**Link å’Œ NavLink**

- é€šå¸¸è·¯å¾„çš„è·³è½¬æ˜¯ä½¿ç”¨ Link ç»„ä»¶ï¼Œæœ€ç»ˆä¼šè¢«æ¸²æŸ“æˆ**a å…ƒç´ **ï¼›
- NavLink æ˜¯åœ¨ Link åŸºç¡€ä¹‹ä¸Šå¢åŠ äº†ä¸€ä¸‹**æ ·å¼å±æ€§**ï¼›
- **to å±æ€§**ï¼ŒLink ä¸­æœ€é‡è¦çš„å±æ€§ï¼Œè®¾ç½®è·³è½¬è·¯å¾„ï¼›

```jsx
return (
  <div>
    <h2>App</h2>
    <Link to="/about">å…³äº</Link>
    <Link to="/home">é¦–é¡µ</Link>
    {/* æ˜ å°„å…³ç³» */}
    <Routes>
      <Route path="/about" element={<About />}></Route>
      <Route path="/home" element={<Home />}></Route>
    </Routes>
  </div>
);
```

#### **not found**é¡µé¢

åœ¨æ˜ å°„å…³ç³»é‡Œé¢ï¼Œå½“æ‰€æœ‰è·¯å¾„éƒ½åŒ¹é…ä¸åˆ°æ—¶ï¼Œä½¿ç”¨**é€šé…ç¬¦**ï¼Œç„¶åæ¸²æŸ“å‡º**notfound**é¡µé¢ï¼›

```jsx
<Routes>
  <Route path="/login" element={<Login />}></Route>
  <Route path="/home" element={<Home />}></Route>
  <Route path="*" element={<NotFound />}></Route>
</Routes>
```

### è·¯ç”±é‡å®šå‘

**Navigate**ç”¨äº**è·¯ç”±é‡å®šå‘**ï¼Œå½“è¿™ä¸ªç»„ä»¶å‡ºç°æ—¶ï¼Œå°±ä¼šæ‰§è¡Œè·³è½¬åˆ°å¯¹åº”çš„**to**çš„è·¯å¾„ä¸­ï¼›

#### **æ¡ˆä¾‹**

ç”¨æˆ·è·³è½¬åˆ° Profile ç•Œé¢ï¼›

ä½† Profile ç•Œé¢æœ‰ä¸€ä¸ª isLogin ç”¨äºè®°å½•ç”¨æˆ·æ˜¯å¦ç™»é™†ï¼›

- trueï¼šé‚£ä¹ˆæ˜¾ç¤ºç”¨æˆ·çš„åç§°ï¼›
- falseï¼šç›´æ¥é‡å®šå‘åˆ°ç™»é™†ç•Œé¢ï¼›

**App**

```jsx
<Routes>
  <Route path="/login" element={<Login />}></Route>
  <Route path="/home" element={<Home />}></Route>
</Routes>
```

**Login**

```jsx
constructor() {
  super()

  this.state = {
    isLogin: false
  }
}
login () {
  this.setState({ isLogin: true })
}
render () {
  const { isLogin } = this.state
  return (
    <div>
      <h2>Login</h2>

      {!isLogin ? <button onClick={e => this.login()}>ç™»é™†</button> : <Navigate to='/home'/>}
    </div>
  )
}
```

#### å¸¸è§åº”ç”¨åœºæ™¯

- **é¦–æ¬¡è¿›å…¥**ç½‘é¡µé‡å®šå‘

**é¦–æ¬¡è¿›å…¥ç½‘é¡µé‡å®šå‘**

```jsx
<Routes>
  <Route path="/login" element={<Navigate to="/home" />}></Route>
  <Route path="/home" element={<Home />}></Route>
</Routes>
```

### è·¯ç”±åµŒå¥—

æ—©æœŸæ˜¯åœ¨**ç»„ä»¶å†…é…ç½®åµŒå¥—è·¯ç”±**çš„ï¼Œè¿™å°±å¯¼è‡´è·¯ç”±çš„æ˜ å°„**å¤ªåˆ†æ•£**ï¼Œrouter6.x ä¹‹åå°±æ–¹ä¾¿è®¸å¤šï¼›

**App**

```jsx
<Routes>
  <Route path="/home" element={<Home />}>
    <Route path="/home/list" element={<List />}></Route>
  </Route>
</Routes>
```

**Home**

```jsx
return (
  <div>
    <h2>Home</h2>
    <Link to="/home/list">åˆ—è¡¨</Link>
  </div>
);
```

æ­¤æ—¶è¿˜éœ€è¦ç±»ä¼¼ router-view çš„**å ä½ç¬¦**ï¼Œç”¨äºæ ‡è®°åŒ¹é…åˆ°å­è·¯ç”±ä¹‹åï¼Œç»„ä»¶æ¸²æŸ“çš„**ä½ç½®**ï¼›

å«**OutLet**

```jsx
return (
  <div>
    <h2>Home</h2>
    <Link to="/home/list">åˆ—è¡¨</Link>
    <Outlet />
  </div>
);
```

#### æ‰‹åŠ¨è·¯ç”±è·³è½¬

å¦‚æœä½¿ç”¨**Lnik ç»„ä»¶**è·³è½¬ï¼Œé‚£æ¸²æŸ“å‡ºæ¥çš„å°†æ˜¯**a å…ƒç´ **ï¼›

**å¦‚æœæƒ³æ¸²æŸ“å…¶å®ƒå…ƒç´ å‘¢ï¼Ÿ**æ¯”å¦‚æŒ‰é’®

react-router-dom æä¾›äº†ä¸€ä¸ª hook å‡½æ•°ï¼Œ**useNavigate**ï¼Œå¯ä»¥æ‰‹åŠ¨å®ç°è·¯ç”±è·³è½¬ï¼›

ä¸è¿‡ï¼Œ**hook å‡½æ•°**åªèƒ½åœ¨**å‡½æ•°å¼ç»„ä»¶**ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”**ç½®äºé¡¶å±‚**ï¼›

ä¸è¿‡ï¼Œå¯ä»¥ä½¿ç”¨**é«˜é˜¶ç»„ä»¶**ï¼Œå¯¹ä¸€ä¸ªç±»ç»„ä»¶è¿›è¡Œ**å¢å¼º**ï¼Œè®©å…¶å¯ä»¥ä½¿ç”¨ hook å‡½æ•°ï¼›

```jsx
export function App(props) {
  const navigate = useNavigate();

  function navigateTo(path) {
    navigate(path);
  }

  return (
    <div>
      <h2>App</h2>
      <button onClick={(e) => navigateTo("/home")}>é¦–é¡µ</button>
      {/* æ˜ å°„å…³ç³» */}
      <Routes>
        <Route path="/home" element={<Home />}></Route>
      </Routes>
    </div>
  );
}
```

#### å°è£… withRouter

å¦‚æœç±»ç»„ä»¶å¸Œæœ›ä½¿ç”¨ hook å‡½æ•°ï¼Œéœ€è¦å¯¹å…¶å¢å¼ºï¼›

å°è£…ä¸€ä¸ªè®©ç±»ç»„ä»¶å¯ä»¥ä½¿ç”¨ hook å‡½æ•°çš„**é«˜é˜¶ç»„ä»¶**ï¼›

```jsx
function withRouter(WrapperComponent) {
  return function (props) {
    const navigate = useNavigate();
    const router = { navigate };
    return <WrapperComponent {...props} router={router} />;
  };
}
```

**Home**

```jsx
export class Home extends PureComponent {
  navigateTo(path) {
    const { navigate } = this.props.router;
    navigate(path);
  }
  render() {
    return (
      <div>
        <h2>Home</h2>
        <button onClick={(e) => this.navigateTo("/home/list")}>åˆ—è¡¨</button>
        <Outlet />
      </div>
    );
  }
}

export default withRouter(Home);
```

### è·¯ç”±ä¼ å‚

react-router-dom æä¾›äº†ä¸€ä¸ª hook å‡½æ•°ï¼Œ**useParams**ï¼Œå¯ä»¥è·å–è·³è½¬å‚æ•°ï¼›

- æ–¹å¼ä¸€ï¼Œ**åŠ¨æ€è·¯ç”±**ï¼Œåœ¨æ˜ å°„å…³ç³»é‚£æ‹¼æ¥ä¸Š `:name`ï¼›
- æ–¹å¼äºŒï¼Œ**æŸ¥è¯¢å­—ç¬¦ä¸²**

#### åŠ¨æ€è·¯ç”±

**æ˜ å°„å…³ç³»**

**App**

```jsx
<Routes>
  <Route path="/home" element={<Home />}>
    <Route path="/home/list/:id" element={<List />}></Route>
  </Route>
</Routes>
```

**æºå¸¦å‚æ•°è·³è½¬**

**Home**

```jsx
export class Home extends PureComponent {
  navigateTo(id) {
    const { navigate } = this.props.router;
    navigate("/home/list/" + id);
  }
  render() {
    return (
      <div>
        <h2>Home</h2>
        <button onClick={(e) => this.navigateTo(123)}>åˆ—è¡¨</button>
        <Outlet />
      </div>
    );
  }
}

export default withRouter(Home);
```

**è·å–ä¼ é€’å‚æ•°**

ä¸ºäº†ç±»ç»„ä»¶èƒ½ä½¿ç”¨ hook å‡½æ•°ï¼Œç»™**é«˜é˜¶ç»„ä»¶**withRouter æ·»åŠ åŠŸèƒ½ï¼›

```jsx
function withRouter(WrapperComponent) {
  return function (props) {
    const navigate = useNavigate();
    const params = useParams();
    const router = { navigate, params };
    return <WrapperComponent {...props} router={router} />;
  };
}
```

è·å–è·³è½¬æ—¶ä¼ é€’è¿‡æ¥çš„å‚æ•°

**List**

```jsx
export class List extends PureComponent {
  render() {
    const { params } = this.props.router;
    return <div>List:{params.id}</div>;
  }
}

export default withRouter(List);
```

#### æŸ¥è¯¢å­—ç¬¦ä¸²

**æ˜ å°„å…³ç³»**

```jsx
<Routes>
  <Route path="/home" element={<Home />}>
    <Route path="/home/list/:id" element={<List />}></Route>
  </Route>
</Routes>
```

**æºå¸¦å‚æ•°è·³è½¬**

**Home**

```jsx
render () {
  return (
    <div>
      <h2>Home</h2>
      <Link to='/home/list?name=zsf&age=18'>åˆ—è¡¨</Link>
      <Outlet />
    </div>
  )
}
```

**è·å–ä¼ é€’å‚æ•°**

é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²è·å–å‚æ•°ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

- react-router-dom æä¾›äº†ä¸€ä¸ª hook å‡½æ•°ï¼Œ**useLocation**ï¼Œå¯ä»¥é€šè¿‡å®ƒè¿”å›å¯¹è±¡ä¸­**search å±æ€§**æ‹¿åˆ°ï¼Œä¸è¿‡è¿˜è¦è¿›è¡Œå¤„ç†ï¼ˆæ¯”å¦‚æ‹¿åˆ°çš„æ˜¯ `?name=zsf&age=18`ï¼‰ï¼›
- react-router-dom è¿˜æä¾›äº†ä¸€ä¸ª hook å‡½æ•°ï¼Œ**useSearchParams**ï¼Œè€Œå®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬åªéœ€è¦é¦–ä¸ªä½ç½®çš„å†…å®¹ï¼ˆåç»­å†è¯´ç¬¬äºŒä¸ªä½ç½®ï¼‰ï¼Œè¯¥å†…å®¹æ˜¯ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å®ƒçš„**get(key)**è·å–å®ƒçš„å±æ€§ï¼ˆæ¯”å¦‚ get('name')ï¼‰

ä¸ºäº†ç±»ç»„ä»¶èƒ½ä½¿ç”¨ hook å‡½æ•°ï¼Œç»™**é«˜é˜¶ç»„ä»¶**withRouter æ·»åŠ åŠŸèƒ½ï¼›

åŒæ—¶ï¼Œä¸ºäº†æ–¹ä¾¿è·å–æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„å†…å®¹ï¼Œéœ€è¦å°† useSearchParams è¿”å›å†…å®¹é¦–ä¸ªä½ç½®çš„é‚£ä¸ªå¯¹è±¡ï¼Œ**è½¬åŒ–ä¸ºæ™®é€šå¯¹è±¡**ï¼ˆä¸ç„¶åªèƒ½é€šè¿‡è¯¥å¯¹è±¡çš„ get æ–¹æ³•è·å–ï¼Œç”±äºä¸ç¡®å®šä¼ å‚æ—¶çš„å±æ€§å‘½åï¼Œæ‰€ä»¥é€šè¿‡ get å»è·å–ä¸è¡Œï¼‰

```jsx
function withRouter(WrapperComponent) {
  return function (props) {
    // ç¼–ç¨‹å¼å¯¼èˆª
    const navigate = useNavigate();
    // åŠ¨æ€è·¯ç”±å‚æ•°ï¼š/detail/:id
    const params = useParams();
    // æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼š/user?name=zsf&age=18
    const [searchParams] = useSearchParams();
    // è½¬åŒ–ä¸ºæ™®é€šå¯¹è±¡
    const query = Object.fromEntries(searchParams);
    const router = { navigate, params, query };
    return <WrapperComponent {...props} router={router} />;
  };
}
```

**List**

```jsx
export class List extends PureComponent {
  render() {
    const { query } = this.props.router;
    return (
      <div>
        List:{query.name}-{query.age}
      </div>
    );
  }
}

export default withRouter(List);
```

### é…ç½®æ–‡ä»¶

Vue çš„è·¯ç”±ä¸ç»„ä»¶æ˜ å°„å…³ç³»æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼›

è€Œ React çš„è·¯ç”±ä¸ç»„ä»¶æ˜ å°„å…³ç³»æ˜¯ä¸€ä¸ª Routes ç»„ä»¶åŒ…è£¹ä¸€äº› Route ç»„ä»¶ï¼›

React å¦‚æœå°†**è·¯ç”±ä¸ç»„ä»¶çš„æ˜ å°„å…³ç³»**éƒ½æ”¾ App ç»„ä»¶çš„è¯å°±ä¸å¤ªåˆé€‚äº†ï¼›

æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™äº›æ˜ å°„å…³ç³»**å†™æˆé…ç½®**:

- åœ¨ Router5.xï¼Œéœ€è¦å®‰è£… react-router-config åº“ï¼›
- è€Œ Router6.xï¼Œç›´æ¥å†™æˆé…ç½®

React æä¾›äº†ä¸€ä¸ª APIï¼Œ**useRoutes**ï¼Œå¯ä»¥æ ¹æ®é…ç½®ä¿¡æ¯ï¼Œç”ŸæˆåŸæ¥çš„æ˜ å°„å…³ç³»

åŸæ¥çš„æ˜ å°„å…³ç³»

```jsx
{
  /* æ˜ å°„å…³ç³» */
}
<Routes>
  <Route path="/home" element={<Home />}>
    <Route path="/home/list" element={<List />}></Route>
  </Route>
</Routes>;
```

æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ routerï¼Œåœ¨é‡Œé¢å†æ–°å»º**index.js**

```js
import { Navigate } from "react-router-dom";
import Home from "../Home";
import List from "../List";

const routes = [
  {
    path: "/",
    element: <Navigate to="/home" />,
  },
  {
    path: "/home",
    element: <Home />,
    children: [
      {
        path: "/home/list",
        element: <List />,
      },
    ],
  },
];

export default routes;
```

**App**

```jsx
return (
  <div>
    <h2>App</h2>
    {/* æ˜ å°„å…³ç³» */}
    {useRoutes(routes)}
  </div>
);
```

#### æ‡’åŠ è½½

å¦‚æœæƒ³åˆ†åŒ…ï¼Œå¯ä»¥ç”¨æ‡’åŠ è½½ï¼›

Reac æä¾›äº† lazy æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª promiseï¼›

```js
import { Navigate } from "react-router-dom";
import React from "react";

const Home = React.lazy(() => import("../Home"));
const List = React.lazy(() => import("../List"));

const routes = [
  {
    path: "/",
    element: <Navigate to="/home" />,
  },
  {
    path: "/home",
    element: <Home />,
    children: [
      {
        path: "/home/list",
        element: <List />,
      },
    ],
  },
];

export default routes;
```

åˆ†åŒ…ä¹‹åï¼Œæœ¬åœ°æœåŠ¡å™¨éœ€è¦**åˆ†åˆ«ä¸‹è½½è¿™äº›åŒ…**æ‰èƒ½æ­£å¸¸æ˜¾ç¤ºé¡µé¢ï¼Œä¸ºäº†é˜²æ­¢è¿™äº›åŒ…å°šæœªå®Œå…¨ä¸‹è½½å¯¼è‡´æŠ¥é”™ï¼›

éœ€è¦ä½¿ç”¨ React æä¾›çš„**Suspense ç»„ä»¶**åŒ…è£¹**æ ¹ç»„ä»¶**ï¼Œå¹¶ä¼ **fallback**ä¸€ä¸ªç»„ä»¶æç¤ºç”¨æˆ·ï¼›

**æ ¹ç»„ä»¶**

```jsx
<Suspense fallback={<h3>Loading...</h3>}>
  <App />
</Suspense>
```

## çŠ¶æ€ç®¡ç†

redux å’Œ React æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®Œå…¨å¯ä»¥åœ¨ Reactã€Angular æˆ–å…¶å®ƒåœ°æ–¹å•ç‹¬ä½¿ç”¨ Redux;

ä½† React å’Œ Redux ç»“åˆçš„æ›´å¥½ï¼Œé€šè¿‡ state å»æè¿°ç•Œé¢çŠ¶æ€ï¼›

### ä¸‰å¤§åŸåˆ™

#### å•ä¸€æ•°æ®æº

- æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ state è¢«å­˜å‚¨åœ¨ä¸€æ£µ**object tree**ä¸­ï¼Œå¹¶ä¸” object tree åªå­˜å‚¨åœ¨**ä¸€ä¸ª store**ä¸­ï¼›
- Redux å¹¶æ²¡æœ‰å¼ºåˆ¶ä¸èƒ½åˆ›å»ºå¤šä¸ª storeï¼Œä½†é‚£æ ·**ä¸åˆ©äºæ•°æ®ç»´æŠ¤**ï¼›
- **å•ä¸€æ•°æ®æº**å¯ä»¥è®©æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ state å˜å¾—æ–¹ä¾¿ç»´æŠ¤ã€è¿½è¸ªã€ä¿®æ”¹ï¼›

#### state æ˜¯åªè¯»çš„

- å”¯ä¸€ä¿®æ”¹ state çš„æ–¹æ³•ä¸€å®šæ˜¯**æ´¾å‘ï¼ˆdispatchï¼‰action**ï¼Œä¸å¯ç›´æ¥ä¿®æ”¹ stateï¼›

- è¿™æ ·å°±ç¡®ä¿äº†è§†å›¾æˆ–ç½‘ç»œè¯·æ±‚éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Œä»–ä»¬**åªèƒ½é€šè¿‡ action æ¥æè¿°è‡ªå·±æƒ³è¦å¦‚ä½•ä¿®æ”¹ state**ï¼›

- è¿™æ ·å¯ä»¥**ä¿è¯æ‰€æœ‰çš„ä¿®æ”¹éƒ½è¢«é›†ä¸­åŒ–å¤„ç†**ï¼Œå¹¶æŒ‰ç…§**ä¸¥æ ¼çš„é¡ºåº**æ¥æ‰§è¡Œï¼Œæ— éœ€æ‹…å¿ƒ**race conditionï¼ˆç«æ€ï¼‰**çš„é—®é¢˜ï¼›

#### ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹

- é€šè¿‡ reducer å°†**æ—§çš„ state å’Œ action**è”ç³»åˆ°ä¸€èµ·ï¼Œå¹¶è¿”å›ä¸€ä¸ª**æ–°çš„ state**ï¼›
- éšç€åº”ç”¨ç¨‹åºçš„**å¤æ‚åº¦å¢åŠ **ï¼Œæˆ‘ä»¬å¯ä»¥å°† reducer**æ‹†åˆ†æˆå¤šä¸ªå°çš„ reducer**ï¼Œåˆ†åˆ«æ“ä½œä¸åŒçš„ state tree çš„ä¸€éƒ¨åˆ†ï¼›
- ä½†æ‰€æœ‰çš„ reducer éƒ½åº”è¯¥æ˜¯**çº¯å‡½æ•°**ï¼Œä¸èƒ½äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼›

### æ ¸å¿ƒ

#### store

#### action

éœ€è¦é€šè¿‡ action æ¥æ›´æ–°æ•°æ®ï¼š

- æ‰€æœ‰çš„çŠ¶æ€å˜åŒ–ï¼Œå¿…é¡»é€šè¿‡æ´¾å‘ï¼ˆ**dispatch**ï¼‰action æ¥æ›´æ–°ï¼›
- action æ˜¯ä¸€ä¸ªæ™®é€šçš„ js å¯¹è±¡ï¼Œç”¨æ¥æè¿°æ­¤æ¬¡æ›´æ–°çš„**type**å’Œ**content**ï¼›

#### reducer

**å¦‚ä½•å°† state å’Œ action è”ç³»åœ¨ä¸€èµ·å‘¢ï¼Ÿ**

reducer æ˜¯ä¸ª**çº¯å‡½æ•°**ï¼›

reducer åšçš„äº‹æƒ…æ˜¯**å°†æ—§çš„ state å’Œ action ç»“åˆèµ·æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ state**ï¼›

### åŸºæœ¬ä½¿ç”¨

```js
import { createStore } from "redux";
// åˆå§‹åŒ–æ•°æ®
const initialState = {
  name: "zsf",
  counter: 100,
};

// å®šä¹‰reducerå‡½æ•°
function reducer(state = initialState, action) {
  // æœ‰æ•°æ®è¿›è¡Œæ›´æ–°æ—¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„state

  // æ²¡æ•°æ®æ›´æ–°è¿”å›æ—§çš„state
  return state;
}

// åˆ›å»ºstore
export const store = createStore(reducer);
```

ä½¿ç”¨**store.getState()**å°±å¯ä»¥è·å– state äº†ï¼›

**reducer**æ¥æ”¶**ä¸¤ä¸ª**å‚æ•°ï¼š

- 1ï¼‰æ—§çš„ state
- 2ï¼‰action

#### ä¿®æ”¹ state

ä¸€æ—¦è°ƒç”¨ dispatchï¼Œreducer å°±ä¼šé‡æ–°æ‰§è¡Œï¼›

```js
import { createStore } from "redux";
// åˆå§‹åŒ–æ•°æ®
const initialState = {
  name: "zsf",
  counter: 100,
};

// å®šä¹‰reducerå‡½æ•°
function reducer(state = initialState, action) {
  // æœ‰æ•°æ®è¿›è¡Œæ›´æ–°æ—¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„state
  if (action.type === "change_name") {
    return { ...state, name: action.name };
  }

  // æ²¡æ•°æ®æ›´æ–°è¿”å›æ—§çš„state
  return state;
}

// åˆ›å»ºstore
export const store = createStore(reducer);
```

å½“**action ç±»å‹è¿‡å¤š**æ—¶ï¼Œåº”è¯¥ä½¿ç”¨**switch**æ›¿ä»£ if

```js
console.log(store.getState()); // { name: 'zsf', couter: 100 }
const nameAction = { type: "change_name", name: "hhh" };
store.dispatch(nameAction);
console.log(store.getState()); // { name: 'hhh', couter: 100 }
```

#### è®¢é˜… state

ä¸Šè¿°è·å– state è¦æ‰‹åŠ¨ï¼Œæƒ³è¦è‡ªåŠ¨è·å–æœ€æ–° state çš„è¯ï¼Œéœ€è¦**è®¢é˜…**ï¼›

**store.subscribe()**ä¼ å…¥ä¸€ä¸ªå›è°ƒ**å‡½æ•°**ï¼Œå½“ state**å‘ç”Ÿå˜åŒ–**æ—¶ä¼šå›è°ƒè¯¥å‡½æ•°ï¼›

```js
store.subscribe(() => {
  console.log(store.getState());
});
```

**å–æ¶ˆè®¢é˜…**

store.subscribe()è¿”å›å€¼æ˜¯ä¸ªå‡½æ•°ï¼Œè°ƒç”¨å³å¯å–æ¶ˆè®¢é˜…ï¼›

#### åŠ¨æ€ç”Ÿæˆ action

```js
store.dispatch({ type: "change_name", name: "hhh" });
store.dispatch({ type: "change_name", name: "xxx" });
store.dispatch({ type: "change_name", name: "jjj" });
```

ä½ ä¼šå‘ç°æœ‰é‡å¤çš„å†…å®¹ï¼Œå¼€å‘ä¸­ä¼šä½¿ç”¨ä¸€ä¸ªå«**actionCreators**çš„ä¸œè¥¿ï¼Œå®ƒä¼šå¸®åŠ©æˆ‘ä»¬åˆ›å»º actionï¼›

```js
const changeNameAction = (name) => ({
  type: "change_name",
  name,
});
store.dispatch(changeNameAction("hhh"));
store.dispatch(changeNameAction("xxx"));
store.dispatch(changeNameAction("jjj"));
```

ä¸€èˆ¬ä¼šå°†ç±»ä¼¼ä¸Šè¿°**changeNameAction**çš„å‡½æ•°æ”¾åˆ° store ä¸‹**actionCreators.js**æ–‡ä»¶ä¸­

#### constants.js

å¯¹äº**ä¸¤å¤„åœ°æ–¹**è¦ä½¿ç”¨**ä¸€æ ·çš„å­—ç¬¦ä¸²**ï¼Œåº”è¯¥å†™æˆ**å¸¸é‡**ï¼Œæ”¾ constants.js ä¸­ï¼›

#### ä»£ç ç»„ç»‡åŸåˆ™

å°†æ´¾å‘çš„**action ç”Ÿæˆè¿‡ç¨‹**æ”¾åˆ°ä¸€ä¸ª actionCreators å‡½æ•°ä¸­ï¼Œå¹¶å°†è¿™äº›å‡½æ•°æ”¾åˆ°**actionCreators.js**æ–‡ä»¶ä¸­ï¼›

**actionCreators**å’Œ**reducer**å‡½æ•°ä¸­ä½¿ç”¨çš„**å­—ç¬¦ä¸²å¸¸é‡**æ˜¯ä¸€è‡´çš„ï¼Œå°†å¸¸é‡æŠ½å–åˆ°**constants.js**æ–‡ä»¶ä¸­ï¼›

å°†**reducer**å’Œé»˜è®¤å€¼(initialState)æ”¾åˆ°**reducer.js**æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ index.js;

### é¡¹ç›®ä¸­ä½¿ç”¨

åœ¨**ç±»ç»„ä»¶**ä¸­çš„**componentDidMoun**t ç”Ÿå‘½å‘¨æœŸä¸­**è®¢é˜… state**ä¸­çš„æ•°æ®ï¼›

å‡è®¾ä½¿ç”¨äº† counter

```js
componentDidMount() {
  store.subscribe(() => {
    const state = store.getState()
    this.setState({ counter: state.counter })
  })
}
```

å¹¶ä¸”åœ¨ç»„ä»¶å¸è½½åä¹Ÿè¦æ‰‹åŠ¨åœ¨**componentWillUnmount**ç”Ÿå‘½å‘¨æœŸè¿›è¡Œ**å–æ¶ˆè®¢é˜…**ï¼›

å¦‚æœæ¯ä¸ªç»„ä»¶éƒ½è¦è¿›è¡Œè¿™äº›æ“ä½œï¼Œé‚£é‡å¤å¯å°±å¤ªå¤šäº†ï¼›

å¯ä»¥æŠŠè¿™äº›é‡å¤çš„æ“ä½œæŠ½å–åˆ°**é«˜é˜¶ç»„ä»¶**ï¼›

çœŸå®å¼€å‘ä¼šä½¿ç”¨ä¸€ä¸ªåº“ï¼Œ**react-redux**ï¼›

ç”±äºå¯èƒ½å¤šä¸ªç»„ä»¶éƒ½ä¼šä½¿ç”¨åˆ° store ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ç»™**æ ¹ç»„ä»¶**æä¾›ï¼›

**æ ¹ç»„ä»¶**

```jsx
...
import { Provider } from 'react-redux'
import { store } from './store'

const root = ReactDOM.createRoot(document.querySelector('#root'))
root.render(
  <Provider store={store}>
    <App/>
  </Provider>
)
```

å‡è®¾ä¸€ä¸ª About ç»„ä»¶æƒ³ä½¿ç”¨ store ä¸­çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨**react-redux**ä¸­çš„ connectï¼›

**connect**çš„**è¿”å›å€¼**æ˜¯ä¸ªé«˜é˜¶ç»„ä»¶ï¼›

**About**

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";

export class About extends PureComponent {
  render() {
    return <div>About</div>;
  }
}

export default connect()(About);
```

**connect ä¸ºä»€ä¹ˆä¸ç›´æ¥å°è£…æˆé«˜é˜¶ç»„ä»¶ï¼Œè€Œè¿”å›å€¼æ‰æ˜¯é«˜é˜¶ç»„ä»¶ï¼Ÿ**

connect å‚æ•°æ¥æ”¶ä¸¤ä¸ª**å‡½æ•°**ï¼›

**ç¬¬ä¸€ä¸ªå‡½æ•°**éœ€è¦å‘ŠçŸ¥ connect æ‹¦æˆªç»„ä»¶ï¼ˆä¸Šè¿°çš„ Aboutï¼‰éœ€è¦ç”¨**store**ä¸­çš„å“ªäº›æ•°æ®ï¼Œä¸æ˜¯å…¨éƒ¨éƒ½è¦ä½¿ç”¨ï¼›

ç¬¬ä¸€ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ˜ å°„ï¼Œä¹Ÿå°±æ˜¯**å½“å‰ç»„ä»¶**å’Œ store ä¸­å“ªäº›æ•°æ®çš„**æ˜ å°„**ï¼›

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";

export class About extends PureComponent {
  render() {
    return <div>About</div>;
  }
}

function fn1(state) {
  return {
    counter: state.counter,
  };
}

export default connect(fn1)(About);
```

#### connect å†…éƒ¨åŸç†

**connect å†…éƒ¨åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ**

åšäº†ç±»ä¼¼è¿™æ ·çš„æ“ä½œ

```jsx
<About {...this.props} {...obj} />
```

ä¼šå°†ä¸Šè¿°**fn1**è¿”å›çš„å¯¹è±¡ï¼ˆobjï¼‰å’Œæ¥æ”¶åˆ°çš„ props ä»¥**å±æ€§**çš„æ–¹å¼ä¼ ç»™**About ç»„ä»¶**ï¼›

è¿™ä¸å°±æ˜¯**é«˜é˜¶ç»„ä»¶**åº”ç”¨åœºæ™¯ä¹‹ä¸€çš„-----**props å¢å¼º**å—ï¼Ÿ

åŒæ ·ï¼Œ**é«˜é˜¶ç»„ä»¶**å¦å¤–çš„åº”ç”¨åœºæ™¯----**æ‹¦æˆªç”Ÿå‘½å‘¨æœŸ**ä¹Ÿåœ¨ connect å†…éƒ¨åº”ç”¨äº†ï¼ˆéœ€è¦å¯¹ store ä¸­çš„ state è®¢é˜…å’Œå–æ¶ˆè®¢é˜…ï¼‰ï¼›

ç”±äº About éœ€è¦ä½¿ç”¨çš„æ•°æ®å·²ç»æ³¨å…¥åˆ° props ä¸­äº†ï¼Œä½¿ç”¨æ–¹å¼ä¸å°±å’Œä½¿ç”¨ props ä¸€æ ·äº†å—ï¼Ÿ

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";

export class About extends PureComponent {
  render() {
    const { counter } = this.props;
    return (
      <div>
        <h2>About----{counter}</h2>
      </div>
    );
  }
}

function fn1(state) {
  return {
    counter: state.counter,
  };
}

export default connect(fn1)(About);
```

ä¸€èˆ¬ä¹Ÿä¸ä¼šä½¿ç”¨ fn1 è¿™æ ·çš„å‡½æ•°å‘½åï¼Œè€Œæ˜¯æ¢æˆ**mapStateToProps**è¿™æ ·è§æ˜çŸ¥ä¹‰çš„å‘½åï¼›

#### ä¿®æ”¹çŠ¶æ€

**å¦‚æœ About ç»„ä»¶æƒ³ä¿®æ”¹ counter è¿™ä¸ªçŠ¶æ€ï¼Œè¯¥æ€ä¹ˆæ“ä½œï¼Ÿ**

é€šå¸¸æ˜¯å¯¼å…¥ storeï¼Œç„¶åä½¿ç”¨**store.dispatch()**æ´¾å‘ actionï¼›

è€Œ**æ´¾å‘æ“ä½œ**æ˜¯å¯ä»¥ä¸åœ¨ç»„ä»¶å†…è¿›è¡Œçš„ï¼Œè‹¥ä¸å¸Œæœ›è¿™æ´¾å‘æ“ä½œä¸ç»„ä»¶è€¦åˆåœ¨ä¸€èµ·ï¼Œæ˜¯**å¯ä»¥è§£è€¦**çš„ï¼›

ä¸Šé¢è¯´åˆ°**connect**æ˜¯æ¥æ”¶ä¸¤ä¸ªå‡½æ•°çš„ï¼Œç¬¬äºŒä¸ªå‡½æ•° fn2 æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼ˆstore ä¼ æ¥çš„**dispatch**ï¼‰ï¼›

å‡½æ•° fn2 è¿”å›çš„ä¹Ÿæ˜¯ä¸ªæ˜ å°„ï¼Œæ˜¯**å½“å‰ç»„ä»¶**ä¿®æ”¹çŠ¶æ€å’Œ**store**ä¸­ä¿®æ”¹çŠ¶æ€çš„**æ˜ å°„ï¼ˆ**ä¸‹é¢çš„ addNumber ä¸ addNumberActionï¼‰ï¼›

è€Œä¿®æ”¹çŠ¶æ€çš„**addNumber**å°±æ·»åŠ åˆ°å½“å‰ç»„ä»¶çš„ props é‡Œé¢äº†ï¼Œå°±å¯ä»¥é€šè¿‡**this.props.addNumber**è¿›è¡Œæ´¾å‘ action æ“ä½œäº†ï¼›

è€Œè¿™æ ·å»æ´¾å‘ï¼Œä»£ç éƒ½æ˜¯ç»„ä»¶è‡ªå·±çš„è¡Œä¸ºï¼Œå°±å¯ä»¥è§£è€¦äº†ï¼›

**About**

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";
import { addNumberAction } from "./store/index";

export class About extends PureComponent {
  changeNum(num) {
    this.props.addNumber(num);
  }
  render() {
    const { counter } = this.props;
    return (
      <div>
        <h2>About----{counter}</h2>
        <button onClick={(e) => this.changeNum(6)}>+6</button>
      </div>
    );
  }
}

function fn1(state) {
  return {
    counter: state.counter,
  };
}

function fn2(disptch) {
  return {
    addNumber(num) {
      disptch(addNumberAction(num));
    },
  };
}

export default connect(fn1, fn2)(About);
```

ä¸€èˆ¬ä¹Ÿä¸ä¼šä½¿ç”¨ fn2 è¿™æ ·çš„å‡½æ•°å‘½åï¼Œè€Œæ˜¯æ¢æˆ**mapDispatchToProps**è¿™æ ·è§æ˜çŸ¥ä¹‰çš„å‘½åï¼›

#### åˆ†æ¨¡å—

å¦‚æœ store ä¸­åˆ†æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰

- constant.js
- actionCreators.js
- reducer.js
- index.js

é‚£å¾—éœ€è¦å°†æ¯ä¸ªæ¨¡å—çš„ reducer ç»“åˆåœ¨ä¸€èµ·ï¼Œåˆ›å»º store çš„æ—¶å€™ä¼ è¿›å»ï¼›

å¯ä»¥ä½¿ç”¨ redux ä¸­çš„**combineReducers**ï¼Œæ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œå±æ€§åä»»æ„èµ·ï¼Œè€Œå±æ€§çš„å€¼åˆ†åˆ«æ˜¯**æ¨¡å—çš„ reducer**ï¼›

```js
const reducer = combineReducers({
  counter: counterReducer,
  home: homeReducer,
});
```

redux åˆ†æ¨¡å—çš„å¥½å¤„æ˜¯ï¼Œæ–¹ä¾¿ä¿®æ”¹è‡ªå·±è´Ÿè´£çš„é€»è¾‘ï¼Œé˜²æ­¢å‡ºç°ä»£ç å†²çªï¼›

å¦‚æœæ•´ä¸ªåº”ç”¨ç¨‹åºéœ€è¦å…±äº«çš„çŠ¶æ€ç®¡ç†ä¸åˆ†å¼€ï¼Œå®¹æ˜“å‡ºç°è¯¯æ”¹ä»–äººä»£ç ï¼›

**combineReducers æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ**

å®ƒå°†ä¼ å…¥çš„**reducer**åˆå¹¶åˆ°ä¸€ä¸ª**å¯¹è±¡**ä¸­ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ª**combination çš„å‡½æ•°**ï¼ˆç›¸å½“äºä¹‹å‰çš„ reducer å‡½æ•°ï¼‰ï¼›

æ‰§è¡Œ**combination å‡½æ•°**çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šé€šè¿‡**åˆ¤æ–­å‰åçš„æ•°æ®æ˜¯å¦ç›¸åŒ**æ¥å†³å®šè¿”å›ä¹‹å‰çš„ state è¿˜æ˜¯æ–°çš„ stateï¼›

**æ–°çš„ state**ä¼šè§¦å‘è®¢é˜…è€…å‘ç”Ÿå¯¹åº”çš„åˆ·æ–°ï¼Œè€Œæ—§çš„ state å¯ä»¥æœ‰æ•ˆçš„ç»„ç»‡è®¢é˜…è€…å‘ç”Ÿåˆ·æ–°ï¼›

```js
function combineReducers(state = {}, action) {
  // è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œstoreçš„state
  return {
    counter: counterReducer(state.counter, action),
  };
}
```

####

### ReduxToolKit

ç®€ç§°**RTK**

å®˜æ–¹æ¨èä½¿ç”¨ ReduxToolKit å·¥å…·åŒ…æ¥è¿›è¡Œ Redux ç›¸å…³ç®¡ç†ï¼Œç¼–å†™ä»£ç ä¼šæ–¹ä¾¿è®¸å¤šï¼ˆåˆ›å»º store æ–¹ä¾¿ï¼Œä½¿ç”¨èµ·æ¥å·®ä¸å¤šï¼‰ï¼›

**å®‰è£…**

```
npm install @redux/toolkit react-redux
```

ç”±äºè¿™å·¥å…·åŒ…ä¹Ÿæ˜¯é’ˆå¯¹ react-redux è¿›è¡Œäº†å°è£…ï¼Œæ‰€ä»¥ä¸¤ä¸ªéƒ½éœ€è¦å®‰è£…ï¼›

#### æ ¸å¿ƒ API

- configureStore
- createSlice
- createAsyncThunk

**configureStore**ï¼šå°è£…**createStore**ä»¥æä¾›**ç®€åŒ–çš„é…ç½®**é€‰é¡¹å’Œ**è‰¯å¥½çš„é»˜è®¤å€¼**ã€‚å®ƒå¯ä»¥è‡ªåŠ¨ç»„åˆä½ çš„ slice reducerï¼Œæ·»åŠ ä»»ä½•çš„**Redux ä¸­é—´ä»¶**ï¼Œ**redux-thunk**é»˜è®¤åŒ…å«ï¼Œå¹¶å¯ç”¨**Redux DevTools Extension**ï¼›

**createSlice**ï¼šæ¥å—**reducer å‡½æ•°**çš„å¯¹è±¡ï¼Œåˆ‡ç‰‡åç§°å’Œåˆè¯†çŠ¶æ€å€¼ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆåˆ‡ç‰‡ reducerï¼Œå¹¶å¸¦æœ‰ç›¸åº”çš„ actionsï¼›

**createAsyncThunk**ï¼šæ¥å—ä¸€ä¸ª**åŠ¨ä½œç±»å‹å­—ç¬¦ä¸²**å’Œä¸€ä¸ª**è¿”å›æ‰¿è¯ºçš„å‡½æ•°**ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª pending/fullfilled/rejected åŸºäºè¯¥æ‰¿è¯ºåˆ†æ´¾åŠ¨ä½œç±»å‹çš„**thunk**ï¼›

#### åŸºæœ¬ä½¿ç”¨

**configureStore**ç”¨äºåˆ›å»º store å¯¹è±¡ï¼Œå¸¸è§å‚æ•°å¦‚ä¸‹ï¼š

- **reducer**ï¼Œå°†å„ä¸ª slice ä¸­çš„ reducer ç»„æˆä¸€ä¸ªå¯¹è±¡ï¼›
- **middleware**ï¼Œä¼ å…¥å…¶å®ƒä¸­é—´ä»¶ï¼›
- **devtools**: æ˜¯å¦é…ç½® devtools å·¥å…·ï¼Œé»˜è®¤ä¸º trueï¼›

store æ–‡ä»¶å¤¹ä¸‹çš„**index.js**

```js
import { configureStore } from "@reduxjs/toolkit";

const store = configStore({
  render: {},
});

export default store;
```

**createSlice**æ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š

- name
- initialState
- reducers

**name**ï¼šç”¨æˆ·æ ‡è®° slice çš„åç§°ï¼ˆåœ¨ redux-devtool ä¼šæ˜¾ç¤ºå¯¹åº”çš„åç§°ï¼‰ï¼Œä½œç”¨ç±»ä¼¼äº**action å¯¹è±¡çš„ type**å±æ€§ï¼›

**initialState**ï¼šåˆå§‹åŒ–å€¼ï¼›

**reducers**ï¼š

- ç›¸å½“äºä¹‹å‰çš„ reducer å‡½æ•°ï¼Œæ˜¯**å¯¹è±¡**ï¼Œå¯ä»¥æ·»åŠ æ›´å¤šå‡½æ•°ï¼›
- **å‡½æ•°**ç±»ä¼¼äºåŸæ¥ reducer ä¸­çš„ä¸€ä¸ª**case**è¯­å¥ï¼›
- å‡½æ•°çš„å‚æ•°ï¼ˆ**state**ï¼Œè°ƒç”¨è¿™ä¸ª action æ—¶ä¼ é€’çš„ action å‚æ•°ï¼‰

è€Œ**å¯¼å‡ºæ—¶**ï¼Œåªéœ€è¦å°†**createSlice åˆ›å»ºå‡ºåˆ‡ç‰‡ä¸­çš„ reducer**å¯¼å‡ºï¼Œåç»­ä¼šå°†å„ä¸ªåˆ‡ç‰‡çš„ reducer ç»“åˆæˆä¸€ä¸ªï¼›

**createSlice**è¿”å›ä¸€ä¸ª**å¯¹è±¡**ï¼ŒåŒ…å«**æ‰€æœ‰çš„ actions**ï¼›

**æŸä¸ª store æ¨¡å—**

```js
import { createSlice } from "@reduxjs/toolkit";

const counterSlice = createSlice({
  name: "counter",
  initlState: {
    counter: 100,
  },
  reducers: {
    addNumber(state, action) {},
  },
});
export default counterSlice.reducer;
```

store æ–‡ä»¶å¤¹ä¸‹çš„**index.js**

```js
import { configureStore } from "@reduxjs/toolkit";
import counterReducer from "./features/counter";

const store = configStore({
  render: {
    counter: createReducer,
  },
});

export default store;
```

**å‘ç°æ²¡æœ‰ï¼Œåˆ›å»ºä¸€ä¸ª store æ˜¯ä¸æ˜¯æ–¹ä¾¿è®¸å¤šï¼Ÿ**

æ¥ç€ä½¿ç”¨ counter æ¨¡å—çš„çŠ¶æ€ï¼Œä¸ä¸Šè¿°ä½¿ç”¨æ–¹å¼å·®ä¸å¤š

**æ ¹ç»„ä»¶**

```jsx
...
import { Provider } from 'react-redux'
import { store } from './store'

const root = ReactDOM.createRoot(document.querySelector('#root'))
root.render(
  <Provider store={store}>
    <App/>
  </Provider>
)
```

**App**

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";

export class App extends PureComponent {
  render() {
    const { counter } = this.props;
    return (
      <div>
        <h2>App----{counter}</h2>
      </div>
    );
  }
}

function mapStateToProps(state) {
  return {
    counter: state.counter.counter,
  };
}

export default connect(mapStateToProps)(App);
```

**ä¿®æ”¹çŠ¶æ€**

**App**

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";
import { addNumberAction } from "./store/couter";

export class App extends PureComponent {
  addNum(num) {
    this.props.addNumber(num);
  }
  render() {
    const { counter } = this.props;
    return (
      <div>
        <h2>App----{counter}</h2>
        <button onClick={(e) => this.addNum(1)}>+1</button>
      </div>
    );
  }
}

function mapStateToProps(state) {
  return {
    counter: state.counter.counter,
  };
}

function mapDispatchToProps(dispatch) {
  return {
    addNumber(num) {
      dispatch(addNumberAction(num));
    },
  };
}

export default connect(mapStateToProps, mapDispatchToProps)(App);
```

**æŸä¸ª store æ¨¡å—(couter)**

```js
import { createSlice } from "@reduxjs/toolkit";

const counterSlice = createSlice({
  name: "counter",
  initlState: {
    counter: 100,
  },
  reducers: {
    addNumber(state, { payload }) {
      state.counter += payload;
    },
  },
});
export const { addNumberAction } = counterSlice.actions;
export default counterSlice.reducer;
```

çœ‹åˆ°è¿™æ®µä»£ç 

```js
reducers: {
    addNumber(state, { payload }) {
        state.counter += payload
    },
}
```

ä½ å¯èƒ½ä¼šé—®ï¼š**ä¸ºä»€ä¹ˆä¸åƒ reducer é‚£æ ·ï¼Œè¿”å›æ–°çš„ stateï¼Ÿ**

å…¶å®è¿™é‡Œ RTK ä¹Ÿåšäº†ä¼˜åŒ–ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªåº“ï¼ˆimmer.jsï¼‰ï¼Œåªè¦ä¿®æ”¹äº† stateï¼Œå°±ä¼šåˆ›å»ºæ–°çš„ state ç„¶åè¿”å›ï¼›

#### å¼‚æ­¥æ“ä½œ

åœ¨ä¹‹å‰çš„å¼€å‘ä¸­ï¼Œé€šè¿‡**redux-thunk ä¸­é—´ä»¶**è®© dispatch**ä¸­å¯ä»¥è¿›è¡Œå¼‚æ­¥æ“ä½œ**ï¼›

Redux Toolkit é»˜è®¤å·²ç»é›†æˆäº† Thunk ç›¸å…³åŠŸèƒ½ï¼š**createAsyncThunk**

å‡è®¾ Home ç»„ä»¶å‘èµ·ç½‘ç»œè¯·æ±‚è·å–åˆ°çš„æ•°æ®ï¼ŒAbout ç»„ä»¶ä¹Ÿæƒ³ä½¿ç”¨

**store æŸæ¨¡å—ï¼ˆhomeï¼‰**

```jsx
import { createSlice, createAsyncThunk } from "@reduxjs/toolkit";

export const getHomeAction = createAsyncThunk("getHomeData", async () => {
  const res = await axios.get("åœ°å€");
});

const homeSlice = createSlice({
  name: "home",
  initlState: {
    banners: [],
  },
  reducers: {
    changeBanners(state, { payload }) {
      state.banners += payload;
    },
  },
});

export default homeSlice.reducer;
```

å¦‚ä½•å°†åœ¨**getHomeAction**ä¸­è·å–çš„æ•°æ®ï¼Œæ”¾åˆ° homeSlice ä¸­çš„**initlState**å‘¢ï¼Ÿ

**createAsyncThunk**çš„åˆ›å»ºå‡ºæ¥çš„ action è¢«**dispatch**æ—¶ï¼Œä¼šå­˜åœ¨ä¸‰ç§çŠ¶æ€ï¼š

- pendingï¼šaction è¢«å‘å‡ºï¼Œä½†è¿˜æ²¡æœ‰æœ€ç»ˆç»“æœï¼›
- fulfilledï¼šè·å–åˆ°æœ€ç»ˆç»“æœï¼ˆæœ‰è¿”å›å€¼çš„ç»“æœï¼‰ï¼›
- rejectedï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰é”™è¯¯æˆ–æŠ›å‡ºå¼‚å¸¸ï¼›

å¯ä»¥åœ¨ createSlice ä¸­çš„**extraReducer**ä¸­ç›‘å¬è¿™äº›ç»“æœï¼š

**store æŸæ¨¡å—ï¼ˆhomeï¼‰**

```jsx
import { createSlice, createAsyncThunk } from "@reduxjs/toolkit";

export const getHomeAction = createAsyncThunk("getHomeData", async () => {
  const res = await axios.get("åœ°å€");
  return res.data;
});

const homeSlice = createSlice({
  name: "home",
  initlState: {
    banners: [],
  },
  reducers: {
    changeBanners(state, { payload }) {
      state.banners = payload;
    },
  },
  extraReducers: {
    [getHomeAction.fulfilled](state, { payload }) {
      state.banners = payload.data.banners.list;
    },
  },
});

export default homeSlice.reducer;
```

å…¶ä¸­ pedding å’Œ rejected çŠ¶æ€å¯ä»¥ä¸ç›‘å¬

**Home ç»„ä»¶**

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";
import { getHomeAction } from "./store/home";

export class Home extends PureComponent {
  componentDidMount() {
    this.props.getHomeData();
  }
  render() {
    return (
      <div>
        <h2>Home</h2>
      </div>
    );
  }
}

function mapDispatchToProps(dispatch) {
  return {
    getHomeData() {
      dispatch(getHomeAction());
    },
  };
}

export default connect(null, mapDispatchToProps)(Home);
```

### ä¸­é—´ä»¶

> ç»„ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œ

ä¸Šè¿°ä½¿ç”¨çš„çŠ¶æ€æ˜¯æœ¬åœ°çš„æ•°æ®ï¼Œä½†åœ¨çœŸå®å¼€å‘å¾€å¾€æ˜¯ä¸‹è¿›è¡Œ**å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚**ï¼Œç„¶åå†ä¿å­˜åˆ°**redux**ä¸­ï¼›

æ¯”å¦‚åœ¨ Home ç»„ä»¶è¯·æ±‚äº†ä¸€äº›æ•°æ®ï¼Œå¦‚æœ Home æƒ³ä½¿ç”¨ï¼Œåªéœ€è¦å°†è¿™äº›æ•°æ®ä¿å­˜åˆ°è‡ªå·±**state**ä¸­ï¼Œä½¿ç”¨ render è¿›è¡Œå±•ç¤ºå³å¯ï¼›

è€Œ About ç»„ä»¶ä¹Ÿæƒ³ä½¿ç”¨é‚£äº›æ•°æ®çš„è¯ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ

- é¦–å…ˆå¯ä»¥æƒ³åŠæ³•ä¸€æ­¥æ­¥ä¼ é€’è¿‡å»ï¼Œæ¯”å¦‚æ”¾åˆ°**Context**é‡Œé¢å»ï¼Œç„¶ååšä¸€ä¸ª**å…±äº«**ï¼Œä½†æ˜¯è¿™ä¸ªæ­¥éª¤æœ‰ç‚¹**ç¹ç**ï¼Œæ’é™¤ï¼›
- å¯ä»¥ä½¿ç”¨**eventBus**ï¼Œæ‹¿åˆ° Home æ•°æ®ä¹‹åå‘å°„å‡ºå»ä¸€ä¸ª**å…¨å±€äº‹ä»¶**ï¼Œå› ä¸º eventBus æ˜¯å¯ä»¥ä¼ å‚æ•°çš„ï¼Œå¯ä»¥æŠŠè¯·æ±‚åˆ°æ•°æ®ä¼ é€’è¿‡æ¥ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªé¡¹ç›®ä¸­**è¿‡å¤šä½¿ç”¨ eventBus**ï¼Œ**ç›‘å¬çš„äº‹ä»¶æ¥è‡ªå“ªé‡Œ**æ˜¯å¾ˆéš¾æŠŠæ§çš„ï¼Œå½“å‡ºç° bug æ˜¯æ—¶ä¸å¥½è°ƒè¯•ï¼Œå¹¶ä¸” eventBus ä¸å»ºè®®ä¼ é€’è¿™ä¹ˆå¤§çš„æ•°æ®ï¼Œæ’é™¤ï¼›
- æœ€åˆé€‚çš„æ–¹æ³•æ˜¯**redux**ï¼Œå…¨å±€å…±äº«ä¸€ä¸ª storeï¼Œé‡Œé¢çš„ state ä¿å­˜ç½‘ç»œè¯·æ±‚åˆ°æ•°æ®ï¼›

**é‚£å¦‚ä½•ä¿å­˜åœ¨ redux ä¸­å‘¢ï¼Ÿ**

å‡å¦‚åœ¨**actionCreators.js æ–‡ä»¶**ä¸­

```js
export const getHomeAction = () => {
  axios.get("åœ°å€").then((res) => {
    const banners = res.data.banners.list;
  });
  return {
    type: "change_banners",
    banners: banners,
  };
};
```

è¿™æ ·çš„è¯ï¼Œä¸ç¡®å®š then ä»€ä¹ˆæ—¶å€™è¢«å›è°ƒï¼Œbanners ä¹Ÿå°±ä¸ç¡®å®šæœ‰æ²¡æœ‰å€¼ï¼›

ä½ å¯èƒ½ä¼šè¯´ï¼Œå¯ä»¥æ‹¿åˆ°ç»“æœä¹‹åå† returnï¼Œæ¯”å¦‚è¿™æ ·

```js
export const getHomeAction = () => {
  axios.get("åœ°å€").then((res) => {
    const banners = res.data.banners.list;
    return {
      type: "change_banners",
      banners: banners,
    };
  });
};
```

è¿™æ ·çš„è¯ï¼Œreturn çš„å†…å®¹å·²ç»ä¸æ˜¯**getHomeAction**æ‰€ return çš„äº†ï¼›

åº”è¯¥è¿™æ ·åš

**ç»„ä»¶ä¸­**

```jsx
import React, { PureComponent } from "react";
import { connect } from "react-redux";
import { getHomeAction } from "./store/index";

export class About extends PureComponent {
  getHomeData() {
    this.props.getHome();
  }
  render() {
    const { counter } = this.props;
    return (
      <div>
        <h2>About----{counter}</h2>
      </div>
    );
  }
}

function mapStateToProps(state) {
  return {
    counter: state.counter,
  };
}

function mapDispatchToProps(disptch) {
  return {
    getHome() {
      disptch(getHomeAction());
    },
  };
}

export default connect(mapStateToProps, mapDispatchToProps)(About);
```

åœ¨**actionCreators.js æ–‡ä»¶**ä¸­

```js
export const getHomeAction = () => {
  return {};
};
```

å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šçš„ actionï¼Œé‚£éœ€è¦è¿”å› action å¯¹è±¡ï¼›

è€Œé—®é¢˜æ˜¯ï¼Œå¯¹è±¡ä¸­ä¸èƒ½ç›´æ¥æ‹¿åˆ°ä»æœåŠ¡å™¨è¯·æ±‚åˆ°çš„å¼‚æ­¥æ•°æ®ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è¿”å›å¯¹è±¡ï¼›

åº”è¯¥è¿”å›ä¸€ä¸ª**å‡½æ•°**ï¼Œç„¶åå‡½æ•°é‡Œè¿›è¡Œç½‘ç»œè¯·æ±‚ï¼›

è€Œ redux è¦æ±‚æ´¾å‘çš„æ˜¯ action å¯¹è±¡ï¼Œè¦æƒ³æ´¾å‘å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸­é—´ä»¶----**redux-thunk**å¯¹ store è¿›è¡Œå¢å¼ºï¼Œä½¿å…¶å¯ä»¥æ´¾å‘å‡½æ•°ï¼›

#### redux-thunk

å®‰è£…

```
npm install redux-thunk
```

ç„¶åä½¿ç”¨ redux ä¸­çš„**applyMiddleware**ï¼Œåœ¨ store åˆ›å»ºçš„æ—¶å€™ï¼Œä¼ é€’ç¬¬äºŒä¸ªå‚æ•°

```js
import { createStore, applyMiddleware } from 'redux'
improt thunk from 'redux-thunk'
import reducer from './reducer'

const store = createStore(reducer, applyMiddleware(thunk))
export default store
```

**thunk å†…éƒ¨åšäº†ä»€ä¹ˆï¼Ÿ**

æ£€æµ‹åˆ°æ´¾å‘çš„æ˜¯å‡½æ•°ï¼Œå°±**è‡ªåŠ¨æ‰§è¡Œ**ï¼Œä¸”å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

- ç¬¬ä¸€ä¸ªæ˜¯ store çš„**dispatch**ï¼ˆç”¨äºä¹‹åå†æ¬¡æ´¾å‘ actionï¼‰ï¼›
- ç¬¬äºŒä¸ªæ˜¯ store çš„**getState**ï¼ˆè€ƒè™‘åˆ°ä¹‹åçš„æ“ä½œä¾èµ–åŸæ¥çš„çŠ¶æ€ï¼‰ï¼›

åœ¨**actionCreators.js æ–‡ä»¶**ä¸­

```js
export const getHomeAction = () => {
  function foo(dispatch) {
    axios.get("åœ°å€").then((res) => {
      const banners = res.data.banners.list;
      dispatch({ type: "change_num", banners });
    });
  }
  return foo;
};
```

**ä¸¤ä¸ªå·¥å…·**

- redux devtool
- react devtool

è°·æ­Œå•†åº—æˆ– github ä¸‹è½½ï¼ˆç‰ˆæœ¬æœ‰ç‚¹ä½ï¼‰

å®˜æ–¹å»ºè®® redux devtool åœ¨**ç”Ÿäº§ç¯å¢ƒæ˜¯çœ‹ä¸åˆ° state**çš„ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µç›´æ¥ä½¿ç”¨ redux devtool æ˜¯æŸ¥çœ‹ä¸åˆ°çŠ¶æ€çš„ï¼Œå¼€å‘ç¯å¢ƒæ‰å¼€å¯ï¼ˆæœ‰çš„ç½‘ç«™ç”Ÿäº§ç¯å¢ƒæ—¶å¼€å¯çš„ï¼Œè¿™ä¸å¥½ï¼‰ï¼›

åœ¨ redux çš„**index.js**

```js
import { compose } from "redux";
const composeEnhancers =
  window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({ trace: true }) || compose;
const store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)));
```

ç”Ÿäº§ç¯å¢ƒçš„è¯ï¼Œæ”¹æˆ

```js
import { compose } from "redux";
const composeEnhancers = compose;
const store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)));
```

#### redux-saga

:question: ä¸ºä½•é€‰æ‹© redux-saga

1. **å¤„ç†å¼‚æ­¥é€»è¾‘**ï¼šredux-saga ä½¿ç”¨ ES6 çš„ Generator åŠŸèƒ½ï¼Œä½¿å¾—å¼‚æ­¥æµç¨‹æ˜“äºè¯»å–ã€ç¼–å†™å’Œæµ‹è¯•ã€‚è¿™ä½¿å¾—å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒæ ‡å‡†çš„åŒæ­¥ JavaScript ä»£ç ã€‚
2. **ç®¡ç†å‰¯ä½œç”¨**ï¼šredux-saga çš„ç›®æ ‡æ˜¯ä½¿åº”ç”¨ç¨‹åºçš„å‰¯ä½œç”¨ï¼ˆå¦‚æ•°æ®è·å–å’Œè®¿é—®æµè§ˆå™¨ç¼“å­˜ç­‰å¼‚æ­¥æ“ä½œï¼‰æ›´æ˜“äºç®¡ç†ï¼Œæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œå¹¶ä¸”åœ¨å¤„ç†å¤±è´¥æ—¶æ›´ä¼˜ç§€ã€‚
3. **é›†æˆ Redux**ï¼šredux-saga æ˜¯ä¸€ä¸ª Redux ä¸­é—´ä»¶ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨æ™®é€šçš„ Redux åŠ¨ä½œä»ä¸»åº”ç”¨ç¨‹åºå¯åŠ¨ã€æš‚åœå’Œå–æ¶ˆè¿™ä¸ªçº¿ç¨‹ã€‚å®ƒå¯ä»¥è®¿é—®å®Œæ•´çš„ Redux åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥åˆ†æ´¾ Redux åŠ¨ä½œã€‚
4. **é¿å…å›è°ƒåœ°ç‹±**ï¼šä¸ redux-thunk ç›¸æ¯”ï¼Œredux-saga ä¸ä¼šå¯¼è‡´å›è°ƒåœ°ç‹±ï¼Œä½ å¯ä»¥è½»æ¾åœ°æµ‹è¯•ä½ çš„å¼‚æ­¥æµç¨‹ï¼Œè€Œä¸”ä½ çš„åŠ¨ä½œä¿æŒçº¯å‡€ã€‚
5. **æ˜“äºæµ‹è¯•**ï¼šç”±äº redux-saga ä½¿ç”¨äº† Generatorï¼Œä½ å¯ä»¥åœ¨ä¸æ‰§è¡Œå®é™…å‰¯ä½œç”¨çš„æƒ…å†µä¸‹è¿›è¡Œæµ‹è¯•ï¼Œè¿™ä½¿å¾—å¼‚æ­¥æµç¨‹çš„æµ‹è¯•å˜å¾—éå¸¸ç®€å•ã€‚

##### effect

##### quick start

#### åŸç†

##### æ‰“å°æ—¥å¿—

å…ˆçœ‹ä¸€ä¸ªéœ€æ±‚ï¼šæ‰“å° dispatch æ—¥å¿—

- dispatch ä¹‹å‰ï¼Œæ‰“å° action
- dispatch ç»“æŸä¹‹åï¼Œæ‰“å° state çš„ç»“æœ

ç›´æ¥çš„æ€è·¯æ˜¯è¿™æ ·çš„

```js
const action = addNumberAction();
console.log("æ´¾å‘ä¸€ä¸ªaction", action);
dispatch(action);
console.log(store.getState());
```

è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼š**æ¯æ¬¡æ´¾å‘**éƒ½éœ€è¦è¿™æ ·å†™ï¼Œé‡å¤ä»£ç å¤ªå¤š

**å¯ä»¥ç¼–å†™ä¸€ä¸ªä¸­é—´ä»¶ï¼Œè®©ä¸­é—´ä»¶å®Œæˆè¿™ä¸ªè¿‡ç¨‹**

æ´¾å‘ action ä¹‹å‰å’Œä¹‹åï¼Œå¯ä»¥è®©**ä¸­é—´ä»¶**åšä¸€ä¸ª**æ‹¦æˆª**ï¼ˆæ­£å¸¸æƒ…å†µæ˜¯ä¸€æ´¾å‘å°±äº¤ç»™ reducerï¼‰

ä¸Šè¿° redux-thunk ä¸­é—´ä»¶æ‰€åšçš„äº‹æƒ…æ˜¯ï¼š

æ£€æµ‹ dispatch ä¼ å…¥çš„æ˜¯å¦ä¸ºå¯¹è±¡ï¼Œè‹¥æ˜¯å‡½æ•°åˆ™ç«‹å³æ‰§è¡Œï¼Œå¹¶ä¼ å…¥ dispatch å’Œ state

```js
function log(store) {
  // ä¿®æ”¹ä¹‹å‰å…ˆè®°å½•åŸæ¥çš„dispatch
  const next = store.dispacth;
  function logAndDispatch(action) {
    console.log("å½“å‰æ´¾å‘çš„action", action);
    // çœŸæ­£æ´¾å‘çš„ä»£ç ï¼šä½¿ç”¨ä¹‹å‰çš„dispatchæ´¾å‘
    next(action);
    console.log("æ´¾å‘ä¹‹åçš„ç»“æœ", store.getState());
  }

  store.dispatch = logAndDispatch;
}
log(store);
store.dispatch({ type: "addNumber", num: 100 });
```

å°†åŸæ¥ store.dispatch æ”¹æˆäº† logAndDispatchï¼›

è¿™ç§æŠ€æœ¯å« monkey patchï¼ˆçŒ´è¡¥ä¸ï¼Œç¯¡æ”¹ç°æœ‰ä»£ç ï¼Œå¯¹æ•´ä½“çš„æ‰§è¡Œé€»è¾‘è¿›è¡Œä¿®æ”¹ï¼‰

è¿™ä¾¿æ˜¯ä¸­é—´ä»¶çš„åŸç†

##### å®ç° thunk æ ¸å¿ƒä»£ç 

```js
function thunk(store) {
  // ä¿®æ”¹ä¹‹å‰å…ˆè®°å½•åŸæ¥çš„dispatch
  const next = store.dispacth;
  function dispatchThunk(action) {
    // å¦‚æœæ´¾å‘çš„æ˜¯å‡½æ•°
    if (typeof action === "funcion") {
      // å¦‚æœæ´¾å‘å‡½æ•°é‡Œé¢åˆæ´¾å‘äº†ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨åŸæ¥çš„dispatchä¼šæŠ¥é”™ï¼Œæ‰€ä»¥åº”è¯¥ä½¿ç”¨æ–°çš„dispatch
      action(store.diapatch, store.getState);
    } else {
      next(action);
    }
  }
  store.dispatch = dispatchThunk;
}
thunk(store);
store.dispatch(function (dispatch, getState) {
  dispatch({});
});
```

##### å®ç° applyMiddleware æ ¸å¿ƒä»£ç 

```js
function applyMiddleware(store, ...fns) {
  fns.forEach((fn) => {
    fn(store);
  });
}
```

### å®ç° connect

å®ç°å…³é”®ç‚¹ï¼š

- ä¸¤ä¸ª**å‚æ•°**ä¸ºå‡½æ•°
- è¿”å›ä¸€ä¸ª**é«˜é˜¶ç»„ä»¶**
- è·å–åˆ° store çš„ state ä½œä¸ºå±æ€§ä¼ è¿›éœ€è¦å…±äº«è¯¥ state çš„ç»„ä»¶
- dispatch åŒç†
- å½“ state ä¸­è¢«å…±äº«çš„æ•°æ®å‘ç”Ÿæ›´æ–°æ—¶ï¼Œç»„ä»¶çš„ render é‡æ–°æ‰§è¡Œï¼Œéœ€è¦ç›‘å¬è®¢é˜…çš„ state æ˜¯å¦å‘ç”Ÿæ”¹å˜
- å–æ¶ˆ state çš„è®¢é˜…
- é™ä½å¯¹ store çš„è€¦åˆåº¦

#### å‚æ•°

é¦–å…ˆï¼Œå®ƒæ¥æ”¶**ä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°**

```js
function connect(mapStateToProps, mapDispatchToProps) {}
```

#### è¿”å›å€¼

è¿”å›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶

```jsx
import { PureComponent } from "react";
export default function connect(mapStateToProps, mapDispatchToProps) {
  return function (WrapperComponent) {
    class Newcpn extends PureComponent {
      render() {
        return <WrapperComponent {...this.props} />;
      }
    }
    return Newcpn;
  };
}
```

è·å–åˆ° store çš„ state**ä½œä¸ºå±æ€§**ä¼ è¿› WrapperComponent

è°ƒç”¨**ç¬¬ä¸€ä¸ªå‚æ•°**ï¼Œå¹¶**ä¼ è¿› state**ï¼Œå®ƒçš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ª**æ˜ å°„**ï¼Œå°±æ˜¯æƒ³å…±äº« store ä¸­å“ªäº›æ•°æ®ï¼›

ç„¶åå°†è¯¥æ˜ å°„æ³¨å…¥ WrapperComponent çš„**props**

åŒç†ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤

```jsx
import { PureComponent } from "react";
import store from "./store";

export default function connect(mapStateToProps, mapDispatchToProps) {
  return function (WrapperComponent) {
    class Newcpn extends PureComponent {
      render() {
        const stateObj = mapStateToProps(store.getState());
        const dispatchObj = mapDispatchToProps(store.dispatch);

        return (
          <WrapperComponent {...this.props} {...stateObj} {...dispatchObj} />
        );
      }
    }
    return Newcpn;
  };
}
```

#### çŠ¶æ€æ›´æ–°

ç›®å‰è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“ WrapperComponent ä¿®æ”¹å…±äº«çš„ state æ—¶ï¼Œç•Œé¢æ²¡æ›´æ–°ã€‚

åº”è¯¥**æ ¹æ®æœ€æ–°çŠ¶æ€**é‡æ–°æ‰§è¡Œ WrapperComponent çš„ render å‡½æ•°

```jsx
import { PureComponent } from "react";
import store from "./store";

export default function connect(mapStateToProps, mapDispatchToProps) {
  return function (WrapperComponent) {
    class Newcpn extends PureComponent {
      componentDidMount() {
        // ç›‘å¬åˆ°è®¢é˜…çš„stateå‘ç”Ÿæ”¹å˜ï¼Œå¼ºåˆ¶æ‰§è¡Œrenderå‡½æ•°
        store.subscribe(() => {
          this.forceUpdate();
        });
      }
      render() {
        const stateObj = mapStateToProps(store.getState());
        const dispatchObj = mapDispatchToProps(store.dispatch);

        return (
          <WrapperComponent {...this.props} {...stateObj} {...dispatchObj} />
        );
      }
    }
    return Newcpn;
  };
}
```

ä½†è¿™æ ·ä¸å¥½ï¼šstate ä¸­ä»»ä½•æ”¹å˜ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œ WrapperComponent çš„ render å‡½æ•°ï¼›

åº”è¯¥æ˜¯ WrapperComponent ç”¨åˆ°çš„é‚£äº› state å‘ç”Ÿæ”¹å˜ï¼Œæ‰éœ€è¦é‡æ–°æ‰§è¡Œ render å‡½æ•°

```jsx
import { PureComponent } from "react";
import store from "./store";

export default function connect(mapStateToProps, mapDispatchToProps) {
  return function (WrapperComponent) {
    class Newcpn extends PureComponent {
      constructor(props) {
        super(props);
        this.state = mapStateToProps(store.getState());
      }
      componentDidMount() {
        // ç›‘å¬åˆ°è®¢é˜…çš„stateå‘ç”Ÿæ”¹å˜ï¼Œå¼ºåˆ¶æ‰§è¡Œrenderå‡½æ•°
        store.subscribe(() => {
          // this.forceUpdate()
          this.setState(mapStateToProps(store.getState()));
        });
      }
      render() {
        const stateObj = mapStateToProps(store.getState());
        const dispatchObj = mapDispatchToProps(store.dispatch);

        return (
          <WrapperComponent {...this.props} {...stateObj} {...dispatchObj} />
        );
      }
    }
    return Newcpn;
  };
}
```

#### å–æ¶ˆè®¢é˜…

ä¸è¦å¿˜è®°ç»„ä»¶å¸è½½æ—¶å–æ¶ˆ state çš„è®¢é˜…å“¦

```jsx
import { PureComponent } from "react";
import store from "./store";

export default function connect(mapStateToProps, mapDispatchToProps) {
  return function (WrapperComponent) {
    class Newcpn extends PureComponent {
      constructor(props) {
        super(props);
        this.state = mapStateToProps(store.getState());
      }
      componentDidMount() {
        // ç›‘å¬åˆ°è®¢é˜…çš„stateå‘ç”Ÿæ”¹å˜ï¼Œå¼ºåˆ¶æ‰§è¡Œrenderå‡½æ•°
        this.unsubscribe = store.subscribe(() => {
          // this.forceUpdate()
          this.setState(mapStateToProps(store.getState()));
        });
      }
      componentWillUnmount() {
        this.unsubscribe();
      }
      render() {
        const stateObj = mapStateToProps(store.getState());
        const dispatchObj = mapDispatchToProps(store.dispatch);

        return (
          <WrapperComponent {...this.props} {...stateObj} {...dispatchObj} />
        );
      }
    }
    return Newcpn;
  };
}
```

#### è§£è€¦

ç›®å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šä¸ä¸Šä¸€å±‚ç›®å½•çš„ store è€¦åˆäº†

- æ–¹å¼ä¸€ï¼Œconnect å†**æ¥æ”¶ä¸€ä¸ªå‚æ•°**ï¼Œè®©ä½¿ç”¨è€…ä¼ å…¥ storeï¼›
- æ–¹å¼äºŒï¼Œå†æä¾›ä¸€ä¸ª**StoreContext**ï¼›

æ–¹å¼ä¸€ä¼šæ¯æ¬¡ä½¿ç”¨ connect æ—¶ä¼šå¤šä¼ ä¸€ä¸ªå‚æ•°ï¼Œæœ‰ç‚¹éº»çƒ¦

**StoreContext.js**

```js
import { createContext } from "react";

export const StoreContext = createContext();
```

**ç»Ÿä¸€å¯¼å‡º**

```js
export { StoreContext } from "./StoreContext";
export { connect } from "./connect";
```

**ä½¿ç”¨è€…**

```jsx
import { StoreContext } from "ç›®å½•åç§°";

<StoreContext.Provider value={store}>
  <ä½¿ç”¨è€… />
</StoreContext.Provider>;
```

**connect.js**

```jsx
import { PureComponent } from "react";
export { StoreContext } from "./StoreContext";

export function connect(mapStateToProps, mapDispatchToProps) {
  return function (WrapperComponent) {
    class Newcpn extends PureComponent {
      constructor(props, context) {
        super(props);
        this.state = mapStateToProps(context.getState());
      }
      componentDidMount() {
        // ç›‘å¬åˆ°è®¢é˜…çš„stateå‘ç”Ÿæ”¹å˜ï¼Œå¼ºåˆ¶æ‰§è¡Œrenderå‡½æ•°
        this.unsubscribe = context.subscribe(() => {
          // this.forceUpdate()
          this.setState(mapStateToProps(this.context.getState()));
        });
      }
      componentWillUnmount() {
        this.unsubscribe();
      }
      render() {
        const stateObj = mapStateToProps(this.context.getState());
        const dispatchObj = mapDispatchToProps(this.context.dispatch);

        return (
          <WrapperComponent {...this.props} {...stateObj} {...dispatchObj} />
        );
      }
    }
    Newcpn.contextType = StoreContext;
    return Newcpn;
  };
}
```

### æ•°æ®ä¸å¯å˜æ€§

æ— è®ºæ˜¯ç±»ç»„ä»¶çš„ state è¿˜æ˜¯ redux ä¸­ç®¡ç†çš„ stateï¼Œéƒ½å¼ºè°ƒ**æ•°æ®çš„ä¸å¯å˜æ€§**ï¼›

æ•´ä¸ª js ç¼–ç ä¸­ï¼Œæ•°æ®çš„ä¸å¯å˜æ€§éå¸¸é‡è¦ï¼›

æ‰€ä»¥å‰é¢è¿›å¸¸è¿›è¡Œæµ…æ‹·è´æ¥å®ŒæˆæŸäº›æ“ä½œï¼Œä½†æµ…æ‹·è´äº‹å®ä¸Šä¹Ÿæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼›

- æ¯”å¦‚è¿‡å¤§çš„å¯¹è±¡ï¼Œæµ…æ‹·è´ä¹Ÿä¼šé€ æˆæ€§èƒ½çš„æµªè´¹ï¼›
- æµ…æ‹·è´åçš„å¯¹è±¡ï¼Œåœ¨æ·±å±‚æ”¹å˜æ—¶ï¼Œä¾ç„¶ä¼šå¯¹ä¹‹å‰çš„å¯¹è±¡äº§ç”Ÿå½±å“ï¼›

**redux toolkit ä½¿ç”¨äº† immerjs è¿™ä¸ªåº“ä¿è¯äº†æ•°æ®çš„ä¸å¯å˜æ€§**

ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ–°çš„å¯¹è±¡ä¼š**å°½å¯èƒ½åˆ©ç”¨ä¹‹å‰çš„æ•°æ®ç»“æ„**è€Œä¸ä¼šå¯¹å†…å­˜é€ æˆæµªè´¹ï¼›

### çŠ¶æ€ç®¡ç†é€‰æ‹©

**react ä¸­å¦‚ä½•ç®¡ç†çŠ¶æ€ï¼Ÿ**

ä¸»è¦æœ‰ä¸‰ç§ï¼š

- **ç»„ä»¶å†…**éƒ¨è‡ªå·±çš„ stateï¼›
- **Context**æ•°æ®çš„å…±äº«ï¼›
- **Redux**ç®¡ç†åº”ç”¨çŠ¶æ€ï¼›

**å¼€å‘ä¸­è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ**

redux ä½œè€…çš„å»ºè®®ï¼š

- UI ç›¸å…³çš„ç»„ä»¶å†…éƒ¨å¯ä»¥ç»´æŠ¤çš„çŠ¶æ€ï¼Œåœ¨ç»„ä»¶å†…éƒ¨è‡ªå·±æ¥ç»´æŠ¤ï¼›
- å¤§éƒ¨åˆ†éœ€è¦å…±äº«çš„çŠ¶æ€ï¼Œéƒ½äº¤ç»™ redux æ¥ç®¡ç†å’Œç»´æŠ¤ï¼›
- ä»æœåŠ¡å™¨è¯·æ±‚çš„æ•°æ®ï¼ˆåŒ…æ‹¬è¯·æ±‚çš„æ“ä½œï¼‰ï¼Œäº¤ç»™ redux æ¥ç»´æŠ¤ï¼›

## è„šæ‰‹æ¶

ä¸‰å¤§ä¸»æµæ¡†æ¶éƒ½æœ‰å¯¹åº”çš„è„šæ‰‹æ¶

- vue---@vue/cli
- angular---@angular/cli
- react---react-create-app(CRA)

### react-create-app

#### åˆ›å»ºé¡¹ç›®

```
create-react-app é¡¹ç›®åç§°
```

**é¡¹ç›®åç§°**ä¸èƒ½åŒ…å«**å¤§å†™å­—æ¯**

#### é¡¹ç›®ç»“æ„

##### manifest.json

é…ç½®è¯¥ç½‘é¡µåº”ç”¨éƒ¨åˆ†åŠŸèƒ½åœ¨**ç§»åŠ¨ç«¯æ¡Œé¢**çš„æ˜¾ç¤ºæ•ˆæœ

##### robots.txt

**çˆ¬è™«**ç›¸å…³ï¼Œå¯ä»¥é…ç½®ç½‘ç«™é‚£äº›å†…å®¹å¯ä»¥è¢«çˆ¬è™«

##### PWA

(Progressive Web App),æ¸è¿›å¼ web åº”ç”¨

ä¸€ä¸ª PWA åº”ç”¨é¦–å…ˆæ˜¯**ä¸€ä¸ªç½‘é¡µ**ï¼Œå¯ä»¥é€šè¿‡**web æŠ€æœ¯**ç¼–å†™å‡ºç½‘é¡µåº”ç”¨ï¼›

éšåæ·»åŠ ä¸Š**App manifest**å’Œ**service worker**æ¥å®ç° PWA çš„**å®‰è£…å’Œç¦»çº¿**ç­‰åŠŸèƒ½ï¼›

å‡è®¾å¼€å‘å‡ºæ¥çš„ç½‘ç«™æ˜¯ä¸€ä¸ª PWAï¼Œåœ¨**Android**ç§»åŠ¨ç«¯çš„**Chrome**æµè§ˆå™¨è·‘èµ·æ¥ï¼Œ**å·¦/å³ä¸Šè§’**ä¼šæœ‰ä¸‰ä¸ªç‚¹ï¼Œç‚¹å‡»ä¼šå‡ºç°ä¸€ä¸ª**èœå•**ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å°†è¿™ä¸ªç½‘ç«™å˜æˆ**æ¡Œé¢å›¾æ ‡**ï¼›

è€Œ**service worker**è´Ÿè´£**ç¦»çº¿ç¼“å­˜**ï¼Œå½“ä¸¢å¤±ç½‘ç»œæ—¶ï¼ŒæŸäº›åŠŸèƒ½ç¦»çº¿ä¹Ÿå¯ä»¥ä½¿ç”¨~ï¼›

å¹¶ä¸”ä¹Ÿå¯ä»¥å®ç°**æ¶ˆæ¯æ¨é€**ï¼›

é€šè¿‡ç¬¬ä¸‰æ–¹åŒ…**react-scripts**å¯ä»¥æŸ¥çœ‹**webpack**é…ç½®ï¼›

## è¿‡æ¸¡åŠ¨ç”»

è¿‡æ¸¡åŠ¨ç”»å¢åŠ ç”¨æˆ·ä½“éªŒï¼›

å¯ä»¥é€šè¿‡**åŸç”Ÿ css**å®ç°ï¼›

ä¸è¿‡ React ç¤¾åŒºä¹Ÿæä¾›äº†**react-transition-group**ç”¨æ¥å®Œæˆè¿‡æ¸¡åŠ¨ç”»ï¼›

### react-transition-group

ä¸»è¦æ˜¯ **å…¥åœº** å’Œ **ç¦»åœº** åŠ¨ç”»

å®‰è£…

```
npm install react-transition-group
```

#### å››ä¸ªç»„ä»¶

- Transitionï¼ˆä¸ä¸€å®šè¦ç»“åˆ cssï¼‰
- CSSTransitionï¼ˆç»“åˆ cssï¼‰
- SwitchTransitionï¼ˆä¸¤ä¸ªç»„ä»¶æ˜¾ç¤ºå’Œéšè—**åˆ‡æ¢**æ—¶ä½¿ç”¨ï¼‰
- TransitionGroupï¼ˆå°†**å¤šä¸ªåŠ¨ç”»**ç»„ä»¶åŒ…è£¹å…¶ä¸­ï¼Œä¸€èˆ¬ç”¨äº**åˆ—è¡¨**ä¸­çš„åŠ¨ç”»ï¼‰

##### CSSTransition

CSSTransition æ˜¯åŸºäº Transition ç»„ä»¶æ„å»ºçš„ï¼›

CSSTransition æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰**ä¸‰ä¸ªçŠ¶æ€**ï¼šappearï¼ˆç¬¬ä¸€æ¬¡åŠ è½½ï¼‰ã€enterã€exitï¼›

**in**ä¼  Boolean å€¼ï¼Œ**å¿…ä¼  timeout**ï¼Œå•ä½æ¯«ç§’ï¼ŒåŠ¨ç”»æŒç»­æ—¶é—´ï¼Œ**å¿…ä¼  unmountOnExit**ï¼Œç»“æŸåŠ¨ç”»æ—¶æ˜¯å¦å¸è½½ï¼Œå¸ƒå°”å€¼ï¼›

å¦‚æœæƒ³è¦**ç¬¬ä¸€æ¬¡åŠ è½½**æ—¶ä¹Ÿå¸Œæœ›æœ‰åŠ¨ç”»ï¼Œå¯ä»¥ç»™ CSSTransition ç»„ä»¶åŠ  appear å±æ€§ï¼Œå¸ƒå°”å€¼ï¼›

###### æ‰§è¡Œè¿‡ç¨‹

1. å½“ in ä¸º true æ—¶ï¼Œè§¦å‘è¿›å…¥çŠ¶æ€ï¼›
2. ä¼šæ·»åŠ **-enter**ã€**-enter-active**çš„ class å¼€å§‹æ‰§è¡ŒåŠ¨ç”»ï¼›
3. å½“åŠ¨ç”»æ‰§è¡Œç»“æŸåï¼Œä¼š**ç§»é™¤**å‰é¢ä¸¤ä¸ª classï¼Œå¹¶æ·»åŠ **-enter-done**çš„ calssï¼›

åä¹‹åŒç†

**App**

```jsx
constructor() {
  super()
  this.state = {
    isShow: true
  }
}
render () {
  const { isShow } = this.state
  return (
    <Fragment>
      <button onClick={e => this.setState({ isShow: !isShow })}>åˆ‡æ¢</button>
      <CSSTransition in={isShow} unmountOnExit={true} classNames="zsf" timeout={2000}>
        <h2>å“ˆå“ˆå“ˆ</h2>
      </CSSTransition>
    </Fragment >
  )
}
```

**å¯¹åº”æ ·å¼**

```
/* å…¥åœºåŠ¨ç”» */
.zsf-enter {
 opacity: 0;
}

.zsf-enter-active {
  opacity: 1;
  transition: opacity 2s ease;
}
/* ç¦»åœºåŠ¨ç”» */
.zsf-exit {
  opacity: 1;
 }

 .zsf-exit-active {
   opacity: 0;
   transition: opacity 2s ease;
 }
```

###### é’©å­å‡½æ•°

ä¸»è¦ä¸ºäº†æ£€æµ‹åŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¥å®Œæˆä¸€äº› js æ“ä½œ

- onEnterï¼šåœ¨è¿›å…¥åŠ¨ç”»ä¹‹å‰è¢«è§¦å‘
- onEnteringï¼š åœ¨åº”ç”¨è¿›å…¥åŠ¨ç”»æ—¶è¢«è§¦å‘
- onEnteredï¼šåœ¨åº”ç”¨è¿›å…¥åŠ¨ç”»ç»“æŸåè¢«è§¦å‘

##### SwitchTransition

æ¯”å¦‚æœ‰ä¸€ä¸ªæŒ‰é’®éœ€è¦åœ¨ on å’Œ off ä¹‹é—´åˆ‡æ¢ï¼Œå¸Œæœ› on å…ˆä»å·¦ä¾§é€€å‡ºï¼Œoff å†ä»å³ä¾§è¿›å…¥ï¼›

è¿™ç§åŠ¨ç”»åœ¨ vue ä¸­è¢«ç§°ä¸º vue transition modesï¼›

å±æ€§ mode æœ‰ä¸ªå€¼ï¼š

- in-out æ–°ç»„ä»¶å…ˆè¿›å…¥ï¼Œæ—§ç»„ä»¶å†ç§»é™¤
- out-in ç»„ä»¶å…ˆç§»é™¤ï¼Œæ–°ç»„ä»¶å†è¿›å…¥

é‡Œé¢è¦æœ‰ CSSTransition æˆ–è€… Transition ç»„ä»¶ï¼Œä¸èƒ½ç›´æ¥åŒ…è£¹ä½ æƒ³è¦åˆ‡æ¢çš„ç»„ä»¶ï¼›

ä¸åƒ CSSTransition æˆ–è€… Transition æ¥æ”¶ in å±æ€§æ¥åˆ¤æ–­å…ƒç´ æ˜¯ä½•ç§çŠ¶æ€ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯**key**å±æ€§ï¼›

**App**

```jsx
constructor() {
  super()
  this.state = {
    isLogin: true
  }
}
render () {
  const { isLogin } = this.state
  return (
    <Fragment>
      <SwitchTransition mode='out-in'>
        <CSSTransition key={isLogin ? 'exit' : 'login'} classNames='zsf' timeout={1000}>
          <button onClick={e => this.setState({ isLogin: !isLogin })}>{isLogin ? 'æ³¨é”€' : 'ç™»é™†'}</button>
        </CSSTransition>
      </SwitchTransition>

    </Fragment >
  )
}
```

**æ ·å¼**

```css
/* å…¥åœºåŠ¨ç”» */
.zsf-enter {
  transform: translateX(100px);
}

.zsf-enter-active {
  transform: translateX(0);
  transition: transform 1s ease;
}
/* ç¦»åœºåŠ¨ç”» */
.zsf-exit {
  transform: translateX(0);
}

.zsf-exit-active {
  transform: translateX(-100px);
  transition: transform 1s ease;
}
```

##### TransitionGroup

å½“æœ‰ä¸€ç»„åŠ¨ç”»æ—¶ï¼Œéœ€è¦å°†è¿™äº›**CSSTransition**æ”¾å…¥åˆ°ä¸€ä¸ª TransitionGroup ä¸­æ¥å®ŒæˆåŠ¨ç”»ï¼›

TransitionGroup é»˜è®¤æ¸²æŸ“æˆ**div**ï¼Œå¯ä»¥ä½¿ç”¨**component å±æ€§**æŒ‡å®šå…¶å®ƒå…ƒç´ ï¼ˆä¼ **å­—ç¬¦ä¸²**ï¼‰ï¼›

å¹¶ä¸” CSSTransition è®¾ç½®**key å±æ€§**è¦ä¿æŒå”¯ä¸€ï¼Œå¦åˆ™ä¼šå‘ç”Ÿé”™ä¹±ï¼›

**App**

```jsx
constructor() {
  super()
  this.state = {
    books: [
      { id: 111, name: 'ä½ ä¸çŸ¥é“çš„js', price: 99 },
      { id: 112, name: 'jsé«˜çº§ç¨‹åºè®¾è®¡', price: 89 },
      { id: 113, name: 'Vueç¨‹åºè®¾è®¡', price: 77 },
    ]
  }
}
addBook () {
  const books = [...this.state.books]
  books.push({ id: 114, name: 'Reactç¨‹åºè®¾è®¡', price: 87 })
  this.setState({ books: books })
}
removeBook (index) {
  const books = [...this.state.books]
  books.splice(index, 1)
  this.setState({ books: books })
}
render () {
  const { books } = this.state
  return (
    <Fragment>
      <h2>ä¹¦ç±åˆ—è¡¨</h2>
      <TransitionGroup component='ul'>
        {
          books.map((item, index) => {
            return (
              <CSSTransition key={item.id} classNames='zsf' timeout={1000}>
                <li key={item.name}>
                  <span>{item.name}-{item.price}</span>
                  <button onClick={e => this.removeBook(index)}>åˆ é™¤</button>
                </li>
              </CSSTransition>
            )
          })
        }
      </TransitionGroup>
      <button onClick={e => this.addBook()}>æ·»åŠ æ–°ä¹¦</button>
    </Fragment >
  )
}
```

**æ ·å¼**

```css
/* å…¥åœºåŠ¨ç”» */
.zsf-enter {
  transform: translateX(150px);
}

.zsf-enter-active {
  transform: translateX(0);
  transition: transform 1s ease;
}
/* ç¦»åœºåŠ¨ç”» */
.zsf-exit {
  transform: translateX(0);
}

.zsf-exit-active {
  transform: translateX(150px);
  transition: transform 1s ease;
}
```

## çˆ±å½¼è¿é¡¹ç›®

### åˆ›å»º

å‘½åä¸º airbnb

```
create-react-app airbnb
```

#### é¡¹ç›®é…ç½®

- icon
- æ ‡é¢˜
- jsconfig.json(vscode æ™ºèƒ½æç¤º)

**jsconfig.json**

```json
{
  "compilerOptions": {
    "target": "es5",
    "module": "esnext",
    "baseUrl": "./",
    "moduleResolution": "node",
    "paths": {
      "@/*": ["src/*"]
    },
    "jsx": "preserve",
    "lib": ["esnext", "dom", "dom.iterable", "scripthost"]
  }
}
```

åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œåªä¿ç•™ App.js å’Œ index.js

#### é‡ç½® App.js å’Œ index.js

**App.js**

```jsx
import React, { memo } from "react";

const App = memo(() => {
  return <div>App</div>;
});

export default App;
```

**index.js**

```jsx
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

#### craco é…ç½®åˆ«å

å®‰è£…

```
npm install @craco/craco@alpha -D
```

æ–°å»º**craco.config.js**

```js
const path = require("path");

const resolve = (dir) => path.resolve(__dirname, dir);

module.exports = {
  webpack: {
    alias: {
      "@": resolve("src"),
      components: resolve("src/components"),
      utils: resolve("src/utils"),
    },
  },
};
```

#### craco é…ç½® less æ–‡ä»¶

å®‰è£…

```
npm install craco-less@2.1.0-alpha.0
```

**craco.config.js**

```js
const path = require("path");
const CracoLessPlugin = require("craco-less");

const resolve = (dir) => path.resolve(__dirname, dir);

module.exports = {
  // less
  plugins: [
    {
      plugin: CracoLessPlugin,
    },
  ],
  // webpack
  webpack: {
    alias: {
      "@": resolve("src"),
      components: resolve("src/components"),
      utils: resolve("src/utils"),
    },
  },
};
```

#### css æ ·å¼é‡ç½®

å¯¹é»˜è®¤ css æ ·å¼é‡ç½®ï¼š

- normalize.css
- reset.css

å®‰è£…

```
npm install normalize.css
```

**index.js**

```js
import "normalize.css";
import "@/assets/css/reset.css";
```

**reset.css**

```less
@import "./variables.less";

body,
button,
dd,
dl,
dt,
form,
h1,
h2,
h3,
h4,
h5,
h6,
hr,
input,
li,
ol,
p,
pre,
td,
textarea,
th,
ul {
  padding: 0;
  margin: 0;
}

a {
  color: @textColor;
  text-decoration: none;
}

img {
  vertical-align: top;
}

ul,
li {
  list-style: none;
}
```

**variables.less**

```less
@textColor: #484848;
@textColorSecondary: #222;
```

### é¡¹ç›®åˆè¯†åŒ–é…ç½®

#### é…ç½® router

å®‰è£…

```
npm install react-router-dom
```

**è·¯ç”±é…ç½®**

```js
import React from "react";
import { Navigate } from "react-router-dom";

const Home = React.lazy(() => import("@/views/home"));
const Entire = React.lazy(() => import("@/views/entire"));
const Detail = React.lazy(() => import("@/views/detail"));

const routes = [
  {
    path: "/",
    element: <Navigate to="/home" />,
  },
  {
    path: "/home",
    element: <Home />,
  },
  {
    path: "/entire",
    element: <Entire />,
  },
  {
    path: "/detail",
    element: <Detail />,
  },
];

export default routes;
```

**index.js**

```jsx
import React, { Suspense } from "react";
import ReactDOM from "react-dom/client";
import { HashRouter } from "react-router-dom";

import App from "./App";
import "normalize.css";
import "@/assets/css/reset.css";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <Suspense fallback="loading">
      <HashRouter>
        <App />
      </HashRouter>
    </Suspense>
  </React.StrictMode>
);
```

**App.jsx**

```jsx
import React, { memo } from "react";
import { useRoutes } from "react-router-dom";
import routes from "./router";

const App = memo(() => {
  return (
    <div className="app">
      <div className="header">header</div>
      <div className="page">{useRoutes(routes)}</div>
      <div className="footer">footer</div>
    </div>
  );
});

export default App;
```

#### é…ç½® redux

å®‰è£…

```
npm install @reduxjs/toolkit react-redux
```

store ä¸‹çš„**index.js**

```js
import { configureStore } from "@reduxjs/toolkit";
import homeReducer from "./modules/home";
import entireReducer from "./modules/entire";

const store = configureStore({
  reducer: {
    home: homeReducer,
    entire: entireReducer,
  },
});

export default store;
```

**home æ¨¡å—çš„ reducer**

```js
import { createSlice } from "@reduxjs/toolkit";

const homeSlice = createSlice({
  name: "home",
  initialState: {},
  reducers: {},
});

export default homeSlice.reducer;
```

**entire æ¨¡å—çš„ reducer**

```js
const initialState = {};

function reducer(state = initialState, action) {
  switch (action.type) {
    default:
      return state;
  }
}

export default reducer;
```

**App.jsx**

```jsx
import React, { Suspense } from "react";
import ReactDOM from "react-dom/client";
import { HashRouter } from "react-router-dom";
import { Provider } from "react-redux";

import App from "./App";
import store from "./store";
import "normalize.css";
import "@/assets/css/reset.css";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <Suspense fallback="loading">
      <Provider store={store}>
        <HashRouter>
          <App />
        </HashRouter>
      </Provider>
    </Suspense>
  </React.StrictMode>
);
```

#### å°è£… axios

å®‰è£…

```
npm install axios
```

services ä¸‹çš„ request ä¸‹çš„**index.js**

```js
import axios from "axios";
import { BASE_URL, TIMEOUT } from "./config";

class SFRequest {
  constructor(baseURL, timeout) {
    this.instance = axios.create({
      baseURL,
      timeout,
    });

    this.instance.interceptors.response.use(
      (res) => {
        return res.data;
      },
      (err) => {
        return err;
      }
    );
  }

  request(config) {
    return this.instance.request(config);
  }

  get(config) {
    return this.request({ ...config, method: "get" });
  }

  post(config) {
    return this.request({ ...config, method: "post" });
  }
}

export default new SFRequest(BASE_URL, TIMEOUT);
```

**config.js**

```js
export const BASE_URL = "xxx";
export const TIMEOUT = 10000;
```

### é¦–é¡µ

#### å¤´éƒ¨å†…å®¹

##### AppHeader

ä½¿ç”¨**css in js**æŠ€æœ¯ç¼–å†™æ ·å¼

```
npm install styled-components
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const HeaderWrapper = styled.div`
  display: flex;
  align-items: center;
  height: 80px;
  border-bottom: 1px solid #eee;
`;
```

**AppHeader**

```jsx
import React, { memo } from "react";

import HeaderCenter from "./c-cpns/header-center";
import HeaderLeft from "./c-cpns/header-left";
import HeaderRight from "./c-cpns/header-right";
import { HeaderWrapper } from "./style";

const AppHeader = memo(() => {
  return (
    <HeaderWrapper>
      <HeaderLeft />
      <HeaderCenter />
      <HeaderRight />
    </HeaderWrapper>
  );
});

export default AppHeader;
```

##### **å¸ƒå±€å…³é”®**

ä¸ºäº†ä¿æŒ**ä¸­é—´éƒ¨åˆ†**å±…ä¸­ï¼Œä¸­é—´**å†…å®¹å†³å®šå®½åº¦**ï¼Œå·¦å³ä¸¤è¾¹å®½åº¦å„**å å‰©ä½™çš„ä¸€åŠ**ï¼Œä¹Ÿå°±æ˜¯**flexï¼š1**ï¼›

**å³è¾¹å†…å®¹**éœ€è¦**å‘å³å¯¹é½**ï¼Œä¹Ÿå°±æ˜¯**justify-contentï¼šflex-end**ï¼›

##### HeaderLeft

```jsx
import React, { memo } from "react";
import { LeftWrapper } from "./style";

const HeaderLeft = memo(() => {
  return <LeftWrapper>HeaderLeft</LeftWrapper>;
});

export default HeaderLeft;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const LeftWrapper = styled.div`
  flex: 1;
`;
```

###### ä½¿ç”¨ svg ä¸¤ç§æ–¹å¼

- ä¿å­˜ä¸º**svg æ–‡ä»¶**ï¼Œé€šè¿‡**img å…ƒç´ **å¼•å…¥
- ç›´æ¥ä½¿ç”¨**svg å…ƒç´ **

ç›´æ¥ä½¿ç”¨ svg å…ƒç´ å¥½å¤„æ˜¯ï¼šå½“é¡µé¢åŠ è½½æ—¶ï¼Œç›´æ¥æ¸²æŸ“ svg å…ƒç´ ï¼Œ**æ— éœ€ä¸‹è½½**ï¼Œä¸”ä¿®æ”¹æ ·å¼æ–¹ä¾¿

###### å­—ç¬¦ä¸²å˜å¯¹è±¡çš„å·¥å…·å‡½æ•°

**styleStrToObject**

```js
function styleStrToObject(styleStr) {
  const obj = {};

  const s = styleStr
    .toLowerCase()
    .replace(/-(.)/g, function (m, g) {
      return g.toUpperCase();
    })
    .replace(/;\s?$/g, "")
    .split(/:|;/g);

  for (var i = 0; i < s.length; i += 2) {
    obj[s[i].replace(/\s/g, "")] = s[i + 1].replace(/^\s+|\s+$/g, "");
  }

  return obj;
}

export default styleStrToObject;
```

**HeaderLeft**

```jsx
import React, { memo } from "react";
import { LeftWrapper } from "./style";

import IconLogo from "@/assets/svg/icon_logo";

const HeaderLeft = memo(() => {
  return (
    <LeftWrapper>
      <IconLogo />
    </LeftWrapper>
  );
});

export default HeaderLeft;
```

**ä¿®æ”¹é¢œè‰²**

svg é»˜è®¤ç”¨åˆ°çš„é¢œè‰²å°±æ˜¯å½“å‰**æœ€è¿‘çˆ¶å…ƒç´ **çš„é¢œè‰²ï¼Œè¿™æ ·é¢œè‰²å°±å¯ä»¥éšä¾¿å˜äº†

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const LeftWrapper = styled.div`
  flex: 1;
  color: red;
`;
```

**IconLogo**

```jsx
import React, { memo } from "react";
import styleStrToObject from "./utils";

const IconLogo = memo(() => {
  return (
    <svg width="102" height="32" style={styleStrToObject("display:block")}>
      <path
        d="M29.3864 22.7101C29.2429 22.3073 29.0752 21.9176 28.9157 21.5565C28.6701 21.0011 28.4129 20.4446 28.1641 19.9067L28.1444 19.864C25.9255 15.0589 23.5439 10.1881 21.0659 5.38701L20.9607 5.18316C20.7079 4.69289 20.4466 4.18596 20.1784 3.68786C19.8604 3.0575 19.4745 2.4636 19.0276 1.91668C18.5245 1.31651 17.8956 0.833822 17.1853 0.502654C16.475 0.171486 15.7005 -9.83959e-05 14.9165 4.23317e-08C14.1325 9.84805e-05 13.3581 0.171877 12.6478 0.503224C11.9376 0.834571 11.3088 1.31742 10.8059 1.91771C10.3595 2.46476 9.97383 3.05853 9.65572 3.68858C9.38521 4.19115 9.12145 4.70278 8.8664 5.19757L8.76872 5.38696C6.29061 10.1884 3.90903 15.0592 1.69015 19.8639L1.65782 19.9338C1.41334 20.463 1.16057 21.0102 0.919073 21.5563C0.75949 21.9171 0.592009 22.3065 0.448355 22.7103C0.0369063 23.8104 -0.094204 24.9953 0.0668098 26.1585C0.237562 27.334 0.713008 28.4447 1.44606 29.3804C2.17911 30.3161 3.14434 31.0444 4.24614 31.4932C5.07835 31.8299 5.96818 32.002 6.86616 32C7.14824 31.9999 7.43008 31.9835 7.71027 31.9509C8.846 31.8062 9.94136 31.4366 10.9321 30.8639C12.2317 30.1338 13.5152 29.0638 14.9173 27.5348C16.3194 29.0638 17.6029 30.1338 18.9025 30.8639C19.8932 31.4367 20.9886 31.8062 22.1243 31.9509C22.4045 31.9835 22.6864 31.9999 22.9685 32C23.8664 32.002 24.7561 31.8299 25.5883 31.4932C26.6901 31.0444 27.6554 30.3161 28.3885 29.3804C29.1216 28.4447 29.5971 27.3341 29.7679 26.1585C29.9287 24.9952 29.7976 23.8103 29.3864 22.7101ZM14.9173 24.377C13.1816 22.1769 12.0678 20.1338 11.677 18.421C11.5169 17.7792 11.4791 17.1131 11.5656 16.4573C11.6339 15.9766 11.8105 15.5176 12.0821 15.1148C12.4163 14.6814 12.8458 14.3304 13.3374 14.0889C13.829 13.8475 14.3696 13.7219 14.9175 13.7219C15.4655 13.722 16.006 13.8476 16.4976 14.0892C16.9892 14.3307 17.4186 14.6817 17.7528 15.1151C18.0244 15.5181 18.201 15.9771 18.2693 16.4579C18.3556 17.114 18.3177 17.7803 18.1573 18.4223C17.7661 20.1349 16.6526 22.1774 14.9173 24.377ZM27.7406 25.8689C27.6212 26.6908 27.2887 27.4674 26.7762 28.1216C26.2636 28.7759 25.5887 29.2852 24.8183 29.599C24.0393 29.9111 23.1939 30.0217 22.3607 29.9205C21.4946 29.8089 20.6599 29.5239 19.9069 29.0824C18.7501 28.4325 17.5791 27.4348 16.2614 25.9712C18.3591 23.3846 19.669 21.0005 20.154 18.877C20.3723 17.984 20.4196 17.0579 20.2935 16.1475C20.1791 15.3632 19.8879 14.615 19.4419 13.9593C18.9194 13.2519 18.2378 12.6768 17.452 12.2805C16.6661 11.8842 15.798 11.6777 14.9175 11.6777C14.0371 11.6777 13.1689 11.8841 12.383 12.2803C11.5971 12.6765 10.9155 13.2515 10.393 13.9589C9.94707 14.6144 9.65591 15.3624 9.5414 16.1465C9.41524 17.0566 9.4623 17.9822 9.68011 18.8749C10.1648 20.9993 11.4748 23.384 13.5732 25.9714C12.2555 27.4348 11.0845 28.4325 9.92769 29.0825C9.17468 29.5239 8.34007 29.809 7.47395 29.9205C6.64065 30.0217 5.79525 29.9111 5.0162 29.599C4.24581 29.2852 3.57092 28.7759 3.05838 28.1217C2.54585 27.4674 2.21345 26.6908 2.09411 25.8689C1.97932 25.0334 2.07701 24.1825 2.37818 23.3946C2.49266 23.0728 2.62663 22.757 2.7926 22.3818C3.0274 21.851 3.27657 21.3115 3.51759 20.7898L3.54996 20.7197C5.75643 15.9419 8.12481 11.0982 10.5894 6.32294L10.6875 6.13283C10.9384 5.64601 11.1979 5.14267 11.4597 4.6563C11.7101 4.15501 12.0132 3.68171 12.3639 3.2444C12.6746 2.86903 13.0646 2.56681 13.5059 2.35934C13.9473 2.15186 14.4291 2.04426 14.9169 2.04422C15.4047 2.04418 15.8866 2.15171 16.3279 2.35911C16.7693 2.56651 17.1593 2.86867 17.4701 3.24399C17.821 3.68097 18.1242 4.15411 18.3744 4.65538C18.6338 5.13742 18.891 5.63623 19.1398 6.11858L19.2452 6.32315C21.7097 11.0979 24.078 15.9415 26.2847 20.7201L26.3046 20.7631C26.5498 21.2936 26.8033 21.8419 27.042 22.382C27.2082 22.7577 27.3424 23.0738 27.4566 23.3944C27.7576 24.1824 27.8553 25.0333 27.7406 25.8689Z"
        fill="currentcolor"
      ></path>
      <path
        d="M41.6847 24.1196C40.8856 24.1196 40.1505 23.9594 39.4792 23.6391C38.808 23.3188 38.2327 22.8703 37.7212 22.2937C37.2098 21.7172 36.8263 21.0445 36.5386 20.3078C36.2509 19.539 36.123 18.7062 36.123 17.8093C36.123 16.9124 36.2829 16.0475 36.5705 15.2787C36.8582 14.51 37.2737 13.8373 37.7852 13.2287C38.2966 12.6521 38.9039 12.1716 39.6071 11.8513C40.3103 11.531 41.0455 11.3708 41.8765 11.3708C42.6756 11.3708 43.3788 11.531 44.0181 11.8833C44.6574 12.2037 45.1688 12.6841 45.5843 13.2927L45.6802 11.7232H48.6209V23.7992H45.6802L45.5843 22.0375C45.1688 22.6781 44.6254 23.1906 43.9222 23.575C43.2829 23.9274 42.5158 24.1196 41.6847 24.1196ZM42.4519 21.2367C43.0272 21.2367 43.5386 21.0765 44.0181 20.7882C44.4656 20.4679 44.8172 20.0515 45.1049 19.539C45.3606 19.0265 45.4884 18.4179 45.4884 17.7452C45.4884 17.0725 45.3606 16.4639 45.1049 15.9514C44.8492 15.4389 44.4656 15.0225 44.0181 14.7022C43.5706 14.3818 43.0272 14.2537 42.4519 14.2537C41.8765 14.2537 41.3651 14.4139 40.8856 14.7022C40.4382 15.0225 40.0866 15.4389 39.7989 15.9514C39.5432 16.4639 39.4153 17.0725 39.4153 17.7452C39.4153 18.4179 39.5432 19.0265 39.7989 19.539C40.0546 20.0515 40.4382 20.4679 40.8856 20.7882C41.3651 21.0765 41.8765 21.2367 42.4519 21.2367ZM53.6392 8.4559C53.6392 8.80825 53.5753 9.12858 53.4154 9.38483C53.2556 9.64109 53.0319 9.86531 52.7442 10.0255C52.4565 10.1856 52.1369 10.2497 51.8173 10.2497C51.4976 10.2497 51.178 10.1856 50.8903 10.0255C50.6026 9.86531 50.3789 9.64109 50.2191 9.38483C50.0592 9.09654 49.9953 8.80825 49.9953 8.4559C49.9953 8.10355 50.0592 7.78323 50.2191 7.52697C50.3789 7.23868 50.6026 7.04649 50.8903 6.88633C51.178 6.72617 51.4976 6.66211 51.8173 6.66211C52.1369 6.66211 52.4565 6.72617 52.7442 6.88633C53.0319 7.04649 53.2556 7.27072 53.4154 7.52697C53.5433 7.78323 53.6392 8.07152 53.6392 8.4559ZM50.2191 23.7672V11.6911H53.4154V23.7672H50.2191V23.7672ZM61.9498 14.8623V14.8943C61.79 14.8303 61.5982 14.7982 61.4383 14.7662C61.2466 14.7342 61.0867 14.7342 60.895 14.7342C60 14.7342 59.3287 14.9904 58.8812 15.535C58.4018 16.0795 58.178 16.8483 58.178 17.8413V23.7672H54.9817V11.6911H57.9223L58.0182 13.517C58.3379 12.8763 58.7214 12.3958 59.2648 12.0435C59.7762 11.6911 60.3835 11.531 61.0867 11.531C61.3105 11.531 61.5342 11.563 61.726 11.595C61.8219 11.6271 61.8858 11.6271 61.9498 11.6591V14.8623ZM63.2283 23.7672V6.72617H66.4247V13.2287C66.8722 12.6521 67.3836 12.2036 68.0229 11.8513C68.6622 11.531 69.3654 11.3388 70.1645 11.3388C70.9635 11.3388 71.6987 11.4989 72.3699 11.8193C73.0412 12.1396 73.6165 12.588 74.128 13.1646C74.6394 13.7412 75.0229 14.4139 75.3106 15.1506C75.5983 15.9194 75.7261 16.7522 75.7261 17.6491C75.7261 18.546 75.5663 19.4109 75.2787 20.1796C74.991 20.9484 74.5755 21.6211 74.064 22.2297C73.5526 22.8063 72.9453 23.2867 72.2421 23.6071C71.5389 23.9274 70.8037 24.0875 69.9727 24.0875C69.1736 24.0875 68.4704 23.9274 67.8311 23.575C67.1918 23.2547 66.6804 22.7742 66.2649 22.1656L66.169 23.7352L63.2283 23.7672ZM69.3973 21.2367C69.9727 21.2367 70.4841 21.0765 70.9635 20.7882C71.411 20.4679 71.7626 20.0515 72.0503 19.539C72.306 19.0265 72.4339 18.4179 72.4339 17.7452C72.4339 17.0725 72.306 16.4639 72.0503 15.9514C71.7626 15.4389 71.411 15.0225 70.9635 14.7022C70.5161 14.3818 69.9727 14.2537 69.3973 14.2537C68.822 14.2537 68.3106 14.4139 67.8311 14.7022C67.3836 15.0225 67.032 15.4389 66.7443 15.9514C66.4886 16.4639 66.3608 17.0725 66.3608 17.7452C66.3608 18.4179 66.4886 19.0265 66.7443 19.539C67 20.0515 67.3836 20.4679 67.8311 20.7882C68.3106 21.0765 68.822 21.2367 69.3973 21.2367ZM76.9408 23.7672V11.6911H79.8814L79.9773 13.2607C80.3289 12.6841 80.8084 12.2357 81.4157 11.8833C82.023 11.531 82.7262 11.3708 83.5253 11.3708C84.4203 11.3708 85.1874 11.595 85.8267 12.0115C86.4979 12.4279 87.0094 13.0365 87.361 13.8053C87.7126 14.574 87.9043 15.5029 87.9043 16.56V23.7992H84.708V16.9764C84.708 16.1436 84.5162 15.4709 84.1326 14.9904C83.7491 14.51 83.2376 14.2537 82.5664 14.2537C82.0869 14.2537 81.6714 14.3498 81.2878 14.574C80.9362 14.7982 80.6486 15.0865 80.4248 15.503C80.2011 15.8873 80.1052 16.3678 80.1052 16.8483V23.7672H76.9408V23.7672ZM89.5025 23.7672V6.72617H92.6989V13.2287C93.1464 12.6521 93.6578 12.2036 94.2971 11.8513C94.9364 11.531 95.6396 11.3388 96.4387 11.3388C97.2378 11.3388 97.9729 11.4989 98.6442 11.8193C99.3154 12.1396 99.8907 12.588 100.402 13.1646C100.914 13.7412 101.297 14.4139 101.585 15.1506C101.873 15.9194 102 16.7522 102 17.6491C102 18.546 101.841 19.4109 101.553 20.1796C101.265 20.9484 100.85 21.6211 100.338 22.2297C99.8268 22.8063 99.2195 23.2867 98.5163 23.6071C97.8131 23.9274 97.0779 24.0875 96.2469 24.0875C95.4478 24.0875 94.7446 23.9274 94.1053 23.575C93.466 23.2547 92.9546 22.7742 92.5391 22.1656L92.4432 23.7352L89.5025 23.7672ZM95.7035 21.2367C96.2788 21.2367 96.7903 21.0765 97.2697 20.7882C97.7172 20.4679 98.0688 20.0515 98.3565 19.539C98.6122 19.0265 98.7401 18.4179 98.7401 17.7452C98.7401 17.0725 98.6122 16.4639 98.3565 15.9514C98.1008 15.4389 97.7172 15.0225 97.2697 14.7022C96.8222 14.3818 96.2788 14.2537 95.7035 14.2537C95.1281 14.2537 94.6167 14.4139 94.1373 14.7022C93.6898 15.0225 93.3382 15.4389 93.0505 15.9514C92.7628 16.4639 92.6669 17.0725 92.6669 17.7452C92.6669 18.4179 92.7948 19.0265 93.0505 19.539C93.3062 20.0515 93.6898 20.4679 94.1373 20.7882C94.6167 21.0765 95.0962 21.2367 95.7035 21.2367Z"
        fill="currentcolor"
      ></path>
    </svg>
  );
});

export default IconLogo;
```

###### ä¸»é¢˜é¢œè‰²

```js
const theme = {
  color: {
    primaryColor: "#ff385c",
    secondaryColor: "#00848A",
  },
};

export default theme;
```

**index.js**

```jsx
import React, { Suspense } from "react";
import ReactDOM from "react-dom/client";
import { HashRouter } from "react-router-dom";
import { Provider } from "react-redux";
import { ThemeProvider } from "styled-components";

import App from "./App";
import store from "./store";
import "normalize.css";
import "@/assets/css/reset.less";
import theme from "./assets/theme";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <Suspense fallback="loading">
      <Provider store={store}>
        <ThemeProvider theme={theme}>
          <HashRouter>
            <App />
          </HashRouter>
        </ThemeProvider>
      </Provider>
    </Suspense>
  </React.StrictMode>
);
```

**HeaderLeft**

```jsx
import React, { memo } from "react";
import { LeftWrapper } from "./style";

import IconLogo from "@/assets/svg/icon_logo";

const HeaderLeft = memo(() => {
  return (
    <LeftWrapper>
      <div className="logo">
        <IconLogo />
      </div>
    </LeftWrapper>
  );
});

export default HeaderLeft;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const LeftWrapper = styled.div`
  flex: 1;
  display: flex;
  align-items: center;
  color: ${(props) => props.theme.color.primaryColor};

  .logo {
    margin-left: 25px;
    cursor: pointer;
  }
`;
```

##### HeaderCenter

```jsx
import IconSearchBar from "@/assets/svg/icon_search_bar";
import React, { memo } from "react";
import { CenterWrapper } from "./style";

const HeaderCenter = memo(() => {
  return (
    <CenterWrapper>
      <div className="search-bar">
        <div className="text">æœç´¢æˆ¿æºå’Œä½“éªŒ</div>
        <div className="icon">
          <IconSearchBar />
        </div>
      </div>
    </CenterWrapper>
  );
});

export default HeaderCenter;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const CenterWrapper = styled.div`
  .search-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 300px;
    height: 48px;
    box-sizing: border-box;
    padding: 0 8px;
    border: 1px solid #ddd;
    border-radius: 24px;
    cursor: pointer;

    ${(props) => props.theme.mixin.boxShadow};

    .text {
      padding: 0 16px;
      color: #222;
      font-weight: 600;
    }

    .icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      color: #fff;
      background-color: ${(props) => props.theme.color.primaryColor};
    }
  }
`;
```

**IconSearchBar**

```jsx
import React, { memo } from "react";
import styleStrToObj from "./utils";

const IconSearchBar = memo(() => {
  return (
    <svg
      viewBox="0 0 32 32"
      xmlns="http://www.w3.org/2000/svg"
      style={styleStrToObj(
        "display:block;fill:none;height:12px;width:12px;stroke:currentColor;stroke-width:5.333333333333333;overflow:visible"
      )}
      aria-hidden="true"
      role="presentation"
      focusable="false"
    >
      <g fill="none">
        <path d="m13 24c6.0751322 0 11-4.9248678 11-11 0-6.07513225-4.9248678-11-11-11-6.07513225 0-11 4.92486775-11 11 0 6.0751322 4.92486775 11 11 11zm8-3 9 9"></path>
      </g>
    </svg>
  );
});

export default IconSearchBar;
```

##### HeaderRight

```jsx
import React, { memo } from "react";

import { RightWrapper } from "./style";
import IconAvatar from "@/assets/svg/icon_avatar";
import IconGlobal from "@/assets/svg/icon_global";
import IconMenu from "@/assets/svg/icon_menu";

const HeaderRight = memo(() => {
  return (
    <RightWrapper>
      <div className="btns">
        <span className="btn">ç™»é™†</span>
        <span className="btn">æ³¨å†Œ</span>
        <span className="btn">
          <IconGlobal />
        </span>
      </div>

      <div className="profile">
        <IconMenu />
        <IconAvatar />
      </div>
    </RightWrapper>
  );
});

export default HeaderRight;
```

**IconGlobal**

```jsx
import React, { memo } from "react";
import styleStrToObject from "./utils";

const IconGlobal = memo(() => {
  return (
    <svg
      viewBox="0 0 16 16"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
      role="presentation"
      focusable="false"
      style={styleStrToObject(
        "display: block; height: 16px; width: 16px; fill: currentcolor;"
      )}
    >
      <path d="m8.002.25a7.77 7.77 0 0 1 7.748 7.776 7.75 7.75 0 0 1 -7.521 7.72l-.246.004a7.75 7.75 0 0 1 -7.73-7.513l-.003-.245a7.75 7.75 0 0 1 7.752-7.742zm1.949 8.5h-3.903c.155 2.897 1.176 5.343 1.886 5.493l.068.007c.68-.002 1.72-2.365 1.932-5.23zm4.255 0h-2.752c-.091 1.96-.53 3.783-1.188 5.076a6.257 6.257 0 0 0 3.905-4.829zm-9.661 0h-2.75a6.257 6.257 0 0 0 3.934 5.075c-.615-1.208-1.036-2.875-1.162-4.686l-.022-.39zm1.188-6.576-.115.046a6.257 6.257 0 0 0 -3.823 5.03h2.75c.085-1.83.471-3.54 1.059-4.81zm2.262-.424c-.702.002-1.784 2.512-1.947 5.5h3.904c-.156-2.903-1.178-5.343-1.892-5.494l-.065-.007zm2.28.432.023.05c.643 1.288 1.069 3.084 1.157 5.018h2.748a6.275 6.275 0 0 0 -3.929-5.068z"></path>
    </svg>
  );
});

export default IconGlobal;
```

**IconMenu**

```jsx
import React, { memo } from "react";
import styleStrToObject from "./utils";

const IconMenu = memo(() => {
  return (
    <svg
      viewBox="0 0 32 32"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
      role="presentation"
      focusable="false"
      style={styleStrToObject(
        "display: block; fill: none; height: 16px; width: 16px; stroke: currentcolor; stroke-width: 3; overflow: visible;"
      )}
    >
      <g fill="none" fillRule="nonzero">
        <path d="m2 16h28"></path>
        <path d="m2 24h28"></path>
        <path d="m2 8h28"></path>
      </g>
    </svg>
  );
});

export default IconMenu;
```

**IconAvatar**

```jsx
import React, { memo } from "react";
import styleStrToObject from "./utils";

const IconAvatar = memo(() => {
  return (
    <svg
      viewBox="0 0 32 32"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
      role="presentation"
      focusable="false"
      style={styleStrToObject(
        "display: block; height: 32px; width: 32px; fill: currentcolor;"
      )}
    >
      <path d="m16 .7c-8.437 0-15.3 6.863-15.3 15.3s6.863 15.3 15.3 15.3 15.3-6.863 15.3-15.3-6.863-15.3-15.3-15.3zm0 28c-4.021 0-7.605-1.884-9.933-4.81a12.425 12.425 0 0 1 6.451-4.4 6.507 6.507 0 0 1 -3.018-5.49c0-3.584 2.916-6.5 6.5-6.5s6.5 2.916 6.5 6.5a6.513 6.513 0 0 1 -3.019 5.491 12.42 12.42 0 0 1 6.452 4.4c-2.328 2.925-5.912 4.809-9.933 4.809z"></path>
    </svg>
  );
});

export default IconAvatar;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const RightWrapper = styled.div`
  flex: 1;
  display: flex;
  justify-content: flex-end;
  align-items: center;

  color: ${(props) => props.theme.text.primaryColor};
  font-size: 14px;
  font-weight: 600;

  .btns {
    display: flex;
    box-sizing: content-box;

    .btn {
      height: 18px;
      line-height: 18px;
      padding: 12px 15px;
      border-radius: 22px;
      cursor: pointer;
      box-sizing: content-box;

      &:hover {
        background-color: #f5f5f5;
      }
    }
  }

  .profile {
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    width: 77px;
    height: 42px;
    margin-right: 24px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 25px;
    background-color: #fff;
    cursor: pointer;

    color: ${(props) => props.theme.text.primaryColor};
  }
`;
```

**ä¸»é¢˜æ ·å¼**

```js
const theme = {
  color: {
    primaryColor: "#ff385c",
    secondaryColor: "#00848A",
  },
  text: {
    primaryColor: "#484848",
    secondaryColor: "#222",
  },
};

export default theme;
```

###### æŠ½å–å¯å¤ç”¨åŠ¨ç”»

**ä¸»ä½“æ ·å¼**

```js
const theme = {
  color: {
    primaryColor: "#ff385c",
    secondaryColor: "#00848A",
  },
  text: {
    primaryColor: "#484848",
    secondaryColor: "#222",
  },
  mixin: {
    boxShadow: `
      transition: box-shadow 200ms ease;
      &:hover {
        box-shadow: 0 2px 4px rgba(0,0,0,.18);
      }
    `,
  },
};

export default theme;
```

**HeaderRight å¯¹åº”æ ·å¼**

```js
.profile {
  ...

  ${props => props.theme.mixin.boxShadow};

}
```

###### **ä¿¡æ¯é¢æ¿åˆ‡æ¢**

ç‚¹å‡»ä¸ªäººä¿¡æ¯å›¾æ ‡ï¼Œ**é¢æ¿**æ˜¾ç¤ºï¼›

çª—å£ä»»ä½•ç‚¹å‡»ï¼Œ**é¢æ¿**éšè—ï¼›

æœ‰ä¸€ä¸ªé—®é¢˜ï¼šç‚¹å‡»ä¸ªäººä¿¡æ¯é¢æ¿åï¼Œç”±äº**äº‹ä»¶å†’æ³¡**ï¼Œå¯¼è‡´çª—å£çš„ç‚¹å‡»äº‹ä»¶ä¹Ÿè§¦å‘äº†ï¼Œæ‰€ä»¥**é¢æ¿**ä¾ç„¶å…³é—­ï¼›

ä½¿ç”¨**äº‹ä»¶æ•è·**ï¼Œ**addEventListener**ç¬¬äºŒä¸ªå‚æ•°ä¸º true å³å¯ï¼›

**HeaderRight**

```jsx
import React, { memo, useEffect, useState } from "react";

import { RightWrapper } from "./style";
import IconAvatar from "@/assets/svg/icon_avatar";
import IconGlobal from "@/assets/svg/icon_global";
import IconMenu from "@/assets/svg/icon_menu";

const HeaderRight = memo(() => {
  // çŠ¶æ€
  const [showPanel, setShowPanel] = useState(false);

  // å‰¯ä½œç”¨
  useEffect(() => {
    function windowHandle() {
      setShowPanel(false);
    }
    window.addEventListener("click", windowHandle, true);
    // å–æ¶ˆç›‘å¬
    return () => {
      window.removeEventListener("click", windowHandle, true);
    };
  }, []);

  // äº‹ä»¶ç›‘å¬
  function profileClick() {
    setShowPanel(true);
  }

  return (
    <RightWrapper>
      <div className="btns">
        <span className="btn">ç™»é™†</span>
        <span className="btn">æ³¨å†Œ</span>
        <span className="btn">
          <IconGlobal />
        </span>
      </div>

      <div className="profile" onClick={profileClick}>
        <IconMenu />
        <IconAvatar />
        {showPanel && (
          <div className="panel">
            <div className="top">
              <div className="item register">æ³¨å†Œ</div>
              <div className="item login">ç™»é™†</div>
            </div>
            <div className="bottom">
              <div className="item">å‡ºç§Ÿæˆ¿æº</div>
              <div className="item">å¼€å±•ä½“éªŒ</div>
              <div className="item">å¸®åŠ©</div>
            </div>
          </div>
        )}
      </div>
    </RightWrapper>
  );
});

export default HeaderRight;
```

**å¯¹åº”æ ·å¼**

```js
.profile {
  ...
  .panel {
      position: absolute;
      top: 54px;
      right: 0;
      width: 240px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 6px rgba(0,0,0,.2);
      color: #666;

      .top, .bottom {
        padding: 10px 0;

        .item {
          height: 40px;
          line-height: 40px;
          padding: 0 16px;

          &:hover {
            background-color: #f5f5f5;
          }
        }
      }

      .top {
        border-bottom: 1px solid #ddd;
      }
  }
}
```

#### ä¸­é—´å†…å®¹

##### é¡¶éƒ¨è½®æ’­å›¾ç‰‡

**Home**

```jsx
import React, { memo } from "react";

import HomeBanner from "./c-cpns/home-banner";
import { HomeWrapper } from "./style";

const Home = memo(() => {
  return (
    <HomeWrapper>
      <HomeBanner />
    </HomeWrapper>
  );
});

export default Home;
```

**HomeBanner**

```jsx
import React, { memo } from "react";

import { BannerWrapper } from "./style";

const HomeBanner = memo(() => {
  return <BannerWrapper>HomeBanner</BannerWrapper>;
});

export default HomeBanner;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const BannerWrapper = styled.div`
  height: 529px;
  background: url(${require("@/assets/img/cover_01.jpeg")}) center/cover;
`;
```

##### é«˜æ€§ä»·æ¯”æ•°æ®

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content"></div>
    </HomeWrapper>
  );
});

export default Home;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const HomeWrapper = styled.div`
  > .content {
    width: 1032px;
    margin: 0 auto;
  }
`;
```

**services çš„ home æ¨¡å—**

```js
import sfRequest from "..";

export function getHomeGoodPriceData() {
  return sfRequest.get({
    url: "/home/goodprice",
  });
}
```

**redux çš„ home æ¨¡å—**

```js
import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";

import { getHomeGoodPriceData } from "@/services";

export const fetchHomeDataAction = createAsyncThunk(
  "fetchHomeData",
  async () => {
    const res = await getHomeGoodPriceData();

    return res;
  }
);

const homeSlice = createSlice({
  name: "home",
  initialState: {
    goodPriceInfo: {},
  },
  reducers: {
    changeGoodPriceInfoAction(state, { payload }) {
      state.goodPriceInfo = payload;
    },
  },
  extraReducers: {
    [fetchHomeDataAction.fulfilled](state, { payload }) {
      state.goodPriceInfo = payload;
    },
  },
});

export const { changeGoodPriceInfoAction } = homeSlice.actions;

export default homeSlice.reducer;
```

##### æˆ¿é—´ item

**RoomItem**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { ItemWrapper } from "./style";

const RoomItem = memo((props) => {
  const { itemData } = props;
  return (
    <ItemWrapper verifyColor={itemData?.verify_info?.text_color || "#39576a"}>
      <div className="inner">
        <div className="cover">
          <img src={itemData.picture_url} alt="" />
        </div>
        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const ItemWrapper = styled.div`
  box-sizing: border-box;
  width: 25%;
  padding: 8px;

  .inner {
    width: 100%;
  }

  .cover {
    position: relative;
    box-sizing: border-box;
    padding: 66.66% 8px 0;
    border-radius: 3px;
    overflow: hidden;

    img {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
    }
  }

  .desc {
    margin: 10px 0 5px;
    font-size: 12px;
    font-weight: 700;
    color: ${(props) => props.verifyColor};
  }

  .name {
    font-size: 16px;
    font-weight: 700;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .price {
    margin: 8px 0;
  }
`;
```

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import SectionHeader from "@/components/section-header";
import RoomItem from "@/components/room-item";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <div className="good-price">
          <SectionHeader title={goodPriceInfo.title} />
          <ul className="room-list">
            {goodPriceInfo.list?.slice(0, 8)?.map((item) => {
              return <RoomItem itemData={item} key={item.id} />;
            })}
          </ul>
        </div>
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

###### é›†æˆ Material UI

**å®‰è£…**

```
npm install @emotion/react @emotion/styled
```

```
npm install @mui/material @mui/styled-engine-sc styled-components
```

ç”±äºä¹‹å‰å®‰è£…è¿‡**styled-components**ï¼Œæ‰€ä»¥è¿™æ ·å®‰è£…å³å¯

```
npm install @mui/material @mui/styled-engine-sc
```

æ¥ç€å°±å¯ä»¥ä½¿ç”¨é‡Œé¢çš„ç»„ä»¶å•¦

###### é›†æˆ AntDesign

**å®‰è£…**

```
npm install antd
```

åœ¨**index.js**å¼•å…¥æ ·å¼

```
import 'antd/dist/reset.css';
```

åŒæ—¶ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨**less**ï¼Œéœ€è¦æ·»åŠ é…ç½®å¦‚ä¸‹

**craco.config.js**

```js
...
module.exports = {
  // less
  plugins: [
    {
      plugin: CracoLessPlugin,
      options: {
        lessLoaderOptions: {
          lessOptions: {
            modifyVars: {  },
            javascriptEnabled: true,
          },
        },
      },
    },
  ],
  // webpack
  ...
}
```

###### åº•éƒ¨è¯„ä»·

**RoomItem**

```jsx
import { Rating } from "@mui/material";
import PropTypes from "prop-types";
import React, { memo } from "react";

import { ItemWrapper } from "./style";

const RoomItem = memo((props) => {
  const { itemData } = props;
  return (
    <ItemWrapper verifyColor={itemData?.verify_info?.text_color || "#39576a"}>
      <div className="inner">
        <div className="cover">
          <img src={itemData.picture_url} alt="" />
        </div>
        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
        <div className="bottom">
          <Rating
            value={itemData.star_rating ?? 5}
            precision={0.5}
            readOnly
            sx={{ fontSize: "12px", color: "#00848A" }}
          />
          <span className="count">{itemData.reviews_count}</span>
          {itemData.bottom_info && (
            <span className="extra">Â·{itemData.bottom_info.content}</span>
          )}
        </div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

**å¯¹åº”æ ·å¼**

```js
/*
 * @Description: å¾…ç¼–è¾‘
 * @Author: SiFeng Zhai
 * @Date: 2023-01-03 19:18:39
 * @LastEditors: SiFeng Zhai
 * @LastEditTime: 2023-01-03 21:56:05
 */
import styled from "styled-components";

export const ItemWrapper = styled.div`
  box-sizing: border-box;
  width: 25%;
  padding: 8px;

  .inner {
    width: 100%;
  }

  .cover {
    position: relative;
    box-sizing: border-box;
    padding: 66.66% 8px 0;
    border-radius: 3px;
    overflow: hidden;

    img {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
    }
  }

  .desc {
    margin: 10px 0 5px;
    font-size: 12px;
    font-weight: 700;
    color: ${(props) => props.verifyColor};
  }

  .name {
    font-size: 16px;
    font-weight: 700;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .price {
    margin: 8px 0;
  }

  .bottom {
    display: flex;
    align-items: center;
    font-size: 12px;
    font-weight: 600;
    color: ${(props) => props.theme.text.primaryColor};

    .count {
      margin: 0 2px 0 4px;
    }

    .MuiRating-icon {
      margin-right: -2px;
    }
  }
`;
```

###### é‡æ„ä¸€ä¸‹

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <div className="good-price">
          <SectionHeader title={goodPriceInfo.title} />
          <SectionRooms roomList={goodPriceInfo.list} />
        </div>
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

**SectionRooms**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import RoomItem from "@/components/room-item";
import { RoomsWrapper } from "./style";

const SectionRooms = memo((props) => {
  const { roomList = [] } = props;
  return (
    <div>
      <RoomsWrapper>
        {roomList.slice(0, 8)?.map((item) => {
          return <RoomItem itemData={item} key={item.id} />;
        })}
      </RoomsWrapper>
    </div>
  );
});

SectionRooms.propTypes = {
  roomList: PropTypes.array,
};

export default SectionRooms;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const RoomsWrapper = styled.div`
  display: flex;
  flex-wrap: wrap;
  margin: 0 -8px;
  cursor: pointer;
`;
```

##### é«˜è¯„åˆ†æ•°æ®

###### è·å–

**services çš„ home æ¨¡å—**

```js
import sfRequest from ".."
...

export function getHomeHighScoreData() {
  return sfRequest.get({
    url: '/home/highscore'
  })
}
```

**store çš„ home æ¨¡å—**

```js
import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";

import { getHomeGoodPriceData, getHomeHighScoreData } from "@/services";

export const fetchHomeDataAction = createAsyncThunk(
  "fetchHomeData",
  (payload, { dispatch }) => {
    getHomeGoodPriceData().then((res) => {
      dispatch(changeGoodPriceInfoAction(res));
    });
    getHomeHighScoreData().then((res) => {
      dispatch(changeHighScoreInfoAction(res));
    });
  }
);

const homeSlice = createSlice({
  name: "home",
  initialState: {
    goodPriceInfo: {},
    highScoreInfo: {},
  },
  reducers: {
    changeGoodPriceInfoAction(state, { payload }) {
      state.goodPriceInfo = payload;
    },
    changeHighScoreInfoAction(state, { payload }) {
      state.highScoreInfo = payload;
    },
  },
  // extraReducers: {
  //   [fetchHomeDataAction.fulfilled](state, { payload }) {
  //     state.goodPriceInfo = payload
  //   }
  // }
});

export const { changeGoodPriceInfoAction, changeHighScoreInfoAction } =
  homeSlice.actions;

export default homeSlice.reducer;
```

###### å±•ç¤º

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <div className="good-price">
          <SectionHeader title={goodPriceInfo.title} />
          <SectionRooms roomList={goodPriceInfo.list} />
        </div>
        <div className="high-score">
          <SectionHeader
            title={highScoreInfo.title}
            subtitle={highScoreInfo.subtitle}
          />
          <SectionRooms roomList={highScoreInfo.list} />
        </div>
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

###### **é‡æ„ä¸€ä¸‹**

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <HomeSertionV1 infoData={goodPriceInfo} />
        <HomeSertionV1 infoData={highScoreInfo} />
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

**HomeSertionV1**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { SectionV1Wrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";

const HomeSertionV1 = memo((props) => {
  const { infoData } = props;
  return (
    <SectionV1Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <SectionRooms roomList={infoData.list} />
    </SectionV1Wrapper>
  );
});

HomeSertionV1.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSertionV1;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const SectionV1Wrapper = styled.div`
  margin-top: 30px;
`;
```

##### æŠ˜æ‰£æ•°æ®

###### è·å–

**services çš„ home æ¨¡å—**

```js
import sfRequest from ".."
...

export function getHomeDiscountData() {
  return sfRequest.get({
    url: '/home/discount'
  })
}
```

**store çš„ home æ¨¡å—**

```js
import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";

import {
  getHomeDiscountData,
  getHomeGoodPriceData,
  getHomeHighScoreData,
} from "@/services";

export const fetchHomeDataAction = createAsyncThunk(
  "fetchHomeData",
  (payload, { dispatch }) => {
    getHomeGoodPriceData().then((res) => {
      dispatch(changeGoodPriceInfoAction(res));
    });
    getHomeHighScoreData().then((res) => {
      dispatch(changeHighScoreInfoAction(res));
    });
    getHomeDiscountData().then((res) => {
      dispatch(changeDiscountInfoAction(res));
    });
  }
);

const homeSlice = createSlice({
  name: "home",
  initialState: {
    goodPriceInfo: {},
    highScoreInfo: {},
    discountInfo: {},
  },
  reducers: {
    changeGoodPriceInfoAction(state, { payload }) {
      state.goodPriceInfo = payload;
    },
    changeHighScoreInfoAction(state, { payload }) {
      state.highScoreInfo = payload;
    },
    changeDiscountInfoAction(state, { payload }) {
      state.discountInfo = payload;
    },
  },
  // extraReducers: {
  //   [fetchHomeDataAction.fulfilled](state, { payload }) {
  //     state.goodPriceInfo = payload
  //   }
  // }
});

export const {
  changeGoodPriceInfoAction,
  changeHighScoreInfoAction,
  changeDiscountInfoAction,
} = homeSlice.actions;

export default homeSlice.reducer;
```

###### RoomItem åŠ¨æ€å®½åº¦

è¿™éƒ¨åˆ†åŒºåŸŸçš„éœ€æ±‚æ˜¯ä¸€è¡Œ 3 ä¸ªï¼ŒRoomItem çš„å®½åº¦æ˜¯ä¸€è¡Œ 4 ä¸ªï¼Œéœ€è¦å°†**RoomItem**çš„å®½åº¦è®¾ç½®æˆ**åŠ¨æ€çš„**ï¼›

**RoomItem**

```jsx
import { Rating } from "@mui/material";
import PropTypes from "prop-types";
import React, { memo } from "react";

import { ItemWrapper } from "./style";

const RoomItem = memo((props) => {
  const { itemData, itemWidth = "25%" } = props;
  return (
    <ItemWrapper
      verifyColor={itemData?.verify_info?.text_color || "#39576a"}
      itemWidth={itemWidth}
    >
      <div className="inner">
        <div className="cover">
          <img src={itemData.picture_url} alt="" />
        </div>
        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
        <div className="bottom">
          <Rating
            value={itemData.star_rating ?? 5}
            precision={0.5}
            readOnly
            sx={{ fontSize: "12px", color: "#00848A" }}
          />
          <span className="count">{itemData.reviews_count}</span>
          {itemData.bottom_info && (
            <span className="extra">Â·{itemData.bottom_info.content}</span>
          )}
        </div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

**å¯¹åº”æ ·å¼**

```js
/*
 * @Description: å¾…ç¼–è¾‘
 * @Author: SiFeng Zhai
 * @Date: 2023-01-03 19:18:39
 * @LastEditors: SiFeng Zhai
 * @LastEditTime: 2023-01-06 08:41:08
 */
import styled from "styled-components";

export const ItemWrapper = styled.div`
  box-sizing: border-box;
  width: ${(props) => props.itemWidth};
  padding: 8px;

  .inner {
    width: 100%;
  }

  .cover {
    position: relative;
    box-sizing: border-box;
    padding: 66.66% 8px 0;
    border-radius: 3px;
    overflow: hidden;

    img {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
    }
  }

  .desc {
    margin: 10px 0 5px;
    font-size: 12px;
    font-weight: 700;
    color: ${(props) => props.verifyColor};
  }

  .name {
    font-size: 16px;
    font-weight: 700;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .price {
    margin: 8px 0;
  }

  .bottom {
    display: flex;
    align-items: center;
    font-size: 12px;
    font-weight: 600;
    color: ${(props) => props.theme.text.primaryColor};

    .count {
      margin: 0 2px 0 4px;
    }

    .MuiRating-icon {
      margin-right: -2px;
    }
  }
`;
```

**SectionRooms**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import RoomItem from "@/components/room-item";
import { RoomsWrapper } from "./style";

const SectionRooms = memo((props) => {
  const { roomList = [], itemWidth } = props;
  return (
    <div>
      <RoomsWrapper>
        {roomList.slice(0, 8)?.map((item) => {
          return (
            <RoomItem itemData={item} key={item.id} itemWidth={itemWidth} />
          );
        })}
      </RoomsWrapper>
    </div>
  );
});

SectionRooms.propTypes = {
  roomList: PropTypes.array,
};

export default SectionRooms;
```

**HomeSertionV1**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { SectionV1Wrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";

const HomeSertionV1 = memo((props) => {
  const { infoData } = props;
  return (
    <SectionV1Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <SectionRooms roomList={infoData.list} itemWidth="25%" />
    </SectionV1Wrapper>
  );
});

HomeSertionV1.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSertionV1;
```

###### å±•ç¤º

####### é€‰é¡¹å¡

**SectionTabs**

```jsx
import classNames from "classnames";
import PropTypes from "prop-types";
import React, { memo, useState } from "react";

import { TabsWrapper } from "./style";

const SectionTabs = memo((props) => {
  const { tabNames = [] } = props;

  const [currentIndex, setCurrentIndex] = useState(0);

  function itmeClick(index) {
    setCurrentIndex(index);
  }
  return (
    <TabsWrapper>
      {tabNames.map((item, index) => {
        return (
          <div
            key={index}
            className={classNames("item", { active: index === currentIndex })}
            onClick={(e) => itmeClick(index)}
          >
            {item}
          </div>
        );
      })}
    </TabsWrapper>
  );
});

SectionTabs.propTypes = {
  tabNames: PropTypes.array,
};

export default SectionTabs;
```

æœ‰ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“**classnames**

å®‰è£…

```
npm install classnames
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const TabsWrapper = styled.div`
  display: flex;
  .item {
    box-sizing: border-box;
    flex-basis: 120px;
    flex-shrink: 0;
    padding: 14px 16px;
    margin-right: 16px;
    border-radius: 3px;
    font-size: 17px;
    text-align: center;
    border: 0.5px solid #d8d8d8;
    white-space: nowrap;
    cursor: pointer;
    ${(props) => props.theme.mixin.boxShadow};

    &:last-child {
      margin-right: 0;
    }

    &.active {
      color: #fff;
      background-color: ${(props) => props.theme.color.secondaryColor};
    }
  }
`;
```

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";
import SectionTabs from "@/components/section-tabs";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo, discountInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
      discountInfo: state.home.discountInfo,
    }),
    shallowEqual
  );

  // æ•°æ®è½¬æ¢
  const tabNames = discountInfo.dest_address?.map((item) => item.name);

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <div className="discount">
          <SectionHeader
            title={discountInfo.title}
            subtitle={discountInfo.subtitle}
          />
          <SectionTabs tabNames={tabNames} />
          <SectionRooms
            roomList={discountInfo.dest_list?.["æˆéƒ½"]}
            itemWidth="33.33%"
          />
        </div>
        <HomeSertionV1 infoData={goodPriceInfo} />
        <HomeSertionV1 infoData={highScoreInfo} />
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

åˆ‡æ¢æ—¶éœ€è¦**å‘å°„äº‹ä»¶**é€šçŸ¥**çˆ¶ç»„ä»¶**

####### æ€§èƒ½ä¼˜åŒ–

ç”±äºæ¶‰åŠåˆ°**çˆ¶å­ç»„ä»¶äº‹ä»¶ä¼ é€’**ï¼Œå¯ä½¿ç”¨**useCallback**æ€§èƒ½ä¼˜åŒ–ï¼›

**SectionTabs**

```jsx
import classNames from "classnames";
import PropTypes from "prop-types";
import React, { memo, useState } from "react";

import { TabsWrapper } from "./style";

const SectionTabs = memo((props) => {
  const { tabNames = [], tabClick } = props;

  const [currentIndex, setCurrentIndex] = useState(0);

  function itmeClick(index, item) {
    setCurrentIndex(index);
    tabClick(item);
  }
  return (
    <TabsWrapper>
      {tabNames.map((item, index) => {
        return (
          <div
            key={index}
            className={classNames("item", { active: index === currentIndex })}
            onClick={(e) => itmeClick(index, item)}
          >
            {item}
          </div>
        );
      })}
    </TabsWrapper>
  );
});

SectionTabs.propTypes = {
  tabNames: PropTypes.array,
};

export default SectionTabs;
```

**Home**

```jsx
import React, { memo, useCallback, useEffect, useState } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";
import SectionTabs from "@/components/section-tabs";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo, discountInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
      discountInfo: state.home.discountInfo,
    }),
    shallowEqual
  );

  // æ•°æ®è½¬æ¢
  const [name, setName] = useState("ä½›å±±");
  const tabNames = discountInfo.dest_address?.map((item) => item.name);
  const tabClickHandle = useCallback(function (name) {
    setName(name);
  }, []);

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <div className="discount">
          <SectionHeader
            title={discountInfo.title}
            subtitle={discountInfo.subtitle}
          />
          <SectionTabs tabNames={tabNames} tabClick={tabClickHandle} />
          <SectionRooms
            roomList={discountInfo.dest_list?.[name]}
            itemWidth="33.33%"
          />
        </div>
        <HomeSertionV1 infoData={goodPriceInfo} />
        <HomeSertionV1 infoData={highScoreInfo} />
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

####### é‡æ„ä¸€ä¸‹

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import HomeSectionV2 from "./c-cpns/home-section-v2";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo, discountInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
      discountInfo: state.home.discountInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        <HomeSectionV2 infoData={discountInfo} />
        <HomeSertionV1 infoData={goodPriceInfo} />
        <HomeSertionV1 infoData={highScoreInfo} />
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

**HomeSectionV2**

```jsx
import PropTypes from "prop-types";
import React, { memo, useCallback, useState } from "react";

import { SectionV2Wrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";
import SectionTabs from "@/components/section-tabs";

const HomeSectionV2 = memo((props) => {
  // ä»propsä¸­è·å–æ•°æ®
  const { infoData } = props;

  // å†…éƒ¨çŠ¶æ€
  const [name, setName] = useState("ä½›å±±");
  const tabNames = infoData.dest_address?.map((item) => item.name);

  // äº‹ä»¶å¤„ç†
  const tabClickHandle = useCallback(function (name) {
    setName(name);
  }, []);
  return (
    <SectionV2Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <SectionTabs tabNames={tabNames} tabClick={tabClickHandle} />
      <SectionRooms roomList={infoData.dest_list?.[name]} itemWidth="33.33%" />
    </SectionV2Wrapper>
  );
});

HomeSectionV2.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSectionV2;
```

####### åˆæ¬¡æ¸²æŸ“é€‰é¡¹å¡çš„æ•°æ®

åˆæ¬¡æ¸²æŸ“çš„é€‰é¡¹å¡é€‰ä¸­çš„ä¸ä¸€å®šæ˜¯ä¸Šè¿°çš„ä½›å±±

ç°åœ¨æœ‰ 3 ç§æ€è·¯ï¼š

1. å–åå°è¿”å›æ•°æ®çš„**ç¬¬ä¸€é¡¹**
2. å½“**infoData**æœ‰å€¼æ—¶æ‰æ¸²æŸ“**HomeSectionV2**ï¼ˆæ¨èï¼‰
3. ä½¿ç”¨**useEffect**ï¼Œç›‘å¬**infoData**ï¼Œè‹¥æ”¹å˜åˆ™è°ƒç”¨**setName**ï¼ˆç»„ä»¶æ¸²æŸ“ 3 æ¬¡ï¼‰

ç¬¬ä¸€ç§æ€è·¯**è¡Œä¸é€š**ï¼š

**HomeSectionV2**é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œ**infoData**æ˜¯**ç©ºå¯¹è±¡**ï¼Œå½“ infoData æœ‰å€¼ä¹‹åï¼ŒHomeSectionV2 ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼›

è€Œ**useState**çš„**åˆå§‹å€¼**ï¼Œåªåœ¨ç»„ä»¶**é¦–æ¬¡æ¸²æŸ“**æ‰æœ‰ç”¨ï¼Œåç»­åˆå§‹å€¼ç”¨ä¸ä¸Šäº†ï¼Œè¿™æ ·å¯¼è‡´ useState çš„åˆå§‹å€¼æ˜¯**ç©ºå¯¹è±¡**ï¼Œæ•…è¡Œä¸é€šï¼›

ç¬¬ 3 ä¸­æ€è·¯**ä¸å»ºè®®**ï¼š

**HomeSectionV2**ç¬¬ 1 æ¬¡æ¸²æŸ“ï¼Œ**infoData**æ²¡æ•°æ®ï¼›

å½“**infoData**æœ‰å€¼æ—¶ï¼Œ**HomeSectionV2**ç¬¬ 2 æ¬¡æ¸²æŸ“ï¼›

**useEffect**ç›‘å¬**infoData**æœ‰å€¼ä¹‹åï¼Œè®¾ç½®äº† nameï¼Œ**HomeSectionV2**ç¬¬ 3 æ¬¡æ¸²æŸ“ï¼›

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import HomeSectionV2 from "./c-cpns/home-section-v2";
import { isEmptyObject } from "@/utils";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo, discountInfo } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
      discountInfo: state.home.discountInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        {isEmptyObject(discountInfo) && (
          <HomeSectionV2 infoData={discountInfo} />
        )}
        {isEmptyObject(goodPriceInfo) && (
          <HomeSertionV1 infoData={goodPriceInfo} />
        )}
        {isEmptyObject(highScoreInfo) && (
          <HomeSertionV1 infoData={highScoreInfo} />
        )}
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

**utils ä¸‹çš„ isEmptyObject**

```js
export function isEmptyObject(obj) {
  return !!Object.keys(obj).length;
}
```

**HomeSectionV2**

```jsx
import PropTypes from "prop-types";
import React, { memo, useCallback, useState } from "react";

import { SectionV2Wrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";
import SectionTabs from "@/components/section-tabs";

const HomeSectionV2 = memo((props) => {
  // ä»propsä¸­è·å–æ•°æ®
  const { infoData } = props;

  // å†…éƒ¨çŠ¶æ€
  const initialName = Object.keys(infoData.dest_list)[0];
  const [name, setName] = useState(initialName);
  const tabNames = infoData.dest_address?.map((item) => item.name);

  // äº‹ä»¶å¤„ç†
  const tabClickHandle = useCallback(function (name) {
    setName(name);
  }, []);
  return (
    <SectionV2Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <SectionTabs tabNames={tabNames} tabClick={tabClickHandle} />
      <SectionRooms roomList={infoData.dest_list?.[name]} itemWidth="33.33%" />
    </SectionV2Wrapper>
  );
});

HomeSectionV2.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSectionV2;
```

##### çƒ­é—¨æ¨èæ•°æ®

###### è·å–

**services çš„ home æ¨¡å—**

```js
import sfRequest from ".."
...

export function getHomeHotRecommendData() {
  return sfRequest.get({
    url: '/home/hotrecommenddest'
  })
}
```

**store çš„ home æ¨¡å—**

```js
import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";

import {
  getHomeDiscountData,
  getHomeGoodPriceData,
  getHomeHighScoreData,
  getHomeHotRecommendData,
} from "@/services";

export const fetchHomeDataAction = createAsyncThunk(
  "fetchHomeData",
  (payload, { dispatch }) => {
    getHomeGoodPriceData().then((res) => {
      dispatch(changeGoodPriceInfoAction(res));
    });
    getHomeHighScoreData().then((res) => {
      dispatch(changeHighScoreInfoAction(res));
    });
    getHomeDiscountData().then((res) => {
      dispatch(changeDiscountInfoAction(res));
    });
    getHomeHotRecommendData().then((res) => {
      dispatch(changeRecommendInfoAction(res));
    });
  }
);

const homeSlice = createSlice({
  name: "home",
  initialState: {
    goodPriceInfo: {},
    highScoreInfo: {},
    discountInfo: {},
    recommendInfo: {},
  },
  reducers: {
    changeGoodPriceInfoAction(state, { payload }) {
      state.goodPriceInfo = payload;
    },
    changeHighScoreInfoAction(state, { payload }) {
      state.highScoreInfo = payload;
    },
    changeDiscountInfoAction(state, { payload }) {
      state.discountInfo = payload;
    },
    changeRecommendInfoAction(state, { payload }) {
      state.recommendInfo = payload;
    },
  },
  // extraReducers: {
  //   [fetchHomeDataAction.fulfilled](state, { payload }) {
  //     state.goodPriceInfo = payload
  //   }
  // }
});

export const {
  changeGoodPriceInfoAction,
  changeHighScoreInfoAction,
  changeDiscountInfoAction,
  changeRecommendInfoAction,
} = homeSlice.actions;

export default homeSlice.reducer;
```

###### å±•ç¤º

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import HomeSectionV2 from "./c-cpns/home-section-v2";
import { isEmptyObject } from "@/utils";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const { goodPriceInfo, highScoreInfo, discountInfo, recommendInfo } =
    useSelector(
      (state) => ({
        goodPriceInfo: state.home.goodPriceInfo,
        highScoreInfo: state.home.highScoreInfo,
        discountInfo: state.home.discountInfo,
        recommendInfo: state.home.recommendInfo,
      }),
      shallowEqual
    );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        {isEmptyObject(discountInfo) && (
          <HomeSectionV2 infoData={discountInfo} />
        )}
        {isEmptyObject(recommendInfo) && (
          <HomeSectionV2 infoData={recommendInfo} />
        )}
        {isEmptyObject(goodPriceInfo) && (
          <HomeSertionV1 infoData={goodPriceInfo} />
        )}
        {isEmptyObject(highScoreInfo) && (
          <HomeSertionV1 infoData={highScoreInfo} />
        )}
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

##### åŒºåŸŸåº•éƒ¨

ä¸¤ç§æƒ…å†µï¼š

- æ ¹æ®é€‰ä¸­åŸå¸‚ï¼Œæ˜¾ç¤ºæ›´å¤šï¼›
- æ˜¾ç¤ºå…¨éƒ¨ï¼›

è¿™ä¸¤ç§æƒ…å†µå–å†³äºæ˜¯å¦ä¼  name å±æ€§

**SectionFooter**

```jsx
import IconMoreArrow from "@/assets/svg/icon_more_arrow";
import PropTypes from "prop-types";
import React, { memo } from "react";

import { FooterWrapper } from "./style";

const SectionFooter = memo((props) => {
  const { name } = props;
  let showMsg = "æ˜¾ç¤ºå…¨éƒ¨";
  if (name) {
    showMsg = `æ˜¾ç¤ºæ›´å¤š${name}æˆ¿æº`;
  }
  return (
    <FooterWrapper color={name ? "#00848A" : "#000"}>
      <div className="info">
        <span className="text">{showMsg}</span>
        <IconMoreArrow />
      </div>
    </FooterWrapper>
  );
});

SectionFooter.propTypes = {
  name: PropTypes.string,
};

export default SectionFooter;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const FooterWrapper = styled.div`
  display: flex;
  margin-top: 10px;

  .info {
    display: flex;
    align-items: center;
    cursor: pointer;

    font-size: 17px;
    font-weight: 700;
    color: ${(props) => props.color};

    &:hover {
      text-decoration: underline;
    }

    .text {
      margin-right: 6px;
    }
  }
`;
```

**IconMoreArrow**

```jsx
import React, { memo } from "react";
import styleStrToObject from "./utils";

const IconMoreArrow = memo(() => {
  return (
    <svg
      viewBox="0 0 18 18"
      role="presentation"
      aria-hidden="true"
      focusable="false"
      style={styleStrToObject("height: 10px; width: 10px; fill: currentcolor;")}
    >
      <path
        d="m4.29 1.71a1 1 0 1 1 1.42-1.41l8 8a1 1 0 0 1 0 1.41l-8 8a1 1 0 1 1 -1.42-1.41l7.29-7.29z"
        fillRule="evenodd"
      ></path>
    </svg>
  );
});

export default IconMoreArrow;
```

**HomeSertionV1**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { SectionV1Wrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";
import SectionFooter from "@/components/section-footer";

const HomeSertionV1 = memo((props) => {
  const { infoData } = props;
  return (
    <SectionV1Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <SectionRooms roomList={infoData.list} itemWidth="25%" />
      <SectionFooter />
    </SectionV1Wrapper>
  );
});

HomeSertionV1.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSertionV1;
```

**HomeSectionV2**

```jsx
import PropTypes from "prop-types";
import React, { memo, useCallback, useState } from "react";

import { SectionV2Wrapper } from "./style";
import SectionHeader from "@/components/section-header";
import SectionRooms from "@/components/section-rooms";
import SectionTabs from "@/components/section-tabs";
import SectionFooter from "@/components/section-footer";

const HomeSectionV2 = memo((props) => {
  // ä»propsä¸­è·å–æ•°æ®
  const { infoData } = props;

  // å†…éƒ¨çŠ¶æ€
  const initialName = Object.keys(infoData.dest_list)[0];
  const [name, setName] = useState(initialName);
  const tabNames = infoData.dest_address?.map((item) => item.name);

  // äº‹ä»¶å¤„ç†
  const tabClickHandle = useCallback(function (name) {
    setName(name);
  }, []);
  return (
    <SectionV2Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <SectionTabs tabNames={tabNames} tabClick={tabClickHandle} />
      <SectionRooms roomList={infoData.dest_list?.[name]} itemWidth="33.33%" />
      <SectionFooter name={name} />
    </SectionV2Wrapper>
  );
});

HomeSectionV2.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSectionV2;
```

##### é€‰é¡¹å¡æ»šåŠ¨çš„å°è£…

è¶…å‡ºéƒ¨åˆ†éšè—ï¼›

**å¯æ»šåŠ¨åŒºåŸŸçš„å†…å®¹**å¤§äºå®½åº¦æ—¶ï¼Œå³è¾¹æŒ‰é’®æ˜¾ç¤ºï¼Œè¿™ä¸ªåˆ¤æ–­åœ¨ç»„ä»¶æ¸²æŸ“å®Œæˆä¹‹åè¿›è¡Œï¼Œå¯ä½¿ç”¨**useEffect**ï¼›

èƒ½å¾€**å³è¾¹**æ»šåŠ¨æ—¶ï¼Œå·¦è¾¹æŒ‰é’®æ˜¾ç¤ºï¼›

ä¸­é—´å±•ç¤º**å†…å®¹ä¸ç¡®å®š**ï¼Œä½¿ç”¨**ç±»ä¼¼æ’æ§½**çš„åšæ³•ï¼Œä¹Ÿå°±æ˜¯**props.children**;

###### å³ä¾§æŒ‰é’®æ˜¾ç¤ºé€»è¾‘

**ScrollView**

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useRef, useState } from "react";
import { ViewWrapper } from "./style";

const ScrollView = memo((props) => {
  // çŠ¶æ€
  const [showRight, setShowRight] = useState(false);
  // ç»„ä»¶æ¸²æŸ“å®Œæˆï¼Œåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå³ä¾§æŒ‰é’®
  const scrollContentRef = useRef();
  useEffect(() => {
    const scrollWith = scrollContentRef.current.srcollWidth; // å¯æ»šåŠ¨å®½åº¦
    const clientWidth = scrollContentRef.current.clientWidth; // æœ¬èº«å æ®å®½åº¦
    const totalDistance = scrollWith - clientWidth;
    setShowRight(totalDistance > 0);
  }, [props.children]);
  return (
    <ViewWrapper>
      <div>å·¦</div>
      {showRight && <button>å³</button>}
      <div className="scroll-content" ref={scrollContentRef}>
        {props.children}
      </div>
    </ViewWrapper>
  );
});

ScrollView.propTypes = {};

export default ScrollView;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const ViewWrapper = styled.div`
  overflow: hidden;
  .scroll-content {
    position: relative;
    display: flex;

    transition: transform 300ms ease;
  }
`;
```

ç‚¹å‡»å³è¾¹æŒ‰é’®ä¹‹åï¼Œ**æ»šåŠ¨çš„åŒºé—´å¤šé•¿å‘¢ï¼Ÿ**

æ»šåŠ¨ä¹‹åï¼Œæœ€å·¦å…ƒç´ çš„**åç§»é‡**å°±æ˜¯æ»šåŠ¨åŒºé—´ï¼Œ**offsetLeft**ï¼ˆç›¸å¯¹äºå®šä½å…ƒç´ ï¼Œæ²¡å®šä½åˆ™ç›¸å¯¹äº bodyï¼‰ï¼›

ä½¿ç”¨ç§»åŠ¨**transform**æ¥å®ç°æ»šåŠ¨, å¹¶åŠ ä¸ŠåŠ¨ç”»ï¼›

æ»šåŠ¨åˆ°æŸç§ç¨‹åº¦ï¼ˆ**totalDistance**å°äº**newEl çš„ offsetLeft**ï¼‰ä¹‹åï¼Œå³è¾¹æŒ‰é’®éœ€è¦éšè—ï¼›

å¤šæ¬¡æ¸²æŸ“ç»„ä»¶æ—¶éœ€è¦å°†**totalDistance**è®°å½•ä¸‹æ¥ï¼›

**ScrollView**

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useRef, useState } from "react";
import { ViewWrapper } from "./style";

const ScrollView = memo((props) => {
  // çŠ¶æ€
  const [showRight, setShowRight] = useState(false);
  const [posIndex, setPosIndex] = useState(0);
  const totalDistanceRef = useRef();

  // ç»„ä»¶æ¸²æŸ“å®Œæˆï¼Œåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå³ä¾§æŒ‰é’®
  const scrollContentRef = useRef();
  useEffect(() => {
    const scrollWidth = scrollContentRef.current.scrollWidth; // å¯æ»šåŠ¨å®½åº¦
    const clientWidth = scrollContentRef.current.clientWidth; // æœ¬èº«å æ®å®½åº¦
    const totalDistance = scrollWidth - clientWidth;
    totalDistanceRef.current = totalDistance;
    setShowRight(totalDistance > 0);
  }, [props.children]);

  // äº‹ä»¶å¤„ç†
  function rightClick() {
    const newIndex = posIndex + 1;
    const newEl = scrollContentRef.current.children[newIndex];
    scrollContentRef.current.style.transform = `translate(-${newEl.offsetLeft}px)`;
    setPosIndex(newIndex);
    // æ˜¯å¦ç»§ç»­æ˜¾ç¤ºå³è¾¹æŒ‰é’®
    setShowRight(totalDistanceRef.current > newEl.offsetLeft);
  }
  return (
    <ViewWrapper>
      <div>å·¦</div>
      {showRight && <button onClick={rightClick}>å³</button>}
      <div className="scroll-content" ref={scrollContentRef}>
        {props.children}
      </div>
    </ViewWrapper>
  );
});

ScrollView.propTypes = {};

export default ScrollView;
```

###### å³ä¾§æŒ‰é’®æ˜¾ç¤ºé€»è¾‘

é»˜è®¤ä¸æ˜¾ç¤ºï¼›

åªè¦**newEl.offsetLeft**å¤§äº 0 å°±æ˜¾ç¤ºï¼›

**ScrollView**

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useRef, useState } from "react";
import { ViewWrapper } from "./style";

const ScrollView = memo((props) => {
  // çŠ¶æ€
  const [showLeft, setShowLeft] = useState(false);
  const [showRight, setShowRight] = useState(false);
  const [posIndex, setPosIndex] = useState(0);
  const totalDistanceRef = useRef();

  // ç»„ä»¶æ¸²æŸ“å®Œæˆï¼Œåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå³ä¾§æŒ‰é’®
  const scrollContentRef = useRef();
  useEffect(() => {
    const scrollWidth = scrollContentRef.current.scrollWidth; // å¯æ»šåŠ¨å®½åº¦
    const clientWidth = scrollContentRef.current.clientWidth; // æœ¬èº«å æ®å®½åº¦
    const totalDistance = scrollWidth - clientWidth;
    totalDistanceRef.current = totalDistance;
    setShowRight(totalDistance > 0);
  }, [props.children]);

  // äº‹ä»¶å¤„ç†
  function leftClick() {
    const newIndex = posIndex - 1;
    const newEl = scrollContentRef.current.children[newIndex];
    scrollContentRef.current.style.transform = `translate(-${newEl.offsetLeft}px)`;
    setPosIndex(newIndex);
    // æ˜¯å¦ç»§ç»­æ˜¾ç¤ºä¸¤è¾¹æŒ‰é’®
    setShowRight(totalDistanceRef.current > newEl.offsetLeft);
    setShowLeft(newEl.offsetLeft > 0);
  }

  function rightClick() {
    const newIndex = posIndex + 1;
    const newEl = scrollContentRef.current.children[newIndex];
    scrollContentRef.current.style.transform = `translate(-${newEl.offsetLeft}px)`;
    setPosIndex(newIndex);
    // æ˜¯å¦ç»§ç»­æ˜¾ç¤ºä¸¤è¾¹æŒ‰é’®
    setShowRight(totalDistanceRef.current > newEl.offsetLeft);
    setShowLeft(newEl.offsetLeft > 0);
  }

  return (
    <ViewWrapper>
      {showLeft && <button onClick={leftClick}>å·¦</button>}
      {showRight && <button onClick={rightClick}>å³</button>}
      <div className="scroll-content" ref={scrollContentRef}>
        {props.children}
      </div>
    </ViewWrapper>
  );
});

ScrollView.propTypes = {};

export default ScrollView;
```

ä¸éš¾å‘ç°ï¼Œ**leftClick**å’Œ**rightClick**é€»è¾‘å‡ ä¹ä¸€æ ·

###### æŠ½å–é‡å¤é€»è¾‘

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useRef, useState } from "react";
import { ViewWrapper } from "./style";

const ScrollView = memo((props) => {
  // çŠ¶æ€
  const [showLeft, setShowLeft] = useState(false);
  const [showRight, setShowRight] = useState(false);
  const [posIndex, setPosIndex] = useState(0);
  const totalDistanceRef = useRef();

  // ç»„ä»¶æ¸²æŸ“å®Œæˆï¼Œåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå³ä¾§æŒ‰é’®
  const scrollContentRef = useRef();
  useEffect(() => {
    const scrollWidth = scrollContentRef.current.scrollWidth; // å¯æ»šåŠ¨å®½åº¦
    const clientWidth = scrollContentRef.current.clientWidth; // æœ¬èº«å æ®å®½åº¦
    const totalDistance = scrollWidth - clientWidth;
    totalDistanceRef.current = totalDistance;
    setShowRight(totalDistance > 0);
  }, [props.children]);

  // äº‹ä»¶å¤„ç†
  function controlClick(isRight) {
    const newIndex = isRight ? posIndex + 1 : posIndex - 1;
    const newEl = scrollContentRef.current.children[newIndex];
    scrollContentRef.current.style.transform = `translate(-${newEl.offsetLeft}px)`;
    setPosIndex(newIndex);
    // æ˜¯å¦ç»§ç»­æ˜¾ç¤ºä¸¤è¾¹æŒ‰é’®
    setShowRight(totalDistanceRef.current > newEl.offsetLeft);
    setShowLeft(newEl.offsetLeft > 0);
  }

  return (
    <ViewWrapper>
      {showLeft && <button onClick={(e) => controlClick(false)}>å·¦</button>}
      {showRight && <button onClick={(e) => controlClick(true)}>å³</button>}
      <div className="scroll-content" ref={scrollContentRef}>
        {props.children}
      </div>
    </ViewWrapper>
  );
});

ScrollView.propTypes = {};

export default ScrollView;
```

###### ä¸¤ä¾§æŒ‰é’®æ›¿æ¢æˆå›¾æ ‡

**ScrollView**

```jsx
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";
import PropTypes from "prop-types";
import React, { memo, useEffect, useRef, useState } from "react";
import { ViewWrapper } from "./style";

const ScrollView = memo((props) => {
  // çŠ¶æ€
  const [showLeft, setShowLeft] = useState(false);
  const [showRight, setShowRight] = useState(false);
  const [posIndex, setPosIndex] = useState(0);
  const totalDistanceRef = useRef();

  // ç»„ä»¶æ¸²æŸ“å®Œæˆï¼Œåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå³ä¾§æŒ‰é’®
  const scrollContentRef = useRef();
  useEffect(() => {
    const scrollWidth = scrollContentRef.current.scrollWidth; // å¯æ»šåŠ¨å®½åº¦
    const clientWidth = scrollContentRef.current.clientWidth; // æœ¬èº«å æ®å®½åº¦
    const totalDistance = scrollWidth - clientWidth;
    totalDistanceRef.current = totalDistance;
    setShowRight(totalDistance > 0);
  }, [props.children]);

  // äº‹ä»¶å¤„ç†
  function controlClick(isRight) {
    const newIndex = isRight ? posIndex + 1 : posIndex - 1;
    const newEl = scrollContentRef.current.children[newIndex];
    scrollContentRef.current.style.transform = `translate(-${newEl.offsetLeft}px)`;
    setPosIndex(newIndex);
    // æ˜¯å¦ç»§ç»­æ˜¾ç¤ºä¸¤è¾¹æŒ‰é’®
    setShowRight(totalDistanceRef.current > newEl.offsetLeft);
    setShowLeft(newEl.offsetLeft > 0);
  }

  return (
    <ViewWrapper>
      {showLeft && (
        <div className="control left" onClick={(e) => controlClick(false)}>
          <IconArrowLeft />
        </div>
      )}
      {showRight && (
        <div className="control right" onClick={(e) => controlClick(true)}>
          <IconArrowRight />
        </div>
      )}
      <div className="scroll">
        <div className="scroll-content" ref={scrollContentRef}>
          {props.children}
        </div>
      </div>
    </ViewWrapper>
  );
});

ScrollView.propTypes = {};

export default ScrollView;
```

**IconArrowLeft**

```jsx
import React, { memo } from "react";
import styleStrToObj from "./utils";

const IconArrowLeft = memo(() => {
  return (
    <svg
      viewBox="0 0 18 18"
      role="img"
      aria-hidden="false"
      aria-label="previous"
      focusable="false"
      style={styleStrToObj(
        "height: 12px; width: 12px; display: block; fill: currentcolor;"
      )}
    >
      <path
        d="m13.7 16.29a1 1 0 1 1 -1.42 1.41l-8-8a1 1 0 0 1 0-1.41l8-8a1 1 0 1 1 1.42 1.41l-7.29 7.29z"
        fillRule="evenodd"
      ></path>
    </svg>
  );
});

export default IconArrowLeft;
```

**IconArrowRight**

```jsx
import React, { memo } from "react";
import styleStrToObj from "./utils";

const IconArrowRight = memo(() => {
  return (
    <svg
      viewBox="0 0 18 18"
      role="img"
      aria-hidden="false"
      aria-label="next"
      focusable="false"
      style={styleStrToObj(
        "height: 12px; width: 12px; display: block; fill: currentcolor;"
      )}
    >
      <path
        d="m4.29 1.71a1 1 0 1 1 1.42-1.41l8 8a1 1 0 0 1 0 1.41l-8 8a1 1 0 1 1 -1.42-1.41l7.29-7.29z"
        fillRule="evenodd"
      ></path>
    </svg>
  );
});

export default IconArrowRight;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const ViewWrapper = styled.div`
  position: relative;
  padding: 8px 0;

  .scroll {
    overflow: hidden;
    .scroll-content {
      display: flex;
      transition: transform 300ms ease;
    }
  }
  .control {
    position: absolute;
    z-index: 9;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    text-align: center;
    border-width: 2px;
    border-style: solid;
    border-color: #fff;
    background: #fff;
    box-shadow: 0px 1px 1px 1px rgba(0, 0, 0, 0.14);
    cursor: pointer;

    &.left {
      left: 0;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    &.right {
      right: 0;
      top: 50%;
      transform: translate(50%, -50%);
    }
  }
`;
```

ä¹‹åé‚£äº›åŒºåŸŸéœ€è¦ç±»ä¼¼é€‰é¡¹å¡çš„æ»šåŠ¨æ•ˆæœï¼Œä½¿ç”¨**ScrollView**å°±è¡Œï¼›

##### å‘å¾€æ•°æ®

###### è·å–

**services ä¸‹çš„ home æ¨¡å—**

```js
import sfRequest from ".."
...

export function getHomeLongForData() {
  return sfRequest.get({
    url: '/home/longfor'
  })
}
```

**store ä¸‹çš„ home æ¨¡å—**

```js
import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";

import {
  getHomeDiscountData,
  getHomeGoodPriceData,
  getHomeHighScoreData,
  getHomeHotRecommendData,
  getHomeLongForData,
} from "@/services";

export const fetchHomeDataAction = createAsyncThunk(
  "fetchHomeData",
  (payload, { dispatch }) => {
    getHomeGoodPriceData().then((res) => {
      dispatch(changeGoodPriceInfoAction(res));
    });
    getHomeHighScoreData().then((res) => {
      dispatch(changeHighScoreInfoAction(res));
    });
    getHomeDiscountData().then((res) => {
      dispatch(changeDiscountInfoAction(res));
    });
    getHomeHotRecommendData().then((res) => {
      dispatch(changeRecommendInfoAction(res));
    });
    getHomeLongForData().then((res) => {
      dispatch(changeLongForInfoAction(res));
    });
  }
);

const homeSlice = createSlice({
  name: "home",
  initialState: {
    goodPriceInfo: {},
    highScoreInfo: {},
    discountInfo: {},
    recommendInfo: {},
    longForInfo: {},
  },
  reducers: {
    changeGoodPriceInfoAction(state, { payload }) {
      state.goodPriceInfo = payload;
    },
    changeHighScoreInfoAction(state, { payload }) {
      state.highScoreInfo = payload;
    },
    changeDiscountInfoAction(state, { payload }) {
      state.discountInfo = payload;
    },
    changeRecommendInfoAction(state, { payload }) {
      state.recommendInfo = payload;
    },
    changeLongForInfoAction(state, { payload }) {
      state.longForInfo = payload;
    },
  },
  // extraReducers: {
  //   [fetchHomeDataAction.fulfilled](state, { payload }) {
  //     state.goodPriceInfo = payload
  //   }
  // }
});

export const {
  changeGoodPriceInfoAction,
  changeHighScoreInfoAction,
  changeDiscountInfoAction,
  changeRecommendInfoAction,
  changeLongForInfoAction,
} = homeSlice.actions;

export default homeSlice.reducer;
```

###### å±•ç¤º

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import HomeSectionV2 from "./c-cpns/home-section-v2";
import { isEmptyObject } from "@/utils";
import HomeLongFor from "./c-cpns/home-longfor";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const {
    goodPriceInfo,
    highScoreInfo,
    discountInfo,
    recommendInfo,
    longForInfo,
  } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
      discountInfo: state.home.discountInfo,
      recommendInfo: state.home.recommendInfo,
      longForInfo: state.home.longForInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        {isEmptyObject(discountInfo) && (
          <HomeSectionV2 infoData={discountInfo} />
        )}
        {isEmptyObject(recommendInfo) && (
          <HomeSectionV2 infoData={recommendInfo} />
        )}
        {isEmptyObject(longForInfo) && <HomeLongFor infoData={longForInfo} />}
        {isEmptyObject(goodPriceInfo) && (
          <HomeSertionV1 infoData={goodPriceInfo} />
        )}
        {isEmptyObject(highScoreInfo) && (
          <HomeSertionV1 infoData={highScoreInfo} />
        )}
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

**HomeLongFor**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { LongForWrapper } from "./style";
import SectionHeader from "@/components/section-header";
import LongforItem from "@/components/longfor-item";

const HomeLongFor = memo((props) => {
  const { infoData } = props;
  return (
    <LongForWrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <div className="longfor-list">
        {infoData.list.map((item) => {
          return <LongforItem itemData={item} key={item.city} />;
        })}
      </div>
    </LongForWrapper>
  );
});

HomeLongFor.propTypes = {
  infoData: PropTypes.object,
};

export default HomeLongFor;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const LongForWrapper = styled.div`
  margin-top: 30px -8px 0;
  .longfor-list {
    display: flex;
    margin: 0 -8px;
  }
`;
```

**LongforItem**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { ItemWrapper } from "./style";

const LongforItem = memo((props) => {
  const { itemData } = props;
  return (
    <ItemWrapper>
      <div className="inner">
        <img className="cover" src={itemData.picture_url} alt="" />
        <div className="bg-cover"></div>
        <div className="info">
          <div className="city">{itemData.city}</div>
          <div className="price">å‡ä»· {itemData.price}</div>
        </div>
      </div>
    </ItemWrapper>
  );
});

LongforItem.propTypes = {
  itemData: PropTypes.object,
};

export default LongforItem;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const ItemWrapper = styled.div`
  flex-shrink: 0;
  width: 20%;

  .inner {
    position: relative;
    padding: 8px;
  }

  .cover {
    width: 100%;
    border-radius: 3px;
    overflow: hidden;
  }

  .bg-cover {
    position: absolute;
    left: 8px;
    right: 8px;
    bottom: 0;
    height: 60%;
    background-image: linear-gradient(
      -180deg,
      rgba(0, 0, 0, 0) 3%,
      rgb(0, 0, 0) 100%
    );
  }

  .info {
    position: absolute;
    left: 8px;
    right: 8px;
    bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0 24px 32px;
    color: #fff;

    .city {
      font-size: 18px;
      font-weight: 600;
    }

    .price {
      font-size: 14px;
      margin-top: 5px;
    }
  }
`;
```

###### æ·»åŠ æ»šåŠ¨æ•ˆæœ

**HomeLongFor**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { LongForWrapper } from "./style";
import SectionHeader from "@/components/section-header";
import LongforItem from "@/components/longfor-item";
import ScrollView from "@/base-ui/scroll-view";

const HomeLongFor = memo((props) => {
  const { infoData } = props;
  return (
    <LongForWrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <div className="longfor-list">
        <ScrollView>
          {infoData.list.map((item) => {
            return <LongforItem itemData={item} key={item.city} />;
          })}
        </ScrollView>
      </div>
    </LongForWrapper>
  );
});

HomeLongFor.propTypes = {
  infoData: PropTypes.object,
};

export default HomeLongFor;
```

##### åº•éƒ¨æ•°æ®

###### è·å–

**services çš„ home æ¨¡å—**

```js
import sfRequest from ".."
...

export function getHomePlusData() {
  return sfRequest.get({
    url: '/home/plus'
  })
}
```

**store çš„ home æ¨¡å—**

```js
import { createAsyncThunk, createSlice } from "@reduxjs/toolkit";

import {
  getHomeDiscountData,
  getHomeGoodPriceData,
  getHomeHighScoreData,
  getHomeHotRecommendData,
  getHomeLongForData,
  getHomePlusData,
} from "@/services";

export const fetchHomeDataAction = createAsyncThunk(
  "fetchHomeData",
  (payload, { dispatch }) => {
    getHomeGoodPriceData().then((res) => {
      dispatch(changeGoodPriceInfoAction(res));
    });
    getHomeHighScoreData().then((res) => {
      dispatch(changeHighScoreInfoAction(res));
    });
    getHomeDiscountData().then((res) => {
      dispatch(changeDiscountInfoAction(res));
    });
    getHomeHotRecommendData().then((res) => {
      dispatch(changeRecommendInfoAction(res));
    });
    getHomeLongForData().then((res) => {
      dispatch(changeLongForInfoAction(res));
    });
    getHomePlusData().then((res) => {
      dispatch(changePlusInfoAction(res));
    });
  }
);

const homeSlice = createSlice({
  name: "home",
  initialState: {
    goodPriceInfo: {},
    highScoreInfo: {},
    discountInfo: {},
    recommendInfo: {},
    longForInfo: {},
    plusInfo: {},
  },
  reducers: {
    changeGoodPriceInfoAction(state, { payload }) {
      state.goodPriceInfo = payload;
    },
    changeHighScoreInfoAction(state, { payload }) {
      state.highScoreInfo = payload;
    },
    changeDiscountInfoAction(state, { payload }) {
      state.discountInfo = payload;
    },
    changeRecommendInfoAction(state, { payload }) {
      state.recommendInfo = payload;
    },
    changeLongForInfoAction(state, { payload }) {
      state.longForInfo = payload;
    },
    changePlusInfoAction(state, { payload }) {
      state.plusInfo = payload;
    },
  },
  // extraReducers: {
  //   [fetchHomeDataAction.fulfilled](state, { payload }) {
  //     state.goodPriceInfo = payload
  //   }
  // }
});

export const {
  changeGoodPriceInfoAction,
  changeHighScoreInfoAction,
  changeDiscountInfoAction,
  changeRecommendInfoAction,
  changeLongForInfoAction,
  changePlusInfoAction,
} = homeSlice.actions;

export default homeSlice.reducer;
```

###### å±•ç¤º

**Home**

```jsx
import React, { memo, useEffect } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";

import HomeBanner from "./c-cpns/home-banner";
import { fetchHomeDataAction } from "@/store/modules/home";
import { HomeWrapper } from "./style";
import HomeSertionV1 from "./c-cpns/home-section-v1";
import HomeSectionV2 from "./c-cpns/home-section-v2";
import { isEmptyObject } from "@/utils";
import HomeLongFor from "./c-cpns/home-longfor";
import HomeSectionV3 from "./c-cpns/home-section-v3";

const Home = memo(() => {
  // ä»reduxä¸­è·å–æ•°æ®
  const {
    goodPriceInfo,
    highScoreInfo,
    discountInfo,
    recommendInfo,
    longForInfo,
    plusInfo,
  } = useSelector(
    (state) => ({
      goodPriceInfo: state.home.goodPriceInfo,
      highScoreInfo: state.home.highScoreInfo,
      discountInfo: state.home.discountInfo,
      recommendInfo: state.home.recommendInfo,
      longForInfo: state.home.longForInfo,
      plusInfo: state.home.plusInfo,
    }),
    shallowEqual
  );

  // æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchHomeDataAction());
  }, [dispatch]);

  return (
    <HomeWrapper>
      <HomeBanner />
      <div className="content">
        {isEmptyObject(discountInfo) && (
          <HomeSectionV2 infoData={discountInfo} />
        )}
        {isEmptyObject(recommendInfo) && (
          <HomeSectionV2 infoData={recommendInfo} />
        )}
        {isEmptyObject(longForInfo) && <HomeLongFor infoData={longForInfo} />}
        {isEmptyObject(goodPriceInfo) && (
          <HomeSertionV1 infoData={goodPriceInfo} />
        )}
        {isEmptyObject(highScoreInfo) && (
          <HomeSertionV1 infoData={highScoreInfo} />
        )}
        {isEmptyObject(plusInfo) && <HomeSectionV3 infoData={plusInfo} />}
      </div>
    </HomeWrapper>
  );
});

export default Home;
```

**HomeSectionV3**

```jsx
import ScrollView from "@/base-ui/scroll-view";
import RoomItem from "@/components/room-item";
import SectionHeader from "@/components/section-header";
import PropTypes from "prop-types";
import React, { memo } from "react";
import { SectionV3Wrapper } from "./style";

const HomeSectionV3 = memo((props) => {
  const { infoData } = props;
  return (
    <SectionV3Wrapper>
      <SectionHeader title={infoData.title} subtitle={infoData.subtitle} />
      <div className="room-list">
        <ScrollView>
          {infoData.list.map((item) => {
            return <RoomItem itemData={item} itemWidth="20%" key={item.id} />;
          })}
        </ScrollView>
      </div>
    </SectionV3Wrapper>
  );
});

HomeSectionV3.propTypes = {
  infoData: PropTypes.object,
};

export default HomeSectionV3;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const SectionV3Wrapper = styled.div`
  .room-list {
    margin: 0 -8px;
  }
`;
```

##### é¦–é¡µè·³è½¬æ€è·¯

åœ¨**SectionFooter**é‡Œé¢ç›‘å¬ç‚¹å‡»ï¼Œè·³è½¬å³å¯ï¼›

**SectionFooter**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";
import { useNavigate } from "react-router-dom";

import { FooterWrapper } from "./style";
import IconMoreArrow from "@/assets/svg/icon_more_arrow";

const SectionFooter = memo((props) => {
  const { name } = props;
  let showMsg = "æ˜¾ç¤ºå…¨éƒ¨";
  if (name) {
    showMsg = `æ˜¾ç¤ºæ›´å¤š${name}æˆ¿æº`;
  }
  // äº‹ä»¶å¤„ç†
  const navigate = useNavigate();
  function more() {
    navigate("/entire");
  }

  return (
    <FooterWrapper color={name ? "#00848A" : "#000"}>
      <div className="info" onClick={more}>
        <span className="text">{showMsg}</span>
        <IconMoreArrow />
      </div>
    </FooterWrapper>
  );
});

SectionFooter.propTypes = {
  name: PropTypes.string,
};

export default SectionFooter;
```

#### åº•éƒ¨å†…å®¹

**AppFooter**

```jsx
import React, { memo } from "react";
import { FooterWrapper } from "./style";
import footerData from "@/assets/data/footer.json";

const AppFooter = memo(() => {
  return (
    <FooterWrapper>
      <div className="wrapper">
        <div className="service">
          {footerData.map((item) => {
            return (
              <div className="item" key={item.name}>
                <div className="name">{item.name}</div>
                <div className="list">
                  {item.list.map((iten) => {
                    return (
                      <div className="iten" key={iten}>
                        {iten}
                      </div>
                    );
                  })}
                </div>
              </div>
            );
          })}
        </div>
        <div className="statement">
          Â© 2022 Airbnb, Inc. All rights reserved.æ¡æ¬¾ Â· éšç§æ”¿ç­– Â· ç½‘ç«™åœ°å›¾ Â·
          å…¨å›½æ—…æ¸¸æŠ•è¯‰æ¸ é“ 12301
        </div>
      </div>
    </FooterWrapper>
  );
});

export default AppFooter;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const FooterWrapper = styled.div`
  margin-top: 100px;
  border-top: 1px solid #ebebeb;

  .wrapper {
    width: 1080px;
    margin: 0 auto;
    box-sizing: border-box;
    padding: 48px 24px;
  }

  .service {
    display: flex;

    .item {
      flex: 1;

      .name {
        margin-bottom: 16px;
        font-weight: 700;
      }

      .list {
        .iten {
          margin-top: 6px;
          color: #767676;
          cursor: pointer;
          &:hover {
            text-decoration: underline;
          }
        }
      }
    }
  }

  .statement {
    margin-top: 30px;
    border-top: 1px solid #ebebeb;
    padding: 20px;
    color: #767676;
    text-align: center;
  }
`;
```

#### å¤´éƒ¨åŠ¨ç”»

å½“æ»šåŠ¨åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå¤´éƒ¨å†…å®¹å‘ç”Ÿå˜åŒ–ï¼š

- å¼¹å‡ºæœç´¢åŒºåŸŸæ—¶ï¼Œå…¶å®ƒåŒºåŸŸ**é˜´å½±**ï¼›
- **ç‚¹å‡»**æœç´¢å¼¹å‡ºæœç´¢åŒºåŸŸ
- **ç‚¹å‡»**å…¶å®ƒåŒºåŸŸæ”¶å›æœç´¢åŒºåŸŸ
- **æ»šåŠ¨**åˆ°ä¸€å®šè·ç¦»æ”¶å›æœç´¢åŒºåŸŸ

ç”±äºæ»šåŠ¨äº‹ä»¶**æ‰§è¡Œé¢‘ç‡å¾ˆé«˜**ï¼Œå¯¼è‡´é¢‘ç¹è°ƒç”¨**setXXX**æ–¹æ³•ï¼Œä½¿å¾—ç»„ä»¶**å¤šæ¬¡é‡æ–°æ¸²æŸ“**ï¼Œæ‰€ä»¥éœ€è¦**èŠ‚æµ**æ“ä½œï¼›

ä½¿ç”¨**underscore**åº“ï¼Œæ¯”**lodash**è½»é‡ï¼›

ä¸å¯ä»¥ç®€å•åˆ¤æ–­æ»šåŠ¨è·ç¦»**å¤§äºæŸä¸ªæ•°å€¼**æ—¶æ”¶å›æœç´¢åŒºåŸŸï¼ˆæ¡ä»¶å¯èƒ½æ— é™æˆç«‹ï¼Œè¶…å¤šæ¬¡é‡æ–°æ¸²æŸ“ï¼‰ï¼Œè€Œæ˜¯**æ»šåŠ¨å ScrollY**ä¸**æ»šåŠ¨å‰çš„ ScrollY**çš„å·®å€¼å¤§äºä¸€å®šæ•°å€¼æ—¶æ‰æ”¶å›æœç´¢åŒºåŸŸï¼›

ç”±äºæ»šåŠ¨å‰çš„ ScrollY ä¸ç»„ä»¶é‡æ–°æ¸²æŸ“æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥æ²¡å¿…è¦ä½¿ç”¨**useState**è®°å½•ï¼›

è€Œ**useRef**åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¿æŒä¸å˜ï¼Œå¯ä»¥ç”¨å®ƒæ¥è®°å½•ï¼›

æ²¡å¼¹å‡ºæœç´¢åŒºæ—¶ï¼Œ**prevY**ä¸**ScrollY**ä¿æŒä¸€è‡´ï¼Œå¼¹å‡ºæœç´¢åŒºåï¼Œå½“ scrollY ä¸ prevY å·®å€¼å¤§äºä¸€å®šæ•°å€¼ï¼Œæ”¶å›æœç´¢åŒºï¼›

å½“å‘ä¸Šæ»šæ—¶ï¼ŒscrollY ä¸ prevY å·®å€¼ä¸ºè´Ÿæ•°ï¼Œå¯¼è‡´ä¸€è‡´ä¸æ”¶å›æœç´¢åŒºï¼Œæ‰€ä»¥ä½¿ç”¨ä»–ä»¬**å·®å€¼çš„ç»å¯¹å€¼**ï¼›

**AppHeader**

```jsx
import React, { memo, useRef, useState } from "react";
import { shallowEqual, useSelector } from "react-redux";
import classNames from "classnames";

import HeaderCenter from "./c-cpns/header-center";
import HeaderLeft from "./c-cpns/header-left";
import HeaderRight from "./c-cpns/header-right";
import { HeaderWrapper, SearchAreaWrapper } from "./style";
import useScrollPosition from "@/hooks/useScrollPosition";

const AppHeader = memo(() => {
  // å†…éƒ¨çŠ¶æ€
  const [isSearch, setIsSearch] = useState(false);

  // reduxä¸­è·å–æ•°æ®
  const { headerConfig } = useSelector(
    (state) => ({
      headerConfig: state.main.headerConfig,
    }),
    shallowEqual
  );
  const { isFixed } = headerConfig;

  // ç›‘å¬æ»šåŠ¨
  const { scrollY } = useScrollPosition();
  const prevY = useRef(0);
  if (!isSearch) prevY.current = scrollY;
  if (isSearch && Math.abs(scrollY - prevY.current) > 30) setIsSearch(false);

  return (
    <HeaderWrapper className={classNames({ fixed: isFixed })}>
      <div className="content">
        <div className="top">
          <HeaderLeft />
          <HeaderCenter
            isSearch={isSearch}
            searchClickHandle={(e) => setIsSearch(true)}
          />
          <HeaderRight />
        </div>
        <SearchAreaWrapper isSearch={isSearch}></SearchAreaWrapper>
      </div>
      {isSearch && (
        <div className="cover" onClick={(e) => setIsSearch(false)}></div>
      )}
    </HeaderWrapper>
  );
});

export default AppHeader;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const HeaderWrapper = styled.div`
  border-bottom: 1px solid #eee;

  &.fixed {
    position: fixed;
    z-index: 99;
    top: 0;
    left: 0;
    right: 0;
  }

  .content {
    position: relative;
    z-index: 19;
    background-color: #fff;
    .top {
      display: flex;
      /* align-items: center; */
      height: 80px;
    }

    .search-area {
      height: 100px;
    }
  }

  .cover {
    position: fixed;
    z-index: 9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.5);
  }
`;
export const SearchAreaWrapper = styled.div`
  transition: height 300ms ease;
  height: ${(props) => (props.isSearch ? "100px" : "0")};
`;
```

**useScrollPosition**

```js
import { useEffect, useState } from "react";
import { throttle } from "underscore";

export default function useScrollPosition() {
  // è£…çŠ¶æ€è®°å½•ä½ç½®
  const [scrollX, setScrollX] = useState(0);
  const [scrollY, setScrollY] = useState(0);

  // ç›‘å¬windowçš„æ»šåŠ¨
  useEffect(() => {
    const handleScroll = throttle(function () {
      setScrollX(window.scrollX);
      setScrollY(window.scrollY);
    }, 100);
    window.addEventListener("scroll", handleScroll);

    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return { scrollX, scrollY };
}
```

**HeaderCenter**

```jsx
import React, { memo, useState } from "react";

import { CenterWrapper } from "./style";
import IconSearchBar from "@/assets/svg/icon_search_bar";
import searchTitles from "@/assets/data/search_titles";
import SearchSections from "./c-cpns/search-sections";
import SearchTabs from "./c-cpns/search-tabs";
import { CSSTransition } from "react-transition-group";

const HeaderCenter = memo((props) => {
  const { isSearch, searchClickHandle } = props;
  const [tabIndex, setTabIndex] = useState(0);

  const titles = searchTitles.map((item) => item.title);
  // äº‹ä»¶å¤„ç†
  function searchClick() {
    if (searchClickHandle) searchClickHandle();
  }

  return (
    <CenterWrapper>
      <CSSTransition
        in={!isSearch}
        classNames="bar"
        timeout={250}
        unmountOnExit={true}
      >
        <div className="search-bar" onClick={searchClick}>
          <div className="text">æœç´¢æˆ¿æºå’Œä½“éªŒ</div>
          <div className="icon">
            <IconSearchBar />
          </div>
        </div>
      </CSSTransition>
      <CSSTransition
        in={isSearch}
        classNames="detail"
        timeout={250}
        unmountOnExit={true}
      >
        <div className="search-detail">
          <SearchTabs titles={titles} tabClick={setTabIndex} />
          <div className="infos">
            <SearchSections searchInfos={searchTitles[tabIndex].searchInfos} />
          </div>
        </div>
      </CSSTransition>
    </CenterWrapper>
  );
});

export default HeaderCenter;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const CenterWrapper = styled.div`
  position: relative;
  display: flex;
  justify-content: center;
  height: 48px;

  .search-bar {
    position: absolute;
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 300px;
    height: 48px;
    margin-top: 20px;
    box-sizing: border-box;
    padding: 0 8px;
    border: 1px solid #ddd;
    border-radius: 24px;
    cursor: pointer;

    ${(props) => props.theme.mixin.boxShadow};

    .text {
      padding: 0 16px;
      color: #222;
      font-weight: 600;
    }

    .icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      color: #fff;
      background-color: ${(props) => props.theme.color.primaryColor};
    }
  }

  .search-detail {
    position: relative;
    transform-origin: 50% 0;
    will-change: transform, opacity;

    .infos {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
    }
  }

  .detail-exit {
    transform: scale(1) translateY(0);
    opacity: 1;
  }

  .detail-exit-active {
    transition: all 250ms ease;
    transform: scale(0.35, 0.727273) translateY(-58px);
    opacity: 0;
  }

  .detail-enter {
    transform: scale(0.35, 0.727273) translateY(-58px);
    opacity: 0;
  }

  .detail-enter-active {
    transform: scale(1) translateY(0);
    opacity: 1;
    transition: all 250ms ease;
  }

  .bar-enter {
    transform: scale(2.85714, 1.375) translateY(58px);
    opacity: 0;
  }

  .bar-enter-active {
    transition: all 250ms ease;
    transform: scale(1) translateY(0);
    opacity: 1;
  }

  .bar-exit {
    opacity: 0;
  }
`;
```

**SearchTabs**

```jsx
import PropTypes from "prop-types";
import React, { memo, useState } from "react";
import classNames from "classnames";

import { TabsWrapper } from "./style";

const SearchTabs = memo((props) => {
  const { titles, tabClick } = props;
  const [currentIndex, setCurrentIndex] = useState(0);
  // äº‹ä»¶å¤„ç†
  function itemClick(index) {
    setCurrentIndex(index);
    if (tabClick) tabClick(index);
  }
  return (
    <TabsWrapper>
      {titles.map((item, index) => {
        return (
          <div
            className={classNames("item", { active: currentIndex === index })}
            key={item}
            onClick={(e) => itemClick(index)}
          >
            <span className="text">{item}</span>
            <span className="bottom"></span>
          </div>
        );
      })}
    </TabsWrapper>
  );
});

SearchTabs.propTypes = {
  titles: PropTypes.array,
};

export default SearchTabs;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const TabsWrapper = styled.div`
  display: flex;

  color: ${(props) => (props.theme.isAlpha ? "#fff" : "#222")};

  .item {
    position: relative;
    width: 64px;
    height: 20px;
    margin: 10px 16px;
    font-size: 16px;
    cursor: pointer;

    &.active .bottom {
      position: absolute;
      top: 28px;
      left: 0;
      width: 64px;
      height: 2px;
      background-color: ${(props) => (props.theme.isAlpha ? "#fff" : "#333")};
    }
  }
`;
```

**SearchSections**

```jsx
import PropTypes from "prop-types";
import React, { memo } from "react";

import { SectionsWrapper } from "./style";

const SearchSections = memo((props) => {
  const { searchInfos } = props;
  return (
    <SectionsWrapper>
      {searchInfos.map((item, index) => {
        return (
          <div className="item" key={index}>
            <div className="info">
              <div className="title">{item.title}</div>
              <div className="desc">{item.desc}</div>
            </div>
            {index !== searchInfos.length - 1 && (
              <div className="divider"></div>
            )}
          </div>
        );
      })}
    </SectionsWrapper>
  );
});

SearchSections.propTypes = {
  searchInfos: PropTypes.array,
};

export default SearchSections;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const SectionsWrapper = styled.div`
  display: flex;
  width: 850px;
  height: 66px;
  border-radius: 32px;
  border: 1px solid #ddd;
  background-color: #fff;

  .item {
    flex: 1;
    display: flex;
    align-items: center;
    border-radius: 32px;

    .info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 0 30px;

      .title {
        font-size: 12px;
        font-weight: 800;
        color: #222;
      }

      .desc {
        font-size: 14px;
        color: #666;
      }
    }

    .divider {
      height: 32px;
      width: 1px;
      background-color: #ddd;
    }

    &:hover {
      background-color: #eee;
    }
  }
`;
```

#### å¤´éƒ¨é€æ˜æ•ˆæœ

é¦–é¡µå¤´éƒ¨æœ‰æœç´¢åŒºæœ‰é€æ˜æ•ˆæœï¼Œå…¶å®ƒé¡µé¢ä¹Ÿå¯èƒ½æœ‰ï¼›

åªæœ‰**å¤´éƒ¨å…è®¸é€æ˜ä¸” ScrollY ç­‰äº 0**çš„æ—¶å€™ï¼Œå¤´éƒ¨æ‰ä¼šé€æ˜ï¼›

**åªè¦å›åˆ°é¡¶éƒ¨ï¼Œä¸”å¤´éƒ¨å…è®¸é€æ˜ï¼Œé‚£å¿…å®šè¦å¼¹å‡ºæœç´¢åŒº**ï¼›

å½“å¤´éƒ¨é€æ˜æ—¶ï¼Œå¤´éƒ¨å¾ˆå¤šåŒºåŸŸæ ·å¼éœ€è¦è°ƒæ•´ï¼Œç”±äº**isAlpha**æœ‰äº›åœ°æ–¹ä¼ ä¸åˆ°ï¼Œæ‰€ä»¥æ— æ³•æ ¹æ® isAlpha è°ƒæ•´ç›¸åº”æ ·å¼ï¼›

åº”è¯¥è®© isAlpha èƒ½ä¼ é€’ç»™æ‰€æœ‰éœ€è¦è°ƒæ•´æ ·å¼çš„ç»„ä»¶ï¼Œç”¨**ThemeProvider**åŒ…èµ·é‚£äº›ç»„ä»¶ï¼›

**AppHeader**

```jsx
import React, { memo, useRef, useState } from "react";
import { shallowEqual, useSelector } from "react-redux";
import classNames from "classnames";

import HeaderCenter from "./c-cpns/header-center";
import HeaderLeft from "./c-cpns/header-left";
import HeaderRight from "./c-cpns/header-right";
import { HeaderWrapper, SearchAreaWrapper } from "./style";
import useScrollPosition from "@/hooks/useScrollPosition";
import { ThemeProvider } from "styled-components";

const AppHeader = memo(() => {
  // å†…éƒ¨çŠ¶æ€
  const [isSearch, setIsSearch] = useState(false);

  // reduxä¸­è·å–æ•°æ®
  const { headerConfig } = useSelector(
    (state) => ({
      headerConfig: state.main.headerConfig,
    }),
    shallowEqual
  );
  const { isFixed, topAlpha } = headerConfig;

  // ç›‘å¬æ»šåŠ¨
  const { scrollY } = useScrollPosition();
  const prevY = useRef(0);
  if (!isSearch) prevY.current = scrollY;
  if (isSearch && Math.abs(scrollY - prevY.current) > 30) setIsSearch(false);

  // é€æ˜åº¦çš„é€»è¾‘
  const isAlpha = topAlpha && scrollY === 0;
  return (
    <ThemeProvider theme={{ isAlpha }}>
      <HeaderWrapper className={classNames({ fixed: isFixed })}>
        <div className="content">
          <div className="top">
            <HeaderLeft />
            <HeaderCenter
              isSearch={isAlpha || isSearch}
              searchClickHandle={(e) => setIsSearch(true)}
            />
            <HeaderRight />
          </div>
          <SearchAreaWrapper isSearch={isAlpha || isSearch}></SearchAreaWrapper>
        </div>
        {isSearch && (
          <div className="cover" onClick={(e) => setIsSearch(false)}></div>
        )}
      </HeaderWrapper>
    </ThemeProvider>
  );
});

export default AppHeader;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const HeaderWrapper = styled.div`
  &.fixed {
    position: fixed;
    z-index: 99;
    top: 0;
    left: 0;
    right: 0;
  }

  .content {
    position: relative;
    z-index: 19;
    background-color: ${(props) =>
      props.theme.isAlpha
        ? "rgba(255, 255, 255, 0)"
        : "rgba(255, 255, 255, 1)"};
    border-bottom: 1px solid #eee;
    border-bottom-color: ${(props) =>
      props.theme.isAlpha
        ? "rgba(233, 233, 233, 0)"
        : "rgba(233, 233, 233, 1)"};
    transition: all 300ms ease;

    .top {
      display: flex;
      align-items: center;
      height: 80px;
    }

    .search-area {
      height: 100px;
    }
  }

  .cover {
    position: fixed;
    z-index: 9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.5);
  }
`;
export const SearchAreaWrapper = styled.div`
  transition: height 300ms ease;
  height: ${(props) => (props.isSearch ? "100px" : "0")};
`;
```

**HeaderLeft å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const LeftWrapper = styled.div`
  flex: 1;
  display: flex;
  align-items: center;
  color: ${(props) =>
    props.theme.isAlpha ? "#fff" : props.theme.color.primaryColor};

  .logo {
    margin-left: 25px;
    cursor: pointer;
  }
`;
```

**HeaderRight å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const RightWrapper = styled.div`
  flex: 1;
  display: flex;
  justify-content: flex-end;
  align-items: center;

  color: ${(props) => props.theme.text.primaryColor};
  font-weight: 600;

  .btns {
    display: flex;
    box-sizing: content-box;
    color: ${(props) =>
      props.theme.isAlpha ? "#fff" : props.theme.text.primaryColor};

    .btn {
      height: 18px;
      line-height: 18px;
      padding: 12px 15px;
      border-radius: 22px;
      cursor: pointer;
      box-sizing: content-box;

      &:hover {
        background-color: ${(props) =>
          props.theme.isAlpha ? "rgba(255, 255, 255, .1)" : "#f5f5f5"};
      }
    }
  }

  .profile {
    position: relative;
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    width: 77px;
    height: 42px;
    margin-right: 24px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 25px;
    background-color: #fff;
    cursor: pointer;

    color: ${(props) => props.theme.text.primaryColor};

    ${(props) => props.theme.mixin.boxShadow};

    .panel {
      position: absolute;
      top: 54px;
      right: 0;
      width: 240px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.2);
      color: #666;

      .top,
      .bottom {
        padding: 10px 0;

        .item {
          height: 40px;
          line-height: 40px;
          padding: 0 16px;

          &:hover {
            background-color: #f5f5f5;
          }
        }
      }

      .top {
        border-bottom: 1px solid #ddd;
      }
    }
  }
`;
```

### æ›´å¤šé¡µ

#### è¿‡æ»¤æ¡ä»¶åŒºåŸŸ

è®°å½•é€‰ä¸­é¡¹ï¼Œå†ä¸€æ¬¡ç‚¹å‡»åˆ™è¯¥é¡¹å‰”é™¤ï¼›

**Entire**

```jsx
import React, { memo } from "react";

import EntireFilter from "./c-cpns/entire-filter";
import EntirePagination from "./c-cpns/entire-pagination";
import EntireRooms from "./c-cpns/entire-rooms";
import { EntireWrapper } from "./style";

const Entire = memo(() => {
  return (
    <EntireWrapper>
      <EntireFilter />
      <EntireRooms />
      <EntirePagination />
    </EntireWrapper>
  );
});

export default Entire;
```

**EntireFilter**

```jsx
import React, { memo, useState } from "react";
import { FilterWrapper } from "./style";
import filerData from "@/assets/data/filter_data.json";
import classNames from "classnames";

const EntireFilter = memo(() => {
  const [selectItems, setSelectItems] = useState([]);
  // äº‹ä»¶å¤„ç†
  function itemClick(item) {
    const newItems = [...selectItems];
    if (newItems.includes(item)) {
      // ç§»é™¤
      const itemIndex = newItems.findIndex((filterItem) => filterItem === item);
      newItems.splice(itemIndex, 1);
    } else {
      // æ·»åŠ 
      newItems.push(item);
    }
    setSelectItems(newItems);
  }
  return (
    <FilterWrapper>
      <div className="filter">
        {filerData.map((item) => {
          return (
            <div
              className={classNames("item", {
                active: selectItems.includes(item),
              })}
              key={item}
              onClick={(e) => itemClick(item)}
            >
              {item}
            </div>
          );
        })}
      </div>
    </FilterWrapper>
  );
});

export default EntireFilter;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const FilterWrapper = styled.div`
  display: flex;
  align-items: center;
  height: 48px;
  padding-left: 16px;
  border-bottom: 1px solid #f2f2f2;
  background-color: #fff;

  .filter {
    display: flex;
    .item {
      margin: 0 4px 0 8px;
      padding: 6px 12px;
      border: 1px solid #dce0e0;
      border-radius: 4px;
      color: #484848;
      cursor: pointer;

      &.active {
        background: #008489;
        border: 1px solid #008489;
        color: #fff;
      }
    }
  }
`;
```

#### æˆ¿é—´åˆ—è¡¨åŒºåŸŸ

##### **æ•°æ®è·å–**

**store çš„ entire æ¨¡å—**

**reducer**

```js
import * as actionType from "./constants";

const initialState = {
  currentPage: 0,
  roomList: [],
  totalCount: 0,
};

function reducer(state = initialState, action) {
  switch (action.type) {
    case actionType.CHANGE_CURRENT_PAGE:
      return { ...state, currentPage: action.currentPage };
    case actionType.CHANGE_ROOM_LIST:
      return { ...state, roomList: action.roomList };
    case actionType.CHANGE_TOTAL_COUNT:
      return { ...state, totalCount: action.totalCount };
    default:
      return state;
  }
}

export default reducer;
```

**constants**

```js
export const CHANGE_CURRENT_PAGE = "entire/change_current_page";
export const CHANGE_ROOM_LIST = "entire/change_room_list";
export const CHANGE_TOTAL_COUNT = "entire/change_total_count";
```

**actionCreators**

```js
/*
 * @Description: å¾…ç¼–è¾‘
 * @Author: SiFeng Zhai
 * @Date: 2022-12-30 11:06:47
 * @LastEditors: SiFeng Zhai
 * @LastEditTime: 2023-01-13 20:37:24
 */
import { getEntireRoomList } from "@/services/modules/entire";
import * as actionType from "./constants";

export const changeCurrentPageAction = (currentPage) => ({
  type: actionType.CHANGE_CURRENT_PAGE,
  currentPage,
});

export const changeRoomListAction = (roomList) => ({
  type: actionType.CHANGE_ROOM_LIST,
  roomList,
});

export const changeTotalCountAction = (totalCount) => ({
  type: actionType.CHANGE_TOTAL_COUNT,
  totalCount,
});

export const fetchRoomListAction = () => {
  return async (dispatch, getState) => {
    // æ ¹æ®é¡µç è·å–æœ€æ–°æ•°æ®
    const currentPage = getState().entire.currentPage;
    const res = await getEntireRoomList(currentPage * 20);
    // å°†æœ€æ–°çš„æ•°æ®ä¿å­˜åˆ°reduxä¸­
    const roomList = res.list;
    const totalCount = res.totalCount;
    dispatch(changeRoomListAction(roomList));
    dispatch(changeTotalCountAction(totalCount));
  };
};
```

**services çš„ entire æ¨¡å—**

```js
import sfRequest from "..";

export function getEntireRoomList(offset = 0, size = 20) {
  return sfRequest.get({
    url: "entire/list",
    params: {
      offset,
      size,
    },
  });
}
```

##### æ•°æ®å±•ç¤º

**EntireRooms**

```jsx
import React, { memo } from "react";
import { useSelector } from "react-redux";
import { RoomsWrapper } from "./style";
import RoomItem from "@/components/room-item";

const EntireRooms = memo(() => {
  // reduxä¸­çš„æ•°æ®
  const { roomList, totalCount } = useSelector((state) => ({
    roomList: state.entire.roomList,
    totalCount: state.entire.totalCount,
  }));
  return (
    <RoomsWrapper>
      <h2 className="title">{totalCount}å¤šå¤„ä½å®¿</h2>
      <div className="list">
        {roomList.map((item) => {
          return <RoomItem itemData={item} itemWidth="20%" key={item.id} />;
        })}
      </div>
    </RoomsWrapper>
  );
});

export default EntireRooms;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const RoomsWrapper = styled.div`
  padding: 30px 20px;
  .title {
    font-weight: 700;
    font-size: 22px;
    color: #222;
    margin: 0 0 10px 10px;
  }
  .list {
    display: flex;
    flex-wrap: wrap;
  }
`;
```

##### å›¾ç‰‡è½®æ’­æ•ˆæœ

MUI æ²¡æœ‰å¯¹åº”çš„è½®æ’­å›¾ç»„ä»¶ï¼Œå¯ä»¥å» Ant design é‡Œé¢æ‰¾ï¼Œant design ä¹Ÿæ˜¯å¼•ç”¨äº†ä¸€ä¸ªå«**react-slick**çš„åº“ï¼›

- å·¦å³ç®­å¤´**å¸ƒå±€æ ·å¼**
- å·¦å³ç®­å¤´**ç‚¹å‡»é€»è¾‘**
- è½®æ’­æŒ‡ç¤ºå™¨

**RoomItem**

```jsx
import { Rating } from "@mui/material";
import PropTypes from "prop-types";
import React, { memo, useRef } from "react";
import { Carousel } from "antd";

import { ItemWrapper } from "./style";
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";

const RoomItem = memo((props) => {
  const { itemData, itemWidth = "25%" } = props;
  const swiperRef = useRef();
  // äº‹ä»¶å¤„ç†
  function controlClick(isRight = true) {
    isRight ? swiperRef.current.next() : swiperRef.current.prev();
  }
  return (
    <ItemWrapper
      verifyColor={itemData?.verify_info?.text_color || "#39576a"}
      itemWidth={itemWidth}
    >
      <div className="inner">
        {/* è½®æ’­å›¾ç‰‡åŒº */}
        <div className="swiper">
          <div className="control">
            <div className="btn left" onClick={(e) => controlClick(false)}>
              <IconArrowLeft width="30" height="30" />
            </div>
            <div className="btn right" onClick={(e) => controlClick()}>
              <IconArrowRight width="30" height="30" />
            </div>
          </div>
          <Carousel dots={false} ref={swiperRef}>
            {itemData?.picture_urls?.map((item) => {
              return (
                <div className="cover" key={item}>
                  <img src={item} alt="" />
                </div>
              );
            })}
          </Carousel>
        </div>

        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
        <div className="bottom">
          <Rating
            value={itemData.star_rating ?? 5}
            precision={0.5}
            readOnly
            sx={{ fontSize: "12px", color: "#00848A" }}
          />
          <span className="count">{itemData.reviews_count}</span>
          {itemData.bottom_info && (
            <span className="extra">Â·{itemData.bottom_info.content}</span>
          )}
        </div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const ItemWrapper = styled.div`
  flex-shrink: 0;
  box-sizing: border-box;
  width: ${(props) => props.itemWidth};
  padding: 8px;

  .inner {
    width: 100%;
  }

  .cover {
    position: relative;
    box-sizing: border-box;
    padding: 66.66% 8px 0;
    border-radius: 3px;
    overflow: hidden;

    img {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .swiper {
    position: relative;
    cursor: pointer;

    &:hover {
      .control {
        display: flex;
      }
    }

    .control {
      position: absolute;
      z-index: 1;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: none;
      justify-content: space-between;
      color: #fff;
      .btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 83px;
        height: 100%;
        background: linear-gradient(
          to left,
          transparent 0%,
          rgba(0, 0, 0, 0.25) 100%
        );

        &.right {
          background: linear-gradient(
            to right,
            transparent 0%,
            rgba(0, 0, 0, 0.25) 100%
          );
        }
      }
    }
  }

  .desc {
    margin: 10px 0 5px;
    font-size: 12px;
    font-weight: 700;
    color: ${(props) => props.verifyColor};
  }

  .name {
    font-size: 16px;
    font-weight: 700;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .price {
    margin: 8px 0;
  }

  .bottom {
    display: flex;
    align-items: center;
    font-size: 12px;
    font-weight: 600;
    color: ${(props) => props.theme.text.primaryColor};

    .count {
      margin: 0 2px 0 4px;
    }

    .MuiRating-icon {
      margin-right: -2px;
    }
  }
`;
```

###### è½®æ’­æŒ‡ç¤ºå™¨

è®©é€‰ä¸­çš„ item å±…ä¸­ï¼Œä¹Ÿå°±æ˜¯ç®—å‡º**é€‰ä¸­å…ƒç´ çš„æ»šåŠ¨è·ç¦»**ï¼›

è¯¥è·ç¦»=**é€‰ä¸­ item.offsetLeft + é€‰ä¸­ item.width \* 0.5 - content.width** ;

æœ‰äº›**ç‰¹æ®Šæƒ…å†µæ˜¯ä¸éœ€è¦é€‰ä¸­ item å±…ä¸­**çš„ï¼Œæ¯”å¦‚åˆšå¼€å§‹é€‰ä¸­ item æ˜¯ç¬¬ä¸€ä¸ªæ—¶ï¼›

å½“**distance**å°äº 0 æ—¶ï¼Œéœ€è¦ç½®ä¸º 0ï¼ˆå·¦è¾¹çš„ç‰¹æ®Šæƒ…å†µï¼‰ï¼›

å½“**distance**å¤§äº**content æ»šåŠ¨è·ç¦»ä¸ content å®½åº¦çš„å·®å€¼**æ—¶ï¼Œéœ€è¦å°†è¯¥å·®å€¼èµ‹å€¼ç»™ distanceï¼›

**RoomItem**

```jsx
import { Rating } from "@mui/material";
import PropTypes from "prop-types";
import React, { memo, useRef, useState } from "react";
import { Carousel } from "antd";

import { ItemWrapper } from "./style";
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";
import Indicator from "@/base-ui/indicator";
import classNames from "classnames";

const RoomItem = memo((props) => {
  const { itemData, itemWidth = "25%" } = props;
  const [selectedIndex, setSelectedIndex] = useState(0);
  const swiperRef = useRef();
  // äº‹ä»¶å¤„ç†
  function controlClick(isRight = true) {
    // ä¸Šä¸€å¼ ï¼Œä¸‹ä¸€å¼ 
    isRight ? swiperRef.current.next() : swiperRef.current.prev();
    // æ›´æ–°é€‰ä¸­item
    let newIndex = isRight ? selectedIndex + 1 : selectedIndex - 1;
    const length = itemData.picture_urls.length;
    if (newIndex < 0) newIndex = length - 1;
    if (newIndex > length - 1) newIndex = 0;
    setSelectedIndex(newIndex);
  }
  return (
    <ItemWrapper
      verifyColor={itemData?.verify_info?.text_color || "#39576a"}
      itemWidth={itemWidth}
    >
      <div className="inner">
        {/* è½®æ’­å›¾ç‰‡åŒº */}
        <div className="swiper">
          {/* å·¦å³ç®­å¤´ */}
          <div className="control">
            <div className="btn left" onClick={(e) => controlClick(false)}>
              <IconArrowLeft width="30" height="30" />
            </div>
            <div className="btn right" onClick={(e) => controlClick()}>
              <IconArrowRight width="30" height="30" />
            </div>
          </div>
          {/* å›¾ç‰‡ */}
          <Carousel dots={false} ref={swiperRef}>
            {itemData?.picture_urls?.map((item) => {
              return (
                <div className="cover" key={item}>
                  <img src={item} alt="" />
                </div>
              );
            })}
          </Carousel>
          {/* æŒ‡ç¤ºå™¨ */}
          <div className="indicator">
            <Indicator selectedIndex={selectedIndex}>
              {itemData?.picture_urls?.map((item, index) => {
                return (
                  <div className="dot-item" key={item}>
                    <span
                      className={classNames("dot", {
                        active: selectedIndex === index,
                      })}
                    ></span>
                  </div>
                );
              })}
            </Indicator>
          </div>
        </div>

        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
        <div className="bottom">
          <Rating
            value={itemData.star_rating ?? 5}
            precision={0.5}
            readOnly
            sx={{ fontSize: "12px", color: "#00848A" }}
          />
          <span className="count">{itemData.reviews_count}</span>
          {itemData.bottom_info && (
            <span className="extra">Â·{itemData.bottom_info.content}</span>
          )}
        </div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const ItemWrapper = styled.div`
  flex-shrink: 0;
  box-sizing: border-box;
  width: ${(props) => props.itemWidth};
  padding: 8px;

  .inner {
    width: 100%;
  }

  .cover {
    position: relative;
    box-sizing: border-box;
    padding: 66.66% 8px 0;
    border-radius: 3px;
    overflow: hidden;

    img {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .swiper {
    position: relative;
    cursor: pointer;

    &:hover {
      .control {
        display: flex;
      }
    }

    .control {
      position: absolute;
      z-index: 1;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: none;
      justify-content: space-between;
      color: #fff;
      .btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 83px;
        height: 100%;
        background: linear-gradient(
          to left,
          transparent 0%,
          rgba(0, 0, 0, 0.25) 100%
        );

        &.right {
          background: linear-gradient(
            to right,
            transparent 0%,
            rgba(0, 0, 0, 0.25) 100%
          );
        }
      }
    }

    .indicator {
      position: absolute;
      z-index: 99;
      bottom: 10px;
      left: 0;
      right: 0;
      margin: 0 auto;
      width: 30%;

      .dot-item {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 20%;

        .dot {
          width: 6px;
          height: 6px;
          background-color: #fff;
          border-radius: 50%;

          &.active {
            width: 8px;
            height: 8px;
          }
        }
      }
    }
  }

  .desc {
    margin: 10px 0 5px;
    font-size: 12px;
    font-weight: 700;
    color: ${(props) => props.verifyColor};
  }

  .name {
    font-size: 16px;
    font-weight: 700;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .price {
    margin: 8px 0;
  }

  .bottom {
    display: flex;
    align-items: center;
    font-size: 12px;
    font-weight: 600;
    color: ${(props) => props.theme.text.primaryColor};

    .count {
      margin: 0 2px 0 4px;
    }

    .MuiRating-icon {
      margin-right: -2px;
    }
  }
`;
```

**Indicator**

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useRef } from "react";
import { IndicatorWrapper } from "./style";

const Indicator = memo((props) => {
  const { selectedIndex = 0 } = props;
  const contentRef = useRef();
  useEffect(() => {
    // selectedIndexå¯¹åº”çš„item
    const selectItemEl = contentRef.current.children[selectedIndex];
    const itemOffsetLeft = selectItemEl.offsetLeft;
    const itemWidth = selectItemEl.clientWidth;
    // contentçš„å®½åº¦
    const contentWidth = contentRef.current.clientWidth;
    const contentScroll = contentRef.current.scrollWidth;

    // selectedIndexæ»šåŠ¨çš„è·ç¦»
    let distance = itemOffsetLeft + itemWidth * 0.5 - contentWidth * 0.5;
    // å·¦å³ä¸¤è¾¹æƒ…å†µçš„ç‰¹æ®Šå¤„ç†
    if (distance < 0) distance = 0; // å·¦è¾¹æƒ…å†µçš„ç‰¹æ®Šå¤„ç†
    const totalDistance = contentScroll - contentWidth;
    if (distance > totalDistance) distance = totalDistance; // å³è¾¹æƒ…å†µçš„ç‰¹æ®Šå¤„ç†
    // æ»šåŠ¨
    contentRef.current.style.transform = `translate(${-distance}px)`;
  }, [selectedIndex]);
  return (
    <IndicatorWrapper>
      <div className="i-content" ref={contentRef}>
        {props.children}
      </div>
    </IndicatorWrapper>
  );
});

Indicator.propTypes = {
  selectedIndex: PropTypes.number,
};

export default Indicator;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";
export const IndicatorWrapper = styled.div`
  overflow: hidden;

  .i-content {
    display: flex;
    position: relative;
    transition: transform 200ms ease;

    > * {
      flex-shrink: 0;
    }
  }
`;
```

##### room-item ä¸åŒæƒ…å†µä¸‹çš„ä½¿ç”¨

æœ‰äº›é¡µé¢éœ€è¦ room-item ä½¿ç”¨è½®æ’­å›¾ï¼Œæœ‰äº›åˆ™ä¸éœ€è¦ï¼Œæ‰€ä»¥éœ€è¦åˆ†ç±»ï¼›

å½“æœåŠ¡å™¨æä¾›å¤šç§å›¾ç‰‡åˆ™ä½¿ç”¨è½®æ’­å›¾ï¼Œå¦åˆ™å°±å±•ç¤ºå›¾ç‰‡ï¼›

**RoomItem**

```jsx
import { Rating } from "@mui/material";
import PropTypes from "prop-types";
import React, { memo, useRef, useState } from "react";
import { Carousel } from "antd";

import { ItemWrapper } from "./style";
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";
import Indicator from "@/base-ui/indicator";
import classNames from "classnames";

const RoomItem = memo((props) => {
  const { itemData, itemWidth = "25%" } = props;
  const [selectedIndex, setSelectedIndex] = useState(0);
  const swiperRef = useRef();
  // äº‹ä»¶å¤„ç†
  function controlClick(isRight = true) {
    // ä¸Šä¸€å¼ ï¼Œä¸‹ä¸€å¼ 
    isRight ? swiperRef.current.next() : swiperRef.current.prev();
    // æ›´æ–°é€‰ä¸­item
    let newIndex = isRight ? selectedIndex + 1 : selectedIndex - 1;
    const length = itemData.picture_urls.length;
    if (newIndex < 0) newIndex = length - 1;
    if (newIndex > length - 1) newIndex = 0;
    setSelectedIndex(newIndex);
  }
  const pictrueEl = (
    <div className="cover">
      <img src={itemData.picture_url} alt="" />
    </div>
  );

  const swiperEl = (
    <div className="swiper">
      {/* å·¦å³ç®­å¤´ */}
      <div className="control">
        <div className="btn left" onClick={(e) => controlClick(false)}>
          <IconArrowLeft width="30" height="30" />
        </div>
        <div className="btn right" onClick={(e) => controlClick()}>
          <IconArrowRight width="30" height="30" />
        </div>
      </div>
      {/* å›¾ç‰‡ */}
      <Carousel dots={false} ref={swiperRef}>
        {itemData?.picture_urls?.map((item) => {
          return (
            <div className="cover" key={item}>
              <img src={item} alt="" />
            </div>
          );
        })}
      </Carousel>
      {/* æŒ‡ç¤ºå™¨ */}
      <div className="indicator">
        <Indicator selectedIndex={selectedIndex}>
          {itemData?.picture_urls?.map((item, index) => {
            return (
              <div className="dot-item" key={item}>
                <span
                  className={classNames("dot", {
                    active: selectedIndex === index,
                  })}
                ></span>
              </div>
            );
          })}
        </Indicator>
      </div>
    </div>
  );
  return (
    <ItemWrapper
      verifyColor={itemData?.verify_info?.text_color || "#39576a"}
      itemWidth={itemWidth}
    >
      <div className="inner">
        {/* è½®æ’­å›¾ç‰‡åŒº */}
        {!itemData.picture_urls ? pictrueEl : swiperEl}
        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
        <div className="bottom">
          <Rating
            value={itemData.star_rating ?? 5}
            precision={0.5}
            readOnly
            sx={{ fontSize: "12px", color: "#00848A" }}
          />
          <span className="count">{itemData.reviews_count}</span>
          {itemData.bottom_info && (
            <span className="extra">Â·{itemData.bottom_info.content}</span>
          )}
        </div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

#### é¡µç åŒºåŸŸ

**æ€»é¡µæ•°**ä¸º totalCount/20 å‘ä¸Šå–æ•´ï¼›

**EntirePagination**

```jsx
import React, { memo } from "react";
import Pagination from "@mui/material/Pagination";
import { PaginationWrapper } from "./style";
import { useSelector } from "react-redux";

const EntirePagination = memo(() => {
  const { totalCount, currentPage, roomList } = useSelector((state) => ({
    totalCount: state.entire.totalCount,
    currentPage: state.entire.currentPage,
    roomList: state.entire.roomList,
  }));
  const totalPage = Math.ceil(totalCount / 20);
  const startCount = currentPage * 20 + 1;
  const endCount = (currentPage + 1) * 20;
  return (
    <PaginationWrapper>
      {!!roomList.length && (
        <div className="info">
          <Pagination count={totalPage} />
          <div className="desc">
            ç¬¬ {startCount} - {endCount} ä¸ªæˆ¿æº, å…±è¶…è¿‡{totalCount}ä¸ª
          </div>
        </div>
      )}
    </PaginationWrapper>
  );
});

export default EntirePagination;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const PaginationWrapper = styled.div`
  display: flex;
  justify-content: center;

  .info {
    display: flex;
    flex-direction: column;
    align-items: center;

    .MuiPaginationItem-page {
      margin: 0 9px;
      &:hover {
        text-decoration: underline;
      }
    }

    .MuiPaginationItem-page.Mui-selected {
      background-color: #222;
      color: #fff;
    }

    .desc {
      margin-top: 16px;
      color: #222;
    }
  }
`;
```

##### é¡µç æ”¹å˜é€»è¾‘

- é‡æ–°å‘èµ·è¯·æ±‚
- å›åˆ°é¡¶éƒ¨
- è’™ç‰ˆ

å½“æ­£åœ¨å‘ç”Ÿç½‘ç»œè¯·æ±‚æ—¶ï¼Œéœ€è¦è’™ç‰ˆï¼›

è€Œéœ€è¦ç”¨ä¸€ä¸ªå˜é‡ï¼ˆisLoadingï¼‰è®°å½•æ˜¯å¦æ­£åœ¨å‘ç”Ÿç½‘ç»œè¯·æ±‚ï¼›

ä¿å­˜åœ¨ store ä¸­çš„ entire æ¨¡å—çš„ reducer ä¸­ï¼›

**EntirePagination**

```jsx
import React, { memo } from "react";
import Pagination from "@mui/material/Pagination";
import { PaginationWrapper } from "./style";
import { shallowEqual, useDispatch, useSelector } from "react-redux";
import { fetchRoomListAction } from "@/store/modules/entire/createActions";

const EntirePagination = memo(() => {
  const { totalCount, currentPage, roomList } = useSelector(
    (state) => ({
      totalCount: state.entire.totalCount,
      currentPage: state.entire.currentPage,
      roomList: state.entire.roomList,
    }),
    shallowEqual
  );
  const totalPage = Math.ceil(totalCount / 20);
  const startCount = currentPage * 20 + 1;
  const endCount = (currentPage + 1) * 20;

  // äº‹ä»¶å¤„ç†
  const dispatch = useDispatch();
  function pageChangeHandle(evevt, pageCount) {
    // å›åˆ°é¡¶éƒ¨
    window.scrollTo(0, 0);
    // é‡æ–°è¯·æ±‚
    dispatch(fetchRoomListAction(pageCount - 1));
  }
  return (
    <PaginationWrapper>
      {!!roomList.length && (
        <div className="info">
          <Pagination count={totalPage} onChange={pageChangeHandle} />
          <div className="desc">
            ç¬¬ {startCount} - {endCount} ä¸ªæˆ¿æº, å…±è¶…è¿‡{totalCount}ä¸ª
          </div>
        </div>
      )}
    </PaginationWrapper>
  );
});

export default EntirePagination;
```

**EntireRooms**

```jsx
import React, { memo } from "react";
import { shallowEqual, useSelector } from "react-redux";
import { RoomsWrapper } from "./style";
import RoomItem from "@/components/room-item";

const EntireRooms = memo(() => {
  // reduxä¸­çš„æ•°æ®
  const { roomList, totalCount, isLoading } = useSelector(
    (state) => ({
      roomList: state.entire.roomList,
      totalCount: state.entire.totalCount,
      isLoading: state.entire.isLoading,
    }),
    shallowEqual
  );
  return (
    <RoomsWrapper>
      <h2 className="title">{totalCount}å¤šå¤„ä½å®¿</h2>
      <div className="list">
        {roomList.map((item) => {
          return <RoomItem itemData={item} itemWidth="20%" key={item.id} />;
        })}
      </div>
      {isLoading && <div className="cover"></div>}
    </RoomsWrapper>
  );
});

export default EntireRooms;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const RoomsWrapper = styled.div`
  position: relative;
  padding: 30px 20px;
  .title {
    font-weight: 700;
    font-size: 22px;
    color: #222;
    margin: 0 0 10px 10px;
  }
  .list {
    display: flex;
    flex-wrap: wrap;
  }
  > .cover {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.8);
  }
`;
```

**store çš„ entire æ¨¡å—**

**actionCreator**

```js
import { getEntireRoomList } from "@/services/modules/entire";
import * as actionType from "./constants";

export const changeCurrentPageAction = (currentPage) => ({
  type: actionType.CHANGE_CURRENT_PAGE,
  currentPage,
});

export const changeRoomListAction = (roomList) => ({
  type: actionType.CHANGE_ROOM_LIST,
  roomList,
});

export const changeTotalCountAction = (totalCount) => ({
  type: actionType.CHANGE_TOTAL_COUNT,
  totalCount,
});

export const changeIsLoadingAction = (isLoading) => ({
  type: actionType.CHANGE_IS_LOADING,
  isLoading,
});

export const fetchRoomListAction = (page = 0) => {
  return async (dispatch, getState) => {
    // ä¿®æ”¹é¡µç 
    dispatch(changeCurrentPageAction(page));
    // æ ¹æ®é¡µç è·å–æœ€æ–°æ•°æ®
    dispatch(changeIsLoadingAction(true));
    const res = await getEntireRoomList(page * 20);
    dispatch(changeIsLoadingAction(false));
    // å°†æœ€æ–°çš„æ•°æ®ä¿å­˜åˆ°reduxä¸­
    const roomList = res.list;
    const totalCount = res.totalCount;
    dispatch(changeRoomListAction(roomList));
    dispatch(changeTotalCountAction(totalCount));
  };
};
```

**reducer**

```js
import * as actionType from "./constants";

const initialState = {
  currentPage: 0,
  roomList: [],
  totalCount: 0,
  isLoading: false,
};

function reducer(state = initialState, action) {
  switch (action.type) {
    case actionType.CHANGE_CURRENT_PAGE:
      return { ...state, currentPage: action.currentPage };
    case actionType.CHANGE_ROOM_LIST:
      return { ...state, roomList: action.roomList };
    case actionType.CHANGE_TOTAL_COUNT:
      return { ...state, totalCount: action.totalCount };
    case actionType.CHANGE_IS_LOADING:
      return { ...state, isLoading: action.isLoading };
    default:
      return state;
  }
}

export default reducer;
```

**constant**

```js
export const CHANGE_CURRENT_PAGE = "entire/change_current_page";
export const CHANGE_ROOM_LIST = "entire/change_room_list";
export const CHANGE_TOTAL_COUNT = "entire/change_total_count";
export const CHANGE_IS_LOADING = "entire/change_is_loading";
```

#### è¯¦æƒ…é¡µè·³è½¬

å¯èƒ½é¦–é¡µä¸éœ€è¦è·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæ‰€ä»¥è·³è½¬é€»è¾‘ä¸è¦å†**room-item**å†…ç›‘å¬ï¼›

è€Œæ˜¯**å°†äº‹ä»¶ä¼ é€’å‡ºå»**ï¼Œ**é€šçŸ¥çˆ¶ç»„ä»¶è·³è½¬**ï¼›

**EntireRooms**

```jsx
import React, { memo, useCallback } from "react";
import { shallowEqual, useSelector } from "react-redux";
import { RoomsWrapper } from "./style";
import RoomItem from "@/components/room-item";
import { useNavigate } from "react-router-dom";

const EntireRooms = memo(() => {
  // reduxä¸­çš„æ•°æ®
  const { roomList, totalCount, isLoading } = useSelector(
    (state) => ({
      roomList: state.entire.roomList,
      totalCount: state.entire.totalCount,
      isLoading: state.entire.isLoading,
    }),
    shallowEqual
  );

  // äº‹ä»¶å¤„ç†
  const navigate = useNavigate();
  const click = useCallback(() => {
    navigate("/detail");
  }, [navigate]);

  return (
    <RoomsWrapper>
      <h2 className="title">{totalCount}å¤šå¤„ä½å®¿</h2>
      <div className="list">
        {roomList.map((item) => {
          return (
            <RoomItem
              itemData={item}
              itemWidth="20%"
              key={item._id}
              itemClick={click}
            />
          );
        })}
      </div>
      {isLoading && <div className="cover"></div>}
    </RoomsWrapper>
  );
});

export default EntireRooms;
```

**RoomItem**

```jsx
import { Rating } from "@mui/material";
import PropTypes from "prop-types";
import React, { memo, useRef, useState } from "react";
import { Carousel } from "antd";

import { ItemWrapper } from "./style";
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";
import Indicator from "@/base-ui/indicator";
import classNames from "classnames";

const RoomItem = memo((props) => {
  const { itemData, itemWidth = "25%", itemClick } = props;
  const [selectedIndex, setSelectedIndex] = useState(0);
  const swiperRef = useRef();
  // äº‹ä»¶å¤„ç†
  function controlClick(isRight = true) {
    // ä¸Šä¸€å¼ ï¼Œä¸‹ä¸€å¼ 
    isRight ? swiperRef.current.next() : swiperRef.current.prev();
    // æ›´æ–°é€‰ä¸­item
    let newIndex = isRight ? selectedIndex + 1 : selectedIndex - 1;
    const length = itemData.picture_urls.length;
    if (newIndex < 0) newIndex = length - 1;
    if (newIndex > length - 1) newIndex = 0;
    setSelectedIndex(newIndex);
  }

  function itemClickHanlde() {
    if (itemClick) itemClick();
  }
  // å­å…ƒç´ èµ‹å€¼
  const pictrueEl = (
    <div className="cover">
      <img src={itemData.picture_url} alt="" />
    </div>
  );

  const swiperEl = (
    <div className="swiper">
      {/* å·¦å³ç®­å¤´ */}
      <div className="control">
        <div className="btn left" onClick={(e) => controlClick(false)}>
          <IconArrowLeft width="30" height="30" />
        </div>
        <div className="btn right" onClick={(e) => controlClick()}>
          <IconArrowRight width="30" height="30" />
        </div>
      </div>
      {/* å›¾ç‰‡ */}
      <Carousel dots={false} ref={swiperRef}>
        {itemData?.picture_urls?.map((item) => {
          return (
            <div className="cover" key={item}>
              <img src={item} alt="" />
            </div>
          );
        })}
      </Carousel>
      {/* æŒ‡ç¤ºå™¨ */}
      <div className="indicator">
        <Indicator selectedIndex={selectedIndex}>
          {itemData?.picture_urls?.map((item, index) => {
            return (
              <div className="dot-item" key={item}>
                <span
                  className={classNames("dot", {
                    active: selectedIndex === index,
                  })}
                ></span>
              </div>
            );
          })}
        </Indicator>
      </div>
    </div>
  );
  return (
    <ItemWrapper
      verifyColor={itemData?.verify_info?.text_color || "#39576a"}
      itemWidth={itemWidth}
      onClick={itemClickHanlde}
    >
      <div className="inner">
        {/* è½®æ’­å›¾ç‰‡åŒº */}
        {!itemData.picture_urls ? pictrueEl : swiperEl}
        <div className="desc">{itemData.verify_info.messages.join("Â·")}</div>
        <div className="name">{itemData.name}</div>
        <div className="price">ï¿¥{itemData.price}/æ™š</div>
        <div className="bottom">
          <Rating
            value={itemData.star_rating ?? 5}
            precision={0.5}
            readOnly
            sx={{ fontSize: "12px", color: "#00848A" }}
          />
          <span className="count">{itemData.reviews_count}</span>
          {itemData.bottom_info && (
            <span className="extra">Â·{itemData.bottom_info.content}</span>
          )}
        </div>
      </div>
    </ItemWrapper>
  );
});

RoomItem.propTypes = {
  itemData: PropTypes.object,
};

export default RoomItem;
```

##### æ•°æ®

ç”±äºè¯¦æƒ…é¡µçš„**æ•°æ®è¿‡å¤§**ï¼Œæ— æ³•é€šè¿‡**åŠ¨æ€è·¯ç”±**å’Œ**query**çš„å½¢å¼ä¼ é€’åˆ°è¯¦æƒ…é¡µï¼›

æ‰€ä»¥å¯ä»¥åœ¨**è·³è½¬ä¹‹å**å°†æ•°æ®ä¿å­˜åˆ°**redux**ä¸­ï¼Œ**è¯¦æƒ…é¡µ**å…±äº«å³å¯

**EntireRooms**

```jsx
import React, { memo, useCallback } from "react";
import { shallowEqual, useDispatch, useSelector } from "react-redux";
import { RoomsWrapper } from "./style";
import RoomItem from "@/components/room-item";
import { useNavigate } from "react-router-dom";
import { changeDetailInfoAction } from "@/store/modules/detail";

const EntireRooms = memo(() => {
  // reduxä¸­çš„æ•°æ®
  const { roomList, totalCount, isLoading } = useSelector(
    (state) => ({
      roomList: state.entire.roomList,
      totalCount: state.entire.totalCount,
      isLoading: state.entire.isLoading,
    }),
    shallowEqual
  );

  // äº‹ä»¶å¤„ç†
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const click = useCallback(
    (item) => {
      dispatch(changeDetailInfoAction(item));
      navigate("/detail");
    },
    [navigate, dispatch]
  );

  return (
    <RoomsWrapper>
      <h2 className="title">{totalCount}å¤šå¤„ä½å®¿</h2>
      <div className="list">
        {roomList.map((item) => {
          return (
            <RoomItem
              itemData={item}
              itemWidth="20%"
              key={item._id}
              itemClick={click}
            />
          );
        })}
      </div>
      {isLoading && <div className="cover"></div>}
    </RoomsWrapper>
  );
});

export default EntireRooms;
```

**store çš„ detail æ¨¡å—**

```js
import { createSlice } from "@reduxjs/toolkit";
const detailSlice = createSlice({
  name: "detail",
  initialState: {
    detailInfo: {},
  },
  reducers: {
    changeDetailInfoAction(state, { payload }) {
      state.detailInfo = payload;
    },
  },
});

export const { changeDetailInfoAction } = detailSlice.actions;
export default detailSlice.reducer;
```

**store çš„ index.js**

```js
import { configureStore } from "@reduxjs/toolkit";
import homeReducer from "./modules/home";
import entireReducer from "./modules/entire";
import detailReducer from "./modules/detail";

const store = configureStore({
  reducer: {
    home: homeReducer,
    entire: entireReducer,
    detail: detailReducer,
  },
});

export default store;
```

##### å±•ç¤º

- é®ç›–å±‚æ•ˆæœ

**Detail**

```jsx
import React, { memo } from "react";
import DetailInfo from "./c-cpns/detail-info";
import DetailPictures from "./c-cpns/detail-pictures";
import { DetailWrapper } from "./style";

const Detail = memo(() => {
  return (
    <DetailWrapper>
      <DetailPictures />
      <DetailInfo />
    </DetailWrapper>
  );
});

export default Detail;
```

**DetailPictures**

```jsx
import React, { memo } from "react";
import { useSelector } from "react-redux";
import { DetailPictureWrapper } from "./style";

const DetailPictures = memo((props) => {
  // reduxè·å–æ•°æ®
  const { detailInfo } = useSelector((state) => ({
    detailInfo: state.detail.detailInfo,
  }));
  return (
    <DetailPictureWrapper>
      <div className="pictures">
        <div className="left">
          <div className="item">
            <img src={detailInfo?.picture_urls?.[0]} alt="" />
            <div className="cover"></div>
          </div>
        </div>
        <div className="right">
          {detailInfo?.picture_urls?.slice(1, 5).map((item) => {
            return (
              <div className="item" key={item}>
                <img src={item} alt="" />
                <div className="cover"></div>
              </div>
            );
          })}
        </div>
      </div>
    </DetailPictureWrapper>
  );
});

export default DetailPictures;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const DetailPictureWrapper = styled.div`
  position: relative;
  > .pictures {
    display: flex;
    height: 600px;
    background-color: #000;

    &:hover {
      .cover {
        opacity: 1 !important;
      }

      .item:hover {
        .cover {
          opacity: 0 !important;
        }
      }
    }
  }

  .left,
  .right {
    width: 50%;
    height: 100%;

    .item {
      position: relative;
      height: 100%;
      overflow: hidden;
      cursor: pointer;

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;

        transition: transform 0.3s ease-in;
      }

      .cover {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.3);
        opacity: 0;
        transition: opacity 200ms ease;
      }

      &:hover {
        img {
          transform: scale(1.1);
        }
      }
    }
  }

  .right {
    display: flex;
    flex-wrap: wrap;

    .item {
      width: 50%;
      height: 50%;
      box-sizing: border-box;
      border: 1px solid #000;
    }
  }

  .show-btn {
    position: absolute;
    z-index: 99;
    right: 15px;
    bottom: 15px;
    line-height: 22px;
    padding: 6px 15px;
    border-radius: 4px;
    background-color: #fff;
    cursor: pointer;
  }
`;
```

##### åˆ‡æ¢æ—¶äº‹ä»¶å†’æ³¡

ç‚¹å‡»ä¸€ä¸ª item æ—¶è¿›å…¥ä¸€ä¸ªå®ƒçš„è¯¦æƒ…é¡µï¼Œæ— å¯åšéï¼›

ä½†æ˜¯ç‚¹å‡»è½®æ’­å›¾çš„åˆ‡æ¢å›¾æ ‡æ—¶ä¹Ÿè¿›å…¥äº†è¯¦æƒ…é¡µï¼Œå› ä¸ºå‘ç”Ÿäº†**äº‹ä»¶å†’æ³¡**ï¼Œéœ€è¦é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼›

### è¯¦æƒ…é¡µ

#### å›¾ç‰‡æµè§ˆå™¨

##### é¡¶éƒ¨å’Œä¸­éƒ¨

ç‚¹å‡»ä»»æ„å›¾ç‰‡æˆ–æŸ¥çœ‹æŒ‰é’®å¯æ‰“å¼€å›¾ç‰‡æµè§ˆå™¨ï¼Œå…³é—­æŒ‰é’®å…³é—­ï¼›

**é“ºæ»¡æ•´ä¸ªå±å¹•ï¼Œæ²¡æœ‰æ»šåŠ¨æ¡**ï¼›

ç”±äº detail é¡µé¢å†…å®¹å¤šäº§ç”Ÿæ»šåŠ¨æ¡ï¼Œå¯¼è‡´æ‰“å¼€å›¾ç‰‡æµè§ˆå™¨æ—¶ä¹Ÿæœ‰ï¼Œéœ€è¦å»æ‰ï¼›

å½“å›¾ç‰‡æµè§ˆå™¨æ˜¾ç¤ºæ—¶ï¼Œéœ€è¦æ»šåŠ¨åŠŸèƒ½æ¶ˆå¤±ï¼Œå½“å›¾ç‰‡æµè§ˆå™¨å…³é—­æ—¶æ¢å¤ï¼›

åŠ ä¸Šåˆ‡æ¢å›¾ç‰‡æ—¶çš„åŠ¨ç”»ï¼Œä½¿ç”¨**react-transition-group**åº“ï¼›

**PictureBrowser**

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useState } from "react";
import { CSSTransition, SwitchTransition } from "react-transition-group";

import { BrowserWrapper } from "./style";
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";
import IconClose from "@/assets/svg/icon_close";

const PictureBrowser = memo((props) => {
  const { pictureUrls, closeHandle } = props;
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isNext, setIsNext] = useState(false);
  // å½“å›¾ç‰‡æµè§ˆå™¨æ˜¾ç¤ºæ—¶ï¼Œéœ€è¦æ»šåŠ¨åŠŸèƒ½æ¶ˆå¤±
  useEffect(() => {
    document.body.style.overflow = "hidden";
    return () => {
      document.body.style.overflow = "auto";
    };
  }, []);
  // äº‹ä»¶å¤„ç†
  function closeClick() {
    // é€šçŸ¥çˆ¶ç»„ä»¶å…³é—­å›¾ç‰‡æµè§ˆå™¨
    if (closeHandle) closeHandle();
  }

  function controlClick(isRight = true) {
    let newIndex = isRight ? currentIndex + 1 : currentIndex - 1;
    if (newIndex < 0) newIndex = pictureUrls.length - 1;
    if (newIndex > pictureUrls.length - 1) newIndex = 0;
    setCurrentIndex(newIndex);
    setIsNext(isRight);
  }
  return (
    <BrowserWrapper isNext={isNext}>
      <div className="top">
        <div className="close-btn" onClick={closeClick}>
          <IconClose />
        </div>
      </div>
      <div className="slider">
        <div className="control">
          <div className="btn left" onClick={(e) => controlClick(false)}>
            <IconArrowLeft height="77" width="77" />
          </div>
          <div className="btn right" onClick={(e) => controlClick(false)}>
            <IconArrowRight height="77" width="77" />
          </div>
        </div>
        <div className="picture">
          <SwitchTransition mode="in-out">
            <CSSTransition
              key={pictureUrls[currentIndex]}
              classNames="pic"
              timeout={200}
            >
              <img src={pictureUrls[currentIndex]} alt="" />
            </CSSTransition>
          </SwitchTransition>
        </div>
      </div>
      <div className="preview"></div>
    </BrowserWrapper>
  );
});

PictureBrowser.propTypes = {
  pictureUrls: PropTypes.array,
};

export default PictureBrowser;
```

**å¯¹åº”æ ·å¼**

```js
import styled from "styled-components";

export const BrowserWrapper = styled.div`
  position: fixed;
  display: flex;
  flex-direction: column;
  z-index: 999;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-color: #333;

  .top {
    position: relative;
    height: 86px;
    background-color: #333;

    .close-btn {
      position: absolute;
      top: 15px;
      right: 25px;
      cursor: pointer;
    }
  }

  .slider {
    display: flex;
    justify-content: center;
    flex: 1;

    .control {
      position: absolute;
      z-index: 1;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      justify-content: space-between;
      color: #fff;

      .btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 83px;
        height: 100%;
        cursor: pointer;
      }
    }

    .picture {
      position: relative;
      height: 100%;
      overflow: hidden;
      width: 100%;
      max-width: 105vh;

      img {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        margin: 0 auto;
        height: 100%;
        user-select: none;
      }

      /* åŠ¨ç”»æ ·å¼ */
      /* è¿›å…¥ */
      .pic-enter {
        transform: translateX(${(props) => (props.isNext ? "100%" : "-100%")});
        opacity: 0;
      }
      .pic-enter-active {
        transform: translate(0);
        opacity: 1;
        transition: all 200 ease;
      }
      /* ç¦»å¼€ */
      .pic-exit {
        opacity: 1;
      }
      .pic-exit-active {
        opacity: 0;
        transition: all 200 ease;
      }
    }
  }

  .preview {
    height: 100px;
    margin-top: 10px;
  }
`;
```

##### åº•éƒ¨æŒ‡ç¤ºå™¨

**PictureBrowser**

```jsx
import PropTypes from "prop-types";
import React, { memo, useEffect, useState } from "react";
import { CSSTransition, SwitchTransition } from "react-transition-group";

import { BrowserWrapper } from "./style";
import IconArrowLeft from "@/assets/svg/icon-arrow-left";
import IconArrowRight from "@/assets/svg/icon-arrow-right";
import IconClose from "@/assets/svg/icon_close";
import IconTriangleArrowBottom from "@/assets/svg/icon_triangle_arrow_bottom";
import Indicator from "../indicator";
import classNames from "classnames";
import IconTriangleArrowTop from "@/assets/svg/icon_triangle_arrow_top";

const PictureBrowser = memo((props) => {
  const { pictureUrls, closeHandle } = props;
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isNext, setIsNext] = useState(false);
  const [showList, setShowList] = useState(true);
  // å½“å›¾ç‰‡æµè§ˆå™¨æ˜¾ç¤ºæ—¶ï¼Œéœ€è¦æ»šåŠ¨åŠŸèƒ½æ¶ˆå¤±
  useEffect(() => {
    document.body.style.overflow = "hidden";
    return () => {
      document.body.style.overflow = "auto";
    };
  }, []);
  // äº‹ä»¶å¤„ç†
  function closeClick() {
    // é€šçŸ¥çˆ¶ç»„ä»¶å…³é—­å›¾ç‰‡æµè§ˆå™¨
    if (closeHandle) closeHandle();
  }

  function controlClick(isRight = true) {
    let newIndex = isRight ? currentIndex + 1 : currentIndex - 1;
    if (newIndex < 0) newIndex = pictureUrls.length - 1;
    if (newIndex > pictureUrls.length - 1) newIndex = 0;
    setCurrentIndex(newIndex);
    setIsNext(isRight);
  }

  function bottomClick(index) {
    // ç‚¹å³ä¾§æ—¶å›¾ç‰‡ä»å³è¿›ï¼Œç‚¹å·¦ä¾§åˆ™ç›¸å
    setIsNext(index > currentIndex);
    setCurrentIndex(index);
  }
  return (
    <BrowserWrapper isNext={isNext} showList={showList}>
      <div className="top">
        <div className="close-btn" onClick={closeClick}>
          <IconClose />
        </div>
      </div>
      <div className="slider">
        <div className="control">
          <div className="btn left" onClick={(e) => controlClick(false)}>
            <IconArrowLeft height="77" width="77" />
          </div>
          <div className="btn right" onClick={(e) => controlClick(false)}>
            <IconArrowRight height="77" width="77" />
          </div>
        </div>
        <div className="picture">
          <SwitchTransition mode="in-out">
            <CSSTransition
              key={pictureUrls[currentIndex]}
              classNames="pic"
              timeout={200}
            >
              <img src={pictureUrls[currentIndex]} alt="" />
            </CSSTransition>
          </SwitchTransition>
        </div>
      </div>
      <div className="preview">
        <div className="info">
          <div className="desc">
            <div className="count">
              <span>
                {currentIndex + 1}/{pictureUrls.length}:
              </span>
              <span>room apartmentå›¾ç‰‡{currentIndex + 1}</span>
            </div>
            <div className="toggle" onClick={(e) => setShowList(!showList)}>
              <span>{showList ? "éšè—" : "æ˜¾ç¤º"}ç…§ç‰‡åˆ—è¡¨</span>
              {showList ? (
                <IconTriangleArrowBottom />
              ) : (
                <IconTriangleArrowTop />
              )}
            </div>
          </div>
          <div className="list">
            <Indicator selectedIndex={currentIndex}>
              {pictureUrls.map((item, index) => {
                return (
                  <div
                    className={classNames("item", {
                      active: currentIndex === index,
                    })}
                    key={item}
                    onClick={(e) => bottomClick(index)}
                  >
                    <img src={item} alt="" />
                  </div>
                );
              })}
            </Indicator>
          </div>
        </div>
      </div>
    </BrowserWrapper>
  );
});

PictureBrowser.propTypes = {
  pictureUrls: PropTypes.array,
};

export default PictureBrowser;
```

**å¯¹åº”æ ·å¼**

```js
/*
 * @Description: å¾…ç¼–è¾‘
 * @Author: SiFeng Zhai
 * @Date: 2023-02-03 09:28:47
 * @LastEditors: SiFeng Zhai
 * @LastEditTime: 2023-02-04 15:26:25
 */
import styled from "styled-components";

export const BrowserWrapper = styled.div`
  position: fixed;
  display: flex;
  flex-direction: column;
  z-index: 999;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-color: #333;

  .top {
    position: relative;
    height: 86px;
    background-color: #333;

    .close-btn {
      position: absolute;
      top: 15px;
      right: 25px;
      cursor: pointer;
    }
  }

  .slider {
    position: relative;
    display: flex;
    justify-content: center;
    flex: 1;

    .control {
      position: absolute;
      z-index: 1;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      justify-content: space-between;
      color: #fff;

      .btn {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 83px;
        height: 100%;
        cursor: pointer;
      }
    }

    .picture {
      position: relative;
      height: 100%;
      overflow: hidden;
      width: 100%;
      max-width: 105vh;

      img {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        margin: 0 auto;
        height: 100%;
        user-select: none;
      }

      /* åŠ¨ç”»æ ·å¼ */
      /* è¿›å…¥ */
      .pic-enter {
        transform: translateX(${(props) => (props.isNext ? "100%" : "-100%")});
        opacity: 0;
      }
      .pic-enter-active {
        transform: translate(0);
        opacity: 1;
        transition: all 200 ease;
      }
      /* ç¦»å¼€ */
      .pic-exit {
        opacity: 1;
      }
      .pic-exit-active {
        opacity: 0;
        transition: all 200 ease;
      }
    }
  }

  .preview {
    display: flex;
    justify-content: center;
    height: 100px;
    margin-top: 10px;

    .info {
      position: absolute;
      bottom: 10px;
      max-width: 105vh;
      color: #fff;

      .desc {
        display: flex;
        justify-content: space-between;

        .toggle {
          cursor: pointer;
        }
      }

      .list {
        margin-top: 3px;
        overflow: hidden;
        transition: height 300ms ease;
        height: ${(props) => (props.showList ? "67px" : "0")};

        .item {
          margin-right: 15px;
          cursor: pointer;

          img {
            height: 67px;
            opacity: 0.5;
          }

          &.active {
            img {
              opacity: 1;
            }
          }
        }
      }
    }
  }
`;
```

## å¾…å›é¡¾

### React.createRef()

### useImperativeHandle()

### useLocation()

### React.lazy

## style-component

```tsx
export const TreeSelectContainer = styled.div<{
  allowClear?: boolean;
  compactMode: boolean;
  isValid: boolean;
  labelPosition?: LabelPosition;
  borderRadius: string;
  boxShadow?: string;
  accentColor: string;
}>`

æ ·å¼è§„åˆ™
`;
```

`styled` å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œç”¨äºå®šä¹‰ç»„ä»¶çš„æ ·å¼è§„åˆ™ï¼›

ä¸Šè¿°å‡ ä¸ªå˜é‡æ˜¯å¯ä»¥åœ¨ css ä½¿ç”¨çš„ propsï¼›

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ ·å¼åŒ–çš„ç»„ä»¶ï¼š

```tsx
import React from "react";
import { TreeSelectContainer } from "./TreeSelectContainer";

const MyComponent = () => {
  return (
    <TreeSelectContainer
      allowClear={true}
      compactMode={false}
      isValid={true}
      labelPosition="left"
      borderRadius="4px"
      boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"
      accentColor="#ff0000"
    >
      {/* ç»„ä»¶çš„å†…å®¹ */}
    </TreeSelectContainer>
  );
};

export default MyComponent;
```

## ç»éªŒç§¯ç´¯

- ä¿®æ”¹ç»„ä»¶é€»è¾‘å‰ï¼Œä¸€å®šè¦æ¸…æ¥šç»„ä»¶è¢«å“ªäº›åœ°æ–¹å¼•ç”¨åˆ°ï¼›

## mini-react

### åŸç”Ÿ

1. åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹
2. å¯¹åº”vdom
3. åŠ¨æ€åˆ›å»ºä¸€ä¸ªvdom

> å¦‚ä½•åˆ›å»ºä¸€ä¸ªAppèŠ‚ç‚¹ï¼Ÿ

index.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="app"></div>
    <script type="module" src="index.js"></script>
</body>
</html>
```

index.js

```js
// åˆ›å»ºèŠ‚ç‚¹ï¼Œè®¾ç½®èŠ‚ç‚¹å±æ€§ï¼Œæ·»åŠ åˆ°æ ¹å®¹å™¨
const dom = document.createElement('div')
dom.id = 'app'
const root = document.querySelector('#app')
root.appendChild(dom)

// åˆ›å»ºå­èŠ‚ç‚¹ï¼Œè®¾ç½®èŠ‚ç‚¹å†…å®¹ï¼Œæ·»åŠ åˆ°èŠ‚ç‚¹
const textNode = document.createTextNode('App')
textNode.nodeValue = 'App'
dom.appendChild(textNode)
```

> ä½¿ç”¨vdomçš„å½¢å¼

index.js

```js
const textEl = {
    type: 'TEXT_ELEMENT',
    props: {
        nodeValue: 'App',
        children: []
    }
}
const el = {
    type: 'div',
    props: {
        id: 'app',
        children: [textEl]
    }
}

const dom = document.createElement(el.type)
dom.id = el.props.id
const root = document.querySelector('#app')
root.appendChild(dom)

const textNode = document.createTextNode('')
textNode.nodeValue = textEl.props.nodeValue
dom.appendChild(textNode)
```

æ”¹æˆå‡½æ•°å½¢å¼åˆ›å»ºvdom

```js
const createTextNode = (text) => {
    return {
        type: 'TEXT_ELEMENT',
        props: {
            nodeValue: text,
            children: []
        }
    }
}

const createElement = (type, props, ...children) => {
    return {
        type,
        props: {
            ...props,
            children
        }
    }
}
const textEl = createTextNode('App')
const App = createElement('div', { id: 'app' }, textEl)

const dom = document.createElement(App.type)
dom.id = App.props.id
const root = document.querySelector('#app')
root.appendChild(dom)

const textNode = document.createTextNode('')
textNode.nodeValue = textEl.props.nodeValue
dom.appendChild(textNode)
```

> åŠ¨æ€åˆ›å»ºvdom

è§‚å¯Ÿä¸Šè¿°åˆ›å»ºvdomæ­¥éª¤ï¼Œå¯æŠ½è±¡æˆ3ä¸ªæ­¥éª¤ï¼š

1. åˆ›å»ºèŠ‚ç‚¹
2. è®¾ç½®props
3. appendè¿›çˆ¶çº§å®¹å™¨

```js
const createTextNode = (text) => {
    return {
        type: 'TEXT_ELEMENT',
        props: {
            nodeValue: text,
            children: []
        }
    }
}

const createElement = (type, props, ...children) => {
    return {
        type,
        props: {
            ...props,
            children: children.map(child => typeof child === 'string' ? createTextNode(child) : child) // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–‡æœ¬èŠ‚ç‚¹
        }
    }
}
// æŠ½è±¡åˆ›å»ºvdom
const render = (element, parentDom) => {
    // åˆ›å»ºdom
    const dom = element.type === 'TEXT_ELEMENT' ? document.createTextNode('') : document.createElement(element.type)
    
    // è®¾ç½®props: id class ...
    Object.keys(element.props).forEach((key) => {
        if (key === 'children') {
            element.props.children.forEach((child) => {
                render(child, dom)
            })
        } else {
            dom[key] = element.props[key]
        }
    })



    // æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹
    parentDom.appendChild(dom)
}

const App = createElement('div', { id: 'app' }, 'app', 'hello')
const root = document.querySelector('#app')
render(App, root)
```

### æ¨¡æ‹Ÿreact

```js
// ç›®æ ‡ï¼šæ¨¡æ‹Ÿreactçš„æ–¹å¼
import ReactDom from 'react-dom/client';
import App from './App';

ReactDom.createRoot(document.getElementById('root')).render(App);
```

å®ç°

```js
const createTextNode = (text) => {
    return {
        type: 'TEXT_ELEMENT',
        props: {
            nodeValue: text,
            children: []
        }
    }
}

const createElement = (type, props, ...children) => {
    return {
        type,
        props: {
            ...props,
            children: children.map(child => typeof child === 'string' ? createTextNode(child) : child) // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–‡æœ¬èŠ‚ç‚¹
        }
    }
}
// æŠ½è±¡åˆ›å»ºvdom
const render = (element, parentDom) => {
    // åˆ›å»ºdom
    const dom = element.type === 'TEXT_ELEMENT' ? document.createTextNode('') : document.createElement(element.type)
    
    // è®¾ç½®props: id class ...
    Object.keys(element.props).forEach((key) => {
        if (key === 'children') {
            element.props.children.forEach((child) => {
                render(child, dom)
            })
        } else {
            dom[key] = element.props[key]
        }
    })

    // æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹
    parentDom.appendChild(dom)
}
const App = createElement('div', { id: 'app' }, 'app', ' hi')
const root = document.querySelector('#app')
const ReactDom = {
    createRoot(container) {
        return {
            render(element) {
                render(element, container)
            }
        }
    }
}

ReactDom.createRoot(root).render(App)
```

### ä¸šåŠ¡æ¡†æ¶åˆ†ç¦»

core/react.js

```js
const createTextNode = (text) => {
    return {
        type: 'TEXT_ELEMENT',
        props: {
            nodeValue: text,
            children: []
        }
    }
}

const createElement = (type, props, ...children) => {
    return {
        type,
        props: {
            ...props,
            children: children.map(child => typeof child === 'string' ? createTextNode(child) : child) // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–‡æœ¬èŠ‚ç‚¹
        }
    }
}
const render = (element, parentDom) => {
    // åˆ›å»ºdom
    const dom = element.type === 'TEXT_ELEMENT' ? document.createTextNode('') : document.createElement(element.type)
    
    // è®¾ç½®props: id class ...
    Object.keys(element.props).forEach((key) => {
        if (key === 'children') {
            element.props.children.forEach((child) => {
                render(child, dom)
            })
        } else {
            dom[key] = element.props[key]
        }
    })

    // æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹
    parentDom.appendChild(dom)
}

const React = {
    createElement,
    render
}

export default React;

```

core/reactDom.js

```js
import React from './react.js';

const ReactDom = {
    createRoot(container) {
        return {
            render(element) {
                React.render(element, container)
            }
        }
    }
}

export default ReactDom;
```



/raw/App.js

```js
import React from '../core/react.js';

const App = React.createElement('div', { id: 'app' }, 'app', ' hi')

export default App;
```



/raw/index.js

```js 
import ReactDom from '../core/reactDom.js';
import App from './App.js';
ReactDom.createRoot(document.getElementById('root')).render(App)
```

/raw/index.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="root"></div>
    <script type="module" src="index.js"></script>
</body>
</html>
```





## ç–‘éš¾æ‚ç—‡

### æŸä¸ªç»„ä»¶è¢«é«˜é˜¶ç»„ä»¶åŒ…è£¹ï¼Œæ— æ³•è®¿é—®é™æ€å±æ€§

ä½¿ç”¨ hoist-non-react-statics åº“

### immer

> :question:Error: [Immer] An immer producer returned a new value _and_ modified its draft. Either return a new value _or_ modify the draft.

immer åº“æŠ¥å‡ºçš„è­¦å‘Šï¼Œä¸èƒ½åœ¨åŒä¸€ä¸ª producer å‡½æ•°ä¸­æ—¢ä¿®æ”¹ draft åˆè¿”å›æ–°çš„å€¼

å¦‚ä½•ç»™ style-componet çš„ç»„ä»¶æ·»åŠ äº‹ä»¶ï¼Ÿ

### å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿ç”¨ useState çš„æœ€æ–°çŠ¶æ€

```tsx
const [xxx, setXxx] = useState(null);
```

æŸäº›æƒ…å†µä¸‹ï¼Œç”±äº React çš„å¼‚æ­¥æ›´æ–°æœºåˆ¶ï¼Œ`xxx`å¹¶ä¸æ˜¯æœ€æ–°çš„çŠ¶æ€ï¼Œä½¿ç”¨ï¼›

å¯ä»¥ä½¿ç”¨`setXxx` çš„å‡½æ•°å½¢å¼ï¼š

```tsx
setGData((prev) => {
  // åœ¨è¿™é‡Œï¼Œprev æ˜¯æœ€æ–°çš„ xxxï¼Œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†prevï¼Œå¹¶è¿”å›æ–°çš„xxx
  // å¤„ç†prev
  return æ–°çš„xxx;
});
```

### åœ¨å‡½æ•°å¼ç»„ä»¶å¤–éƒ¨æ€ä¹ˆè·å–æŸä¸ªæ¨¡å—çš„ state

### react ä¸­ä½¿ç”¨ svg

- import å¯¼

  å…¥

- ç»„ä»¶å¯¼å…¥

å¯¼å…¥ SVG æ–‡ä»¶å¹¶åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨æ—¶ï¼ŒSVG æ–‡ä»¶å†…å®¹é€šå¸¸ä¼šè¢«è§£æä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¸²æŸ“ä¸ºå›¾åƒã€‚è¿™æ˜¯å› ä¸ºåœ¨ React ä¸­ï¼ŒSVG æ–‡ä»¶é€šå¸¸è¢«è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„ XML æ•°æ®ï¼Œè€Œä¸æ˜¯æ™®é€šçš„å›¾åƒã€‚

**ä½¿ç”¨ `import` å¯¼å…¥ SVG æ–‡ä»¶**

å¯¼å…¥ SVG æ–‡ä»¶å¹¶å°†å…¶åˆ†é…ç»™ä¸€ä¸ªå˜é‡ï¼Œå°±åƒæ­£å¸¸å¯¼å…¥å…¶ä»–æ¨¡å—ä¸€æ ·ï¼š

```ts
import React from "react";
import mySvg from "./my-svg-file.svg";

function MyComponent() {
  return (
    <div>
      {/* ä½¿ç”¨å¯¼å…¥çš„ SVG æ–‡ä»¶ */}
      <img src={mySvg} alt="My SVG" />
    </div>
  );
}

export default MyComponent;
```

**å°† SVG ä½œä¸ºç»„ä»¶ä½¿ç”¨ï¼š** è¿˜å¯ä»¥å°† SVG æ–‡ä»¶ä½œä¸º React ç»„ä»¶ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å°†å…¶ç›´æ¥å‘ˆç°ä¸ºå›¾åƒã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°† SVG æ–‡ä»¶çš„å†…å®¹åŒ…è£…åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¯¥ç»„ä»¶ã€‚è¿™å¯ä»¥æ›´çµæ´»åœ°æ“ä½œ SVG å†…å®¹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```ts
javascriptCopy codeimport React from 'react';
import MySvgComponent from './MySvgComponent';

function MyComponent() {
  return (
    <div>
      {/* ä½¿ç”¨ SVG ç»„ä»¶ */}
      <MySvgComponent />
    </div>
  );
}

export default MyComponent;
```

**æ³¨æ„ï¼šsvg å½“ç»„ä»¶æ—¶è®°å¾—å°†æœ‰è¿æ¥ç¬¦-çš„å±æ€§æ¢æˆé©¼å³°**

æŠ¥é”™ä¿¡æ¯ï¼š

```
Warning:
```

### Warning

**æŠ¥é”™ä¿¡æ¯ï¼š**

> Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?

è¿™ä¸ªè­¦å‘Šæ˜¯å› ä¸ºä½ è¯•å›¾ç»™ä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ `StyledLink`ï¼‰ä¼ é€’ä¸€ä¸ª `ref`ï¼Œä½†æ˜¯å‡½æ•°ç»„ä»¶é»˜è®¤æ˜¯ä¸èƒ½æ¥æ”¶ `ref` çš„ã€‚

éœ€è¦ä½¿ç”¨ React.forwardRef()è¿›è¡Œ ref è½¬å‘

**æŠ¥é”™ä¿¡æ¯ï¼š**

> Encountered two children with the same key, `null`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted â€” the behavior is unsupported and could change in a future version.

åœ¨ React ä¸­ï¼Œå½“ä½ åœ¨æ¸²æŸ“ä¸€ä¸ªåˆ—è¡¨çš„æ—¶å€™ï¼Œæ¯ä¸ªåˆ—è¡¨é¡¹éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„ `key` å±æ€§ã€‚è¿™ä¸ª `key` å±æ€§å¸®åŠ© React è¯†åˆ«å“ªäº›é¡¹æœ‰å˜åŒ–ã€è¢«æ·»åŠ ã€æˆ–è¢«ç§»é™¤ã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼Œæœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šåˆ—è¡¨é¡¹çš„ `key` å±æ€§éƒ½æ˜¯ `null`

å¯ä»¥ä½¿ç”¨ index ä½œä¸ºå¤‡é€‰ key

**æŠ¥é”™ä¿¡æ¯ï¼š**

> Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in a useEffect cleanup function.

è¿™ä¸ªé”™è¯¯é€šå¸¸æ˜¯å› ä¸ºä½ åœ¨ç»„ä»¶å¸è½½åå°è¯•æ›´æ–°å…¶çŠ¶æ€,å¯ä»¥åœ¨ `useEffect` é’©å­çš„æ¸…ç†å‡½æ•°ä¸­å–æ¶ˆä»»ä½•å¯èƒ½å¯¼è‡´çŠ¶æ€æ›´æ–°çš„æ“ä½œ;

å¦ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯æ£€æŸ¥ç»„ä»¶æ˜¯å¦å·²ç»å¸è½½ï¼Œç„¶åå†æ›´æ–°çŠ¶æ€ã€‚

> type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
>
> Check your code at index.tsx:122.

> Prop `style` did not match. Server: "null" Client: "display:"

> An error occurred during hydration. The server HTML was replaced with client content in `<div>`.

> Cannot update a component (`GNavigationBarH5`) while rendering a different component (`CommonLayout`). To locate the bad setState() call inside `CommonLayout`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render

> Expected server HTML to contain a matching `<div>` in `<div>`.

### TypeError

æŠ¥é”™ä¿¡æ¯ï¼š

```
Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.
```

å¯¹éç±»æ•°ç»„å¯¹è±¡è¿›è¡Œå±•å¼€è¿ç®—ï¼›

é”™è¯¯ä¿¡æ¯ï¼š

> N is not a function located in the react-dom.production.min.js

é”™è¯¯æºï¼š

```tsx
useEffect(() => {
  fetchCaptcha();
}, []);
const fetchCaptcha = async () => {
  const res: any = await UserApi.fetchCaptcha();
  const codeImg = window.URL.createObjectURL(res);
  setCaptchaBlob(codeImg);
};
```

åŸå› ï¼š

> const å£°æ˜çš„å˜é‡ã€å‡½æ•°ä¸ä¼šæå‡

ä¿®æ”¹åï¼š

```tsx
const fetchCaptcha = async () => {
  const res: any = await UserApi.fetchCaptcha();
  const codeImg = window.URL.createObjectURL(res);
  setCaptchaBlob(codeImg);
};
useEffect(() => {
  fetchCaptcha();
}, []);
```

å‚è€ƒï¼š

> https://stackoverflow.com/questions/75646528/react-router-dom-typeerror-n-is-not-a-function-on-route-reloading-page-works

### Uncaught Error

> There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.

> Hydration failed because the initial UI does not match what was rendered on the server

å‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºåœ¨æµè§ˆå™¨ä¸­ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´å‘ˆç°çš„ React æ ‘(ç§°ä¸ºæ°´åˆä½œç”¨)ä¸ä»æœåŠ¡å™¨é¢„æ¸²æŸ“çš„ React æ ‘ä¹‹é—´å­˜åœ¨ä¸åŒ¹é…

æ°´åˆåŒ–æ˜¯ React é€šè¿‡é™„åŠ **äº‹ä»¶å¤„ç†ç¨‹åº**å°†é¢„æ¸²æŸ“çš„ HTML è½¬æ¢ä¸º**äº¤äº’å¼åº”ç”¨**ç¨‹åºçš„è¿‡ç¨‹ã€‚æ°´åˆä½œç”¨é—®é¢˜å¯èƒ½ç”±å‡ ç§åŸå› å¼•èµ·:

- ä½¿ç”¨äº†**ä»…æµè§ˆå™¨**æ”¯æŒçš„ APIï¼ˆå¦‚ `typeof window !== 'undefined` ã€`localStorage`ï¼‰
- ä¸æ­£ç¡®çš„**å…ƒç´ åµŒå¥—**ï¼ˆå¦‚ a å…ƒç´ åŒ…è£¹ a å…ƒç´ ç­‰ï¼‰
- ä½¿ç”¨äº†**æµè§ˆå™¨æ’ä»¶**ï¼Œä¿®æ”¹äº† html å†…å®¹
- ç­‰

å‚è€ƒï¼šhttps://nextjs.org/docs/messages/react-hydration-error

### Rendered fewer hooks than expected. This may be caused by an accidental early return statement.

è¿™ä¸ªé”™è¯¯é€šå¸¸æ˜¯ç”±äºåœ¨ React ç»„ä»¶ä¸­æ¡ä»¶æ€§åœ°è°ƒç”¨ Hooks å¯¼è‡´çš„ã€‚åœ¨ React ä¸­ï¼Œä½ ä¸èƒ½åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hooksï¼Œå¿…é¡»ç¡®ä¿åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä»¥ç›¸åŒçš„é¡ºåºè°ƒç”¨æ‰€æœ‰çš„ Hooksã€‚

### Uncaught SyntaxError

> Unexpected token ':'

### ä¿®æ”¹ create-react-app é»˜è®¤å¯åŠ¨ç«¯å£ 3000

ä¿®æ”¹å¯åŠ¨è„šæœ¬

```json
"scripts": {
    "start": "set PORT=3001 && react-scripts start",
  },
```

å‚è€ƒé“¾æ¥

- https://create-react-app.dev/docs/adding-custom-environment-variables

### è‡ªå®šä¹‰ç»„ä»¶æ·»åŠ å›è½¦äº‹ä»¶ï¼Ÿ

å¦‚ä½•ç»™ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶æ·»åŠ å›è½¦äº‹ä»¶ï¼Œä½†æ˜¯è¯¥ç»„ä»¶çš„ `props` ä¸­å¹¶æ²¡æœ‰æä¾›ç›¸åº”çš„å›è½¦äº‹ä»¶å¤„ç†å‡½æ•°ï¼Ÿ

### antd ä¸­ Menu ç»„ä»¶è®¾ç½®ä¸»é¢˜

```jsx
import React from "react";
import { ConfigProvider, Button, Space, Input, Divider } from "antd";

const App: React.FC = () => (
  <>
    <ConfigProvider
      theme={{
        components: {
          Button: {
            colorPrimary: "#00b96b",
            algorithm: true, // å¯ç”¨ç®—æ³•
          },
          Input: {
            colorPrimary: "#eb2f96",
            algorithm: true, // å¯ç”¨ç®—æ³•
          },
        },
      }}
    >
      <Space>
        <div style={{ fontSize: 14 }}>å¼€å¯ç®—æ³•ï¼š</div>
        <Input placeholder="Please Input" />
        <Button type="primary">Submit</Button>
      </Space>
    </ConfigProvider>
  </>
);

export default App;
```

### Objects are not valid as a React child

Uncaught Error: Objects are not valid as a React child (found: object with keys {}). If you meant to render a collection of children, use an array instead.

è¿™ä¸ªé”™è¯¯é€šå¸¸å‘ç”Ÿåœ¨ä½¿ç”¨ React è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œå°è¯•å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸º React å­å…ƒç´ è¿›è¡Œæ¸²æŸ“ï¼Œè€Œä¸æ˜¯æœ‰æ•ˆçš„ React å…ƒç´ æˆ–ç»„ä»¶ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯¼è‡´è¯¥é”™è¯¯çš„ç¤ºä¾‹ï¼š

```js
const data = {
  name: "John",
  age: 30,
};

function App() {
  return (
    <div>
      {data} {/* é”™è¯¯çš„ç”¨æ³• */}
    </div>
  );
}
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦å°†å¯¹è±¡è½¬æ¢ä¸ºæœ‰æ•ˆçš„ React å…ƒç´ æˆ–ç»„ä»¶ï¼Œæˆ–è€…å°†å¯¹è±¡ä¸­çš„ç‰¹å®šå±æ€§æå–å‡ºæ¥è¿›è¡Œæ¸²æŸ“ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªä¿®æ­£çš„ç¤ºä¾‹ï¼š

å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¸²æŸ“ï¼š

```js
const data = {
  name: "John",
  age: 30,
};

function App() {
  return (
    <div>
      {JSON.stringify(data)} {/* å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¸²æŸ“ */}
    </div>
  );
}
```

æå–å¯¹è±¡å±æ€§è¿›è¡Œæ¸²æŸ“ï¼š

```js
const data = {
  name: "John",
  age: 30,
};

function App() {
  return (
    <div>
      <p>Name: {data.name}</p>
      <p>Age: {data.age}</p>
    </div>
  );
}
```

### Warning: validateDOMNesting(...): `<div>` cannot appear as a descendant of `<p>`.

è¿™ä¸ªè­¦å‘Šæ˜¯ç”± React æä¾›çš„ DOM ç»“æ„éªŒè¯æœºåˆ¶è§¦å‘çš„ã€‚å®ƒè¡¨ç¤ºåœ¨ HTML ä¸­ï¼Œ`<div>` å…ƒç´ ä¸èƒ½ä½œä¸º `<p>` å…ƒç´ çš„å­å…ƒç´ å‡ºç°ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†è§¦å‘è¯¥è­¦å‘Šçš„æƒ…å†µï¼š

```html
<p>
  è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚
  <div>è¿™æ˜¯ä¸€ä¸ª divã€‚</div>
</p>
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„ç¤ºä¾‹ï¼Œä¿®å¤äº†è¿™ä¸ªè­¦å‘Šï¼š

```html
<div>
  <p>è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚</p>
  <div>è¿™æ˜¯ä¸€ä¸ª divã€‚</div>
</div>
```

### è­¦å‘Š

> Image with src "http://120.78.165.27:8087/upload/ttmall/img/20240305/0a078df03c6ea35519add1a0a1335cfc.png=z-250,147_f-png" has either width or height modified, but not the other. If you use CSS to change the size of your image, also include the styles 'width: "auto"' or 'height: "auto"' to maintain the aspect ratio.

> Do not add `<script>` tags using next/head (see inline `<script>`). Use next/script instead.
> See more info here: https://nextjs.org/docs/messages/no-script-tags-in-head-component

> Third-party cookie will be blocked. Learn more in the Issues tab.

> The domain LOCALHOST is not authorized to show the cookie banner for domain group ID f9c46b56-5a60-4907-b929-105ac2e24049. Please add it to the domain group in the Cookiebot Manager to authorize the domain.

### React does not recognize the `data-widgetId` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `data-widgetid` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
